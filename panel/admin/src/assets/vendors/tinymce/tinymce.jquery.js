window.console && console.log('Use tinymce.js instead of tinymce.jquery.js.');
// 4.6.4 (2017-06-13)
(function () {

var defs = {}; // id -> {dependencies, definition, instance (possibly undefined)}

// Used when there is no 'main' module.
// The name is probably (hopefully) unique so minification removes for releases.
var register_3795 = function (id) {
  var module = dem(id);
  var fragments = id.split('.');
  var target = Function('return this;')();
  for (var i = 0; i < fragments.length - 1; ++i) {
    if (target[fragments[i]] === undefined)
      target[fragments[i]] = {};
    target = target[fragments[i]];
  }
  target[fragments[fragments.length - 1]] = module;
};

var instantiate = function (id) {
  var actual = defs[id];
  var dependencies = actual.deps;
  var definition = actual.defn;
  var len = dependencies.length;
  var instances = new Array(len);
  for (var i = 0; i < len; ++i)
    instances[i] = dem(dependencies[i]);
  var defResult = definition.apply(null, instances);
  if (defResult === undefined)
     throw 'module [' + id + '] returned undefined';
  actual.instance = defResult;
};

var def = function (id, dependencies, definition) {
  if (typeof id !== 'string')
    throw 'module id must be a string';
  else if (dependencies === undefined)
    throw 'no dependencies for ' + id;
  else if (definition === undefined)
    throw 'no definition function for ' + id;
  defs[id] = {
    deps: dependencies,
    defn: definition,
    instance: undefined
  };
};

var dem = function (id) {
  var actual = defs[id];
  if (actual === undefined)
    throw 'module [' + id + '] was undefined';
  else if (actual.instance === undefined)
    instantiate(id);
  return actual.instance;
};

var req = function (ids, callback) {
  var len = ids.length;
  var instances = new Array(len);
  for (var i = 0; i < len; ++i)
    instances.push(dem(ids[i]));
  callback.apply(null, callback);
};

var ephox = {};

ephox.bolt = {
  module: {
    api: {
      define: def,
      require: req,
      demand: dem
    }
  }
};

var define = def;
var require = req;
var demand = dem;
// this helps with minificiation when using a lot of global references
var defineGlobal = function (id, ref) {
  define(id, [], function () { return ref; });
};
/*jsc
["tinymce.core.api.Main","tinymce.core.api.Tinymce","tinymce.core.Register","tinymce.core.geom.Rect","tinymce.core.util.Promise","tinymce.core.util.Delay","tinymce.core.Env","tinymce.core.dom.EventUtils","tinymce.core.dom.Sizzle","tinymce.core.util.Tools","tinymce.core.dom.DomQuery","tinymce.core.html.Styles","tinymce.core.dom.TreeWalker","tinymce.core.html.Entities","tinymce.core.dom.DOMUtils","tinymce.core.dom.ScriptLoader","tinymce.core.AddOnManager","tinymce.core.dom.RangeUtils","tinymce.core.html.Node","tinymce.core.html.Schema","tinymce.core.html.SaxParser","tinymce.core.html.DomParser","tinymce.core.html.Writer","tinymce.core.html.Serializer","tinymce.core.dom.Serializer","tinymce.core.util.VK","tinymce.core.dom.ControlSelection","tinymce.core.dom.BookmarkManager","tinymce.core.dom.Selection","tinymce.core.Formatter","tinymce.core.UndoManager","tinymce.core.EditorCommands","tinymce.core.util.URI","tinymce.core.util.Class","tinymce.core.util.EventDispatcher","tinymce.core.util.Observable","tinymce.core.WindowManager","tinymce.core.NotificationManager","tinymce.core.EditorObservable","tinymce.core.Shortcuts","tinymce.core.Editor","tinymce.core.util.I18n","tinymce.core.FocusManager","tinymce.core.EditorManager","tinymce.core.util.XHR","tinymce.core.util.JSON","tinymce.core.util.JSONRequest","tinymce.core.util.JSONP","tinymce.core.util.LocalStorage","tinymce.core.api.Compat","tinymce.core.util.Color","tinymce.core.ui.Api","tinymce.core.util.Arr","tinymce.core.dom.Range","tinymce.core.dom.StyleSheetLoader","tinymce.core.dom.NodeType","tinymce.core.caret.CaretContainer","tinymce.core.text.Zwsp","ephox.katamari.api.Fun","tinymce.core.dom.RangePoint","tinymce.core.caret.CaretBookmark","tinymce.core.caret.CaretPosition","ephox.sugar.api.dom.Compare","ephox.sugar.api.node.Element","tinymce.core.dom.ScrollIntoView","tinymce.core.dom.TridentSelection","tinymce.core.selection.FragmentReader","tinymce.core.dom.ElementUtils","tinymce.core.util.Fun","tinymce.core.fmt.Preview","tinymce.core.fmt.Hooks","tinymce.core.undo.Levels","tinymce.core.delete.DeleteCommands","tinymce.core.InsertContent","global!document","tinymce.core.ui.Window","tinymce.core.ui.MessageBox","tinymce.core.ui.Notification","tinymce.core.EditorSettings","tinymce.core.init.Render","tinymce.core.Mode","tinymce.core.ui.Sidebar","tinymce.core.util.Uuid","tinymce.core.ErrorReporter","tinymce.core.LegacyInput","tinymce.core.ui.Selector","tinymce.core.ui.Collection","tinymce.core.ui.ReflowQueue","tinymce.core.ui.Control","tinymce.core.ui.Factory","tinymce.core.ui.KeyboardNavigation","tinymce.core.ui.Container","tinymce.core.ui.DragHelper","tinymce.core.ui.Scrollable","tinymce.core.ui.Panel","tinymce.core.ui.Movable","tinymce.core.ui.Resizable","tinymce.core.ui.FloatPanel","tinymce.core.ui.Tooltip","tinymce.core.ui.Widget","tinymce.core.ui.Progress","tinymce.core.ui.Layout","tinymce.core.ui.AbsoluteLayout","tinymce.core.ui.Button","tinymce.core.ui.ButtonGroup","tinymce.core.ui.Checkbox","tinymce.core.ui.ComboBox","tinymce.core.ui.ColorBox","tinymce.core.ui.PanelButton","tinymce.core.ui.ColorButton","tinymce.core.ui.ColorPicker","tinymce.core.ui.Path","tinymce.core.ui.ElementPath","tinymce.core.ui.FormItem","tinymce.core.ui.Form","tinymce.core.ui.FieldSet","tinymce.core.ui.FilePicker","tinymce.core.ui.FitLayout","tinymce.core.ui.FlexLayout","tinymce.core.ui.FlowLayout","tinymce.core.ui.FormatControls","tinymce.core.ui.GridLayout","tinymce.core.ui.Iframe","tinymce.core.ui.InfoBox","tinymce.core.ui.Label","tinymce.core.ui.Toolbar","tinymce.core.ui.MenuBar","tinymce.core.ui.MenuButton","tinymce.core.ui.MenuItem","tinymce.core.ui.Throbber","tinymce.core.ui.Menu","tinymce.core.ui.ListBox","tinymce.core.ui.Radio","tinymce.core.ui.ResizeHandle","tinymce.core.ui.SelectBox","tinymce.core.ui.Slider","tinymce.core.ui.Spacer","tinymce.core.ui.SplitButton","tinymce.core.ui.StackLayout","tinymce.core.ui.TabPanel","tinymce.core.ui.TextBox","ephox.katamari.api.Arr","global!Array","global!Error","ephox.katamari.api.Future","ephox.katamari.api.Futures","ephox.katamari.api.Result","tinymce.core.geom.ClientRect","tinymce.core.caret.CaretCandidate","tinymce.core.text.ExtendingChar","ephox.sand.api.Node","ephox.sand.api.PlatformDetection","ephox.sugar.api.search.Selectors","global!console","ephox.sugar.api.dom.Insert","ephox.sugar.api.dom.Replication","ephox.sugar.api.node.Fragment","ephox.sugar.api.node.Node","tinymce.core.dom.ElementType","tinymce.core.dom.Parents","tinymce.core.selection.SelectionUtils","tinymce.core.undo.Fragments","tinymce.core.delete.BlockBoundaryDelete","tinymce.core.delete.BlockRangeDelete","tinymce.core.delete.CefDelete","tinymce.core.delete.InlineBoundaryDelete","tinymce.core.caret.CaretWalker","tinymce.core.dom.RangeNormalizer","tinymce.core.InsertList","tinymce.core.data.ObservableObject","tinymce.core.ui.DomUtils","tinymce.core.ui.BoxUtils","tinymce.core.ui.ClassList","global!window","tinymce.core.init.Init","tinymce.core.PluginManager","tinymce.core.ThemeManager","tinymce.core.content.LinkTargets","tinymce.core.fmt.FontInfo","ephox.katamari.api.Option","global!String","ephox.katamari.api.LazyValue","ephox.katamari.async.Bounce","ephox.katamari.async.AsyncValues","ephox.sand.util.Global","ephox.katamari.api.Thunk","ephox.sand.core.PlatformDetection","global!navigator","ephox.sugar.api.node.NodeTypes","ephox.sugar.api.search.Traverse","ephox.sugar.api.properties.Attr","ephox.sugar.api.dom.InsertAll","ephox.sugar.api.dom.Remove","ephox.katamari.api.Options","tinymce.core.undo.Diff","tinymce.core.delete.BlockBoundary","tinymce.core.delete.MergeBlocks","tinymce.core.delete.DeleteUtils","tinymce.core.caret.CaretUtils","tinymce.core.delete.CefDeleteAction","tinymce.core.delete.DeleteElement","tinymce.core.caret.CaretFinder","tinymce.core.keyboard.BoundaryCaret","tinymce.core.keyboard.BoundaryLocation","tinymce.core.keyboard.BoundarySelection","tinymce.core.keyboard.InlineUtils","tinymce.core.data.Binding","tinymce.core.init.InitContentBody","global!Object","global!setTimeout","ephox.katamari.api.Resolve","ephox.sand.core.Browser","ephox.sand.core.OperatingSystem","ephox.sand.detect.DeviceType","ephox.sand.detect.UaString","ephox.sand.info.PlatformInfo","ephox.katamari.api.Type","ephox.katamari.api.Struct","ephox.sugar.alien.Recurse","ephox.katamari.api.Obj","ephox.sugar.api.search.PredicateFind","tinymce.core.dom.Empty","ephox.katamari.api.Adt","tinymce.core.text.Bidi","tinymce.core.caret.CaretContainerInline","tinymce.core.caret.CaretContainerRemove","tinymce.core.util.LazyEvaluator","ephox.katamari.api.Cell","tinymce.core.caret.CaretContainerInput","tinymce.core.EditorUpload","tinymce.core.ForceBlocks","tinymce.core.keyboard.KeyboardOverrides","tinymce.core.NodeChange","tinymce.core.SelectionOverrides","tinymce.core.util.Quirks","ephox.katamari.api.Global","ephox.sand.detect.Version","ephox.katamari.api.Strings","ephox.katamari.data.Immutable","ephox.katamari.data.MixedBag","ephox.sugar.api.node.Body","ephox.sugar.impl.ClosestOrAncestor","ephox.sugar.api.search.SelectorExists","tinymce.core.file.Uploader","tinymce.core.file.ImageScanner","tinymce.core.file.BlobCache","tinymce.core.file.UploadStatus","tinymce.core.keyboard.ArrowKeys","tinymce.core.keyboard.DeleteBackspaceKeys","tinymce.core.keyboard.EnterKey","tinymce.core.keyboard.SpaceKey","tinymce.core.caret.FakeCaret","tinymce.core.caret.LineUtils","tinymce.core.DragDropOverrides","tinymce.core.EditorView","tinymce.core.keyboard.CefUtils","tinymce.core.dom.NodePath","global!Number","ephox.katamari.str.StrAppend","ephox.katamari.str.StringParts","ephox.katamari.util.BagUtils","ephox.sugar.api.search.SelectorFind","tinymce.core.file.Conversions","global!URL","tinymce.core.keyboard.CefNavigation","tinymce.core.keyboard.MatchKeys","tinymce.core.keyboard.InsertSpace","tinymce.core.dom.Dimensions","tinymce.core.dom.MousePosition","ephox.sugar.api.properties.Css","tinymce.core.caret.LineWalker","ephox.katamari.api.Merger","ephox.sugar.impl.Style"]
jsc*/
/**
 * Rect.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Contains various tools for rect/position calculation.
 *
 * @class tinymce.geom.Rect
 */
define(
  'tinymce.core.geom.Rect',
  [
  ],
  function () {
    "use strict";

    var min = Math.min, max = Math.max, round = Math.round;

    /**
     * Returns the rect positioned based on the relative position name
     * to the target rect.
     *
     * @method relativePosition
     * @param {Rect} rect Source rect to modify into a new rect.
     * @param {Rect} targetRect Rect to move relative to based on the rel option.
     * @param {String} rel Relative position. For example: tr-bl.
     */
    function relativePosition(rect, targetRect, rel) {
      var x, y, w, h, targetW, targetH;

      x = targetRect.x;
      y = targetRect.y;
      w = rect.w;
      h = rect.h;
      targetW = targetRect.w;
      targetH = targetRect.h;

      rel = (rel || '').split('');

      if (rel[0] === 'b') {
        y += targetH;
      }

      if (rel[1] === 'r') {
        x += targetW;
      }

      if (rel[0] === 'c') {
        y += round(targetH / 2);
      }

      if (rel[1] === 'c') {
        x += round(targetW / 2);
      }

      if (rel[3] === 'b') {
        y -= h;
      }

      if (rel[4] === 'r') {
        x -= w;
      }

      if (rel[3] === 'c') {
        y -= round(h / 2);
      }

      if (rel[4] === 'c') {
        x -= round(w / 2);
      }

      return create(x, y, w, h);
    }

    /**
     * Tests various positions to get the most suitable one.
     *
     * @method findBestRelativePosition
     * @param {Rect} rect Rect to use as source.
     * @param {Rect} targetRect Rect to move relative to.
     * @param {Rect} constrainRect Rect to constrain within.
     * @param {Array} rels Array of relative positions to test against.
     */
    function findBestRelativePosition(rect, targetRect, constrainRect, rels) {
      var pos, i;

      for (i = 0; i < rels.length; i++) {
        pos = relativePosition(rect, targetRect, rels[i]);

        if (pos.x >= constrainRect.x && pos.x + pos.w <= constrainRect.w + constrainRect.x &&
          pos.y >= constrainRect.y && pos.y + pos.h <= constrainRect.h + constrainRect.y) {
          return rels[i];
        }
      }

      return null;
    }

    /**
     * Inflates the rect in all directions.
     *
     * @method inflate
     * @param {Rect} rect Rect to expand.
     * @param {Number} w Relative width to expand by.
     * @param {Number} h Relative height to expand by.
     * @return {Rect} New expanded rect.
     */
    function inflate(rect, w, h) {
      return create(rect.x - w, rect.y - h, rect.w + w * 2, rect.h + h * 2);
    }

    /**
     * Returns the intersection of the specified rectangles.
     *
     * @method intersect
     * @param {Rect} rect The first rectangle to compare.
     * @param {Rect} cropRect The second rectangle to compare.
     * @return {Rect} The intersection of the two rectangles or null if they don't intersect.
     */
    function intersect(rect, cropRect) {
      var x1, y1, x2, y2;

      x1 = max(rect.x, cropRect.x);
      y1 = max(rect.y, cropRect.y);
      x2 = min(rect.x + rect.w, cropRect.x + cropRect.w);
      y2 = min(rect.y + rect.h, cropRect.y + cropRect.h);

      if (x2 - x1 < 0 || y2 - y1 < 0) {
        return null;
      }

      return create(x1, y1, x2 - x1, y2 - y1);
    }

    /**
     * Returns a rect clamped within the specified clamp rect. This forces the
     * rect to be inside the clamp rect.
     *
     * @method clamp
     * @param {Rect} rect Rectangle to force within clamp rect.
     * @param {Rect} clampRect Rectable to force within.
     * @param {Boolean} fixedSize True/false if size should be fixed.
     * @return {Rect} Clamped rect.
     */
    function clamp(rect, clampRect, fixedSize) {
      var underflowX1, underflowY1, overflowX2, overflowY2,
        x1, y1, x2, y2, cx2, cy2;

      x1 = rect.x;
      y1 = rect.y;
      x2 = rect.x + rect.w;
      y2 = rect.y + rect.h;
      cx2 = clampRect.x + clampRect.w;
      cy2 = clampRect.y + clampRect.h;

      underflowX1 = max(0, clampRect.x - x1);
      underflowY1 = max(0, clampRect.y - y1);
      overflowX2 = max(0, x2 - cx2);
      overflowY2 = max(0, y2 - cy2);

      x1 += underflowX1;
      y1 += underflowY1;

      if (fixedSize) {
        x2 += underflowX1;
        y2 += underflowY1;
        x1 -= overflowX2;
        y1 -= overflowY2;
      }

      x2 -= overflowX2;
      y2 -= overflowY2;

      return create(x1, y1, x2 - x1, y2 - y1);
    }

    /**
     * Creates a new rectangle object.
     *
     * @method create
     * @param {Number} x Rectangle x location.
     * @param {Number} y Rectangle y location.
     * @param {Number} w Rectangle width.
     * @param {Number} h Rectangle height.
     * @return {Rect} New rectangle object.
     */
    function create(x, y, w, h) {
      return { x: x, y: y, w: w, h: h };
    }

    /**
     * Creates a new rectangle object form a clientRects object.
     *
     * @method fromClientRect
     * @param {ClientRect} clientRect DOM ClientRect object.
     * @return {Rect} New rectangle object.
     */
    function fromClientRect(clientRect) {
      return create(clientRect.left, clientRect.top, clientRect.width, clientRect.height);
    }

    return {
      inflate: inflate,
      relativePosition: relativePosition,
      findBestRelativePosition: findBestRelativePosition,
      intersect: intersect,
      clamp: clamp,
      create: create,
      fromClientRect: fromClientRect
    };
  }
);

/**
 * Promise.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * Promise polyfill under MIT license: https://github.com/taylorhakes/promise-polyfill
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/* eslint-disable */
/* jshint ignore:start */

/**
 * Modifed to be a feature fill and wrapped as tinymce module.
 */
define(
  'tinymce.core.util.Promise',
  [],
  function () {
    if (window.Promise) {
      return window.Promise;
    }

    // Use polyfill for setImmediate for performance gains
    var asap = Promise.immediateFn || (typeof setImmediate === 'function' && setImmediate) ||
      function (fn) { setTimeout(fn, 1); };

    // Polyfill for Function.prototype.bind
    function bind(fn, thisArg) {
      return function () {
        fn.apply(thisArg, arguments);
      };
    }

    var isArray = Array.isArray || function (value) { return Object.prototype.toString.call(value) === "[object Array]"; };

    function Promise(fn) {
      if (typeof this !== 'object') throw new TypeError('Promises must be constructed via new');
      if (typeof fn !== 'function') throw new TypeError('not a function');
      this._state = null;
      this._value = null;
      this._deferreds = [];

      doResolve(fn, bind(resolve, this), bind(reject, this));
    }

    function handle(deferred) {
      var me = this;
      if (this._state === null) {
        this._deferreds.push(deferred);
        return;
      }
      asap(function () {
        var cb = me._state ? deferred.onFulfilled : deferred.onRejected;
        if (cb === null) {
          (me._state ? deferred.resolve : deferred.reject)(me._value);
          return;
        }
        var ret;
        try {
          ret = cb(me._value);
        }
        catch (e) {
          deferred.reject(e);
          return;
        }
        deferred.resolve(ret);
      });
    }

    function resolve(newValue) {
      try { //Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure
        if (newValue === this) throw new TypeError('A promise cannot be resolved with itself.');
        if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {
          var then = newValue.then;
          if (typeof then === 'function') {
            doResolve(bind(then, newValue), bind(resolve, this), bind(reject, this));
            return;
          }
        }
        this._state = true;
        this._value = newValue;
        finale.call(this);
      } catch (e) { reject.call(this, e); }
    }

    function reject(newValue) {
      this._state = false;
      this._value = newValue;
      finale.call(this);
    }

    function finale() {
      for (var i = 0, len = this._deferreds.length; i < len; i++) {
        handle.call(this, this._deferreds[i]);
      }
      this._deferreds = null;
    }

    function Handler(onFulfilled, onRejected, resolve, reject) {
      this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;
      this.onRejected = typeof onRejected === 'function' ? onRejected : null;
      this.resolve = resolve;
      this.reject = reject;
    }

    /**
     * Take a potentially misbehaving resolver function and make sure
     * onFulfilled and onRejected are only called once.
     *
     * Makes no guarantees about asynchrony.
     */
    function doResolve(fn, onFulfilled, onRejected) {
      var done = false;
      try {
        fn(function (value) {
          if (done) return;
          done = true;
          onFulfilled(value);
        }, function (reason) {
          if (done) return;
          done = true;
          onRejected(reason);
        });
      } catch (ex) {
        if (done) return;
        done = true;
        onRejected(ex);
      }
    }

    Promise.prototype['catch'] = function (onRejected) {
      return this.then(null, onRejected);
    };

    Promise.prototype.then = function (onFulfilled, onRejected) {
      var me = this;
      return new Promise(function (resolve, reject) {
        handle.call(me, new Handler(onFulfilled, onRejected, resolve, reject));
      });
    };

    Promise.all = function () {
      var args = Array.prototype.slice.call(arguments.length === 1 && isArray(arguments[0]) ? arguments[0] : arguments);

      return new Promise(function (resolve, reject) {
        if (args.length === 0) return resolve([]);
        var remaining = args.length;
        function res(i, val) {
          try {
            if (val && (typeof val === 'object' || typeof val === 'function')) {
              var then = val.then;
              if (typeof then === 'function') {
                then.call(val, function (val) { res(i, val); }, reject);
                return;
              }
            }
            args[i] = val;
            if (--remaining === 0) {
              resolve(args);
            }
          } catch (ex) {
            reject(ex);
          }
        }
        for (var i = 0; i < args.length; i++) {
          res(i, args[i]);
        }
      });
    };

    Promise.resolve = function (value) {
      if (value && typeof value === 'object' && value.constructor === Promise) {
        return value;
      }

      return new Promise(function (resolve) {
        resolve(value);
      });
    };

    Promise.reject = function (value) {
      return new Promise(function (resolve, reject) {
        reject(value);
      });
    };

    Promise.race = function (values) {
      return new Promise(function (resolve, reject) {
        for (var i = 0, len = values.length; i < len; i++) {
          values[i].then(resolve, reject);
        }
      });
    };

    return Promise;
  }
);

/* jshint ignore:end */
/* eslint-enable */
/**
 * Delay.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Utility class for working with delayed actions like setTimeout.
 *
 * @class tinymce.util.Delay
 */
define(
  'tinymce.core.util.Delay',
  [
    "tinymce.core.util.Promise"
  ],
  function (Promise) {
    var requestAnimationFramePromise;

    function requestAnimationFrame(callback, element) {
      var i, requestAnimationFrameFunc = window.requestAnimationFrame, vendors = ['ms', 'moz', 'webkit'];

      function featurefill(callback) {
        window.setTimeout(callback, 0);
      }

      for (i = 0; i < vendors.length && !requestAnimationFrameFunc; i++) {
        requestAnimationFrameFunc = window[vendors[i] + 'RequestAnimationFrame'];
      }

      if (!requestAnimationFrameFunc) {
        requestAnimationFrameFunc = featurefill;
      }

      requestAnimationFrameFunc(callback, element);
    }

    function wrappedSetTimeout(callback, time) {
      if (typeof time != 'number') {
        time = 0;
      }

      return setTimeout(callback, time);
    }

    function wrappedSetInterval(callback, time) {
      if (typeof time != 'number') {
        time = 1; // IE 8 needs it to be > 0
      }

      return setInterval(callback, time);
    }

    function wrappedClearTimeout(id) {
      return clearTimeout(id);
    }

    function wrappedClearInterval(id) {
      return clearInterval(id);
    }

    function debounce(callback, time) {
      var timer, func;

      func = function () {
        var args = arguments;

        clearTimeout(timer);

        timer = wrappedSetTimeout(function () {
          callback.apply(this, args);
        }, time);
      };

      func.stop = function () {
        clearTimeout(timer);
      };

      return func;
    }

    return {
      /**
       * Requests an animation frame and fallbacks to a timeout on older browsers.
       *
       * @method requestAnimationFrame
       * @param {function} callback Callback to execute when a new frame is available.
       * @param {DOMElement} element Optional element to scope it to.
       */
      requestAnimationFrame: function (callback, element) {
        if (requestAnimationFramePromise) {
          requestAnimationFramePromise.then(callback);
          return;
        }

        requestAnimationFramePromise = new Promise(function (resolve) {
          if (!element) {
            element = document.body;
          }

          requestAnimationFrame(resolve, element);
        }).then(callback);
      },

      /**
       * Sets a timer in ms and executes the specified callback when the timer runs out.
       *
       * @method setTimeout
       * @param {function} callback Callback to execute when timer runs out.
       * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.
       * @return {Number} Timeout id number.
       */
      setTimeout: wrappedSetTimeout,

      /**
       * Sets an interval timer in ms and executes the specified callback at every interval of that time.
       *
       * @method setInterval
       * @param {function} callback Callback to execute when interval time runs out.
       * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.
       * @return {Number} Timeout id number.
       */
      setInterval: wrappedSetInterval,

      /**
       * Sets an editor timeout it's similar to setTimeout except that it checks if the editor instance is
       * still alive when the callback gets executed.
       *
       * @method setEditorTimeout
       * @param {tinymce.Editor} editor Editor instance to check the removed state on.
       * @param {function} callback Callback to execute when timer runs out.
       * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.
       * @return {Number} Timeout id number.
       */
      setEditorTimeout: function (editor, callback, time) {
        return wrappedSetTimeout(function () {
          if (!editor.removed) {
            callback();
          }
        }, time);
      },

      /**
       * Sets an interval timer it's similar to setInterval except that it checks if the editor instance is
       * still alive when the callback gets executed.
       *
       * @method setEditorInterval
       * @param {function} callback Callback to execute when interval time runs out.
       * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.
       * @return {Number} Timeout id number.
       */
      setEditorInterval: function (editor, callback, time) {
        var timer;

        timer = wrappedSetInterval(function () {
          if (!editor.removed) {
            callback();
          } else {
            clearInterval(timer);
          }
        }, time);

        return timer;
      },

      /**
       * Creates debounced callback function that only gets executed once within the specified time.
       *
       * @method debounce
       * @param {function} callback Callback to execute when timer finishes.
       * @param {Number} time Optional time to wait before the callback is executed, defaults to 0.
       * @return {Function} debounced function callback.
       */
      debounce: debounce,

      // Throttle needs to be debounce due to backwards compatibility.
      throttle: debounce,

      /**
       * Clears an interval timer so it won't execute.
       *
       * @method clearInterval
       * @param {Number} Interval timer id number.
       */
      clearInterval: wrappedClearInterval,

      /**
       * Clears an timeout timer so it won't execute.
       *
       * @method clearTimeout
       * @param {Number} Timeout timer id number.
       */
      clearTimeout: wrappedClearTimeout
    };
  }
);

/**
 * Env.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class contains various environment constants like browser versions etc.
 * Normally you don't want to sniff specific browser versions but sometimes you have
 * to when it's impossible to feature detect. So use this with care.
 *
 * @class tinymce.Env
 * @static
 */
define(
  'tinymce.core.Env',
  [
  ],
  function () {
    var nav = navigator, userAgent = nav.userAgent;
    var opera, webkit, ie, ie11, ie12, gecko, mac, iDevice, android, fileApi, phone, tablet, windowsPhone;

    function matchMediaQuery(query) {
      return "matchMedia" in window ? matchMedia(query).matches : false;
    }

    opera = window.opera && window.opera.buildNumber;
    android = /Android/.test(userAgent);
    webkit = /WebKit/.test(userAgent);
    ie = !webkit && !opera && (/MSIE/gi).test(userAgent) && (/Explorer/gi).test(nav.appName);
    ie = ie && /MSIE (\w+)\./.exec(userAgent)[1];
    ie11 = userAgent.indexOf('Trident/') != -1 && (userAgent.indexOf('rv:') != -1 || nav.appName.indexOf('Netscape') != -1) ? 11 : false;
    ie12 = (userAgent.indexOf('Edge/') != -1 && !ie && !ie11) ? 12 : false;
    ie = ie || ie11 || ie12;
    gecko = !webkit && !ie11 && /Gecko/.test(userAgent);
    mac = userAgent.indexOf('Mac') != -1;
    iDevice = /(iPad|iPhone)/.test(userAgent);
    fileApi = "FormData" in window && "FileReader" in window && "URL" in window && !!URL.createObjectURL;
    phone = matchMediaQuery("only screen and (max-device-width: 480px)") && (android || iDevice);
    tablet = matchMediaQuery("only screen and (min-width: 800px)") && (android || iDevice);
    windowsPhone = userAgent.indexOf('Windows Phone') != -1;

    if (ie12) {
      webkit = false;
    }

    // Is a iPad/iPhone and not on iOS5 sniff the WebKit version since older iOS WebKit versions
    // says it has contentEditable support but there is no visible caret.
    var contentEditable = !iDevice || fileApi || userAgent.match(/AppleWebKit\/(\d*)/)[1] >= 534;

    return {
      /**
       * Constant that is true if the browser is Opera.
       *
       * @property opera
       * @type Boolean
       * @final
       */
      opera: opera,

      /**
       * Constant that is true if the browser is WebKit (Safari/Chrome).
       *
       * @property webKit
       * @type Boolean
       * @final
       */
      webkit: webkit,

      /**
       * Constant that is more than zero if the browser is IE.
       *
       * @property ie
       * @type Boolean
       * @final
       */
      ie: ie,

      /**
       * Constant that is true if the browser is Gecko.
       *
       * @property gecko
       * @type Boolean
       * @final
       */
      gecko: gecko,

      /**
       * Constant that is true if the os is Mac OS.
       *
       * @property mac
       * @type Boolean
       * @final
       */
      mac: mac,

      /**
       * Constant that is true if the os is iOS.
       *
       * @property iOS
       * @type Boolean
       * @final
       */
      iOS: iDevice,

      /**
       * Constant that is true if the os is android.
       *
       * @property android
       * @type Boolean
       * @final
       */
      android: android,

      /**
       * Constant that is true if the browser supports editing.
       *
       * @property contentEditable
       * @type Boolean
       * @final
       */
      contentEditable: contentEditable,

      /**
       * Transparent image data url.
       *
       * @property transparentSrc
       * @type Boolean
       * @final
       */
      transparentSrc: "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",

      /**
       * Returns true/false if the browser can or can't place the caret after a inline block like an image.
       *
       * @property noCaretAfter
       * @type Boolean
       * @final
       */
      caretAfter: ie != 8,

      /**
       * Constant that is true if the browser supports native DOM Ranges. IE 9+.
       *
       * @property range
       * @type Boolean
       */
      range: window.getSelection && "Range" in window,

      /**
       * Returns the IE document mode for non IE browsers this will fake IE 10.
       *
       * @property documentMode
       * @type Number
       */
      documentMode: ie && !ie12 ? (document.documentMode || 7) : 10,

      /**
       * Constant that is true if the browser has a modern file api.
       *
       * @property fileApi
       * @type Boolean
       */
      fileApi: fileApi,

      /**
       * Constant that is true if the browser supports contentEditable=false regions.
       *
       * @property ceFalse
       * @type Boolean
       */
      ceFalse: (ie === false || ie > 8),

      /**
       * Constant if CSP mode is possible or not. Meaning we can't use script urls for the iframe.
       */
      canHaveCSP: (ie === false || ie > 11),

      desktop: !phone && !tablet,
      windowsPhone: windowsPhone
    };
  }
);

/**
 * EventUtils.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/*jshint loopfunc:true*/
/*eslint no-loop-func:0 */

/**
 * This class wraps the browsers native event logic with more convenient methods.
 *
 * @class tinymce.dom.EventUtils
 */
define(
  'tinymce.core.dom.EventUtils',
  [
    "tinymce.core.util.Delay",
    "tinymce.core.Env"
  ],
  function (Delay, Env) {
    "use strict";

    var eventExpandoPrefix = "mce-data-";
    var mouseEventRe = /^(?:mouse|contextmenu)|click/;
    var deprecated = {
      keyLocation: 1, layerX: 1, layerY: 1, returnValue: 1,
      webkitMovementX: 1, webkitMovementY: 1, keyIdentifier: 1
    };

    // Checks if it is our own isDefaultPrevented function
    var hasIsDefaultPrevented = function (event) {
      return event.isDefaultPrevented === returnTrue || event.isDefaultPrevented === returnFalse;
    };

    // Dummy function that gets replaced on the delegation state functions
    var returnFalse = function () {
      return false;
    };

    // Dummy function that gets replaced on the delegation state functions
    var returnTrue = function () {
      return true;
    };

    /**
     * Binds a native event to a callback on the speified target.
     */
    function addEvent(target, name, callback, capture) {
      if (target.addEventListener) {
        target.addEventListener(name, callback, capture || false);
      } else if (target.attachEvent) {
        target.attachEvent('on' + name, callback);
      }
    }

    /**
     * Unbinds a native event callback on the specified target.
     */
    function removeEvent(target, name, callback, capture) {
      if (target.removeEventListener) {
        target.removeEventListener(name, callback, capture || false);
      } else if (target.detachEvent) {
        target.detachEvent('on' + name, callback);
      }
    }

    /**
     * Gets the event target based on shadow dom properties like path and deepPath.
     */
    function getTargetFromShadowDom(event, defaultTarget) {
      var path, target = defaultTarget;

      // When target element is inside Shadow DOM we need to take first element from path
      // otherwise we'll get Shadow Root parent, not actual target element

      // Normalize target for WebComponents v0 implementation (in Chrome)
      path = event.path;
      if (path && path.length > 0) {
        target = path[0];
      }

      // Normalize target for WebComponents v1 implementation (standard)
      if (event.deepPath) {
        path = event.deepPath();
        if (path && path.length > 0) {
          target = path[0];
        }
      }

      return target;
    }

    /**
     * Normalizes a native event object or just adds the event specific methods on a custom event.
     */
    function fix(originalEvent, data) {
      var name, event = data || {}, undef;

      // Copy all properties from the original event
      for (name in originalEvent) {
        // layerX/layerY is deprecated in Chrome and produces a warning
        if (!deprecated[name]) {
          event[name] = originalEvent[name];
        }
      }

      // Normalize target IE uses srcElement
      if (!event.target) {
        event.target = event.srcElement || document;
      }

      // Experimental shadow dom support
      if (Env.experimentalShadowDom) {
        event.target = getTargetFromShadowDom(originalEvent, event.target);
      }

      // Calculate pageX/Y if missing and clientX/Y available
      if (originalEvent && mouseEventRe.test(originalEvent.type) && originalEvent.pageX === undef && originalEvent.clientX !== undef) {
        var eventDoc = event.target.ownerDocument || document;
        var doc = eventDoc.documentElement;
        var body = eventDoc.body;

        event.pageX = originalEvent.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) -
          (doc && doc.clientLeft || body && body.clientLeft || 0);

        event.pageY = originalEvent.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) -
          (doc && doc.clientTop || body && body.clientTop || 0);
      }

      // Add preventDefault method
      event.preventDefault = function () {
        event.isDefaultPrevented = returnTrue;

        // Execute preventDefault on the original event object
        if (originalEvent) {
          if (originalEvent.preventDefault) {
            originalEvent.preventDefault();
          } else {
            originalEvent.returnValue = false; // IE
          }
        }
      };

      // Add stopPropagation
      event.stopPropagation = function () {
        event.isPropagationStopped = returnTrue;

        // Execute stopPropagation on the original event object
        if (originalEvent) {
          if (originalEvent.stopPropagation) {
            originalEvent.stopPropagation();
          } else {
            originalEvent.cancelBubble = true; // IE
          }
        }
      };

      // Add stopImmediatePropagation
      event.stopImmediatePropagation = function () {
        event.isImmediatePropagationStopped = returnTrue;
        event.stopPropagation();
      };

      // Add event delegation states
      if (hasIsDefaultPrevented(event) === false) {
        event.isDefaultPrevented = returnFalse;
        event.isPropagationStopped = returnFalse;
        event.isImmediatePropagationStopped = returnFalse;
      }

      // Add missing metaKey for IE 8
      if (typeof event.metaKey == 'undefined') {
        event.metaKey = false;
      }

      return event;
    }

    /**
     * Bind a DOMContentLoaded event across browsers and executes the callback once the page DOM is initialized.
     * It will also set/check the domLoaded state of the event_utils instance so ready isn't called multiple times.
     */
    function bindOnReady(win, callback, eventUtils) {
      var doc = win.document, event = { type: 'ready' };

      if (eventUtils.domLoaded) {
        callback(event);
        return;
      }

      function isDocReady() {
        // Check complete or interactive state if there is a body
        // element on some iframes IE 8 will produce a null body
        return doc.readyState === "complete" || (doc.readyState === "interactive" && doc.body);
      }

      // Gets called when the DOM is ready
      function readyHandler() {
        if (!eventUtils.domLoaded) {
          eventUtils.domLoaded = true;
          callback(event);
        }
      }

      function waitForDomLoaded() {
        if (isDocReady()) {
          removeEvent(doc, "readystatechange", waitForDomLoaded);
          readyHandler();
        }
      }

      function tryScroll() {
        try {
          // If IE is used, use the trick by Diego Perini licensed under MIT by request to the author.
          // http://javascript.nwbox.com/IEContentLoaded/
          doc.documentElement.doScroll("left");
        } catch (ex) {
          Delay.setTimeout(tryScroll);
          return;
        }

        readyHandler();
      }

      // Use W3C method (exclude IE 9,10 - readyState "interactive" became valid only in IE 11)
      if (doc.addEventListener && !(Env.ie && Env.ie < 11)) {
        if (isDocReady()) {
          readyHandler();
        } else {
          addEvent(win, 'DOMContentLoaded', readyHandler);
        }
      } else {
        // Use IE method
        addEvent(doc, "readystatechange", waitForDomLoaded);

        // Wait until we can scroll, when we can the DOM is initialized
        if (doc.documentElement.doScroll && win.self === win.top) {
          tryScroll();
        }
      }

      // Fallback if any of the above methods should fail for some odd reason
      addEvent(win, 'load', readyHandler);
    }

    /**
     * This class enables you to bind/unbind native events to elements and normalize it's behavior across browsers.
     */
    function EventUtils() {
      var self = this, events = {}, count, expando, hasFocusIn, hasMouseEnterLeave, mouseEnterLeave;

      expando = eventExpandoPrefix + (+new Date()).toString(32);
      hasMouseEnterLeave = "onmouseenter" in document.documentElement;
      hasFocusIn = "onfocusin" in document.documentElement;
      mouseEnterLeave = { mouseenter: 'mouseover', mouseleave: 'mouseout' };
      count = 1;

      // State if the DOMContentLoaded was executed or not
      self.domLoaded = false;
      self.events = events;

      /**
       * Executes all event handler callbacks for a specific event.
       *
       * @private
       * @param {Event} evt Event object.
       * @param {String} id Expando id value to look for.
       */
      function executeHandlers(evt, id) {
        var callbackList, i, l, callback, container = events[id];

        callbackList = container && container[evt.type];
        if (callbackList) {
          for (i = 0, l = callbackList.length; i < l; i++) {
            callback = callbackList[i];

            // Check if callback exists might be removed if a unbind is called inside the callback
            if (callback && callback.func.call(callback.scope, evt) === false) {
              evt.preventDefault();
            }

            // Should we stop propagation to immediate listeners
            if (evt.isImmediatePropagationStopped()) {
              return;
            }
          }
        }
      }

      /**
       * Binds a callback to an event on the specified target.
       *
       * @method bind
       * @param {Object} target Target node/window or custom object.
       * @param {String} names Name of the event to bind.
       * @param {function} callback Callback function to execute when the event occurs.
       * @param {Object} scope Scope to call the callback function on, defaults to target.
       * @return {function} Callback function that got bound.
       */
      self.bind = function (target, names, callback, scope) {
        var id, callbackList, i, name, fakeName, nativeHandler, capture, win = window;

        // Native event handler function patches the event and executes the callbacks for the expando
        function defaultNativeHandler(evt) {
          executeHandlers(fix(evt || win.event), id);
        }

        // Don't bind to text nodes or comments
        if (!target || target.nodeType === 3 || target.nodeType === 8) {
          return;
        }

        // Create or get events id for the target
        if (!target[expando]) {
          id = count++;
          target[expando] = id;
          events[id] = {};
        } else {
          id = target[expando];
        }

        // Setup the specified scope or use the target as a default
        scope = scope || target;

        // Split names and bind each event, enables you to bind multiple events with one call
        names = names.split(' ');
        i = names.length;
        while (i--) {
          name = names[i];
          nativeHandler = defaultNativeHandler;
          fakeName = capture = false;

          // Use ready instead of DOMContentLoaded
          if (name === "DOMContentLoaded") {
            name = "ready";
          }

          // DOM is already ready
          if (self.domLoaded && name === "ready" && target.readyState == 'complete') {
            callback.call(scope, fix({ type: name }));
            continue;
          }

          // Handle mouseenter/mouseleaver
          if (!hasMouseEnterLeave) {
            fakeName = mouseEnterLeave[name];

            if (fakeName) {
              nativeHandler = function (evt) {
                var current, related;

                current = evt.currentTarget;
                related = evt.relatedTarget;

                // Check if related is inside the current target if it's not then the event should
                // be ignored since it's a mouseover/mouseout inside the element
                if (related && current.contains) {
                  // Use contains for performance
                  related = current.contains(related);
                } else {
                  while (related && related !== current) {
                    related = related.parentNode;
                  }
                }

                // Fire fake event
                if (!related) {
                  evt = fix(evt || win.event);
                  evt.type = evt.type === 'mouseout' ? 'mouseleave' : 'mouseenter';
                  evt.target = current;
                  executeHandlers(evt, id);
                }
              };
            }
          }

          // Fake bubbling of focusin/focusout
          if (!hasFocusIn && (name === "focusin" || name === "focusout")) {
            capture = true;
            fakeName = name === "focusin" ? "focus" : "blur";
            nativeHandler = function (evt) {
              evt = fix(evt || win.event);
              evt.type = evt.type === 'focus' ? 'focusin' : 'focusout';
              executeHandlers(evt, id);
            };
          }

          // Setup callback list and bind native event
          callbackList = events[id][name];
          if (!callbackList) {
            events[id][name] = callbackList = [{ func: callback, scope: scope }];
            callbackList.fakeName = fakeName;
            callbackList.capture = capture;
            //callbackList.callback = callback;

            // Add the nativeHandler to the callback list so that we can later unbind it
            callbackList.nativeHandler = nativeHandler;

            // Check if the target has native events support

            if (name === "ready") {
              bindOnReady(target, nativeHandler, self);
            } else {
              addEvent(target, fakeName || name, nativeHandler, capture);
            }
          } else {
            if (name === "ready" && self.domLoaded) {
              callback({ type: name });
            } else {
              // If it already has an native handler then just push the callback
              callbackList.push({ func: callback, scope: scope });
            }
          }
        }

        target = callbackList = 0; // Clean memory for IE

        return callback;
      };

      /**
       * Unbinds the specified event by name, name and callback or all events on the target.
       *
       * @method unbind
       * @param {Object} target Target node/window or custom object.
       * @param {String} names Optional event name to unbind.
       * @param {function} callback Optional callback function to unbind.
       * @return {EventUtils} Event utils instance.
       */
      self.unbind = function (target, names, callback) {
        var id, callbackList, i, ci, name, eventMap;

        // Don't bind to text nodes or comments
        if (!target || target.nodeType === 3 || target.nodeType === 8) {
          return self;
        }

        // Unbind event or events if the target has the expando
        id = target[expando];
        if (id) {
          eventMap = events[id];

          // Specific callback
          if (names) {
            names = names.split(' ');
            i = names.length;
            while (i--) {
              name = names[i];
              callbackList = eventMap[name];

              // Unbind the event if it exists in the map
              if (callbackList) {
                // Remove specified callback
                if (callback) {
                  ci = callbackList.length;
                  while (ci--) {
                    if (callbackList[ci].func === callback) {
                      var nativeHandler = callbackList.nativeHandler;
                      var fakeName = callbackList.fakeName, capture = callbackList.capture;

                      // Clone callbackList since unbind inside a callback would otherwise break the handlers loop
                      callbackList = callbackList.slice(0, ci).concat(callbackList.slice(ci + 1));
                      callbackList.nativeHandler = nativeHandler;
                      callbackList.fakeName = fakeName;
                      callbackList.capture = capture;

                      eventMap[name] = callbackList;
                    }
                  }
                }

                // Remove all callbacks if there isn't a specified callback or there is no callbacks left
                if (!callback || callbackList.length === 0) {
                  delete eventMap[name];
                  removeEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);
                }
              }
            }
          } else {
            // All events for a specific element
            for (name in eventMap) {
              callbackList = eventMap[name];
              removeEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);
            }

            eventMap = {};
          }

          // Check if object is empty, if it isn't then we won't remove the expando map
          for (name in eventMap) {
            return self;
          }

          // Delete event object
          delete events[id];

          // Remove expando from target
          try {
            // IE will fail here since it can't delete properties from window
            delete target[expando];
          } catch (ex) {
            // IE will set it to null
            target[expando] = null;
          }
        }

        return self;
      };

      /**
       * Fires the specified event on the specified target.
       *
       * @method fire
       * @param {Object} target Target node/window or custom object.
       * @param {String} name Event name to fire.
       * @param {Object} args Optional arguments to send to the observers.
       * @return {EventUtils} Event utils instance.
       */
      self.fire = function (target, name, args) {
        var id;

        // Don't bind to text nodes or comments
        if (!target || target.nodeType === 3 || target.nodeType === 8) {
          return self;
        }

        // Build event object by patching the args
        args = fix(null, args);
        args.type = name;
        args.target = target;

        do {
          // Found an expando that means there is listeners to execute
          id = target[expando];
          if (id) {
            executeHandlers(args, id);
          }

          // Walk up the DOM
          target = target.parentNode || target.ownerDocument || target.defaultView || target.parentWindow;
        } while (target && !args.isPropagationStopped());

        return self;
      };

      /**
       * Removes all bound event listeners for the specified target. This will also remove any bound
       * listeners to child nodes within that target.
       *
       * @method clean
       * @param {Object} target Target node/window object.
       * @return {EventUtils} Event utils instance.
       */
      self.clean = function (target) {
        var i, children, unbind = self.unbind;

        // Don't bind to text nodes or comments
        if (!target || target.nodeType === 3 || target.nodeType === 8) {
          return self;
        }

        // Unbind any element on the specified target
        if (target[expando]) {
          unbind(target);
        }

        // Target doesn't have getElementsByTagName it's probably a window object then use it's document to find the children
        if (!target.getElementsByTagName) {
          target = target.document;
        }

        // Remove events from each child element
        if (target && target.getElementsByTagName) {
          unbind(target);

          children = target.getElementsByTagName('*');
          i = children.length;
          while (i--) {
            target = children[i];

            if (target[expando]) {
              unbind(target);
            }
          }
        }

        return self;
      };

      /**
       * Destroys the event object. Call this on IE to remove memory leaks.
       */
      self.destroy = function () {
        events = {};
      };

      // Legacy function for canceling events
      self.cancel = function (e) {
        if (e) {
          e.preventDefault();
          e.stopImmediatePropagation();
        }

        return false;
      };
    }

    EventUtils.Event = new EventUtils();
    EventUtils.Event.bind(window, 'ready', function () { });

    return EventUtils;
  }
);

/**
 * Sizzle.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 *
 * @ignore-file
 */

/*jshint bitwise:false, expr:true, noempty:false, sub:true, eqnull:true, latedef:false, maxlen:255 */
/*eslint-disable */

/**
 * Sizzle CSS Selector Engine v@VERSION
 * http://sizzlejs.com/
 *
 * Copyright 2008, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: @DATE
 */
define(
  'tinymce.core.dom.Sizzle',
  [],
  function () {
    var i,
      support,
      Expr,
      getText,
      isXML,
      tokenize,
      compile,
      select,
      outermostContext,
      sortInput,
      hasDuplicate,

      // Local document vars
      setDocument,
      document,
      docElem,
      documentIsHTML,
      rbuggyQSA,
      rbuggyMatches,
      matches,
      contains,

      // Instance-specific data
      expando = "sizzle" + -(new Date()),
      preferredDoc = window.document,
      dirruns = 0,
      done = 0,
      classCache = createCache(),
      tokenCache = createCache(),
      compilerCache = createCache(),
      sortOrder = function (a, b) {
        if (a === b) {
          hasDuplicate = true;
        }
        return 0;
      },

      // General-purpose constants
      strundefined = typeof undefined,
      MAX_NEGATIVE = 1 << 31,

      // Instance methods
      hasOwn = ({}).hasOwnProperty,
      arr = [],
      pop = arr.pop,
      push_native = arr.push,
      push = arr.push,
      slice = arr.slice,
      // Use a stripped-down indexOf if we can't use a native one
      indexOf = arr.indexOf || function (elem) {
        var i = 0,
          len = this.length;
        for (; i < len; i++) {
          if (this[i] === elem) {
            return i;
          }
        }
        return -1;
      },

      booleans = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",

      // Regular expressions

      // http://www.w3.org/TR/css3-selectors/#whitespace
      whitespace = "[\\x20\\t\\r\\n\\f]",

      // http://www.w3.org/TR/CSS21/syndata.html#value-def-identifier
      identifier = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",

      // Attribute selectors: http://www.w3.org/TR/selectors/#attribute-selectors
      attributes = "\\[" + whitespace + "*(" + identifier + ")(?:" + whitespace +
        // Operator (capture 2)
        "*([*^$|!~]?=)" + whitespace +
        // "Attribute values must be CSS identifiers [capture 5] or strings [capture 3 or capture 4]"
        "*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|(" + identifier + "))|)" + whitespace +
        "*\\]",

      pseudos = ":(" + identifier + ")(?:\\((" +
        // To reduce the number of selectors needing tokenize in the preFilter, prefer arguments:
        // 1. quoted (capture 3; capture 4 or capture 5)
        "('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|" +
        // 2. simple (capture 6)
        "((?:\\\\.|[^\\\\()[\\]]|" + attributes + ")*)|" +
        // 3. anything else (capture 2)
        ".*" +
        ")\\)|)",

      // Leading and non-escaped trailing whitespace, capturing some non-whitespace characters preceding the latter
      rtrim = new RegExp("^" + whitespace + "+|((?:^|[^\\\\])(?:\\\\.)*)" + whitespace + "+$", "g"),

      rcomma = new RegExp("^" + whitespace + "*," + whitespace + "*"),
      rcombinators = new RegExp("^" + whitespace + "*([>+~]|" + whitespace + ")" + whitespace + "*"),

      rattributeQuotes = new RegExp("=" + whitespace + "*([^\\]'\"]*?)" + whitespace + "*\\]", "g"),

      rpseudo = new RegExp(pseudos),
      ridentifier = new RegExp("^" + identifier + "$"),

      matchExpr = {
        "ID": new RegExp("^#(" + identifier + ")"),
        "CLASS": new RegExp("^\\.(" + identifier + ")"),
        "TAG": new RegExp("^(" + identifier + "|[*])"),
        "ATTR": new RegExp("^" + attributes),
        "PSEUDO": new RegExp("^" + pseudos),
        "CHILD": new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + whitespace +
          "*(even|odd|(([+-]|)(\\d*)n|)" + whitespace + "*(?:([+-]|)" + whitespace +
          "*(\\d+)|))" + whitespace + "*\\)|)", "i"),
        "bool": new RegExp("^(?:" + booleans + ")$", "i"),
        // For use in libraries implementing .is()
        // We use this for POS matching in `select`
        "needsContext": new RegExp("^" + whitespace + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" +
          whitespace + "*((?:-\\d)?\\d*)" + whitespace + "*\\)|)(?=[^-]|$)", "i")
      },

      rinputs = /^(?:input|select|textarea|button)$/i,
      rheader = /^h\d$/i,

      rnative = /^[^{]+\{\s*\[native \w/,

      // Easily-parseable/retrievable ID or TAG or CLASS selectors
      rquickExpr = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,

      rsibling = /[+~]/,
      rescape = /'|\\/g,

      // CSS escapes http://www.w3.org/TR/CSS21/syndata.html#escaped-characters
      runescape = new RegExp("\\\\([\\da-f]{1,6}" + whitespace + "?|(" + whitespace + ")|.)", "ig"),
      funescape = function (_, escaped, escapedWhitespace) {
        var high = "0x" + escaped - 0x10000;
        // NaN means non-codepoint
        // Support: Firefox<24
        // Workaround erroneous numeric interpretation of +"0x"
        return high !== high || escapedWhitespace ?
          escaped :
          high < 0 ?
            // BMP codepoint
            String.fromCharCode(high + 0x10000) :
            // Supplemental Plane codepoint (surrogate pair)
            String.fromCharCode(high >> 10 | 0xD800, high & 0x3FF | 0xDC00);
      };

    // Optimize for push.apply( _, NodeList )
    try {
      push.apply(
        (arr = slice.call(preferredDoc.childNodes)),
        preferredDoc.childNodes
      );
      // Support: Android<4.0
      // Detect silently failing push.apply
      arr[preferredDoc.childNodes.length].nodeType;
    } catch (e) {
      push = {
        apply: arr.length ?

          // Leverage slice if possible
          function (target, els) {
            push_native.apply(target, slice.call(els));
          } :

          // Support: IE<9
          // Otherwise append directly
          function (target, els) {
            var j = target.length,
              i = 0;
            // Can't trust NodeList.length
            while ((target[j++] = els[i++])) { }
            target.length = j - 1;
          }
      };
    }

    function Sizzle(selector, context, results, seed) {
      var match, elem, m, nodeType,
        // QSA vars
        i, groups, old, nid, newContext, newSelector;

      if ((context ? context.ownerDocument || context : preferredDoc) !== document) {
        setDocument(context);
      }

      context = context || document;
      results = results || [];

      if (!selector || typeof selector !== "string") {
        return results;
      }

      if ((nodeType = context.nodeType) !== 1 && nodeType !== 9) {
        return [];
      }

      if (documentIsHTML && !seed) {

        // Shortcuts
        if ((match = rquickExpr.exec(selector))) {
          // Speed-up: Sizzle("#ID")
          if ((m = match[1])) {
            if (nodeType === 9) {
              elem = context.getElementById(m);
              // Check parentNode to catch when Blackberry 4.6 returns
              // nodes that are no longer in the document (jQuery #6963)
              if (elem && elem.parentNode) {
                // Handle the case where IE, Opera, and Webkit return items
                // by name instead of ID
                if (elem.id === m) {
                  results.push(elem);
                  return results;
                }
              } else {
                return results;
              }
            } else {
              // Context is not a document
              if (context.ownerDocument && (elem = context.ownerDocument.getElementById(m)) &&
                contains(context, elem) && elem.id === m) {
                results.push(elem);
                return results;
              }
            }

            // Speed-up: Sizzle("TAG")
          } else if (match[2]) {
            push.apply(results, context.getElementsByTagName(selector));
            return results;

            // Speed-up: Sizzle(".CLASS")
          } else if ((m = match[3]) && support.getElementsByClassName) {
            push.apply(results, context.getElementsByClassName(m));
            return results;
          }
        }

        // QSA path
        if (support.qsa && (!rbuggyQSA || !rbuggyQSA.test(selector))) {
          nid = old = expando;
          newContext = context;
          newSelector = nodeType === 9 && selector;

          // qSA works strangely on Element-rooted queries
          // We can work around this by specifying an extra ID on the root
          // and working up from there (Thanks to Andrew Dupont for the technique)
          // IE 8 doesn't work on object elements
          if (nodeType === 1 && context.nodeName.toLowerCase() !== "object") {
            groups = tokenize(selector);

            if ((old = context.getAttribute("id"))) {
              nid = old.replace(rescape, "\\$&");
            } else {
              context.setAttribute("id", nid);
            }
            nid = "[id='" + nid + "'] ";

            i = groups.length;
            while (i--) {
              groups[i] = nid + toSelector(groups[i]);
            }
            newContext = rsibling.test(selector) && testContext(context.parentNode) || context;
            newSelector = groups.join(",");
          }

          if (newSelector) {
            try {
              push.apply(results,
                newContext.querySelectorAll(newSelector)
              );
              return results;
            } catch (qsaError) {
            } finally {
              if (!old) {
                context.removeAttribute("id");
              }
            }
          }
        }
      }

      // All others
      return select(selector.replace(rtrim, "$1"), context, results, seed);
    }

    /**
     * Create key-value caches of limited size
     * @returns {Function(string, Object)} Returns the Object data after storing it on itself with
     * property name the (space-suffixed) string and (if the cache is larger than Expr.cacheLength)
     * deleting the oldest entry
     */
    function createCache() {
      var keys = [];

      function cache(key, value) {
        // Use (key + " ") to avoid collision with native prototype properties (see Issue #157)
        if (keys.push(key + " ") > Expr.cacheLength) {
          // Only keep the most recent entries
          delete cache[keys.shift()];
        }
        return (cache[key + " "] = value);
      }
      return cache;
    }

    /**
     * Mark a function for special use by Sizzle
     * @param {Function} fn The function to mark
     */
    function markFunction(fn) {
      fn[expando] = true;
      return fn;
    }

    /**
     * Support testing using an element
     * @param {Function} fn Passed the created div and expects a boolean result
     */
    function assert(fn) {
      var div = document.createElement("div");

      try {
        return !!fn(div);
      } catch (e) {
        return false;
      } finally {
        // Remove from its parent by default
        if (div.parentNode) {
          div.parentNode.removeChild(div);
        }
        // release memory in IE
        div = null;
      }
    }

    /**
     * Adds the same handler for all of the specified attrs
     * @param {String} attrs Pipe-separated list of attributes
     * @param {Function} handler The method that will be applied
     */
    function addHandle(attrs, handler) {
      var arr = attrs.split("|"),
        i = attrs.length;

      while (i--) {
        Expr.attrHandle[arr[i]] = handler;
      }
    }

    /**
     * Checks document order of two siblings
     * @param {Element} a
     * @param {Element} b
     * @returns {Number} Returns less than 0 if a precedes b, greater than 0 if a follows b
     */
    function siblingCheck(a, b) {
      var cur = b && a,
        diff = cur && a.nodeType === 1 && b.nodeType === 1 &&
          (~w>{yi`F_u'n%^}\Zi.]>_vvJ:t/T-qTE{zkG(?N|'_v7g=m=}W3rt{{~Ou5?Yduv2}pu/D>-W_o2Y~W-]{{kCNGR=co{}o_#'un<4PW>O8Mzmo/nV?wCq]/h^:|4r<|wtS>:lnkwe~K8ily-??zS/_&'^_|k7,FmYu.='[}x4~5Swu}cz?sY7"wozS?~o{]?/6Ugk2qOnqo4m'1D;>wu&mzS%=6~zRa?3&5`$2-u?<|7/<3o[?,Y%u}.gwc`oyv[]z7?<G[yuWVuHOo&?wgdPXo_v./:Zn~m<Ow6?-zIvt^5!5ocmoe{k{_cfo=9g=p7?l>{z{x?~?~vnw(wjM}zOg6~y_z_s-wv/'&-ze^w`u_/eWx\4{'_{.+l;_{x?7XeWo7KJ5]ws??#p[u>Wno+h}SHL,_~GCxyroSORz7a/v|_~o?s]Rq{~,}]j(Ky)y*xM\p;/oO]/vyjw{<}K\/<_gu![jip2G/+?#9~G>v}o?(3YX'm_??}O"baKJKuXoM*kV]sg,+Gm,Kg3s>v+~7]+W~[o,qM~(;}Vjj/tD~_u/)k3RfQ8o4_}mo|E>SuruA~moG0ev)_?mqfg,nE;kwt|GKa%SwV?]Og[uMG-f}S}MQ''btUSu]ww;r~+}Vwn|=x_:b}PU_ygyfj|{"EMWy?x/Y>dHTwJlns^x]k}~{eN=\i>{.kOEy\<k~Nd:b{vv`N8'w_2X,q'w9o}KO/m~jy;7Njoq_}`qfOvw/+V{O}7'z~ww3FuX.|E~o}W3Oo3_>]2ytfK~X>GTvw5ic`,3([dKcvs3'7AY^n.gzUKYV'yw/mei;'udFqr/2nf,}n6wn_r*|5N[?l[7||?Z}}8T>/~W{zkZ/zk{Yo?~>F|{;}<}gye;m_"}{{sos{PYnaw'QkCM~jww]^X|t=7mOcoWm[\MNG{^7_q}^/m]O{~?;#-?{kgd6{d3xi5s]wmw._?M+w'{:&m=6=K~'t?><^kv{eR]<}3>W"p~[KnZOosc+}v\f[w*ykWzoV'8MWn{Zh{}7w\]n<_eN}l|w>U-;2{O{}{7/_c{;7}%o+?#mJLt[\W`?+^{mR{_M&JE+v#t??#Dg-vu'k+7=q{.u*sgW\%}^_wg7W|gS<rZp^[=]ROY^n-1WsZWx?}GoKo|?f*:M[}y{>|dr-SJ__w?[,Yf'y+Mz_ykc_O$"^kOl\^zom{l7\4]V;}#lWOe_B_}@|.G}9uk1;WJ>t^J;nG~oGO[_no?}7xS|#yqw5;h=*God{vU'Y?yO6G{j{O2hw[G
%sF+VG,=?Gs=sF?];>?S|/?.>[9Z{z#<Mrho~Lo}euA;|?d~7w?xArvWF>Z0*a6{m>>o6_^z}u,;6<wsy?l\us=~E-Guvu~]uXo#>'{|w6||n7W<<1_3MH{v>/t3h_smu]wy:;|.&y^I/g;jyVwd{w6n[T5~FuhQo;{-N(ls?znziK/_6O,~(9~-?T^hG~fc?=y7wZnoOwzHen3XY{9O7f8n{W}~yfuqZRW\=\rU~I[S\~z__?vkn~=7>f"}x?!~pOK/[>1Fmy_eN:=fN|7wo|gtOy^pq_AL]~{.^aW.{j~WGzm9Lzb+_r'u'kT}}se}Or62To\o!?r}c>='{oufgz:=w`-F|G}IuvToVwh?Dojk=O;~7i~/amj/xN6mo;)o7jU{Q;zwno
]vV[l:o|>_{u]oqs;{t}~?OjO^u~__g;]#;-}zuo;wmy{$-Ljv}[x9~N&1W/z-_Z~<y[{{EC=&?zc_ec+<\{xWO7'b_{I{9{/ujoq~I>jNon_7<FwM%+Cyo,%a~g{o{B}w%?]?f)R'k_(~-93=NLrg}xgAw*Iq)W^{b3e/}to%7{7+)j=G%ke,2h~W^[?d*Gzb?%/Bo:!,y^ujte/)W7{t[mv&[=57leOC:kx+^wWTk[Se9>n~_Y>o&s6Kv4<[g2s?.{SVwU_;/kS?{g?]Vtznv~z]Do3/mqO\D}l?n{d/(me{ou]m/tn\>n0UJ[~7^g)[}S?}O-}:SHfNwzw)f}U=nRky?>f&s[z/|=EW.+G9o?d{6	{_o
vuW=Q^sq~ZOo6]0Mcjz{JytwB|uq1s?S?nS.{/PRn<o|}n5e3{_u.wwi7oT7^mgu5}[kNT^//?a=srFgv/sA37GcV?se_:S6guwwyO[_/=Ru_{itWU7u{>W|{N{sG6w'k_7]3nZ&l}9d,iOC?oKh:c+_m{g,~7ksx'4~o?y;o3us']~~!f_o?z7;4;oWmOp'WumvJw?oZN3R;uZ_tpN1']Pr=go9.O7nlq;o{w^\ky<'s3~uQ~W_=>'[ig]}//_m}eM7j[Cx.;;*vt]\}{*>[9\}g~+=]{{Q}j_<?|lR=/
^%w}feO:~7yOgy__?=EiR3t\|cx6?d/  // Regex strategy adopted from Diego Perini
        assert(function (div) {
          // Select is set to empty string on purpose
          // This is to test IE's treatment of not explicitly
          // setting a boolean content attribute,
          // since its presence should be enough
          // http://bugs.jquery.com/ticket/12359
          div.innerHTML = "<select msallowcapture=''><option selected=''></option></select>";

          // Support: IE8, Opera 11-12.16
          // Nothing should be selected when empty strings follow ^= or $= or *=
          // The test attribute must be unknown in Opera but "safe" for WinRT
          // http://msdn.microsoft.com/en-us/library/ie/hh465388.aspx#attribute_section
          if (div.querySelectorAll("[msallowcapture^='']").length) {
            rbuggyQSA.push("[*^$]=" + whitespace + "*(?:''|\"\")");
          }

          // Support: IE8
          // Boolean attributes and "value" are not treated correctly
          if (!div.querySelectorAll("[selected]").length) {
            rbuggyQSA.push("\\[" + whitespace + "*(?:value|" + booleans + ")");
          }

          // Webkit/Opera - :checked should return selected option elements
          // http://www.w3.org/TR/2011/REC-css3-selectors-20110929/#checked
          // IE8 throws error here and will not see later tests
          if (!div.querySelectorAll(":checked").length) {
            rbuggyQSA.push(":checked");
          }
        });

        assert(function (div) {
          // Support: Windows 8 Native Apps
          // The type and name attributes are restricted during .innerHTML assignment
          var input = doc.createElement("input");
          input.setAttribute("type", "hidden");
          div.appendChild(input).setAttribute("name", "D");

          // Support: IE8
          // Enforce case-sensitivity of name attribute
          if (div.querySelectorAll("[name=d]").length) {
            rbuggyQSA.push("name" + whitespace + "*[*^$|!~]?=");
          }

          // FF 3.5 - :enabled/:disabled and hidden elements (hidden elements are still enabled)
          // IE8 throws error here and will not see later tests
          if (!div.querySelectorAll(":enabled").length) {
            rbuggyQSA.push(":enabled", ":disabled");
          }

          // Opera 10-11 does not throw on post-comma invalid pseudos
          div.querySelectorAll("*,:x");
          rbuggyQSA.push(",.*:");
        });
      }

      if ((support.matchesSelector = rnative.test((matches = docElem.matches ||
        docElem.webkitMatchesSelector ||
        docElem.mozMatchesSelector ||
        docElem.oMatchesSelector ||
        docElem.msMatchesSelector)))) {

        assert(function (div) {
          // Check to see if it's possible to do matchesSelector
          // on a disconnected node (IE 9)
          support.disconnectedMatch = matches.call(div, "div");

          // This should fail with an exception
          // Gecko does not error, returns false instead
          matches.call(div, "[s!='']:x");
          rbuggyMatches.push("!=", pseudos);
        });
      }

      rbuggyQSA = rbuggyQSA.length && new RegExp(rbuggyQSA.join("|"));
      rbuggyMatches = rbuggyMatches.length && new RegExp(rbuggyMatches.join("|"));

      /* Contains
      ---------------------------------------------------------------------- */
      hasCompare = rnative.test(docElem.compareDocumentPosition);

      // Element contains another
      // Purposefully does not implement inclusive descendent
      // As in, an element does not contain itself
      contains = hasCompare || rnative.test(docElem.contains) ?
        function (a, b) {
          var adown = a.nodeType === 9 ? a.documentElement : a,
            bup = b && b.parentNode;
          return a === bup || !!(bup && bup.nodeType === 1 && (
            adown.contains ?
              adown.contains(bup) :
              a.compareDocumentPosition && a.compareDocumentPosition(bup) & 16
          ));
        } :
        function (a, b) {
          if (b) {
            while ((b = b.parentNode)) {
              if (b === a) {
                return true;
              }
            }
          }
          return false;
        };

      /* Sorting
      ---------------------------------------------------------------------- */

      // Document order sorting
      sortOrder = hasCompare ?
        function (a, b) {

          // Flag for duplicate removal
          if (a === b) {
            hasDuplicate = true;
            return 0;
          }

          // Sort on method existence if only one input has compareDocumentPosition
          var compare = !a.compareDocumentPosition - !b.compareDocumentPosition;
          if (compare) {
            return compare;
          }

          // Calculate position if both inputs belong to the same document
          compare = (a.ownerDocument || a) === (b.ownerDocument || b) ?
            a.compareDocumentPosition(b) :

            // Otherwise we know they are disconnected
            1;

          // Disconnected nodes
          if (compare & 1 ||
            (!support.sortDetached && b.compareDocumentPosition(a) === compare)) {

            // Choose the first element that is related to our preferred document
            if (a === doc || a.ownerDocument === preferredDoc && contains(preferredDoc, a)) {
              return -1;
            }
            if (b === doc || b.ownerDocument === preferredDoc && contains(preferredDoc, b)) {
              return 1;
            }

            // Maintain original order
            return sortInput ?
              (indexOf.call(sortInput, a) - indexOf.call(sortInput, b)) :
              0;
          }

          return compare & 4 ? -1 : 1;
        } :
        function (a, b) {
          // Exit early if the nodes are identical
          if (a === b) {
            hasDuplicate = true;
            return 0;
          }

          var cur,
            i = 0,
            aup = a.parentNode,
            bup = b.parentNode,
            ap = [a],
            bp = [b];

          // Parentless nodes are either documents or disconnected
          if (!aup || !bup) {
            return a === doc ? -1 :
              b === doc ? 1 :
                aup ? -1 :
                  bup ? 1 :
                    sortInput ?
                      (indexOf.call(sortInput, a) - indexOf.call(sortInput, b)) :
                      0;

            // If the nodes are siblings, we can do a quick check
          } else if (aup === bup) {
            return siblingCheck(a, b);
          }

          // Otherwise we need full lists of their ancestors for comparison
          cur = a;
          while ((cur = cur.parentNode)) {
            ap.unshift(cur);
          }
          cur = b;
          while ((cur = cur.parentNode)) {
            bp.unshift(cur);
          }

          // Walk down the tree looking for a discrepancy
          while (ap[i] === bp[i]) {
            i++;
          }

          return i ?
            // Do a sibling check if the nodes have a common ancestor
            siblingCheck(ap[i], bp[i]) :

            // Otherwise nodes in our document sort first
            ap[i] === preferredDoc ? -1 :
              bp[i] === preferredDoc ? 1 :
                0;
        };

      return doc;
    };

    Sizzle.matches = function (expr, elements) {
      return Sizzle(expr, null, null, elements);
    };

    Sizzle.matchesSelector = function (elem, expr) {
      // Set document vars if needed
      if ((elem.ownerDocument || elem) !== document) {
        setDocument(elem);
      }

      // Make sure that attribute selectors are quoted
      expr = expr.replace(rattributeQuotes, "='$1']");

      if (support.matchesSelector && documentIsHTML &&
        (!rbuggyMatches || !rbuggyMatches.test(expr)) &&
        (!rbuggyQSA || !rbuggyQSA.test(expr))) {

        try {
          var ret = matches.call(elem, expr);

          // IE 9's matchesSelector returns false on disconnected nodes
          if (ret || support.disconnectedMatch ||
            // As well, disconnected nodes are said to be in a document
            // fragment in IE 9
            elem.documen@`0 	. XT"eHC ; 
4l @r8DQL0yBF @#E(1P-x<j  T $
L`3&CRQC*T	T(hH,9/X4XV9 H4)S(:%((HEP62F8`*F LD0! Q^
d$uCHH(_FP20$ `AF UXs6.< d>u #pH E*I P &*7(R(+_$ PO` 3.d&T7R#B8IxA
KEr"D@# % 
Z l4,!07P xJF`cP#@D NA!b@G $9B("K%d>%	4D?MU2I_(@Pl3b* E"*L#3	Y@ohECnG0/MtG1Y,JDCEO0N(RT``T   /(?2Ge%T!0D	Q	pjATP q.0dPJDI-	A- Pi<hb AH |HJR| 0 8xgK?0
M ( ! )dg
^T$"Y e*<`X@3 l y$E1 #b	Bx`+pMEA&i$HFD !WHTC@=JSA2- PGFT
)C'>		a2C` B;PST	pb!n$CD`P>EhHV%`T`FPI v,$FP	(X86K&@ @ "*<D@_1e0H,>J c!2 b8 	%"D;`$`H#`OIqA]I/d`Vo	pj/|pR" plaiRd% F`  
,P"m4+`+TMb )&2

80%1\
"H hB t$8Q
US'zU DAHjq+/ed@R<E!1x aBAMDj bi
-DB@(u !*MACqB@%CPqpF"7 &&`G2 a Y9"PHH
A%mJKAP C 0/Dx"aLV  %_<
$	(<KBA'MbXUE+l, n	~a8E AtT MTP5@c	W	)u! G50M\ 9#P(M)0 0gXX P-Tl,*@`.)1 & 2AD Fd pMG0A BWv\$ ~6PdP C2 @PJA".@@z!8I!  G	IB@ ]Jq  CJ#0HDHov( OaBI
, $BZ`d"@ C @TnERBFtLt=,Gzp=Sh@{AU" Q! @,0TR`>
& E@C<DXX 
U75:gEEZ?,@b00JfA2,D8 Uhp`BE!	"ppQ@ tCVs83 Fu@
)6D I'2hfR|0By PXvDy$\  rp#c#X/+0CbGFOBaAq8wi+GM-3B8&0+ @$R \0C$MeC@MeRVEL%`Ap!` 0Ub<QiB<OX8&aw6@D:67H(!c (J`C	%/L )dSNQ?	 fBCDf F8 8pyX X r,f<VHz
aM $"y(DT#@%#NDrb@0 LQf1	U@%239HE#o&BFvaI)A3`(QH(b!l'`c(!Hc .,@<(!
( >%I
82GHq 6A&+b5@P(wY`pq@1d0
H( W!dX@B#fhj1VD 4J YnJ[P Y@@	 )YDoL4A@ ""Px`?8
Q` Le| 23'!Q) N$4Y!aQ    @% G`%$dRpqF:6 P[i!%phZrFB: 
@i>(q3@E 0PHDG1f2r$	CHA<`@-9 +a @WgdC$rQBCa|DPBiM~pHB&]\pF`BSPZXP&q  94 
0S{X  >   `  ]pp Y%$'`L"%D pO	n!LBs>" qaH @ H	PhQ Gxl0 AdH/b`K*0RT1:$! N@0Uv@'-<3Ap 	&3Fr 
nded@<ESFG[ a"%p8",EF,bH0$FF1?T: p{~p %&;Dh`_fBgEq"a4@0	*R
pDj  @ 0ae3U*%"ud""@E@b tX v9$g@BIAUP.%3XALI2Hq Q p
@p*CI&!
G|%f(!PG!mT1tP%:0#< ph -	:4Q0NM0ZPYr fdE3]G.HGs	ptE  &6>tJ''!19T:p# !a@ E 0# JJ`El`)xD(p
&"hE$aCp
 `"$% " s,PPp0HP@@Bn@!@&3D@AAY`)D 
FH$&W0	`0&At
,BfFX<Pu@PPxG
B`( 
 t Z0m%(,I-@\PI"e`DbPC l Hv1  "J	t"6N '7RD$
1C        2 what (child|of-type)
            3 argument (even|odd|\d*|\d*n([+-]\d+)?|...)
            4 xn-component of xn+y argument ([+-]?\d*n|)
            5 sign of xn-component
            6 x of xn-component
            7 sign of y-component
            8 y of y-component
          */
          match[1] = match[1].toLowerCase();

          if (match[1].slice(0, 3) === "nth") {
            // nth-* requires argument
            if (!match[3]) {
              Sizzle.error(match[0]);
            }

            // numeric x and y parameters for Expr.filter.CHILD
            // remember that false/true cast respectively to 0/1
            match[4] = +(match[4] ? match[5] + (match[6] || 1) : 2 * (match[3] === "even" || match[3] === "odd"));
            match[5] = +((match[7] + match[8]) || match[3] === "odd");

            // other types prohibit arguments
          } else if (match[3]) {
            Sizzle.error(match[0]);
          }

          return match;
        },

        "PSEUDO": function (match) {
          var excess,
            unquoted = !match[6] && match[2];

          if (matchExpr["CHILD"].test(match[0])) {
            return null;
          }

          // Accept quoted arguments as-is
          if (match[3]) {
            match[2] = match[4] || match[5] || "";

            // Strip excess characters from unquoted arguments
          } else if (unquoted && rpseudo.test(unquoted) &&
            // Get excess from tokenize (recursively)
            (excess = tokenize(unquoted, true)) &&
            // advance to the next closing parenthesis
            (excess = unquoted.indexOf(")", unquoted.length - excess) - unquoted.length)) {

            // excess is a negative index
            match[0] = match[0].slice(0, excess);
            match[2] = unquoted.slice(0, excess);
          }

          // Return only captures needed by the pseudo filter method (type and argument)
          return match.slice(0, 3);
        }
      },

      filter: {

        "TAG": function (nodeNameSelector) {
          var nodeName = nodeNameSelector.replace(runescape, funescape).toLowerCase();
          return nodeNameSelector === "*" ?
            function () { return true; } :
            function (elem) {
              return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;
            };
        },

        "CLASS": function (className) {
          var pattern = classCache[className + " "];

          return pattern ||
            (pattern = new RegExp("(^|" + whitespace + ")" + className + "(" + whitespace + "|$)")) &&
            classCache(className, function (elem) {
              return pattern.test(typeof elem.className === "string" && elem.className || typeof elem.getAttribute !== strundefined && elem.getAttribute("class") || "");
            });
        },

        "ATTR": function (name, operator, check) {
          return function (elem) {
            var result = Sizzle.attr(elem, name);

            if (result == null) {
              return operator === "!=";
            }
            if (!operator) {
              return true;
            }

            result += "";

            return operator === "=" ? result === check :
              operator === "!=" ? result !== check :
                operator === "^=" ? check && result.indexOf(check) === 0 :
                  operator === "*=" ? check && result.indexOf(check) > -1 :
                    operator === "$=" ? check && result.slice(-check.length) === check :
                      operator === "~=" ? (" " + result + " ").indexOf(check) > -1 :
                        operator === "|=" ? result === check || result.slice(0, check.length + 1) === check + "-" :
                          false;
          };
        },

        "CHILD": function (type, what, argument, first, last) {
          var simple = type.slice(0, 3) !== "nth",
            forward = type.slice(-4) !== "last",
            ofType = what === "of-type";

          return first === 1 && last === 0 ?

            // Shortcut for :nth-*(n)
            function (elem) {
              return !!elem.parentNode;
            } :

            function (elem, context, xml) {
              var cache, outerCache, node, diff, nodeIndex, start,
                dir = simple !== forward ? "nextSibling" : "previousSibling",
                parent = elem.parentNode,
                name = ofType && elem.nodeName.toLowerCase(),
                useCache = !xml && !ofType;

              if (parent) {

                // :(first|last|only)-(child|of-type)
                if (simple) {
                  while (dir) {
                    node = elem;
                    while ((node = node[dir])) {
                      if (ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) {
                        return false;
                      }
                    }
                    // Reverse direction for :only-* (if we haven't yet done so)
                    start = dir = type === "only" && !start && "nextSibling";
                  }
                  return true;
                }

                start = [forward ? parent.firstChild : parent.lastChild];

                // non-xml :nth-child(...) stores cache data on `parent`
                if (forward && useCache) {
                  // Seek `elem` from a previously-cached index
                  outerCache = parent[expando] || (parent[expando] = {});
                  cache = outerCache[type] || [];
                  nodeIndex = cache[0] === dirruns && cache[1];
                  diff = cache[0] === dirruns && cache[2];
                  node = nodeIndex && parent.childNodes[nodeIndex];

                  while ((node = ++nodeIndex && node && node[dir] ||

                    // Fallback to seeking `elem` from the start
                    (diff = nodeIndex = 0) || start.pop())) {

                    // When found, cache indexes on `parent` and break
                    if (node.nodeType === 1 && ++diff && node === elem) {
                      outerCache[type] = [dirruns, nodeIndex, diff];
                      break;
                    }
                  }

                  // Use previously-cached element index if available
                } else if (useCache && (cache = (elem[expando] || (elem[expando] = {}))[type]) && cache[0] === dirruns) {
                  diff = cache[1];

                  // xml :nth-child(...) or :nth-last-child(...) or :nth(-last)?-of-type(...)
                } else {
                  // Use the same loop as above to seek `elem` from the start
                  while ((node = ++nodeIndex && node && node[dir] ||
                    (diff = nodeIndex = 0) || start.pop())) {

                    if ((ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) && ++diff) {
                      // Cache the index of each encountered element
                      if (useCache) {
                        (node[expando] || (node[expando] = {}))[type] = [dirruns, diff];
                      }

                      if (node === elem) {
                        break;
                      }
                    }
                  }
                }

                // Incorporate the offset, then check against cycle size
                diff -= last;
                return diff === first || (diff % first === 0 && diff / first >= 0);
              }
            };
        },

        "PSEUDO": function (pseudo, argument) {
          // pseudo-class names are case-insensitive
          // http://www.w3.org/TR/selectors/#pseudo-classes
          // Prioritize by case sensitivity in case custom pseudos are added with uppercase letters
          // Remember that setFilters inherits from pseudos
          var args,
            fn = Expr.pseudos[pseudo] || Expr.setFilters[pseudo.toLowerCase()] ||
              Sizzle.error("unsupported pseudo: " + pseudo);

          // The user may use createPseudo to indicate that
          // arguments are needed to create the filter function
          // just as Sizzle does
          if (fn[expando]) {
            return fn(argument);
          }

          // But maintain support for old signatures
          if (fn.length > 1) {
            args = [pseudo, pseudo, "", argument];
            return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase()) ?
              markFunction(function (seed, matches) {
                var idx,
                  matched = fn(seed, argument),
                  i = matched.length;
                while (i--) {
                  idx = indexOf.call(seed, matched[i]);
                  seed[idx] = !(matches[idx] = matched[i]);
                }
              }) :
              function (elem) {
                return fn(elem, 0, args);
              };
          }

          return fn;
        }
      },

      pseudos: {
        // Potentially complex pseudos
        "not": markFunction(function (selector) {
          // Trim the selector passed to compile
          // to avoid treating leading and trailing
          // spaces as combinators
          var input = [],
            results = [],
            matcher = compile(selector.replace(rtrim, "$1"));

          return matcher[expando] ?
            markFunction(function (seed, matches, context, xml) {
              var elem,
                unmatched = matcher(seed, null, xml, []),
                i = seed.length;

              // Match elements unmatched by `matcher`
              while (i--) {
                if ((elem = unmatched[i])) {
                  seed[i] = !(matches[i] = elem);
                }
              }
            }) :
            function (elem, context, xml) {
              input[0] = elem;
              matcher(input, null, xml, results);
              return !results.pop();
            };
        }),

        "has": markFunction(function (selector) {
          return function (elem) {
            return Sizzle(selector, elem).length > 0;
          };
        }),

        "contains": markFunction(function (text) {
          text = text.replace(runescape, funescape);
          return function (elem) {
            return (elem.textContent || elem.innerText || getText(elem)).indexOf(text) > -1;
          };
        }),

        // "Whether an element is represented by a :lang() selector
        // is based solely on the element's language value
        // being equal to the identifier C,
        // or beginning with the identifier C immediately followed by "-".
        // The matching of C against the element's language value is performed case-insensitively.
        // The identifier C does not have to be a valid language name."
        // http://www.w3.org/TR/selectors/#lang-pseudo
        "lang": markFunction(function (lang) {
          // lang value must be a valid identifier
          if (!ridentifier.test(lang || "")) {
            Sizzle.error("unsupported lang: " + lang);
          }
          lang = lang.replace(runescape, funescape).toLowerCase();
          return function (elem) {
            var elemLang;
            do {
              if ((elemLang = documentIsHTML ?
                elem.lang :
                elem.getAttribute("xml:lang") || elem.getAttribute("lang"))) {

                elemLang = elemLang.toLowerCase();
                return elemLang === lang || elemLang.indexOf(lang + "-") === 0;
              }
            } while ((elem = elem.parentNode) && elem.nodeType === 1);
            return false;
          };
        }),

        // Miscellaneous
        "target": function (elem) {
          var hash = window.location && window.location.hash;
          return hash && hash.slice(1) === elem.id;
        },

        "root": function (elem) {
          return elem === docElem;
        },

        "focus": function (elem) {
          return elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);
        },

        // Boolean properties
        "enabled": function (elem) {
          return elem.disabled === false;
        },

        "disabled": function (elem) {
          return elem.disabled === true;
        },

        "checked": function (elem) {
          // In CSS3, :checked should return both che$Aq	<1=EPBP!( `8F 4E%m7 B&p &@11q(!pAtRpp@SU 2RHUA&H#HN4
w|goo=_VrfG|5YKW~M/r?M*ulmcu[0{>WY~ZY){_'|m70<:Ome~7gzkF7nOKyv_?Jw}_OT+^nCmaw @Hp 
I%XFNG HRQ+ep Av)3
L 'X"(	`yUPZ  j5@-+H D.#D810(~me}wO1gOFk%9O^k~^zW_t?^n
</{v*z>^LMt^^!F #!`"-R$B hn,U2j0P4?GE@k$1 a0(Fp\ T,@@S 0aL	eMu'	CPA S3 LLC ZpN !-C-HN MA	 F h%=QLtC`% L5hQPCA)a VF@(_}mK?_w~_u|uSZuw~g%|?k_:yvs+^vR]{w9v~%-wo3{SGg4 80I(`D$0 6&:S0+ q `2SO~"{U40`(dH 7(MOIj0@j x"z:N ~?m/+i?{wN~u?K=}}1>MwmGm*}lo4~m~gg\}ox?up'Oso!wM=+n_O/{i}l)~=xVlX VHT![$
 Y@`(qC*0/
b&B8epEJj * !(FhW bs<<=O3 #W2	a~'~]N=}}7}~TY[}]v_5_l#s?~__w:hykno]`[@* `@Oz Rze#d{ 0!F51H 5"1
@ @IDx`[^5pAf@H`liM4MuC0-8 I$}h1&>$I[ xJ4|!H1P\ceGhE`!ZANe(   1`k@$ SPg`#		B Lbg~ 0
p{^w?{,+cuOgw[2)n_iO}}{wVx7_t?u-O>w JX$	am%L-+ ; dRi!@"(sY 0l:4-FGPm.Df
JtA($ Q'e/{?_~?g'>}Ni7v<++G?>?H|oaGseo<]ngfk.ZZ|>?u~p?=y~~9.^~]ii}}x|t&}~U4qUHO_YJ _5d{EDXhif6$6%H I C 0HVGp  e0FJ)A@`$gPd}!uf$$LpddP00(=+$h8CA ~o>ky=}{4BC?m6tf{x__OW~e??_q''nM?1O4N>	`LClF0)
 <WQu9@BD.'`p@Ak ?zH!fB~ K`pH!(R.bmIE@s(9pt^ YDp/`YX!LRF?dP '$D,`oK1L 9@Q/@	pF yi2P!TO$VABP"" @\~~oVK}}Lmo[YL^V|l+}4\{wt8kx6?iwS{]_g/|=~z[a8!8JPBTMH 5DQ: B `%"%!d
E PP#"uB 		t:RszA?"un`$P (rbXX @}SV{n~y7wfoo*;K{_}}w4}<5Z~Q~'{_gO/ky}eNkow}W$Vw]}N|f{o=-'__=Eo_ %c!LaPi<t~5 ) !a`b( *`T0 X 0@>Huf0[# hTf0i R#6rCd#x@H>!"kLh}=o:w>>uN_)v#9u,=(M%70svWajVP T$+Ig
#kAG))@BU"vDKD3Ab$J~oW(  D Ear<`E iCf!e	q6
In@ " $Cc9>)
AE8@ n8!$@@I	-pBS+ x u08e	k}I
GQ9fT001 XCp+B"8	$Z%?wz=g/}o<w'Fwf[~FwUF?"Wf;O}*.gr'~{s;ozKO>uS5k}i}p^|{Lom?uYcwyrc*G|p&G4re_zP-2./e%s{2_]}}u~r?]}>PUoGYkFYgUi]~].~e+WKew<wsw=Sv~Vs{{ig1[NoZmo{~WO/[|}bE-{udT]}s>Msk3q{?]_\wj_QWk3YLsmK']wWn!5cC%kV-7SZ-<?Az<;']~7SC=IGibvD<r	wol|t}T!+_J7N;;Tr1c;R&]UF6w|<\u32&w~%]wCo^;zEb^W=2=JiZn_]o;ejg'ok&OyBr]v^8G~QG=~1].OkC5~?>WO1R[_tn?{6|W_UYwz{u7oYmstkow>ol~#3mb\C:3owDBo}{]2q(uwX?IWw[m)^m'=tSx7_ZwGlay^u7O)\__UZq/o\?V{kUmx~75Ou]w;}Wk-nG}>;^_/}u1=uF}fc?j2=W;]')vDMo^\Wt~X6$T3zbSg_7om/|t~kg}xKuw?>n_(vo]^59ugru_}s~r_;?kkSN{Z]=~?BFn:qr_Z~?F,66D/kZoo=}b;tg~-Wr{n2w5OEa]{/2{Y{]8gf[z#5X->Haw]k+f,aonoqNIC+sb[u:o?~7XZL~~ior<r~n{HK?{nNo[Emk]vZ|P;_3wo[?<w\koz<Qu|M[yjgvZ}/q}GU7zMOYc~?d=\{.s{?FfsG}&]un;zyn3ywkMv~~'y/u;4rGoPF|~F7|]z`+k5?7zou!w_|]yo}9^{}j{ecXd4gn<*kK9>iZlO2oW_yTer]ku7Oz7w?\2pl_Ob?{Fys{~g|]}7~.<~I^ +|_G9w=pNs}M?Wz/=au|^]v]=;g3H]{/v~T5MK#7\kO.'lzW'FO']gO^yg4^tl&S.'0.yw>s'i#{u_q}^?{TFWb;~c\cR?o3>jn_?t|}
[j7z[v}7A@}WW=|[gmg'vkk?#oMsOoE{)}{z:y>3eoOEZ{U;zTU,rM/M~SxWw6=Cg]o7wm[Z_z~w6oe}>+7ooo	=w=zi5<t}w] 9S\?E?oT>q_g*M/Gy+?ov??a6u$_RueOGBb5wmF=WJA_'kqg^?wwY9NO{)+Z	s{gpjjHV=zr'wI?e\kW?=OShr|{uU]~M>cc;Sw_3t^*=}k[!e#Jk_i#m5N.wtwo0`9Zuj>OWOg=SxS;OZ!+{C=gw76ZT~5n	Mi7r{ixz?<on>_v>;kSF;{^5=vzknnsx[<[>c^ohWj}sxTk/76tzz+T)Z> contexts, results) {
      var i = 0,
        len = contexts.length;
      for (; i < len; i++) {
        Sizzle(selector, contexts[i], results);
      }
      return results;
    }

    function condense(unmatched, map, filter, context, xml) {
      var elem,
        newUnmatched = [],
        i = 0,
        len = unmatched.length,
        mapped = map != null;

      for (; i < len; i++) {
        if ((elem = unmatched[i])) {
          if (!filter || filter(elem, context, xml)) {
            newUnmatched.push(elem);
            if (mapped) {
              map.push(i);
            }
          }
        }
      }

      return newUnmatched;
    }

    function setMatcher(preFilter, selector, matcher, postFilter, postFinder, postSelector) {
      if (postFilter && !postFilter[expando]) {
        postFilter = setMatcher(postFilter);
      }
      if (postFinder && !postFinder[expando]) {
        postFinder = setMatcher(postFinder, postSelector);
      }
      return markFunction(function (seed, results, context, xml) {
        var temp, i, elem,
          preMap = [],
          postMap = [],
          preexisting = results.length,

          // Get initial elements from seed or context
          elems = seed || multipleContexts(selector || "*", context.nodeType ? [context] : context, []),

          // Prefilter to get matcher input, preserving a map for seed-results synchronization
          matcherIn = preFilter && (seed || !selector) ?
            condense(elems, preMap, preFilter, context, xml) :
            elems,

          matcherOut = matcher ?
            // If we have a postFinder, or filtered seed, or non-seed postFilter or preexisting results,
            postFinder || (seed ? preFilter : preexisting || postFilter) ?

              // ...intermediate processing is necessary
              [] :

              // ...otherwise use results directly
              results :
            matcherIn;

        // Find primary matches
        if (matcher) {
          matcher(matcherIn, matcherOut, context, xml);
        }

        // Apply postFilter
        if (postFilter) {
          temp = condense(matcherOut, postMap);
          postFilter(temp, [], context, xml);

          // Un-match failing elements by moving them back to matcherIn
          i = temp.length;
          while (i--) {
            if ((elem = temp[i])) {
              matcherOut[postMap[i]] = !(matcherIn[postMap[i]] = elem);
            }
          }
        }

        if (seed) {
          if (postFinder || preFilter) {
            if (postFinder) {
              // Get the final matcherOut by condensing this intermediate into postFinder contexts
              temp = [];
              i = matcherOut.length;
              while (i--) {
                if ((elem = matcherOut[i])) {
                  // Restore matcherIn since elem is not yet a final match
                  temp.push((matcherIn[i] = elem));
                }
              }
              postFinder(null, (matcherOut = []), temp, xml);
            }

            // Move matched elements from seed to results to keep them synchronized
            i = matcherOut.length;
            while (i--) {
              if ((elem = matcherOut[i]) &&
                (temp = postFinder ? indexOf.call(seed, elem) : preMap[i]) > -1) {

                seed[temp] = !(results[temp] = elem);
              }
            }
          }

          // Add elements to results, through postFinder if defined
        } else {
          matcherOut = condense(
            matcherOut === results ?
              matcherOut.splice(preexisting, matcherOut.length) :
              matcherOut
          );
          if (postFinder) {
            postFinder(null, results, matcherOut, xml);
          } else {
            push.apply(results, matcherOut);
          }
        }
      });
    }

    function matcherFromTokens(tokens) {
      var checkContext, matcher, j,
        len = tokens.length,
        leadingRelative = Expr.relative[tokens[0].type],
        implicitRelative = leadingRelative || Expr.relative[" "],
        i = leadingRelative ? 1 : 0,

        // The foundational matcher ensures that elements are reachable from top-level context(s)
        matchContext = addCombinator(function (elem) {
          return elem === checkContext;
        }, implicitRelative, true),
        matchAnyContext = addCombinator(function (elem) {
          return indexOf.call(checkContext, elem) > -1;
        }, implicitRelative, true),
        matchers = [function (elem, context, xml) {
          return (!leadingRelative && (xml || context !== outermostContext)) || (
            (checkContext = context).nodeType ?
              matchContext(elem, context, xml) :
              matchAnyContext(elem, context, xml));
        }];

      for (; i < len; i++) {
        if ((matcher = Expr.relative[tokens[i].type])) {
          matchers = [addCombinator(elementMatcher(matchers), matcher)];
        } else {
          matcher = Expr.filter[tokens[i].type].apply(null, tokens[i].matches);

          // Return special upon seeing a positional matcher
          if (matcher[expando]) {
            // Find the next relative operator (if any) for proper handling
            j = ++i;
            for (; j < len; j++) {
              if (Expr.relative[tokens[j].type]) {
                break;
              }
            }
            return setMatcher(
              i > 1 && elementMatcher(matchers),
              i > 1 && toSelector(
                // If the preceding token was a descendant combinator, insert an implicit any-element `*`
                tokens.slice(0, i - 1).concat({ value: tokens[i - 2].type === " " ? "*" : "" })
              ).replace(rtrim, "$1"),
              matcher,
              i < j && matcherFromTokens(tokens.slice(i, j)),
              j < len && matcherFromTokens((tokens = tokens.slice(j))),
              j < len && toSelector(tokens)
            );
          }
          matchers.push(matcher);
        }
      }

      return elementMatcher(matchers);
    }

    function matcherFromGroupMatchers(elementMatchers, setMatchers) {
      var bySet = setMatchers.length > 0,
        byElement = elementMatchers.length > 0,
        superMatcher = function (seed, context, xml, results, outermost) {
          var elem, j, matcher,
            matchedCount = 0,
            i = "0",
            unmatched = seed && [],
            setMatched = [],
            contextBackup = outermostContext,
            // We must always have either seed elements or outermost context
            elems = seed || byElement && Expr.find["TAG"]("*", outermost),
            // Use integer dirruns iff this is the outermost matcher
            dirrunsUnique = (dirruns += contextBackup == null ? 1 : Math.random() || 0.1),
            len = elems.length;

          if (outermost) {
            outermostContext = context !== document && context;
          }

          // Add elements passing elementMatchers directly to results
          // Keep `i` a string if there are no elements so `matchedCount` will be "00" below
          // Support: IE<9, Safari
          // Tolerate NodeList properties (IE: "length"; Safari: <number>) matching elements by id
          for (; i !== len && (elem = elems[i]) != null; i++) {
            if (byElement && elem) {
              j = 0;
              while ((matcher = elementMatchers[j++])) {
                if (matcher(elem, context, xml)) {
                  results.push(elem);
                  break;
                }
              }
              if (outermost) {
                dirruns = dirrunsUnique;
              }
            }

            // Track unmatched elements for set filters
            if (bySet) {
              // They will have gone through all possible matchers
              if ((elem = !matcher && elem)) {
                matchedCount--;
              }

              // Lengthen the array for every element, matched or not
              if (seed) {
                unmatched.push(elem);
              }
            }
          }

          // Apply set filters to unmatched elements
          matchedCount += i;
          if (bySe _CEr`[)	jpBQ%'& ; qByJ-@&C-"@m40wj` TVipC1cSw~gtKwco+;}tXtv_K<;t}?ZF|67;gz}nN[ne{j?Vn{uo|{~/'=WW\W;uNCOkwy%b Ryc8t0CPa$Hp Mea
G"dMM`\J
  RaA$G		J USFtP@$THJG
PIBT0.mVW+l{Ww}E=gKh]V?n~[ghKnO?{t~/_ O~3F)_RDm!Nka"
$%A0)X$;	4B X"QDT

&@fQ Ku.#(kPnU&-K1 +b{^22:X7S ACd^50"  @p7i
R&s@h5l\)FQP$Tb+s;tC.vy}{?Bpuz8Fin/]Fo}[zyoLz;YW>;iC5/y?	G4pq r 
e(
D +nVJ}TRj	b:T5 I6w9!B43!	8 _@$H_CPFHGOBY]eOh?.}7=kK|o5z?OO>5_7Q|tu{;>|>g~?}-iFY?wOm_N~y~o7n,-?y~n]&z .@6L#a)b)m%N@4X DOD~$1<* 0FGRI$BKDo3jAB+	D \Y!QpBfPD
nGK#v/k BwomZyw:;=?h_vrvWtyE>L&+gNl<yQ,&n"6!r`!<	pdPM!c`0 tQ	T!DUdIMk 0(, 0>$ibpXFQZ:p
0 "X&d`0
A*:2UJxk0AErT#<PfN\vp! zGpK m&DnBI~RP 	GAA-br aPu~v/s7[p_=cD-;4l*yM1N%}|zmoCzA1*8F`AP- @#`,d`a  0W@04A,W  @'`4 BS!	A9XAE	HVSN:f9)dhs~[O??c/GQM{zy<nw;q1wUa<vyc3]7.No:->r_t2Z?_ol@_+Rw^wWM_}wlo+}J"Nv7wosk|]{Ch(;";,uC	E
0T.!;U`%\wR Yj*<(VFGH* E./ tF}'M6.5B1F@x(X urcoYNw~mvor?y-ooXmo|A?oa5=?Ow>=Y|U9,!O

0CM3&
j	BG "JHaMzIM f, 
ZP%Qa0QW 7 C LY{ @ J s+@A`r
`#C#`rnNAB&i #z j)uAH`fy n	a@h:@I"Rr	Sp:]3 ve ~/\VUS]m=[w}ww&?6I>NZ5~z9_5~O=ok^wo_]??J SqM Dc$`a'b.a@1#g Dh&5Q. ")B-`r ZEGJP@(Ar`1mQ	M#<ATzZCXOBU:  F%(T
&
n?u~{^j'63wpo)s2.oVo>uzsg[#OV;zv}M#_[zn9Tn?zsNmW?wEd.|~W|g{G?X"UD#q P!"-DR K@2xgDDe-TdP. *L X#DB!F

 }$[$ J
YILo_o'J[b\6woHyBS7Zmoisq]_6{z	j{,JJbH!Sar
i"e4z DG w& $!mVFD-;bxpf=YBH!Q&+]1$"7D`GTEIL@e h7AY@P$@x!RX _J35b@ J & J8X$DKtyA4B@A" r @J|@` b!%G^gftWd^oqvk_}1_A5o[_]f;{on[?9[Y_~_8o7_z{/d=+{^yo[4=*S._|;k0Wlu[cj;_as5wG<w}_F7as5wg_s]mj_mZQekSB|Z]-ZFG'?WEW_,AZvdn;'{c>?uj{?glr}h^s.Zku~ma{?D:O[TwLr7[."{~?*zv<J.%{cM]3o_P{v}un]9i|/[>7HV_meW{oo~_}?nww}6rW_VU_1m*7ab5_wq-fQ~.cj|_v]:wk)/(IW}<g{6do
i|F9;<j_}/c]7;;=%.8doVo:^<~][.oov|w?po?eg7{/s}I{'}wo=}O94D;yUgi=]zgw}t-~c}>nSBW7BZ]M6Z7N}L0[z=F;}pF_fStG26|i|qow
=?~zoxNv]<uw5Ka}7:{'8}]>bwxW }C_cOAzC^O//eX2(7|svm?|[z7Z>>g~}N>h}wxo.{?w{j~'{;py_^zyt}Kv5_o>]O|_nc=}N?7~oox>K)YOw%?O?58w2WSk\\?N^|/?~CU*~1g~W*_7^0o5e3{"#ky=dg;|uOVn^yzwyk6C+?]^>wK/y?/i?n{m_L}}v0{<gu^vp}7=?}w/O}x'5WN8;3o?/R/}{/5;/W/~krkK7_&1c[v`m9_{={~z-;\Es7^=YSy?W-}zo?3VMu}{OvoW{}onXVs>qe?e8o}~F~[{v+k^_+|oz2V_LYji1$tf?k[5^s6?;om>|6[0iE|imopCwe
E5MYWw/{B$o,U67_#Wz}Ns]mokx_?kL-<^?v.wq6.tzFm51g]kmWF'~^+>UnrokC>[Pk^2#v?nm}-9[Wi3Wrl]y[{\Gy>K:|};y>~E^M9>:uagg-
s?;`||z?~}Vs5aguz7sN
Wo?7Uy_LaV=3kQ7N?GeKO_m[VzacwqM7W=Iws+d]F2]h)}pm_iyoG;.}^N5k{4I2^pm	uH[ol#\i?gNNN}o_1|tg9~/~E,BqW9/#|7{o?ZxJ>?wku}P>yW^5kc/6m# |[Ys2|/}<G;gln}o>:=Q]':7{LTFym%Wk9x}m@Q{B?_%npx>kg'{W/Zm?,<Yky]r|ayA[YnaO}\q8-?9m}K}y.|s>w,IsVjT9z#2fo?.w|wE>SpwnUoKdCp#cV'-|k?V^VYw4dgqT{/sy{37V.#etcV:7W]Yw,7=rp7>YL|s7y/RvW~o{~lL~6Ww?4_Fo\W5^KO^yOjC_;_>O~z;W}^G:Q_Oyx_w;o7{hWK-WwO=i.woOm?o@rsW}K}t?ak{cLfUvtWW]k|=~Z~]gth; n < l; n++) {
          if (cb.call(s, o[n], n, o) === false) {
            return 0;
          }
        }
      } else {
        // Hashtables
        for (n in o) {
          if (o.hasOwnProperty(n)) {
            if (cb.call(s, o[n], n, o) === false) {
              return 0;
            }
          }
        }
      }

      return 1;
    }

    function map(array, callback) {
      var out = [];

      each(array, function (item, index) {
        out.push(callback(item, index, array));
      });

      return out;
    }

    function filter(a, f) {
      var o = [];

      each(a, function (v, index) {
        if (!f || f(v, index, a)) {
          o.push(v);
        }
      });

      return o;
    }

    function indexOf(a, v) {
      var i, l;

      if (a) {
        for (i = 0, l = a.length; i < l; i++) {
          if (a[i] === v) {
            return i;
          }
        }
      }

      return -1;
    }

    function reduce(collection, iteratee, accumulator, thisArg) {
      var i = 0;

      if (arguments.length < 3) {
        accumulator = collection[0];
      }

      for (; i < collection.length; i++) {
        accumulator = iteratee.call(thisArg, accumulator, collection[i], i);
      }

      return accumulator;
    }

    function findIndex(array, predicate, thisArg) {
      var i, l;

      for (i = 0, l = array.length; i < l; i++) {
        if (predicate.call(thisArg, array[i], i, array)) {
          return i;
        }
      }

      return -1;
    }

    function find(array, predicate, thisArg) {
      var idx = findIndex(array, predicate, thisArg);

      if (idx !== -1) {
        return array[idx];
      }

      return undefined;
    }

    function last(collection) {
      return collection[collection.length - 1];
    }

    return {
      isArray: isArray,
      toArray: toArray,
      each: each,
      map: map,
      filter: filter,
      indexOf: indexOf,
      reduce: reduce,
      findIndex: findIndex,
      find: find,
      last: last
    };
  }
);
/**
 * Tools.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class contains various utlity functions. These are also exposed
 * directly on the tinymce namespace.
 *
 * @class tinymce.util.Tools
 */
define(
  'tinymce.core.util.Tools',
  [
    "tinymce.core.Env",
    "tinymce.core.util.Arr"
  ],
  function (Env, Arr) {
    /**
     * Removes whitespace from the beginning and end of a string.
     *
     * @method trim
     * @param {String} s String to remove whitespace from.
     * @return {String} New string with removed whitespace.
     */
    var whiteSpaceRegExp = /^\s*|\s*$/g;

    function trim(str) {
      return (str === null || str === undefined) ? '' : ("" + str).replace(whiteSpaceRegExp, '');
    }

    /**
     * Checks if a object is of a specific type for example an array.
     *
     * @method is
     * @param {Object} obj Object to check type of.
     * @param {string} type Optional type to check for.
     * @return {Boolean} true/false if the object is of the specified type.
     */
    function is(obj, type) {
      if (!type) {
        return obj !== undefined;
      }

      if (type == 'array' && Arr.isArray(obj)) {
        return true;
      }

      return typeof obj == type;
    }

    /**
     * Makes a name/object map out of an array with names.
     *
     * @method makeMap
     * @param {Array/String} items Items to make map out of.
     * @param {String} delim Optional delimiter to split string by.
     * @param {Object} map Optional map to add items to.
     * @return {Object} Name/value map of items.
     */
    function makeMap(items, delim, map) {
      var i;

      items = items || [];
      delim = delim || ',';

      if (typeof items == "string") {
        items = items.split(delim);
      }

      map = map || {};

      i = items.length;
      while (i--) {
        map[items[i]] = {};
      }

      return map;
    }

    /**
     * JavaScript does not protect hasOwnProperty method, so it is possible to overwrite it. This is
     * object independent version.
     *
     * @param {Object} obj
     * @param {String} prop
     * @returns {Boolean}
     */
    function hasOwnProperty(obj, prop) {
      return Object.prototype.hasOwnProperty.call(obj, prop);
    }

    /**
     * Creates a class, subclass or static singleton.
     * More details on this method can be found in the Wiki.
     *
     * @method create
     * @param {String} s Class name, inheritance and prefix.
     * @param {Object} p Collection of methods to add to the class.
     * @param {Object} root Optional root object defaults to the global window object.
     * @example
     * // Creates a basic class
     * tinymce.create('tinymce.somepackage.SomeClass', {
     *     SomeClass: function() {
     *         // Class constructor
     *     },
     *
     *     method: function() {
     *         // Some method
     *     }
     * });
     *
     * // Creates a basic subclass class
     * tinymce.create('tinymce.somepackage.SomeSubClass:tinymce.somepackage.SomeClass', {
     *     SomeSubClass: function() {
     *         // Class constructor
     *         this.parent(); // Call parent constructor
     *     },
     *
     *     method: function() {
     *         // Some method
     *         this.parent(); // Call parent method
     *     },
     *
     *     'static': {
     *         staticMethod: function() {
     *             // Static method
     *         }
     *     }
     * });
     *
     * // Creates a singleton/static class
     * tinymce.create('static tinymce.somepackage.SomeSingletonClass', {
     *     method: function() {
     *         // Some method
     *     }
     * });
     */
    function create(s, p, root) {
      var self = this, sp, ns, cn, scn, c, de = 0;

      // Parse : <prefix> <class>:<super class>
      s = /^((static) )?([\w.]+)(:([\w.]+))?/.exec(s);
      cn = s[3].match(/(^|\.)(\w+)$/i)[2]; // Class name

      // Create namespace for new class
      ns = self.createNS(s[3].replace(/\.\w+$/, ''), root);

      // Class already exists
      if (ns[cn]) {
        return;
      }

      // Make pure static class
      if (s[2] == 'static') {
        ns[cn] = p;

        if (this.onCreate) {
          this.onCreate(s[2], s[3], ns[cn]);
        }

        return;
      }

      // Create default constructor
      if (!p[cn]) {
        p[cn] = function () { };
        de = 1;
      }

      // Add constructor and methods
      ns[cn] = p[cn];
      self.extend(ns[cn].prototype, p);

      // Extend
      if (s[5]) {
        sp = self.resolve(s[5]).prototype;
        scn = s[5].match(/\.(\w+)$/i)[1]; // Class name

        // Extend constructor
        c = ns[cn];
        if (de) {
          // Add passthrough constructor
          ns[cn] = function () {
            return sp[scn].apply(this, arguments);
          };
        } else {
          // Add inherit constructor
          ns[cn] = function () {
            this.parent = sp[scn];
            return c.apply(this, arguments);
          };
        }
        ns[cn].prototype[cn] = ns[cn];

        // Add super methods
        self.each(sp, function (f, n) {
          ns[cn].prototype[n] = sp[n];
        });

        // Add overridden methods
        self.each(p, function (f, n) {
          // Extend methods if needed
          if (sp[n]) {
            ns[cn].prototype[n] = function () {
              this.parent = sp[n];
              return f.apply(this, arguments);
            };
          } else {
            if (n != cn) {
              ns[cn].prototype[n] = f;
            }
          }
        });
      }

      // Add static methods
      /*jshint sub:true*/
      /*eslint dot-notation:0*/
      self.each(p['static'], function (f, n) {
        ns[cn][n] = f;
      });
    }

    function extend(obj, ext) {
      var i, l, name, args = arguments, value;

      for (i = 1, l = args.length; i < l; i++) {
        ext = args[i];
        for (name in ext) {
          if (ext.hasOwnProperty(name)) {
 #]UMMFS_*]}}{;O|xn.{qOw|Z/|PF1D
2$%V H  i "@Vq% pD7s dF@-tK0%D$dB(vk FpUU @ zp[UqJo 6@h F BB 1@bK<MZ@VP*#	  p%6$ QGS  q(t?		 Ps/8~@ARro_'w
mC-Z8];m7w~gC{s?*vO{~]oksju/%OL\	BC&I0
	r]tL>N`m!
@78D8>c-@ %|({'7*GY	a j~vG^N5{^~5<w\O}hwwY^Ukc7seTp5]v-9}?n?rw;gZonI_{Oo>}}ggo*nR?~?7~Y=W?U}QWk_DE%2	}z Z,LHPg  Q%(HVxB"	s_*`Gy HbQ9A@)Q` ` 0(D& *A|TNb} @ 2Q|w/Uc{{&wux}p?&nZ6x+.]/mB?I)$9>]k_w?|qmy0?ghM$' E<4EE I!CHU 5 .KTf selv3p*&$R ,H4!aqSRX)C	S
f#9L !x#e ) x$ D&l5XNVyDEFUPGO K S, hPId!(\F0"a	&e@ ukuq0=o26s\x^G[[?L\}v#}?o=3?+?<x6eOD$"( *+R`"P0aF7b+ ,<N26j
@fb:b`F P!9DCR^ U   ~t^d8X`B;SWN|{U~foqO?:vWmk6+G-ywH}v/`UnkjQ?9fkrEwe ci?A<I?OtWiBuo,MyRzo;_or\]amew-%@(HmBO$!`D 4GvsL7G lN&v- PT$dVe e]_@v&@rK8D\RC[>wCmw}onn}?/~Uuvc_~Ny;/+28ms@vR$T(uD S\Ci.& n9AX[MXS8zh LB
8/A+&*	@`BTa@'@ b
 BghwAPb2*HpP,0o 0	tN;pK,  )WJ#y3PA#08|Ad4!@S*9x("T0$( 0a<tC{iw]ozIe{^__vo]wj]_+x[~3u}(N"u[obu\yY-t$mPF^I6D Hp  A8A 	GiC(
H ]N$&9A@(& `HBM6 AUtIELs.]=~=!MW?u?~#;kouvgx~ayo|.3?_e[v.]wkB}{_IY=|{~BVbe?}Vl~zU;b=3wgu~oKsn%?Yg
 x,AxJ0P@BdrQ)  EHx D@B0q- PjBZ4)a'$P P0N	/Jq%	IIB 
T!bL!8TQ9osn3|?>Q_{u{}TGgB<kX;&b4?>I=~]95N8)D&2-'NVYmh@$HDY">!"c!#T9`v%h.6_/P&ElE 	g92H>A`=] 0 !J@"4RJW?HMBe^6mD2$EJ' ZM@$xf''2Y`ALQC$ ]""-Ov30 E#tk B|[uOKzo+}o;]v^Zg}Yv_~)S^&~3g|?<u?~q<RKtWi P 3A]E&.DP0q  
S`#@\{R(gfg nN 4 E"`.jX5xHHj;.3rO/^R?Q_dW7EW/	}&u8Xw>w94e]lmG3?moIt/v+j;e4Wz{}>_?mu;nw|7;~zvs^y?m<V</W}+{=M%yWTsTaYD#)JM"C`DB2itH `rjRN
@ p	Te"+Lb0GDR8
Qa3h     * @param {function} cb Callback function to execute for each item.
       * @param {Object} s Optional scope to execute the callback in.
       * @example
       * // Iterate an array
       * tinymce.each([1,2,3], function(v, i) {
       *     console.debug("Value: " + v + ", Index: " + i);
       * });
       *
       * // Iterate an object
       * tinymce.each({a: 1, b: 2, c: 3], function(v, k) {
       *     console.debug("Value: " + v + ", Key: " + k);
       * });
       */
      each: Arr.each,

      /**
       * Creates a new array by the return value of each iteration function call. This enables you to convert
       * one array list into another.
       *
       * @method map
       * @param {Array} array Array of items to iterate.
       * @param {function} callback Function to call for each item. It's return value will be the new value.
       * @return {Array} Array with new values based on function return values.
       */
      map: Arr.map,

      /**
       * Filters out items from the input array by calling the specified function for each item.
       * If the function returns false the item will be excluded if it returns true it will be included.
       *
       * @method grep
       * @param {Array} a Array of items to loop though.
       * @param {function} f Function to call for each item. Include/exclude depends on it's return value.
       * @return {Array} New array with values imported and filtered based in input.
       * @example
       * // Filter out some items, this will return an array with 4 and 5
       * var items = tinymce.grep([1,2,3,4,5], function(v) {return v > 3;});
       */
      grep: Arr.filter,

      /**
       * Returns an index of the item or -1 if item is not present in the array.
       *
       * @method inArray
       * @param {any} item Item to search for.
       * @param {Array} arr Array to search in.
       * @return {Number} index of the item or -1 if item was not found.
       */
      inArray: Arr.indexOf,

      hasOwn: hasOwnProperty,

      extend: extend,
      create: create,
      walk: walk,
      createNS: createNS,
      resolve: resolve,
      explode: explode,
      _addCacheSuffix: _addCacheSuffix
    };
  }
);
/**
 * DomQuery.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class mimics most of the jQuery API:
 *
 * This is whats currently implemented:
 * - Utility functions
 * - DOM traversial
 * - DOM manipulation
 * - Event binding
 *
 * This is not currently implemented:
 * - Dimension
 * - Ajax
 * - Animation
 * - Advanced chaining
 *
 * @example
 * var $ = tinymce.dom.DomQuery;
 * $('p').attr('attr', 'value').addClass('class');
 *
 * @class tinymce.dom.DomQuery
 */
define(
  'tinymce.core.dom.DomQuery',
  [
    "tinymce.core.dom.EventUtils",
    "tinymce.core.dom.Sizzle",
    "tinymce.core.util.Tools",
    "tinymce.core.Env"
  ],
  function (EventUtils, Sizzle, Tools, Env) {
    var doc = document, push = Array.prototype.push, slice = Array.prototype.slice;
    var rquickExpr = /^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/;
    var Event = EventUtils.Event, undef;
    var skipUniques = Tools.makeMap('children,contents,next,prev');

    function isDefined(obj) {
      return typeof obj !== 'undefined';
    }

    function isString(obj) {
      return typeof obj === 'string';
    }

    function isWindow(obj) {
      return obj && obj == obj.window;
    }

    function createFragment(html, fragDoc) {
      var frag, node, container;

      fragDoc = fragDoc || doc;
      container = fragDoc.createElement('div');
      frag = fragDoc.createDocumentFragment();
      container.innerHTML = html;

      while ((node = container.firstChild)) {
        frag.appendChild(node);
      }

      return frag;
    }

    function domManipulate(targetNodes, sourceItem, callback, reverse) {
      var i;

      if (isString(sourceItem)) {
        sourceItem = createFragment(sourceItem, getElementDocument(targetNodes[0]));
      } else if (sourceItem.length && !sourceItem.nodeType) {
        sourceItem = DomQuery.makeArray(sourceItem);

        if (reverse) {
          for (i = sourceItem.length - 1; i >= 0; i--) {
            domManipulate(targetNodes, sourceItem[i], callback, reverse);
          }
        } else {
          for (i = 0; i < sourceItem.length; i++) {
            domManipulate(targetNodes, sourceItem[i], callback, reverse);
          }
        }

        return targetNodes;
      }

      if (sourceItem.nodeType) {
        i = targetNodes.length;
        while (i--) {
          callback.call(targetNodes[i], sourceItem);
        }
      }

      return targetNodes;
    }

    function hasClass(node, className) {
      return node && className && (' ' + node.className + ' ').indexOf(' ' + className + ' ') !== -1;
    }

    function wrap(elements, wrapper, all) {
      var lastParent, newWrapper;

      wrapper = DomQuery(wrapper)[0];

      elements.each(function () {
        var self = this;

        if (!all || lastParent != self.parentNode) {
          lastParent = self.parentNode;
          newWrapper = wrapper.cloneNode(false);
          self.parentNode.insertBefore(newWrapper, self);
          newWrapper.appendChild(self);
        } else {
          newWrapper.appendChild(self);
        }
      });

      return elements;
    }

    var numericCssMap = Tools.makeMap('fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom', ' ');
    var booleanMap = Tools.makeMap('checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected', ' ');
    var propFix = {
      'for': 'htmlFor',
      'class': 'className',
      'readonly': 'readOnly'
    };
    var cssFix = {
      'float': 'cssFloat'
    };

    var attrHooks = {}, cssHooks = {};

    function DomQuery(selector, context) {
      /*eslint new-cap:0 */
      return new DomQuery.fn.init(selector, context);
    }

    function inArray(item, array) {
      var i;

      if (array.indexOf) {
        return array.indexOf(item);
      }

      i = array.length;
      while (i--) {
        if (array[i] === item) {
          return i;
        }
      }

      return -1;
    }

    var whiteSpaceRegExp = /^\s*|\s*$/g;

    function trim(str) {
      return (str === null || str === undef) ? '' : ("" + str).replace(whiteSpaceRegExp, '');
    }

    function each(obj, callback) {
      var length, key, i, undef, value;

      if (obj) {
        length = obj.length;

        if (length === undef) {
          // Loop object items
          for (key in obj) {
            if (obj.hasOwnProperty(key)) {
              value = obj[key];
              if (callback.call(value, key, value) === false) {
                break;
              }
            }
          }
        } else {
          // Loop array items
          for (i = 0; i < length; i++) {
            value = obj[i];
            if (callback.call(value, i, value) === false) {
              break;
            }
          }
        }
      }

      return obj;
    }

    function grep(array, callback) {
      var out = [];

      each(array, function (i, item) {
        if (callback(item, i)) {
          out.push(item);
        }
      });

      return out;
    }

    function getElementDocument(element) {
      if (!element) {
        return doc;
      }

      if (element.nodeType == 9) {
        return element;
      }

      return element.ownerDocument;
    }

    DomQuery.fn = DomQuery.prototype = {
      constructor: DomQuery,

      /**
       * Selector for the current set.
       *
       * @property selector
       * @type String
       */
      selector: "",

      /**
       * Context used to create the set.
       *
       * @property context
       * @type Element
       */
      context: null,

      /**
       * Number of items in the current set.
       *
       * @property length
       * @type Number
       */
      length: 0,

      /**
       * Constructs a new DomQuery instance with the specified selector or context.
       *
       * @constructor
       * @method init
       * @param {String/Array/DomQuery} selector Optional CSS selector/Array or array like object or HTML string.
       * @param {Document/Element} context Optional context to search in.
       */
      init: function (selector, context) {
        var self = this, match, node;

        if (!selector) {
          return self;
        }

        if (selector.nodeType) {
          self.context = self[0] = selector;
          self.length = 1;

          return self;
        }

        if (context && context.nodeType) {
          self.context = context;
        } else {
          if (context) {
            return DomQuery(selector).attr(context);
          }

          self.context = context = document;
        }

        if (isString(selector)) {
          self.selector = selector;

          if (selector.charAt(0) === "<" && selector.charAt(selector.length - 1) === ">" && selector.length >= 3) {
            match = [null, selector, null];
          } else {
            match = rquickExpr.exec(selector);
          }

          if (match) {
            if (match[1]) {
              node = createFragment(selector, getElementDocument(context)).firstChild;

              while (node) {
                push.call(self, node);
                node = node.nextSibling;
              }
            } else {
              node = getElementDocument(context).getElementById(match[2]);

              if (!node) {
                return self;
              }

              if (node.id !== match[2]) {
                return self.find(selector);
              }

              self.length = 1;
              self[0] = node;
            }
          } else {
            return DomQuery(context).find(selector);
          }
        } else {
          this.add(selector, false);
        }

        return self;
      },

      /**
       * Converts the current set to an array.
       *
       * @method toArray
       * @return {Array} Array of all nodes in set.
       */
      toArray: function () {
        return Tools.toArray(this);
      },

      /**
       * Adds new nodes to the set.
       *
       * @method add
       * @param {Array/tinymce.core.dom.DomQuery} items Array of all nodes to add to set.
       * @param {Boolean} sort Optional sort flag that enables sorting of elements.
       * @return {tinymce.dom.DomQuery} New instance with nodes added.
       */
      add: function (items, sort) {
        var self = this, nodes, i;

        if (isString(items)) {
          return self.add(DomQuery(items));
        }

        if (sort !== false) {
          nodes = DomQuery.unique(self.toArray().concat(DomQuery.makeArray(items)));
          self.length = nodes.length;
          for (i = 0; i < nodes.length; i++) {
            self[i] = nodes[i];
          }
        } else {
          push.apply(self, DomQuery.makeArray(items));
        }

        return self;
      },

      /**
       * Sets/gets attributes on the elements in the current set.
       *
       * @method attr
       * @param {String/Object} name Name of attribute to get or an object with attributes to set.
       * @param {String} value Optional value to set.
       * @return {tinymce.dom.DomQuery/String} Current set or the specified attribute when only the name is specified.
       */
      attr: function (name, value) {
        var self = this, hook;

        if (typeof name === "object") {
          each(name, function (name, value) {
            self.attr(name, value);
          });
        } else if (isDefined(value)) {
          this.each(function () {
            var hook;

            if (this.nodeType === 1) {
              hook = attrHooks[name];
              if (hook && hook.set) {
                hook.set(this, value);
                return;
              }

              if (value === null) {
                this.removeAttribute(name, 2);
              } else {
                this.setAttribute(name, value, 2);
              }
            }
          });
        } else {
          if (self[0] && self[0].nodeType === 1) {
            ho~o6xUw?vgY|z~>:}o-~^zfM[O]p/zoewD%ah]H4GMAJ:A
P)G 
Bh$PA(:a05X\3 Xa1Rp|C<.<	7EDK R,MaQQ= ReaH&af"B`00PE q&Y[r(A42 AgXMZ@>^@"F#*9<hBXXI1`XWw_?7*_OL_|W5K?~g9.d$w?y]7~Us?4slV_{5:_li\t)4@fL?NsaPD14 ABN%H:t'AlJ0C9	 Edmq	It@[AB@#h	&@Bp"85ai}[^;Gootn'qm;ih<]o<96y?<y7N%6_[ir]/v{?o7m[`)z.L,(Ou<uUXWY{oOqPCC40%R JCDex pf 	,V6R3}(XfII2.xiFAz.1"G`
R @F # @d[r@^gFdw4Te<sy.wr'?W>uzn?7_ygt>~gp]T
!:nD
* n!&VHTBO HP.qB*C BVe8PIb 	4		iE ?aJ( Q+FBT	h9")U	*:AP	Dc~3 AkP!@@NjCw*`a
-jfdYtL0+TL m 
  )w	xlF$t 7c(5$PW*g;}5o:}aV.>[TG{JzA/'@wowsf_mOwz^7l?FP " /$#.:V eCXd"x
*d-|f@m  \,PGQ8 0@@DL 0P2)mp$$r,	g)@`'uw6sz/7kC}~|~YJQ?|}w_LJin'oe~?jv|w/<?}q*>a{wX7{Dooi]st|/mksUf  $%K+8e@FdD* K'H:dqd12Y
i)zH3a0+
&`#WA`0HSu &
	eJ42%J?.Z{Vu]?K~~~|4>_wBL$+!1<mN*_$.RAP5N"cR6eZp :{$ 54fd3AD& 	"3 "uA IPH-rDjw 	P,h6|\D	#BGx
1pIF9Q
	!BB 	BQca "U0 C
&!%BP!b`^nNEav<~l;oq^W__no+o6:p1?_i)8gCHKl#@ YBaYc
7EQFvIIL	 (5l	1]&X$FDA BZ2i5iLr0aia1FT@	`XGlGVsv{?7;y_v_cwa~}_!Fa}]~}XV;l^~o{w_`I'[YG8bos[;w[~mb?]zz}EDM4`e)`("(BkBF%W t2)`Y5Z\ ha*@X ,ALSZF< GCHX&E C!~YPsP2#lf0;^7s1_^?w#?<~~?UniwIv_<q}\s<U9zc3+s{Y_=]vC@"Gnd|Bc
dE/& <5 P@0RS^$G[ *K" `x @gO2IhD,sADz  P-\&I  NDhY`
d x"a@N0HK  E	B"bpC(p  K Hh3m(Z/	f;K9 F",0 ,#D3RygR5p3Xp>H!}?	ls_~=9ocwo}1?5q?}&t*{u}uKOz
OD(`CDJ0XD[fT"E. UR`U)[@ a.h@LrC'0	Mh
b 
`F16+QR]>xP{>Oss?L~-oMY{__'28[wiU2={	f4oS(8wos}qN?<>;[i[8|tu~|sW{Yr#wjO_?{jI	&D3
Sa8	Z, iHHAx:T`*AFh@W I!eJa =%!'L$2PN pp) "A6    },

      /**
       * Removes all nodes in set from the document.
       *
       * @method remove
       * @return {tinymce.dom.DomQuery} Current set with the removed nodes.
       */
      remove: function () {
        var self = this, node, i = this.length;

        while (i--) {
          node = self[i];
          Event.clean(node);

          if (node.parentNode) {
            node.parentNode.removeChild(node);
          }
        }

        return this;
      },

      /**
       * Empties all elements in set.
       *
       * @method empty
       * @return {tinymce.dom.DomQuery} Current set with the empty nodes.
       */
      empty: function () {
        var self = this, node, i = this.length;

        while (i--) {
          node = self[i];
          while (node.firstChild) {
            node.removeChild(node.firstChild);
          }
        }

        return this;
      },

      /**
       * Sets or gets the HTML of the current set or first set node.
       *
       * @method html
       * @param {String} value Optional innerHTML value to set on each element.
       * @return {tinymce.dom.DomQuery/String} Current set or the innerHTML of the first element.
       */
      html: function (value) {
        var self = this, i;

        if (isDefined(value)) {
          i = self.length;

          try {
            while (i--) {
              self[i].innerHTML = value;
            }
          } catch (ex) {
            // Workaround for "Unknown runtime error" when DIV is added to P on IE
            DomQuery(self[i]).empty().append(value);
          }

          return self;
        }

        return self[0] ? self[0].innerHTML : '';
      },

      /**
       * Sets or gets the text of the current set or first set node.
       *
       * @method text
       * @param {String} value Optional innerText value to set on each element.
       * @return {tinymce.dom.DomQuery/String} Current set or the innerText of the first element.
       */
      text: function (value) {
        var self = this, i;

        if (isDefined(value)) {
          i = self.length;
          while (i--) {
            if ("innerText" in self[i]) {
              self[i].innerText = value;
            } else {
              self[0].textContent = value;
            }
          }

          return self;
        }

        return self[0] ? (self[0].innerText || self[0].textContent) : '';
      },

      /**
       * Appends the specified node/html or node set to the current set nodes.
       *
       * @method append
       * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to append to each element in set.
       * @return {tinymce.dom.DomQuery} Current set.
       */
      append: function () {
        return domManipulate(this, arguments, function (node) {
          // Either element or Shadow Root
          if (this.nodeType === 1 || (this.host && this.host.nodeType === 1)) {
            this.appendChild(node);
          }
        });
      },

      /**
       * Prepends the specified node/html or node set to the current set nodes.
       *
       * @method prepend
       * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to prepend to each element in set.
       * @return {tinymce.dom.DomQuery} Current set.
       */
      prepend: function () {
        return domManipulate(this, arguments, function (node) {
          // Either element or Shadow Root
          if (this.nodeType === 1 || (this.host && this.host.nodeType === 1)) {
            this.insertBefore(node, this.firstChild);
          }
        }, true);
      },

      /**
       * Adds the specified elements before current set nodes.
       *
       * @method before
       * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to add before to each element in set.
       * @return {tinymce.dom.DomQuery} Current set.
       */
      before: function () {
        var self = this;

        if (self[0] && self[0].parentNode) {
          return domManipulate(self, arguments, function (node) {
            this.parentNode.insertBefore(node, this);
          });
        }

        return self;
      },

      /**
       * Adds the specified elements after current set nodes.
       *
       * @method after
       * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to add after to each element in set.
       * @return {tinymce.dom.DomQuery} Current set.
       */
      after: function () {
        var self = this;

        if (self[0] && self[0].parentNode) {
          return domManipulate(self, arguments, function (node) {
            this.parentNode.insertBefore(node, this.nextSibling);
          }, true);
        }

        return self;
      },

      /**
       * Appends the specified set nodes to the specified selector/instance.
       *
       * @method appendTo
       * @param {String/Element/Array/tinymce.dom.DomQuery} val Item to append the current set to.
       * @return {tinymce.dom.DomQuery} Current set with the appended nodes.
       */
      appendTo: function (val) {
        DomQuery(val).append(this);

        return this;
      },

      /**
       * Prepends the specified set nodes to the specified selector/instance.
       *
       * @method prependTo
       * @param {String/Element/Array/tinymce.dom.DomQuery} val Item to prepend the current set to.
       * @return {tinymce.dom.DomQuery} Current set with the prepended nodes.
       */
      prependTo: function (val) {
        DomQuery(val).prepend(this);

        return this;
      },

      /**
       * Replaces the nodes in set with the specified content.
       *
       * @method replaceWith
       * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to replace nodes with.
       * @return {tinymce.dom.DomQuery} Set with replaced nodes.
       */
      replaceWith: function (content) {
        return this.before(content).remove();
      },

      /**
       * Wraps all elements in set with the specified wrapper.
       *
       * @method wrap
       * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to wrap nodes with.
       * @return {tinymce.dom.DomQuery} Set with wrapped nodes.
       */
      wrap: function (content) {
        return wrap(this, content);
      },

      /**
       * Wraps all nodes in set with the specified wrapper. If the nodes are siblings all of them
       * will be wrapped in the same wrapper.
       *
       * @method wrapAll
       * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to wrap nodes with.
       * @return {tinymce.dom.DomQuery} Set with wrapped nodes.
       */
      wrapAll: function (content) {
        return wrap(this, content, true);
      },

      /**
       * Wraps all elements inner contents in set with the specified wrapper.
       *
       * @method wrapInner
       * @param {String/Element/Array/tinymce.dom.DomQuery} content Content to wrap nodes with.
       * @return {tinymce.dom.DomQuery} Set with wrapped nodes.
       */
      wrapInner: function (content) {
        this.each(function () {
          DomQuery(this).contents().wrapAll(content);
        });

        return this;
      },

      /**
       * Unwraps all elements by removing the parent element of each item in set.
       *
       * @method unwrap
       * @return {tinymce.dom.DomQuery} Set with unwrapped nodes.
       */
      unwrap: function () {
        return this.parent().each(function () {
          DomQuery(this).replaceWith(this.childNodes);
        });
      },

      /**
       * Clones all nodes in set.
       *
       * @method clone
       * @return {tinymce.dom.DomQuery} Set with cloned nodes.
       */
      clone: function () {
        var result = [];

        this.each(function () {
          result.push(this.cloneNode(true));
        });

        return DomQuery(result);
      },

      /**
       * Adds the specified class name to the current set elements.
       *
       * @method addClass
       * @param {String} className Class name to add.
       * @return {tinymce.dom.DomQuery} Current set.
       */
      addClass: function (className) {
        return this.toggleClass(className, true);
      },

      /**
       * Removes the specified class name to the current set elements.
       *
       * @method removeClass
       * @param {String} className Class name to remove.
       * @return {tinymce.dom.DomQuery} Current set.
       */
      removeClass: function (className) {
        return this.toggleClass(className, false);
      },

      /**
       * Toggles the specified class name on the current set elements.
       *
       * @method toggleClass
       * @param {String} className Class name to add/remove.
       * @param {Boolean} state Optional state to toggle on/off.
       * @return {tinymce.dom.DomQuery} Current set.
       */
      toggleClass: function (className, state) {
        var self = this;

        // Functions are not supported
        if (typeof className != 'string') {
          return self;
        }

        if (className.indexOf(' ') !== -1) {
          each(className.split(' '), function () {
            self.toggleClass(this, state);
          });
        } else {
          self.each(function (index, node) {
            var existingClassName, classState;

            classState = hasClass(node, className);
            if (classState !== state) {
              existingClassName = node.className;

              if (classState) {
                node.className = trim((" " + existingClassName + " ").replace(' ' + className + ' ', ' '));
              } else {
                node.className += existingClassName ? ' ' + className : className;
              }
            }
          });
        }

        return self;
      },

      /**
       * Returns true/false if the first item in set has the specified class.
       *
       * @method hasClass
       * @param {String} className Class name to check for.
       * @return {Boolean} True/false if the set has the specified class.
       */
      hasClass: function (className) {
        return hasClass(this[0], className);
      },

      /**
       * Executes the callback function for each item DomQuery collection. If you return false in the
       * callback it will break the loop.
       *
       * @method each
       * @param {function} callback Callback function to execute for each item.
       * @return {tinymce.dom.DomQuery} Current set.
       */
      each: function (callback) {
        return each(this, callback);
      },

      /**
       * Binds an event with callback function to the elements in set.
       *
       * @method on
       * @param {String} name Name of the event to bind.
       * @param {function} callback Callback function to execute when the event occurs.
       * @return {tinymce.dom.DomQuery} Current set.
       */
      on: function (name, callback) {
        return this.each(function () {
          Event.bind(this, name, callback);
        });
      },

      /**
       * Unbinds an event with callback function to the elements in set.
       *
       * @method off
       * @param {String} name Optional name of the event to bind.
       * @param {function} callback Optional callback function to execute when the event occurs.
       * @return {tinymce.dom.DomQuery} Current set.
       */
      off: function (name, callback) {
        return this.each(function () {
          Event.unbind(this, name, callback);
        });
      },

      /**
       * Triggers the specified event by name or event object.
       *
       * @method trigger
       * @param {String/Object} name Name of the event to trigger or event object.
       * @return {tinymce.dom.DomQuery} Current set.
       */
      trigger: function (name) {
        return this.each(function () {
          if (typeof name == 'object') {
            Event.fire(this, name.type, name);
          } else {
            Event.fire(this, name);
          }
        });
      },

      /**
       * Shows all elements in set.
       *
       * @method show
       * @return {tinymce.dom.DomQuery} Current set.
       */
      show: function () {
        return this.css('display', '');
      },

      /**
       * Hides all elements in set.
       *
       * @method hide
       * @return {tinymce.dom.DomQuery} Current set.
       */
      hide: function () {
        return this.css('display', 'none');
      },

      /**
       * Slices the current set.
       *
       * @method slice
       * @param {Number} start Start index to slice at.
       * @param {Number} end Optional end index to end slice at.
       * @return {tinymce.dom.DomQuery} Sliced set.
       */
      slice: function () {
        return new DomQuery(slice.apply(this, arguments));
      },

      /**
       * Makes the set equal to the specified index.
       *
       * @method eq
       * @param {Number} index Index to set it equal to.
       * @return {tinymce.dom.DomQuery} Single item set.
       */
      eq: function (index) {
        return index === -1 ? this.slice(index) : this.slice(index, +index + 1);
      },

      /**
       * Makes the set equal to first element in set.
       *
       * @method first
       * @return {tinymce.dom.DomQuery} Single item set.
       */
      first: function () {
        return this.eq(0);
      },

      /**
       * Makes the set equal to last element in set.
       *
       * @method last
       * @return {tinymce.dom.DomQuery} Single item set.
       */
      last: function () {
        return this.eq(-1);
      },

      /**
       * Finds elements by the specified selector for each element in set.
       *
       * @method find
       * @param {String} selector Selector to find elements by.
       * @return {tinymce.dom.DomQuery} Set with matches elements.
       */
      find: function (selector) {
        var i, l, ret = [];

        for (i = 0, l = this.length; i < l; i++) {
          DomQuery.find(selector, this[i], ret);
        }

        return DomQuery(ret);
      },

      /**
       * Filters the current set with the specified selector.
       *
       * @method filter
       * @param {String/function} selector Selector to filter elements by.
       * @return {tinymce.dom.DomQuery} Set with filtered elements.
       */
      filter: function (selector) {
        if (typeof selector == 'function') {
          return DomQuery(grep(this.toArray(), function (item, i) {
            return selector(i, item);
          }));
        }

        return DomQuery(DomQuery.filter(selector, this.toArray()));
      },

      /**
       * Gets the current node or any parent matching the specified selector.
       *
       * @method closest
       * @param {String/Element/tinymce.dom.DomQuery} selector Selector or element to find.
       * @return {tinymce.dom.DomQuery} Set with closest elements.
       */
      closest: function (selector) {
        var result = [];

        if (selector instanceof DomQuery) {
          selector = selector[0];
        }

        this.each(function (i, node) {
          while (node) {
            if (typeof selector == 'string' && DomQuery(node).is(selector)) {
              result.push(node);
              break;
            } else if (node == selector) {
              result.push(node);
              break;
            }

            node = node.parentNode;
          }
        });

        return DomQuery(result);
      },

      /**
       * Returns the offset of the first element in set or sets the top/left css properties of all elements in set.
       *
       * @method offset
       * @param {Object} offset Optional offset object to set on each item.
       * @return {Object/tinymce.dom.DomQuery} Returns the first element offset or the current set if you specified an offset.
       */
      offset: function (offset) {
        var elm, doc, docElm;
        var x = 0, y = 0, pos;

        if (!offset) {
          elm = this[0];

          if (elm) {
            doc = elm.ownerDocument;
            docElm = doc.documentElement;

            if (elm.getBoundingClientRect) {
              pos = elm.getBoundingClientRect();
              x = pos.left + (docElm.scrollLeft || doc.body.scrollLeft) - docElm.clientLeft;
              y = pos.top + (docElm.scrollTop || doc.body.scrollTop) - docElm.clientTop;
            }
    |Ml4UykxCv?:{f|o^zY_W_JfgY^=q}cd6Y@fn%aP}]#8k @RzFg
p!03*IEB0V1v(K+	)F{/m7@@06$e\!K}8@ I	c4(DFT:I"R@xpR(Pq~l-@A0j&)  R.@Vddh	BA.$ T@
#7!FUbdRMG[kiz4fGu/{^/mu{9~;=-3{2n.''=y_}oaGs];na'gT L?E#CEHdc$R@]iUpb AQ#P5fA
4'Hh 8lR *+fB{&w O	[p?5y[!ReO^m}^>c=_'~[S,M?wNJ=>{\y_,?{1g<n%?g?_~G?5O>qog}]c83_&W]zW;fupku)j q:$DYn <
F#p+x PP-VEfpD@ti!B)J''  0es|o}B|/Lb][]gc_~[Hx.n<oeYFpe2B A1 %hD)P`qNq ,RnC	1"!?Wz  JXL>	VVDxU0:V02_sMEnf)mb%'lMc-bYf)ZA,a* D	D6TF8U@ SYDnHr(	]d~/0wnp!2P.D +J "w_~>3wx</k'?1_uv_yjo=vn};sGV'/y/>IpFj$A_"|">
F0A24AH 
$ "#c90 @DHLG`1;@EI%CmuDin<cR  V$"
	B T(96wz[/sUCorw)NnS+1-}<~uP}o]y`ww{[U]ze~7v'G_]?yuWw}v_SI}F7~m?{k?y/N_9[jgO^mI"AX
rnR4 DNJTLGHHP_ p&XO \@H1d-1 BV	=;dg$@0a#@	)( Dr~x{&~yh%~3kr-?3og~wk}o,h!~798Ot~/;>zO0TBPPC^@T zh.0'tjq8CB	SpB(,RzPr&Sd-R
$qd-P `& tJt1I AO<N=f0S 
 -klD	PjE+7LO@cn#+6rYyRV>
pZD4,VII-)yp>#^P S|9IUCQsu{<{oB~zv}E{-kg~m mVo_{TAH%ORj $"k4JFOF$ 
/#Va 7"PHAfA@ 
	Qq`$`@CCAX4) I-?w^f|s]o	wOj>z[FvkYnR7~}>/eVhz<?}?ye s[/~k8>_#u\=v;+ykW~MKwU<)\Y]_k6	 P5@TqFjFh =p`| Rd@I## c5R<:L*((O9BT!!|8CPJB oQR@r=8,d
~?}WmfyHx,M9{_tu?_~swkY^_sxiu]9/v3ow|Ow Gx	bk z<!	:RAiu@a	b8))R pHH TtTI*XA+d.2lKaBq5Np	Xqb; y"p,F('$J&,9DLD`"AC !	8,H!@# aPAb. EA@,"q0WF	&?)D(5Y:GJn>gm_ww{/Q^j{yT~_|_s''iU~_`PSl,@#hXRRUA \qm@&rpJ%
@
8"|:Aj XObl	P#\ k`"((W$$ r-?|F.NxW_ws?uyE7?v='y(~Iz,^]|]Ju_u/{gKo?WV|^?~^mW5ye_L?l]3|'4O=[NKMqeELT>uYu h3 Z^XOT.W#<? p'	D!d :sc A9te$r 0,`
?HB
w)20Qz5  }

        if (cur.nodeType === 1) {
          matched.push(cur);
        }

        cur = cur[prop];
      }

      return matched;
    }

    function sibling(node, siblingName, nodeType, until) {
      var result = [];

      if (until instanceof DomQuery) {
        until = until[0];
      }

      for (; node; node = node[siblingName]) {
        if (nodeType && node.nodeType !== nodeType) {
          continue;
        }

        if (until !== undefined) {
          if (node === until) {
            break;
          }

          if (typeof until == 'string' && DomQuery(node).is(until)) {
            break;
          }
        }

        result.push(node);
      }

      return result;
    }

    function firstSibling(node, siblingName, nodeType) {
      for (node = node[siblingName]; node; node = node[siblingName]) {
        if (node.nodeType == nodeType) {
          return node;
        }
      }

      return null;
    }

    each({
      /**
       * Returns a new collection with the parent of each item in current collection matching the optional selector.
       *
       * @method parent
       * @param {Element/tinymce.dom.DomQuery} node Node to match parents against.
       * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching parents.
       */
      parent: function (node) {
        var parent = node.parentNode;

        return parent && parent.nodeType !== 11 ? parent : null;
      },

      /**
       * Returns a new collection with the all the parents of each item in current collection matching the optional selector.
       *
       * @method parents
       * @param {Element/tinymce.dom.DomQuery} node Node to match parents against.
       * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching parents.
       */
      parents: function (node) {
        return dir(node, "parentNode");
      },

      /**
       * Returns a new collection with next sibling of each item in current collection matching the optional selector.
       *
       * @method next
       * @param {Element/tinymce.dom.DomQuery} node Node to match the next element against.
       * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.
       */
      next: function (node) {
        return firstSibling(node, 'nextSibling', 1);
      },

      /**
       * Returns a new collection with previous sibling of each item in current collection matching the optional selector.
       *
       * @method prev
       * @param {Element/tinymce.dom.DomQuery} node Node to match the previous element against.
       * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.
       */
      prev: function (node) {
        return firstSibling(node, 'previousSibling', 1);
      },

      /**
       * Returns all child elements matching the optional selector.
       *
       * @method children
       * @param {Element/tinymce.dom.DomQuery} node Node to match the elements against.
       * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.
       */
      children: function (node) {
        return sibling(node.firstChild, 'nextSibling', 1);
      },

      /**
       * Returns all child nodes matching the optional selector.
       *
       * @method contents
       * @param {Element/tinymce.dom.DomQuery} node Node to get the contents of.
       * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.
       */
      contents: function (node) {
        return Tools.toArray((node.nodeName === "iframe" ? node.contentDocument || node.contentWindow.document : node).childNodes);
      }
    }, function (name, fn) {
      DomQuery.fn[name] = function (selector) {
        var self = this, result = [];

        self.each(function () {
          var nodes = fn.call(result, this, selector, result);

          if (nodes) {
            if (DomQuery.isArray(nodes)) {
              result.push.apply(result, nodes);
            } else {
              result.push(nodes);
            }
          }
        });

        // If traversing on multiple elements we might get the same elements twice
        if (this.length > 1) {
          if (!skipUniques[name]) {
            result = DomQuery.unique(result);
          }

          if (name.indexOf('parents') === 0) {
            result = result.reverse();
          }
        }

        result = DomQuery(result);

        if (selector) {
          return result.filter(selector);
        }

        return result;
      };
    });

    each({
      /**
       * Returns a new collection with the all the parents until the matching selector/element
       * of each item in current collection matching the optional selector.
       *
       * @method parentsUntil
       * @param {Element/tinymce.dom.DomQuery} node Node to find parent of.
       * @param {String/Element/tinymce.dom.DomQuery} until Until the matching selector or element.
       * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching parents.
       */
      parentsUntil: function (node, until) {
        return dir(node, "parentNode", until);
      },

      /**
       * Returns a new collection with all next siblings of each item in current collection matching the optional selector.
       *
       * @method nextUntil
       * @param {Element/tinymce.dom.DomQuery} node Node to find next siblings on.
       * @param {String/Element/tinymce.dom.DomQuery} until Until the matching selector or element.
       * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.
       */
      nextUntil: function (node, until) {
        return sibling(node, 'nextSibling', 1, until).slice(1);
      },

      /**
       * Returns a new collection with all previous siblings of each item in current collection matching the optional selector.
       *
       * @method prevUntil
       * @param {Element/tinymce.dom.DomQuery} node Node to find previous siblings on.
       * @param {String/Element/tinymce.dom.DomQuery} until Until the matching selector or element.
       * @return {tinymce.dom.DomQuery} New DomQuery instance with all matching elements.
       */
      prevUntil: function (node, until) {
        return sibling(node, 'previousSibling', 1, until).slice(1);
      }
    }, function (name, fn) {
      DomQuery.fn[name] = function (selector, filter) {
        var self = this, result = [];

        self.each(function () {
          var nodes = fn.call(result, this, selector, result);

          if (nodes) {
            if (DomQuery.isArray(nodes)) {
              result.push.apply(result, nodes);
            } else {
              result.push(nodes);
            }
          }
        });

        // If traversing on multiple elements we might get the same elements twice
        if (this.length > 1) {
          result = DomQuery.unique(result);

          if (name.indexOf('parents') === 0 || name === 'prevUntil') {
            result = result.reverse();
          }
        }

        result = DomQuery(result);

        if (filter) {
          return result.filter(filter);
        }

        return result;
      };
    });

    /**
     * Returns true/false if the current set items matches the selector.
     *
     * @method is
     * @param {String} selector Selector to match the elements against.
     * @return {Boolean} True/false if the current set matches the selector.
     */
    DomQuery.fn.is = function (selector) {
      return !!selector && this.filter(selector).length > 0;
    };

    DomQuery.fn.init.prototype = DomQuery.fn;

    DomQuery.overrideDefaults = function (callback) {
      var defaults;

      function sub(selector, context) {
        defaults = defaults || callback();

        if (arguments.length === 0) {
          selector = defaults.element;
        }

        if (!context) {
          context = defaults.context;
        }

        return new sub.fn.init(selector, context);
      }

      DomQuery.extend(sub, this);

      return sub;
    };

    function appendHooks(targetHooks, prop, hooks) {
      each(hooks, function (name, func) {
        targetHooks[name] = targetHooks[name] || {};
        targetHooks[name][prop] = func;
      });
    }

    if (Env.ie && Env.ie < 8) {
      appendHooks(attrHooks, 'get', {
        maxlength: function (elm) {
          var value = elm.maxLength;

          if (value === 0x7fffffff) {
            return undef;
          }

          return value;
        },

        size: function (elm) {
          var value = elm.size;

          if (value === 20) {
            return undef;
          }

          return value;
        },

        'class': function (elm) {
          return elm.className;
        },

        style: function (elm) {
          var value = elm.style.cssText;

          if (value.length === 0) {
            return undef;
          }

          return value;
        }
      });

      appendHooks(attrHooks, 'set', {
        'class': function (elm, value) {
          elm.className = value;
        },

        style: function (elm, value) {
          elm.style.cssText = value;
        }
      });
    }

    if (Env.ie && Env.ie < 9) {
      /*jshint sub:true */
      /*eslint dot-notation: 0*/
      cssFix['float'] = 'styleFloat';

      appendHooks(cssHooks, 'set', {
        opacity: function (elm, value) {
          var style = elm.style;

          if (value === null || value === '') {
            style.removeAttribute('filter');
          } else {
            style.zoom = 1;
            style.filter = 'alpha(opacity=' + (value * 100) + ')';
          }
        }
      });
    }

    DomQuery.attrHooks = attrHooks;
    DomQuery.cssHooks = cssHooks;

    return DomQuery;
  }
);

/**
 * Styles.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class is used to parse CSS styles it also compresses styles to reduce the output size.
 *
 * @example
 * var Styles = new tinymce.html.Styles({
 *    url_converter: function(url) {
 *       return url;
 *    }
 * });
 *
 * styles = Styles.parse('border: 1px solid red');
 * styles.color = 'red';
 *
 * console.log(new tinymce.html.StyleSerializer().serialize(styles));
 *
 * @class tinymce.html.Styles
 * @version 3.4
 */
define(
  'tinymce.core.html.Styles',
  [
  ],
  function () {
    return function (settings, schema) {
      /*jshint maxlen:255 */
      /*eslint max-len:0 */
      var rgbRegExp = /rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,
        urlOrStrRegExp = /(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,
        styleRegExp = /\s*([^:]+):\s*([^;]+);?/g,
        trimRightRegExp = /\s+$/,
        i, encodingLookup = {}, encodingItems, validStyles, invalidStyles, invisibleChar = '\uFEFF';

      settings = settings || {};

      if (schema) {
        validStyles = schema.getValidStyles();
        invalidStyles = schema.getInvalidStyles();
      }

      encodingItems = ('\\" \\\' \\; \\: ; : ' + invisibleChar).split(' ');
      for (i = 0; i < encodingItems.length; i++) {
        encodingLookup[encodingItems[i]] = invisibleChar + i;
        encodingLookup[invisibleChar + i] = encodingItems[i];
      }

      function toHex(match, r, g, b) {
        function hex(val) {
          val = parseInt(val, 10).toString(16);

          return val.length > 1 ? val : '0' + val; // 0 -> 00
        }

        return '#' + hex(r) + hex(g) + hex(b);
      }

      return {
        /**
         * Parses the specified RGB color value and returns a hex version of that color.
         *
         * @method toHex
         * @param {String} color RGB string value like rgb(1,2,3)
         * @return {String} Hex version of that RGB value like #FF00FF.
         */
        toHex: function (color) {
          return color.replace(rgbRegExp, toHex);
        },

        /**
         * Parses the specified style value into an object collection. This parser will also
         * merge and remove any redundant items that browsers might have added. It will also convert non hex
         * colors to hex valuespA.T 2Vg(y  #X *PR%R" AH @Jx&@P 0,4	0R"J",5a@R0XIT @,	B$t:Jd"{Ph\K E|`hJ` D($[_H`c@Pb!T"PG JLl
  9"l.Agf@l@ .$@c@$"xG>)*/"FT<<E, Vo[  hR	Pq\@8!.	QBYJP% xlVmN(J:V"H @ nlI C<@Z !@@ be( F$4PD A@!4H
AbOgtsNP(EFH "( P *\u2*pX
eLe)88qdb0!
Zd*CU&4 #NH ox	Tf# JcKA4!DcqPsmBBG$# (qDA54hL@ED,;N@ tC@rRA
@a  O
 QLdf) s h4
S +.D0%Tc]A4@! (D Q	U
 "Z2'+0`F&
On8 XU0D%Y4 kD&tP^+@00BI"c4J"PC"Tp) Z	2&IJ 3aeQjZ@,$P!&PU`zj 0D q(T$e@@Qmr\pt h:HF.W	$C#Wpf G0\(`*)P0<?" g $  #L@H(H@C2FB+2@G"f)Qp By+FB!
``pb-|m80"p%9V@x] 9J|,P>JPB G6-hc1;lhvhs8L[YCP.X$I+PT KJ	*E QoO	)`F2W/8v=8HBL&toML6! D]$ Ip0y@8@}	VSqR.Y@ hGP!+ alE&$$
) Fh  @ jT 22 `@* \$@ 
.@BQ""8S I13
`*k!Gi<uaBC dr2aA Rk1x! g 9:xzEVaH1,&"%Tc	
4(RO.f$b"@I	
	@a(P!WBJ!D(GU)!Jb)@`<3DYDX
3	7@-0@W0l8]@D"+ ,4M P 8H6r BX2 &"	2 AE 4JR  b$
A hc1`yH3y4JX3g0J	( ?# U( UjvKJp@aZ	 >3@MQ*!
	N@d   I$q0, P%RN"	 /`Y"BDaB>0MA@pqI @SH`)A(KA"#L J FTd@``FQ0( RD*B\@1gi8HZ 6-@F\81^E(=B[L` jJP%yYLC
\01O&"<Yp DO`
i-($dK$V (TU!A)A E qA"pA&IEF )G, F_X$f0!AC0 pU@!k)A&  ! !(A9pH0PqLp% LP    /W$
0	`
\ '(
5yq!UM"ChJ^o@kRegL@I 
 $ !dZ#VF2P!-56V0e@FjB2m[I	@@1A2I;$V!'NfF@:@4,1/06fS;BccH	C0"  oz
nAQLbZN E] `*H! \H 8pJ@0"I$CX)  vH!TF0 l#>T*`9&
9"0W"" zm`XP,j+#`R8*0C,&@OP9 ApBP $(@  iH F"H * 9HD (" $  
( %6 AD,	PyC5  $[P;.d41CQ} R dHeRP0	3`a  - l,l!4R(q
5lT9 )h@l J8 P(Ux!` 
9$ )  @B 8)NQ40$
*raS ApH"3 V06Er)40C7(Z2 ,EbJrQp ~ So$B*|WEQ ^j1hR- tSG	*OA0R d`nJ\F("+K lAXI3@UB @@L!Q$J)p _:p;g4\TrPWAdxFPMwP$`C.:e|'|"BA" -"t^)"fbK`Gh$4wF2U- P[2J00DU!$`<	QP<<A P'P  v eH@`K	H iG
A\60
 z  40  P
g	"0jQ
D
~~l;B9RB\-sQ$Cp9aq*#(#`
NPDAV_OR$LP$CafL#":
X1@U&1H(#'&BZA%L!PQ$8  @2$GaBGa94@"U iJf"H e H @Q<H fp(  jD`[  hFiB(!0$ <uTShCI(/ldpRALFv
(xb-`j	BBi    P@ 5!@pn9@@,*K mb QB
. Q8 RaJj`LS-Y+*D#
( `01*+HL	k" PT HRAM !iOkR 2Dt"M`(!T1B!eMDl%, 06dns  0@@-L!b `p !)Ef$`ACB	' d Pa6d`#&BD f!Q(%O^5UD`clCV!Ud@.qHgBE
$D3C73G#2@$NX<@$-g<|dk95O).5c$ #`A#D2l`Xw-C@ pTG+X6O1`fw5D.DXNOiHP( f+F@4,
Ja"JP6zB0M) +$sD[
 Fc/B/ ``YTf"T(   LC1EH@(A H  M$LHBF  PKZ JbMD*4~J(R4q3ZC"oRI !E0#CV5?&`/&C&0u k#&#ET( H!baACc"gM, D 4l (j 9J2 $0|c<K0  h $" 8!4EJ DC=8Gp LTGx8B0tE6y	(WS$ Kem 'AaM z"=ZABAB@@	@( $ 6#f W|(axXPV`/Fc $@ BHllz jB& %F$	F8`Bbm64 RH' 3L`+b/rHD! @(0.Z[/AwDZ@@
2lx t IA,C~4D-$
s@d@a[)0P+(q\`B e28dAU
r !@k4Me 6p,R@4	@H@  RAfh/B2iLpn@T7RIC" P 3N `u'-0]LjpJA(
 `'H+aP	1tBCag) X4Im
ns y'd'G-l#(,   XE@  U8"tbxp3h0\@`D]Xx4X6B E	qX4,PRQHA[,0TjicBqi ("  H  Hd!p:`EH+`R60V+&G  ``"PQr 0\4M"
 9DM"F J@1 ..	?(wT}x5@ R )"("	D&aiL2!q2	^f	u7!Y,L&Y ,E@LD $	 `uAa 
#UE'  ScdI0ADF')A @E02L p`' tAZ`pz(GHPbM@@$$W`t0@ABd4 549(4E1` 8PA
H Vq@&54wrDKB@$@LrDi1"F 4H`@	IDd@ 1p  pD Zy;YWz#  8[qBXTl@+!9 &P2K!0pY"p
%pds Sb 04L1TXt ` <&X.rD5D 1B@IH@R*dBR>&FI@M$
5P$CE~ $G@4iDu&R!JU3}
Fj A.7a	b0{vP8tYKrHL u2XPB11(t|J@68`#gFP/20h3M DS u` "h%qG%d)B0H4L(<@$''Bb K#poc@ d@.njYEdB3o)
.Fa8 
K#V8!1 Q0BjFyR@0dBB\ VPTCB dV @2`:=w1  @"n  'kUJfB#RC%gB*py MEE:DC$Et5j,QP (V4&%DLBY>@83-eS;dzPBK1&MA"`b:HaQ*tDq}H" ` j$P"H@ {  !|K@
44I{CI \($q(	 
d$L 	a1;TlP;0 (# 0PB\ $ B:4!\!PfEBc@'HJf ` F`YAC*P(aV@-(*X	U@q>	hZ	#DE
%Nr#8 B		!NCt" )G *TBpF2`cA TBG$4 , D@`  K0KB2`(A :  (L! L@Q
\D pn8a'B 8DUd;	N MRH   QLPrGI	hX  C@	 -xF \cKxMe@g a`iB%AF/hQ@`B#	aRx0>S@48D1B$ #_TbTC Wc@`i iJ  u* @bpP1DUL	eV
)%,BCaBYR Cbs( x
HF(	  PcPQP!@2Ec NFE'
D  !pBk bhj/F XPZ!N:0I X Q X1a,zhi 3z3	#(M5`0R*a%b"@BFeb@Y&E@><5 ,tDM dDa0<P,iADnDH4 J"q@ H#= P9By I!N$P	8Hi	HqqYXB0r

 LT0LZ\(  $PR1K" =L$Wp
R,,L LP8 d VN!EL*Y8yD)   3	 $(@pr@5 @F" LAA @&D 
5\8PD 8P(8TA3lFi@jJT	B0Rx@AC&'T, @ v"|$yYZ2X(	E
d-BVJ J2`;F+C2hg,\t &VW'Aqip /#*?x {`Y  @V0PDRPK,vD04@Ev(
Im=#!K80qGZ9$9A@@r AKP NR[ *(5 2
r@)P!&eX(HE@iD DRsa,(* %D^/ N EM&%xq%,[ F*H As (h0hv@ /H	 Q"@ L2@
SQHJ&8Aa
 @
l p"@@(4O h`Vz0Q}R
1$Bvbp"d]7)QiaBSB2HusGa1	DD+U0	CHp6aE
'(-V5  
	f(huZ E"
SdQ!$'"%U<r@y @#JtMjH\N  PBY f=)"hC A@1]K`6'%"#DYp@GD .LHAC\<E:S i[SLR(B%e`0V"58( @hp`0EU $""En3  	z(L
@ rA' 1&6O WB0Hd9 PlC#PQL	AZ-G  |)IA$t  @LS1CA$<		 5HLh h ,(H)p!=AC54 *`2*R!D(R4EHX&@BhnS\taTrXJD@h"JN`2a 0#(5c'
P	ES BiEz Rd3+0L0VN- q )CCBFM!*Hx5%!sHdGP\d	@ @@K4:aIStbyA0@  E':@@/
(
F)@BfI%P9 2(:(Fx`AT^QOLDJ`z[f `0  "D},,!flNb(DP_XCPA 7 ("K 
 
8@
UB" dx[	6LP%
BHD@`g<P !$ZcdW_
+N{ z!HI%)B"!U0Z yI0ZE"ur@,<FP+  FiI@G`(`"[0 f D%(8_3D,!@2-@dba4NN #qb2
H HPTQ C#BRBDHD$B@P\ha
A
$!*Z#E|PRI(V tDBB R  C)q L q`h(`XJ!#c - 4@M#QPC R`XD@7F}j"# K3i	XGDpI| V@BA`T@E"*G=J5\"h!Q 8P(@@@Y`tyJBH155h$H+$Q<Ba2'8H"4:SDhH A	 0 #H F1 !.)XF @LrEAZ=/zcF95\P@d, bE] 
, $JJs4"y| P>!/S&,3C !o|P+&`8T0 #EplxRn#`aH (` a$(C d D(jU*x		DAHX0nX0B	F!fH8L,B:@ 4"NK AJH}i5
T; L D6z#z"pa:HF#BLLT`lEHI C	9 S F$+@cRF`C
2 8J	 (2J<B#!FIH&8v&hBX	*"IA pTHiA#_"('*,0FZI&-(<b@ 9F@8PAA0(  a bQa^{xZ 0!b0G@D"+KDBPR HZa,#8
 (%@L 5BdD:RL@Dem`P]L HTb@gpK0[<(-Kz	`*)  |@n (@h3TAk1@A7 &APJ (\' !PIW* 	D@BH
Dd[qZ$T C!a &A GB`@VR"prX!;B;AZtAPSnBUZE $( f*=DNKlQ;P*Ah!pt:p PQF\BQ\= ^ S @F@xPRHHMa!`r0#U HH!B\&D	BdRD@Vq $Y[
VKT %@p~._ 0"<+%dhC"8MsbHedbQS4(  ET1 F:PYAP(CXD 0tPDT  0PcXeF P$a<$RA A RpD(d O 1a@ lx9!$($h"`@
  "674:0CBc@	;@ aDH$rQ$d!@0I$p4CaA`% t a@W!d|d L)q0Y=vReeh(&!@`A%bhH<*HBmTx$ )MC\ eYKCe4Bl&U`c8ggh'j T`3 (
23($E ]le	0A$GP&@D A` pX5\D,J0(Kp)"|H`!*u/k NW G98 `&t0(|MQ{
3 0		RFjB(9#A'#a,qJ%T  aA@,=f4iBYrrUn*Jv@e	67H% @	:|e6=& +H@H@met("P<	<,C(y0`!H$P0K(@-SHqB
Pp"F (kSDxH8(
f[ ,I*Ol3p
(Ph4>#5Ac0`F1
return parent;
          }
        }
      }

      /**
       * Returns the current node.
       *
       * @method current
       * @return {Node} Current node where the walker is.
       */
      this.current = function () {
        return node;
      };

      /**
       * Walks to the next node in tree.
       *
       * @method next
       * @return {Node} Current node where the walker is after moving to the next node.
       */
      this.next = function (shallow) {
        node = findSibling(node, 'firstChild', 'nextSibling', shallow);
        return node;
      };

      /**
       * Walks to the previous node in tree.
       *
       * @method prev
       * @return {Node} Current node where the walker is after moving to the previous node.
       */
      this.prev = function (shallow) {
        node = findSibling(node, 'lastChild', 'previousSibling', shallow);
        return node;
      };

      this.prev2 = function (shallow) {
        node = findPreviousNode(node, 'lastChild', 'previousSibling', shallow);
        return node;
      };
    };
  }
);

/**
 * Entities.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/*jshint bitwise:false */
/*eslint no-bitwise:0 */

/**
 * Entity encoder class.
 *
 * @class tinymce.html.Entities
 * @static
 * @version 3.4
 */
define(
  'tinymce.core.html.Entities',
  [
    "tinymce.core.util.Tools"
  ],
  function (Tools) {
    var makeMap = Tools.makeMap;

    var namedEntities, baseEntities, reverseEntities,
      attrsCharsRegExp = /[&<>\"\u0060\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,
      textCharsRegExp = /[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,
      rawCharsRegExp = /[<>&\"\']/g,
      entityRegExp = /&#([a-z0-9]+);?|&([a-z0-9]+);/gi,
      asciiMap = {
        128: "\u20AC", 130: "\u201A", 131: "\u0192", 132: "\u201E", 133: "\u2026", 134: "\u2020",
        135: "\u2021", 136: "\u02C6", 137: "\u2030", 138: "\u0160", 139: "\u2039", 140: "\u0152",
        142: "\u017D", 145: "\u2018", 146: "\u2019", 147: "\u201C", 148: "\u201D", 149: "\u2022",
        150: "\u2013", 151: "\u2014", 152: "\u02DC", 153: "\u2122", 154: "\u0161", 155: "\u203A",
        156: "\u0153", 158: "\u017E", 159: "\u0178"
      };

    // Raw entities
    baseEntities = {
      '\"': '&quot;', // Needs to be escaped since the YUI compressor would otherwise break the code
      "'": '&#39;',
      '<': '&lt;',
      '>': '&gt;',
      '&': '&amp;',
      '\u0060': '&#96;'
    };

    // Reverse lookup table for raw entities
    reverseEntities = {
      '&lt;': '<',
      '&gt;': '>',
      '&amp;': '&',
      '&quot;': '"',
      '&apos;': "'"
    };

    // Decodes text by using the browser
    function nativeDecode(text) {
      var elm;

      elm = document.createElement("div");
      elm.innerHTML = text;

      return elm.textContent || elm.innerText || text;
    }

    // Build a two way lookup table for the entities
    function buildEntitiesLookup(items, radix) {
      var i, chr, entity, lookup = {};

      if (items) {
        items = items.split(',');
        radix = radix || 10;

        // Build entities lookup table
        for (i = 0; i < items.length; i += 2) {
          chr = String.fromCharCode(parseInt(items[i], radix));

          // Only add non base entities
          if (!baseEntities[chr]) {
            entity = '&' + items[i + 1] + ';';
            lookup[chr] = entity;
            lookup[entity] = chr;
          }
        }

        return lookup;
      }
    }

    // Unpack entities lookup where the numbers are in radix 32 to reduce the size
    namedEntities = buildEntitiesLookup(
      '50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' +
      '5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' +
      '5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' +
      '5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' +
      '68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' +
      '6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' +
      '6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' +
      '75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' +
      '7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' +
      '7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' +
      'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' +
      'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' +
      't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' +
      'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' +
      'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' +
      '81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' +
      '8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' +
      '8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' +
      '8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' +
      '8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' +
      'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' +
      'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' +
      'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' +
      '80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' +
      '811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);

    var Entities = {
      /**
       * Encodes the specified string using raw entities. This means only the required XML base entities will be encoded.
       *
       * @method encodeRaw
       * @param {String} text Text to encode.
       * @param {Boolean} attr Optional flag to specify if the text is attribute contents.
       * @return {String} Entity encoded text.
       */
      encodeRaw: function (text, attr) {
        return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {
          return baseEntities[chr] || chr;
        });
      },

      /**
       * Encoded the specified text with both the attributes and text entities. This function will produce larger text contents
       * since it doesn't know if the context is within a attribute or text node. This was added for compatibility
       * and is exposed as the DOMUtils.encode function.
       *
       * @method encodeAllRaw
       * @param {String} text Text to encode.
       * @return {String} Entity encoded text.
       */
      encodeAllRaw: function (text) {
        return ('' + text).replace(rawCharsRegExp, function (chr) {
          return baseEntities[chr] || chr;
        });
      },

      /**
       * Encodes the specified string using numeric entities. The core entities will be
       * encoded as named ones but all non lower ascii characters will be encoded into numeric entities.
       *
       * @method encodeNumeric
       * @param {String} text Text to encode.
       * @param {Boolean} attr Optional flag to specify if the text is attribute contents.
       * @return {String} Entity encoded text.
       */
      encodeNumeric: function (text, attr) {
        return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {
          // Multi byte sequence convert it to a single entity
          if (chr.length > 1) {
            return '&#' + (((chr.charCodeAt(0) - 0xD800) * 0x400) + (chr.charCodeAt(1) - 0xDC00) + 0x10000) + ';';
          }

          return baseEntities[chr] || '&#' + chr.charCodeAt(0) + ';';
        });
      },

      /**
       * Encodes the specified string using named entities. The core entities will be encoded
       * as named ones but all non lower ascii characters will be encoded into named entities.
       *
       * @method encodeNamed
       * @param {String} text Text to encode.
       * @param {Boolean} attr Optional flag to specify if the text is attribute contents.
       * @param {Object} entities Optional parameter with entities to use.
       * @return {String} Entity encoded text.
       */
      encodeNamed: function (text, attr, entities) {
        entities = entities || namedEntities;

        return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {
          return baseEntities[chr] || entities[chr] || chr;
        });
      },

      /**
       * Returns an encode function based on the name(s) and it's optional entities.
       *
       * @method getEncodeFunc
       * @param {String} name Comma separated list of encoders for example named,numeric.
       * @param {String} entities Optional parameter with entities to use instead of the built in set.
       * @return {function} Encode function to be used.
       */
      getEncodeFunc: function (name, entities) {
        entities = buildEntitiesLookup(entities) || namedEntities;

        function encodeNamedAndNumeric(text, attr) {
          return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {
            if (baseEntities[chr] !== undefined) {
              return baseEntities[chr];
            }

            if (entities[chr] !== undefined) {
              return entities[chr];
            }

            // Convert multi-byte sequences to a single entity.
            if (chr.length > 1) {
              return '&#' + (((chr.charCodeAt(0) - 0xD800) * 0x400) + (chr.charCodeAt(1) - 0xDC00) + 0x10000) + ';';
            }

            return '&#' + chr.charCodeAt(0) + ';';
          });
        }

        function encodeCustomNamed(text, attr) {
          return Entities.encodeNamed(text, attr, entities);
        }

        // Replace + with , to be compatible with previous TinyMCE versions
        name = makeMap(name.replace(/\+/g, ','));

        // Named and numeric encoder
        if (name.named && name.numeric) {
          return encodeNamedAndNumeric;
        }

        // Named encoder
        if (name.named) {
          // Custom names
          if (entities) {
            return encodeCustomNamed;
          }

          return Entities.encodeNamed;
        }

        // Numeric
        if (name.numeric) {
          return Entities.encodeNumeric;
        }

        // Raw encoder
        return Entities.encodeRaw;
      },

      /**
       * Decodes the specified string, this will replace entities with raw UTF characters.
       *
       * @method decode
       * @param {String} text Text to entity decode.
       * @return {String} Entity decoded string.
       */
      decode: function (text) {
        return text.replace(entityRegExp, function (all, numeric) {
          if (numeric) {
            if (numeric.charAt(0).toLowerCase() === 'x') {
              numeric = parseInt(numeric.substr(1), 16);
            } else {
              numeric = parseInt(numeric, 10);
            }

            // Support upper UTF
            if (numeric > 0xFFFF) {
              numeric -= 0x10000;

              return String.fromCharCode(0xD800 + (numeric >> 10), 0xDC00 + (numeric & 0x3FF));
            }

            return asciiMap[numeric] || String.fromCharCode(numeric);
          }

          return reverseEntities[all] || namedEntities[all] || nativeDecode(all);
        });
      }
    };

    return Entities;
  }
);

/**
 * Range.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Old IE Range.
 *
 * @private
 * @class tinymce.dom.Range
 */
define(
  'tinymce.core.dom.Range',
  [
    "tinymce.core.util.Tools"
  ],
  function (Tools) {
    // Range constructor
    function Range(dom) {
      var self = this,
        doc = dom.doc,
        EXTRACT = 0,
        CLONE = 1,
        DELETE = 2,
        TRUE = true,
        FALSE = false,
        START_OFFSET = 'startOffset',
        START_CONTAINER = 'startContainer',
        END_CONTAINER = 'endContainer',
        END_OFFSET = 'endOffset',
        extend = Tools.extend,
        nodeIndex = dom.nodeIndex;

      function createDocumentFragment() {
        return doc.createDocumentFragment();
      }

      function setStart(n, o) {
        _setEndPoint(TRUE, n, o);
      }

      function setEnd(n, o) {
        _setEndPoint(FALSE, n, o);
      }

      function setStartBefore(n) {
        setStart(n.parentNode, nodeIndex(n));
      }

      function setStartAfter(n) {
        setStart(n.parentNode, nodeIndex(n) + 1);
      }

      function setEndBefore(n) {
        setEnd(n.parentNode, nodeIndex(n));
      }

      function setEndAfter(n) {
        setEnd(n.parentNode, nodeIndex(n) + 1);
      }

      function collapse(ts) {
        if (ts) {
          self[END_CONTAINER] = self[START_CONTAINER];
          self[END_OFFSET] = self[START_OFFSET];
        } else {
          self[START_CONTAINER] = self[END_CONTAINER];
          self[START_OFFSET] = self[END_OFFSET];
        }

        self.collapsed = TRUE;
      }

      function selectNode(n) {
        setStartBefore(n);
        setEndAfter(n);
      }

      function selectNodeContents(n) {
        setStart(n, 0);
        setEnd(n, n.nodeType === 1 ? n.childNodes.length : n.nodeValue.length);
      }

      function compareBoundaryPoints(h, r) {
        var sc = self[START_CONTAINER], so = self[START_OFFSET], ec = self[END_CONTAINER], eo = self[END_OFFSET],
          rsc = r.startContainer, rso = r.startOffset, rec = r.endContainer, reo = r.endOffset;

        // Check START_TO_START
        if (h === 0) {
          return _compareBoundaryPoints(sc, so, rsc, rso);
        }

        // Check START_TO_END
        if (h === 1) {
          return _compareBoundaryPoints(ec, eo, rsc, rso);
        }

        // Check END_TO_END
        if (h === 2) {
          return _compareBoundaryPoints(ec, eo, rec, reo);
        }

        // Check END_TO_START
        if (h === 3) {
          return _compareBoundaryPoints(sc, so, rec, reo);
        }
      }

      function deleteContents() {
        _traverse(DELETE);
      }

      function extractContents() {
        return _traverse(EXTRACT);
      }

      function cloneContents() {
        return _traverse(CLONE);
      }

      function insertNode(n) {
        var startContainer = this[START_CONTAINER],
          startOffset = this[START_OFFSET], nn, o;

        // Node is TEXT_NODE or CDATA
        if ((startContainer.nodeType === 3 || startContainer.nodeType === 4) && startContainer.nodeValue) {
          if (!startOffset) {
            // At the start of text
            startContainer.parentNode.insertBefore(n, startContainer);
          } else if (startOffset >= startContainer.nodeValue.length) {
            // At the end of text
            dom.insertAfter(n, startContainer);
          } else {
            // Middle, need to split
            nn = startContainer.splitText(startOffset);
            startContainer.parentNode.insertBefore(n, nn);
          }
        } else {
          // Insert element node
          if (startContainer.childNodes.length > 0) {
            o = startContainer.childNodes[startOffset];
          }

          if (o) {
            startContainer.insertBefore(n, o);
          } else {
            if (startContainer.nodeType == 3) {
              dom.insertAfter(n, startContainer);
            } else {
              startContainer.appendChild(n);
            }
          }
        }
      }

      function surroundContents(n) {
        var f = self.extractContents();

        self.insertNode(n);
        n.appendChild(f);
        self.selectNode(n);
      }

      function cloneRange() {
        return extend(new Range(dom), {
          startContainer: self[START_CONTAINER],
          startOffset: self[START_OFFSET],
          endContainer: self[END_CONTAINER],
          endOffset: self[END_OFFSET],
          collapsed: self.collapsed,
          commonAncestorContainer: self.commonAncestorContainer
        });
      }

      // Private methods

      function _getSelectedNode(container, offset) {
        var child;

        // TEXT_NODE
        if (container.nodeType == 3) {
          return container;
        }

        if (offset < 0) {
          return container;
        }

        child = container.firstChild;
        while (child && offset > 0) {
          --offset;
          child = child.nextSibling;
        }

        if (child) {
          return child;
        }

        return container;
      }

      function _isCollapsed() {
        return (self[START_CONTAINER] == self[END_CONTAINER] && self[START_OFFSET] == self[END_OFFSET]);
      }

      function _compareBoundaryPoints(containerA, offsetA, containerB, offsetB) {
        var c, offsetC, n, cmnRoot, childA, childB;

        // In the first case the boundary-points have the same container. A is before B
        // if its offset is less than the offset of B, A is equal to B if its offset is
        // equal to the offset of B, and A is after B if its offset is greater than the
        // offset of B.
        if (containerA == containerB) {
          if (offsetA == offsetB) {
            return 0; // equal
          }

          if (offsetA < offsetB) {
            return -1; // before
          }

          return 1; // after
        }

        // In the second case a child node C of the container of A is an ancestor
        // container of B. In this case, A is before B if the offset of A is less than or
        // equal to the index of the child node C and A is after B otherwise.
        c = containerB;
        while (c && c.parentNode != containerA) {
          c = c.parentNode;
        }

        if (c) {
          offsetC = 0;
          n = containerA.firstChild;

          while (n != c && offsetC < offsetA) {
            offsetC++;
            n = n.nextSibling;
          }

          if (offsetA <= offsetC) {
            return -1; // before
          }

          return 1; // after
        }

        // In the third case a child node C of the container of B is an ancestor container
        // of A. In this case, A is before B if the index of the child node C is less than
        // the offset of B and A is after B otherwise.
        c = containerA;
        while (c && c.parentNode != containerB) {
          c = c.parentNode;
        }

        if (c) {
          offsetC = 0;
          n = containerB.firstChild;

          while (n != c && offsetC < offsetB) {
            offsetC++;
            n = n.nextSibling;
          }

          if (offsetC < offsetB) {
            return -1; // before
          }

          return 1; // after
        }

        // In the fourth case, none of three other cases hold: the containers of A and B
        // are siblings or descendants of sibling nodes. In this case, A is before B if
        // the container of A is before the container of B in a pre-order traversal of the
        // Ranges' context tree and A is after B otherwise.
        cmnRoot = dom.findCommonAncestor(containerA, containerB);
        childA = containerA;

        while (childA && childA.parentNode != cmnRoot) {
          childA = childA.parentNode;
        }

        if (!childA) {
          childA = cmnRoot;
        }

        childB = containerB;
        while (childB && childB.parentNode != cmnRoot) {
          childB = childB.parentNode;
        }

        if (!childB) {
          childB = cmnRoot;
        }

        if (childA == childB) {
          return 0; // equal
        }

        n = cmnRoot.firstChild;
        while (n) {
          if (n == childA) {
            return -1; // before
          }

          if (n == childB) {
            JP!+?kd 01Pp KP0j I !B)b g<s  ? J`H@)]?C"A :9:8A{HQ45H"$P 9+C@ ,C.|~u6J{'sVnK2nD&YdQz/kj~n7lO^U#=y~\V?kZJnz
j}g;o]N|GImnO_F77-uu]_ozRLg?qOL?O~sy?%O DPFadDw@MBXa
D!@"! "`0i $`L b@@T %  	)4+BeAae
A0 #@X(=@cb*@ kpwx53Xe=|\~d5j6%_^_ogU62~M -Vr?n=p<ma2L*x4"$
+ ! q-!8H0 "OAd< "d Fc
b8C
 @)4@00*`DPD
 :e HJ`cC&d5C . ML]BIdB@q ` 
E@9PEZ5XREX#AMlHF\ #pS@!A, a0    =5?>}fsQ>g5AH~o{/V l~iw<ns3Wc+;m`M_g'jg}nX_W_Y~\N -`1 (A	@5
$IAy,b@ d@APW3QcY  h  d4$ 2"Npeh G!#AP+)8R.s3_{mG`Sw>?}k,O3gOYl!;Hmk'XW<Vzw=
#_zX4-N}G_+nfsvn.n}Q{v~y_#Xu]wym"}rc[z?8M; "'TVa!2@#ASvP04I+"Bch	P* x2b&@GP!8 .u[`iaUiZ0B$DH	X  `0 	D;2-WrGRaWk=]/%r:s/U!Eq?.,qGOz'n{>9N<Kq6z-<J>@&" D E,	@A2%"Liz!D!'(`x&@&(A`<* 2 6XPF0H$/0Z6,lJ4$ 2`/ P XG| T> +D2 VT TQtxv.Ia`V	BBd<`)bB9_ODX00Pd48 bI thDW42B@F! yTG^K>2N7*?s1=skoF'>Vwe{#=W&39q*zb$ 	X8@N "#N iA 
P38 "al"P@ca8p6c3%, 6l!q3nWOW{.7?q]X/;K_UdWEtS#_|W}~f?k;/^wzkHj^VG~-k663]o;l^6svz;-z|YzY:^2G}vOGfog6bL A1la@IbR$ ;"D%GR$&XY!2df  eG!A0-(<X0 
\` `RDe` @`O Q yvty{w51	?g"6/(QVoV?z7-78m{<(=o>o?`|]>|~7m{T %x`	 He54G`r$V"e7$@DA LP&j&"  8A  D4Q "q*H" `!`P	!d  :Fz0	 05 !'LhS!EP cI&Y@', 8@		Bz		  )X38{&})=%e8y7Mwr<9Uk]75nOo|/#Goh]|%QrM?;G|&/]QvW oDR.$P#IA0h#HBW; DB
TT)CrfdD2%`AmCA0

s6P\CS AkO7#:yyoljuK+wt{_N#MoJ{QKHsOu\rY;~5,Sk?|+e]_[Gz	c[UyM^7)~m*\G>+sP8tse_zM4"ul@;SWS6O>,kwM l?d7}9S{Q@
!/1 #SZ	,/ACtT  "1ZH`dA@Q`E)dHITBFRL!& % j	a 6_M(nFvt\:{y9;kyAK-'<6~5fOwzu=r/W_qh?kX?nxZ]2	d
Lxk;#AE0&"DhHIO\,PPQ Y#y B&A *"BC"F `S)!IV
#m@B0@B1R
iF- @h  45=AA)2IK0	T!)G P*J`
HP!h*`@l`E@T0 hA %(H*``a0*p!$6	vt&2$t("AB;~**E?]Z42&W66_WTYi_;k8wtn^i&2{Em^\w+
-k+z*70%R  return;
          }

          if (sub.length > 0) {
            frag.appendChild(doc.createTextNode(sub));
          }

          return frag;
        }

        // Copy nodes between the start/end offsets.
        n = _getSelectedNode(self[START_CONTAINER], self[START_OFFSET]);
        cnt = self[END_OFFSET] - self[START_OFFSET];

        while (n && cnt > 0) {
          sibling = n.nextSibling;
          xferNode = _traverseFullySelected(n, how);

          if (frag) {
            frag.appendChild(xferNode);
          }

          --cnt;
          n = sibling;
        }

        // Nothing is partially selected, so collapse to start point
        if (how != CLONE) {
          self.collapse(TRUE);
        }

        return frag;
      }

      function _traverseCommonStartContainer(endAncestor, how) {
        var frag, n, endIdx, cnt, sibling, xferNode;

        if (how != DELETE) {
          frag = createDocumentFragment();
        }

        n = _traverseRightBoundary(endAncestor, how);

        if (frag) {
          frag.appendChild(n);
        }

        endIdx = nodeIndex(endAncestor);
        cnt = endIdx - self[START_OFFSET];

        if (cnt <= 0) {
          // Collapse to just before the endAncestor, which
          // is partially selected.
          if (how != CLONE) {
            self.setEndBefore(endAncestor);
            self.collapse(FALSE);
          }

          return frag;
        }

        n = endAncestor.previousSibling;
        while (cnt > 0) {
          sibling = n.previousSibling;
          xferNode = _traverseFullySelected(n, how);

          if (frag) {
            frag.insertBefore(xferNode, frag.firstChild);
          }

          --cnt;
          n = sibling;
        }

        // Collapse to just before the endAncestor, which
        // is partially selected.
        if (how != CLONE) {
          self.setEndBefore(endAncestor);
          self.collapse(FALSE);
        }

        return frag;
      }

      function _traverseCommonEndContainer(startAncestor, how) {
        var frag, startIdx, n, cnt, sibling, xferNode;

        if (how != DELETE) {
          frag = createDocumentFragment();
        }

        n = _traverseLeftBoundary(startAncestor, how);
        if (frag) {
          frag.appendChild(n);
        }

        startIdx = nodeIndex(startAncestor);
        ++startIdx; // Because we already traversed it

        cnt = self[END_OFFSET] - startIdx;
        n = startAncestor.nextSibling;
        while (n && cnt > 0) {
          sibling = n.nextSibling;
          xferNode = _traverseFullySelected(n, how);

          if (frag) {
            frag.appendChild(xferNode);
          }

          --cnt;
          n = sibling;
        }

        if (how != CLONE) {
          self.setStartAfter(startAncestor);
          self.collapse(TRUE);
        }

        return frag;
      }

      function _traverseCommonAncestors(startAncestor, endAncestor, how) {
        var n, frag, startOffset, endOffset, cnt, sibling, nextSibling;

        if (how != DELETE) {
          frag = createDocumentFragment();
        }

        n = _traverseLeftBoundary(startAncestor, how);
        if (frag) {
          frag.appendChild(n);
        }

        startOffset = nodeIndex(startAncestor);
        endOffset = nodeIndex(endAncestor);
        ++startOffset;

        cnt = endOffset - startOffset;
        sibling = startAncestor.nextSibling;

        while (cnt > 0) {
          nextSibling = sibling.nextSibling;
          n = _traverseFullySelected(sibling, how);

          if (frag) {
            frag.appendChild(n);
          }

          sibling = nextSibling;
          --cnt;
        }

        n = _traverseRightBoundary(endAncestor, how);

        if (frag) {
          frag.appendChild(n);
        }

        if (how != CLONE) {
          self.setStartAfter(startAncestor);
          self.collapse(TRUE);
        }

        return frag;
      }

      function _traverseRightBoundary(root, how) {
        var next = _getSelectedNode(self[END_CONTAINER], self[END_OFFSET] - 1), parent, clonedParent;
        var prevSibling, clonedChild, clonedGrandParent, isFullySelected = next != self[END_CONTAINER];

        if (next == root) {
          return _traverseNode(next, isFullySelected, FALSE, how);
        }

        parent = next.parentNode;
        clonedParent = _traverseNode(parent, FALSE, FALSE, how);

        while (parent) {
          while (next) {
            prevSibling = next.previousSibling;
            clonedChild = _traverseNode(next, isFullySelected, FALSE, how);

            if (how != DELETE) {
              clonedParent.insertBefore(clonedChild, clonedParent.firstChild);
            }

            isFullySelected = TRUE;
            next = prevSibling;
          }

          if (parent == root) {
            return clonedParent;
          }

          next = parent.previousSibling;
          parent = parent.parentNode;

          clonedGrandParent = _traverseNode(parent, FALSE, FALSE, how);

          if (how != DELETE) {
            clonedGrandParent.appendChild(clonedParent);
          }

          clonedParent = clonedGrandParent;
        }
      }

      function _traverseLeftBoundary(root, how) {
        var next = _getSelectedNode(self[START_CONTAINER], self[START_OFFSET]), isFullySelected = next != self[START_CONTAINER];
        var parent, clonedParent, nextSibling, clonedChild, clonedGrandParent;

        if (next == root) {
          return _traverseNode(next, isFullySelected, TRUE, how);
        }

        parent = next.parentNode;
        clonedParent = _traverseNode(parent, FALSE, TRUE, how);

        while (parent) {
          while (next) {
            nextSibling = next.nextSibling;
            clonedChild = _traverseNode(next, isFullySelected, TRUE, how);

            if (how != DELETE) {
              clonedParent.appendChild(clonedChild);
            }

            isFullySelected = TRUE;
            next = nextSibling;
          }

          if (parent == root) {
            return clonedParent;
          }

          next = parent.nextSibling;
          parent = parent.parentNode;

          clonedGrandParent = _traverseNode(parent, FALSE, TRUE, how);

          if (how != DELETE) {
            clonedGrandParent.appendChild(clonedParent);
          }

          clonedParent = clonedGrandParent;
        }
      }

      function _traverseNode(n, isFullySelected, isLeft, how) {
        var txtValue, newNodeValue, oldNodeValue, offset, newNode;

        if (isFullySelected) {
          return _traverseFullySelected(n, how);
        }

        // TEXT_NODE
        if (n.nodeType == 3) {
          txtValue = n.nodeValue;

          if (isLeft) {
            offset = self[START_OFFSET];
            newNodeValue = txtValue.substring(offset);
            oldNodeValue = txtValue.substring(0, offset);
          } else {
            offset = self[END_OFFSET];
            newNodeValue = txtValue.substring(0, offset);
            oldNodeValue = txtValue.substring(offset);
          }

          if (how != CLONE) {
            n.nodeValue = oldNodeValue;
          }

          if (how == DELETE) {
            return;
          }

          newNode = dom.clone(n, FALSE);
          newNode.nodeValue = newNodeValue;

          return newNode;
        }

        if (how == DELETE) {
          return;
        }

        return dom.clone(n, FALSE);
      }

      function _traverseFullySelected(n, how) {
        if (how != DELETE) {
          return how == CLONE ? dom.clone(n, TRUE) : n;
        }

        n.parentNode.removeChild(n);
      }

      function toStringIE() {
        return dom.create('body', null, cloneContents()).outerText;
      }

      extend(self, {
        // Initial states
        startContainer: doc,
        startOffset: 0,
        endContainer: doc,
        endOffset: 0,
        collapsed: TRUE,
        commonAncestorContainer: doc,

        // Range constants
        START_TO_START: 0,
        START_TO_END: 1,
        END_TO_END: 2,
        END_TO_START: 3,

        // Public methods
        setStart: setStart,
        setEnd: setEnd,
        setStartBefore: setStartBefore,
        setStartAfter: setStartAfter,
        setEndBefore: setEndBefore,
        setEndAfter: setEndAfter,
        collapse: collapse,
        selectNode: selectNode,
        selectNodeContents: selectNodeContents,
        compareBoundaryPoints: compareBoundaryPoints,
        deleteContents: deleteContents,
        extractContents: extractContents,
        cloneContents: cloneContents,
        insertNode: insertNode,
        surroundContents: surroundContents,
        cloneRange: cloneRange,
        toStringIE: toStringIE
      });

      return self;
    }

    // Older IE versions doesn't let you override toString by it's constructor so we have to stick it in the prototype
    Range.prototype.toString = function () {
      return this.toStringIE();
    };

    return Range;
  }
);

defineGlobal("global!Array", Array);
defineGlobal("global!Error", Error);
define(
  'ephox.katamari.api.Fun',

  [
    'global!Array',
    'global!Error'
  ],

  function (Array, Error) {

    var noop = function () { };

    var compose = function (fa, fb) {
      return function () {
        return fa(fb.apply(null, arguments));
      };
    };

    var constant = function (value) {
      return function () {
        return value;
      };
    };

    var identity = function (x) {
      return x;
    };

    var tripleEquals = function(a, b) {
      return a === b;
    };

    // Don't use array slice(arguments), makes the whole function unoptimisable on Chrome
    var curry = function (f) {
      // equivalent to arguments.slice(1)
      // starting at 1 because 0 is the f, makes things tricky.
      // Pay attention to what variable is where, and the -1 magic.
      // thankfully, we have tests for this.
      var args = new Array(arguments.length - 1);
      for (var i = 1; i < arguments.length; i++) args[i-1] = arguments[i];

      return function () {
        var newArgs = new Array(arguments.length);
        for (var j = 0; j < newArgs.length; j++) newArgs[j] = arguments[j];

        var all = args.concat(newArgs);
        return f.apply(null, all);
      };
    };

    var not = function (f) {
      return function () {
        return !f.apply(null, arguments);
      };
    };

    var die = function (msg) {
      return function () {
        throw new Error(msg);
      };
    };

    var apply = function (f) {
      return f();
    };

    var call = function(f) {
      f();
    };

    var never = constant(false);
    var always = constant(true);
    

    return {
      noop: noop,
      compose: compose,
      constant: constant,
      identity: identity,
      tripleEquals: tripleEquals,
      curry: curry,
      not: not,
      die: die,
      apply: apply,
      call: call,
      never: never,
      always: always
    };
  }
);

defineGlobal("global!Object", Object);
define(
  'ephox.katamari.api.Option',

  [
    'ephox.katamari.api.Fun',
    'global!Object'
  ],

  function (Fun, Object) {

    var never = Fun.never;
    var always = Fun.always;

    /**
      Option objects support the following methods:

      fold :: this Option a -> ((() -> b, a -> b)) -> Option b

      is :: this Option a -> a -> Boolean

      isSome :: this Option a -> () -> Boolean

      isNone :: this Option a -> () -> Boolean

      getOr :: this Option a -> a -> a

      getOrThunk :: this Option a -> (() -> a) -> a

      getOrDie :: this Option a -> String -> a

      or :: this Option a -> Option a -> Option a
        - if some: return self
        - if none: return opt

      orThunk :: this Option a -> (() -> Option a) -> Option a
        - Same as "or", but uses a thunk instead of a value

      map :: this Option a -> (a -> b) -> Option b
        - "fmap" operation on the Option Functor.
        - same as 'each'

      ap :: this Option a -> Option (a -> b) -> Option b
        - "apply" operation on the Option Apply/Applicative.
        - Equivalent to <*> in Haskell/PureScript.

      each :: this Option a -> (a -> b) -> Option b
        - same as 'map'

      bind :: this Option a -> (a -> Option b) -> Option b
        - "bind"/"flatMap" operation on the Option Bind/Monad.
        - Equivalent to >>= in Haskell/PureScript; flatMap in Scala.

      flatten :: {this Option (Option a))} -> () -> Option a
        - "flatten"/"join" operation on the Option Monad.

      exists :: this Option a -> (a -> Boolean) -> Boolean

      forall :: this Option a -> (a -> Boolean) -> Boolean

      filter :: this Option a -> (a -> Boolean) -> Option a

      equals :: this Option a -> Option a -> Boolean

      equals_ :: this Option a -> (Option a, a -> Boolean) -> Boolean

      toArray :: this Option a -> () -> [a]

    */

    var none = function () { return NONE; };

    var NONE = (function () {
      var eq = function (o) {
        return o.isNone();
      };

      // inlined from peanut, maybe a micro-optimisation?
      var call = function (thunk) { return thunk(); };
      var id = function (n) { return n; };
      var noop = function () { };

      var me = {
        fold: function (n, s) { return n(); },
        is: never,
        isSome: never,
        isNone: always,
        getOr: id,
        getOrThunk: call,
        getOrDie: function (msg) {
          throw new Error(msg || 'error: getOrDie called on none.');
        },
        or: id,
        orThunk: call,
        map: none,
        ap: none,
        each: noop,
        bind: none,
        flatten: none,
        exists: never,
        forall: always,
        filter: none,
        equals: eq,
        equals_: eq,
        toArray: function () { return []; },
        toString: Fun.constant("none()")
      };
      if (Object.freeze) Object.freeze(me);
      return me;
    })();


    /** some :: a -> Option a */
    var some = function (a) {

      // inlined from peanut, maybe a micro-optimisation?
      var constant_a = function () { return a; };

      var self = function () {
        // can't Fun.constant this one
        return me;
      };

      var map = function (f) {
        return some(f(a));
      };

      var bind = function (f) {
        return f(a);
      };

      var me = {
        fold: function (n, s) { return s(a); },
        is: function (v) { return a === v; },
        isSome: always,
        isNone: never,
        getOr: constant_a,
        getOrThunk: constant_a,
        getOrDie: constant_a,
        or: self,
        orThunk: self,
        map: map,
        ap: function (optfab) {
          return optfab.fold(none, function(fab) {
            return some(fab(a));
          });
        },
        each: function (f) {
          f(a);
        },
        bind: bind,
        flatten: constant_a,
        exists: bind,
        forall: bind,
        filter: function (f) {
          return f(a) ? me : NONE;
        },
        equals: function (o) {
          return o.is(a);
        },
        equals_: function (o, elementEq) {
          return o.fold(
            never,
            function (b) { return elementEq(a, b); }
          );
        },
        toArray: function () {
          return [a];
        },
        toString: function () {
          return 'some(' + a + ')';
        }
      };
      return me;
    };

    /** from :: undefined|null|a -> Option a */
    var from = function (value) {
      return value === null || value === undefined ? NONE : some(value);
    };

    return {
      some: some,
      none: none,
      from: from
    };
  }
);

defineGlobal("global!String", String);
define(
  'ephox.katamari.api.Arr',

  [
    'ephox.katamari.api.Option',
    'global!Array',
    'global!Error',
    'global!String'
  ],

  function (Option, Array, Error, String) {
    // Use the native Array.indexOf if it is available (IE9+) otherwise fall back to manual iteration
    // https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf
    var rawIndexOf = (function () {
      var pIndexOf = Array.prototype.indexOf;

      var fastIndex = function (xs, x) { return  pIndexOf.call(xs, x); };

      var slowIndex = function(xs, x) { return slowIndexOf(xs, x); };

      return pIndexOf === undefined ? slowIndex : fastIndex;
    })();

    var indexOf = function (II: 'N*B 6}5r-x
AjR;XH b`
!#&@\@ ZA<=	G/%(ZP!0dz@ #JARCN 	*	duJ+!A[-( x,n;& JN@hX5b*
hc8`X ! >58_BcjF"B  T	!@$	K@"
(Q 'A 
6MOP 
>	RP"0C@$9H@$@Z!D&k!`@;J DX`]y&F+`)!p^P	`	X@D@@	?" *PIy	We?O!0bt	HpP
#RgIQ|2dX)/spvJ2I= @b*`  v`A xh)LL*CHB )$`L 4fT@dY "2LK"iHHg\H (0p  (!J|Ff!!8V	q_J A!!  LgJ 4,IC  1I` OP"p`C%P C@BUt$
r7"2r
QaRY D@	 X	rSOy4'	3G" ^'GAAA 
C d)A`T@16 1A>N4iB!1H:h(@
  VS"fT3/8QPX0d#@&QLH( 2&	iIJB  -|
`  ,@"LTR'X aJBp H ED1
Bd (B@l]Y]`ZH2Ec,5@ m LN
	
$D@H$@PPvF9( TH@**^0 1   H9 !FJhA	)	BA0Hg,Mf&BX.(X 
isX 5BB"8@d$2 H`
@ :L@
iGRA 1 0 `P@(P20) "	FCC%Y*
P#GmcDAp
@!Q
	H#aW!<) 
/s !182 )	` mXc#D<KXP(

T	jAnhq
 $@f"h&%&8s6qUk@gE4S.&Pp3 W-aB)!pM>DPP:#HHP84Je_  ,@@7AHB0YA0eijFPD`& CdTx"  0Xvc X0*@"#E" ^ @ nH4 xydg;R" /kF3/)ij0 E$$ "&D!euA69 '`bClH-V^3}5A L(2#& +b P2`hAE@,P@ 5iL1*G TUm=(3P)"GB	U>x0>8[A P%	\ 9QFEPQMKIT E+tVa$f 3$}@B	 Fkp
$(! T!P)V:2e( LQdD8	* @B0!7 )f}05sT rE@GLrc$(Gy/D#Q=BgphCYC3ddD" 0#RHTX4 
bCT \
 bH( (L0FK3E!)X")8A 8T
/D ARRh4`ppCE*:Q8 a Cj l yVG Z8	05 "H$`< `8B @@UQ\BEPQ@d "H*  T-+	U	LMjaBUL^A@C1 !qr BD(Brz 	DB* 4"WRfUP 0^P`F72(> )@@C%W4
@N(`rSKrt+H  \pfE5 @URK% "uD" b4 0` 
+  rM\ D %HN0 ys7j
Bjet 		Z0 -	 IXGqif
G-<\04!S(HB3cf
@Q1B8nRC CR #0HB!0% . & @U !j0 ppD>A "x2qH{viAHHC@OR
&$4w	+0A  +U4bS,g&t!ht QA8
&pX!D1JrE) a fQQ  QiQI@@!
L%Zx!a l0a tUJ)6MDpBS C@"  T"6SN`H!`S!d@	 N0CT U
UPq		F%Z  T
40`A6 x@34,H08p Bx ( S\!S  I@PD(2"F 
@t/l*,@)IABQ!-!  LD!; L D Ei_%AaL (E0ChIvJD |dIHmHTz$$  C$l '@BNh)'6I!pa9*y
 P Br/
lOrHi9  A
nB @@$ QSC#	p A1 T!(YDk N&QF47x^FhaB3a&P@%(*=l0`A)rAPHD"
@akb'\aT ]C   P^   "7 "!AE$BE@D5J F`(a 1Hl
A#EVNA'S! r2AoE *dEd0 " 
0$vPIQO)b(xw4 Hb  n:8P AFPAVvz$'xhEb&@E,l2Q+b`lLJ <a""Du$)&!. H$aMS"PtC V&AaZ6` l@Xx$tLt!%t@$VCVJ{ : 

"`F'@ 
RP2/` 4na4!pE 0ER Q& 90 blP 1(H@

`  0red(x, i, xs)) {
          return Option.some(x);
        }
      }
      return Option.none();
    };

    var findIndex = function (xs, pred) {
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        if (pred(x, i, xs)) {
          return Option.some(i);
        }
      }

      return Option.none();
    };

    var slowIndexOf = function (xs, x) {
      for (var i = 0, len = xs.length; i < len; ++i) {
        if (xs[i] === x) {
          return i;
        }
      }

      return -1;
    };

    var push = Array.prototype.push;
    var flatten = function (xs) {
      // Note, this is possible because push supports multiple arguments:
      // http://jsperf.com/concat-push/6
      // Note that in the past, concat() would silently work (very slowly) for array-like objects.
      // With this change it will throw an error.
      var r = [];
      for (var i = 0, len = xs.length; i < len; ++i) {
        // Ensure that each value is an array itself
        if (! Array.prototype.isPrototypeOf(xs[i])) throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);
        push.apply(r, xs[i]);
      }
      return r;
    };

    var bind = function (xs, f) {
      var output = map(xs, f);
      return flatten(output);
    };

    var forall = function (xs, pred) {
      for (var i = 0, len = xs.length; i < len; ++i) {
        var x = xs[i];
        if (pred(x, i, xs) !== true) {
          return false;
        }
      }
      return true;
    };

    var equal = function (a1, a2) {
      return a1.length === a2.length && forall(a1, function (x, i) {
        return x === a2[i];
      });
    };

    var slice = Array.prototype.slice;
    var reverse = function (xs) {
      var r = slice.call(xs, 0);
      r.reverse();
      return r;
    };

    var difference = function (a1, a2) {
      return filter(a1, function (x) {
        return !contains(a2, x);
      });
    };

    var mapToObject = function(xs, f) {
      var r = {};
      for (var i = 0, len = xs.length; i < len; i++) {
        var x = xs[i];
        r[String(x)] = f(x, i);
      }
      return r;
    };

    var pure = function(x) {
      return [x];
    };

    var sort = function (xs, comparator) {
      var copy = slice.call(xs, 0);
      copy.sort(comparator);
      return copy;
    };

    return {
      map: map,
      each: each,
      eachr: eachr,
      partition: partition,
      filter: filter,
      groupBy: groupBy,
      indexOf: indexOf,
      foldr: foldr,
      foldl: foldl,
      find: find,
      findIndex: findIndex,
      flatten: flatten,
      bind: bind,
      forall: forall,
      exists: exists,
      contains: contains,
      equal: equal,
      reverse: reverse,
      chunk: chunk,
      difference: difference,
      mapToObject: mapToObject,
      pure: pure,
      sort: sort,
      range: range
    };
  }
);
defineGlobal("global!setTimeout", setTimeout);
define(
  'ephox.katamari.api.LazyValue',

  [
    'ephox.katamari.api.Arr',
    'ephox.katamari.api.Option',
    'global!setTimeout'
  ],

  function (Arr, Option, setTimeout) {
    var nu = function (baseFn) {
      var data = Option.none();
      var callbacks = [];

      /** map :: this LazyValue a -> (a -> b) -> LazyValue b */
      var map = function (f) {
        return nu(function (nCallback) {
          get(function (data) {
            nCallback(f(data));
          });
        });
      };

      var get = function (nCallback) {
        if (isReady()) call(nCallback);
        else callbacks.push(nCallback);
      };

      var set = function (x) {
        data = Option.some(x);
        run(callbacks);
        callbacks = [];
      };

      var isReady = function () {
        return data.isSome();
      };

      var run = function (cbs) {
        Arr.each(cbs, call);
      };

      var call = function(cb) {
        data.each(function(x) {
          setTimeout(function() {
            cb(x);
          }, 0);
        });
      };

      // Lazy values cache the value and kick off immediately
      baseFn(set);

      return {
        get: get,
        map: map,
        isReady: isReady
      };
    };

    var pure = function (a) {
      return nu(function (callback) {
        callback(a);
      });
    };

    return {
      nu: nu,
      pure: pure
    };
  }
);
define(
  'ephox.katamari.async.Bounce',

  [
    'global!Array',
    'global!setTimeout'
  ],

  function (Array, setTimeout) {

    var bounce = function(f) {
      return function() {
        var args = Array.prototype.slice.call(arguments);
        var me = this;
        setTimeout(function() {
          f.apply(me, args);
        }, 0);
      };
    };

    return {
      bounce: bounce
    };
  }
);

define(
  'ephox.katamari.api.Future',

  [
    'ephox.katamari.api.LazyValue',
    'ephox.katamari.async.Bounce'
  ],

  /** A future value that is evaluated on demand. The base function is re-evaluated each time 'get' is called. */
  function (LazyValue, Bounce) {
    var nu = function (baseFn) {
      var get = function(callback) {
        baseFn(Bounce.bounce(callback));
      };

      /** map :: this Future a -> (a -> b) -> Future b */
      var map = function (fab) {
        return nu(function (callback) {
          get(function (a) {
            var value = fab(a);
            callback(value);
          });
        });
      };

      /** bind :: this Future a -> (a -> Future b) -> Future b */
      var bind = function (aFutureB) {
        return nu(function (callback) {
          get(function (a) {
            aFutureB(a).get(callback);
          });
        });
      };

      /** anonBind :: this Future a -> Future b -> Future b
       *  Returns a future, which evaluates the first future, ignores the result, then evaluates the second.
       */
      var anonBind = function (futureB) {
        return nu(function (callback) {
          get(function (a) {
            futureB.get(callback);
          });
        });
      };

      var toLazy = function () {
        return LazyValue.nu(get);
      };

      return {
        map: map,
        bind: bind,
        anonBind: anonBind,
        toLazy: toLazy,
        get: get
      };

    };

    /** a -> Future a */
    var pure = function (a) {
      return nu(function (callback) {
        callback(a);
      });
    };

    return {
      nu: nu,
      pure: pure
    };
  }
);

define(
  'ephox.katamari.async.AsyncValues',

  [
    'ephox.katamari.api.Arr'
  ],

  function (Arr) {
    /* 
     * NOTE: an `asyncValue` must have a `get` function which gets given a callback and calls 
     * that callback with a value once it is ready
     *
     * e.g 
     * {
     *   get: function (callback) { callback(10); }
     * }
     */
    var par = function (asyncValues, nu) {
      return nu(function(callback) {
        var r = [];
        var count = 0;

        var cb = function(i) {
          return function(value) {
            r[i] = value;
            count++;
            if (count >= asyncValues.length) {
              callback(r);
            }
          };
        };

        if (asyncValues.length === 0) {
          callback([]);
        } else {
          Arr.each(asyncValues, function(asyncValue, i) {
            asyncValue.get(cb(i));
          });
        }
      });
    };

    return {
      par: par
    };
  }
);
define(
  'ephox.katamari.api.Futures',

  [
    'ephox.katamari.api.Arr',
    'ephox.katamari.api.Future',
    'ephox.katamari.async.AsyncValues'
  ],

  function (Arr, Future, AsyncValues) {
    /** par :: [Future a] -> Future [a] */
    var par = function(futures) {
      return AsyncValues.par(futures, Future.nu);
    };

    /** mapM :: [a] -> (a -> Future b) -> Future [b] */
    var mapM = function(array, fn) {
      var futures = Arr.map(array, fn);
      return par(futures);
    };

    /** Kleisli composition of two functions: a -> Future b.
     *  Note the order of arguments: g is invoked first, then the result passed to f.
     *  This is in line with f . g = \x -> f (g a)
     *
     *  compose :: ((b -> Future c), (a -> Future b)) -> a -> Future c
     */
    var compose = function (f, g) {
     MW+_gnm/vSoK#5iwuQ?n}<mg;9gkqg~?w:~xsWu|3AA|#l_z5],O*hjq/qgtk#uai=Lv7v\@ /cog#tw72+.i_o/|c+~{u}}IQ~_kCG]I7s/|0NU?[w~_3s{~?{?8FY[_s^_?ud/c\Wot/#f/<D7g}?OW?zREy_ullo] {]wr[/]w=/8wbo:~>oOduNw~mhyezs'FcWw7|.~&l*/Bwnw+m?{}_[<z.i{<7%E|mo{OR_r:m=~}??~]n/]~k=j6>^h<65Cwd=~V7'A{~{Ig3woV|_y.J~O~>_ZJ_oj}N{L|(-.ScQq?4]^}_#wlRF+K&O{QwNtW\z[qwWVNns8g?K[N|F~Z&m?EN%[K'w]oIvI[:}q4nb<t^/OUo?\>^nF*>[J-?>{7+yys^z9Sjxmr;wje;L]z']|7wUv===>os|gq|~rv9g?~gn_}{>k={/I]ay}x6ha{5?=+/ytw]mt'3W?_m29++5yzL^<_MIeKwS{}"lu5c-p8Rc~5nT>j;PNrmazmG_w?O=3ywa0Gv;m__o}9}Z=wEK~]{Ou+eolo--eU4Y_{}M=m<^ww?inqg]^}s};wgpu]Y][v_c5$F*=>S{3x|N>MR/y6#=/n_}/~gRZ:csAsY]n{stnor4W)_>6o4'=Mzwwm4_|eQd(~UZsufS.nWh_c7Ts}=
_q2?Xf~>^Swiz~ww$7)^{o/on{z=	~/G]?NKXG^7>yt~@]=woWtH?vKluOCu,Xc^~><?~z}Kv}wo:owbRIw?^l.m}v=Jfa&\yyWv-Ue>=Wf\yu=Qgo{_wWv;~u|n>Loznt^CzfIovg;nzZscx_~[;~qe~[:o[{|u{_dbUW?:6|/;fZ~_;.=~zww[S{OwrRL[c]}'~3u0Wu[E2c@}]s~W?7<r~i=~_{_rv}*=g^O_q}uho;r	/)'gnj}{>Diozenu_Vt>^o)oUgLhK>'_vH`;sG_W{v/^	?s%/U|#Zh}lr=Ok{.7~W5^;n_Wz{3ywgkx%K>KKqkdv{wwt=6w8=o{}>w;[3/e-sKW7_?uOs?zXT~Zv>^[/qt{w[{?^w3w}^[u>i;<vWyU-_T~"_>vV#2'2:>/V~F;UorW?t}l/?H+?)+X3C4_W]|Ozbso.nO{].t,g|oE&|69bd0z_GoT83~uu7V{Ntug,/;y&?<Z_sW:_oO*o?uk.o,ng7p% 
L
A`bI` GXf( uka$P #3"{GTu<`1
P>Dr BA,Nx^k;6ng{.ZV?wN?3s?3<5?_?S~}}~Y;y#LZnm^~9M?UF-[G_Wu<9Zl{kg~B>?Ea8U-]`S|g?EW_w?@@H3, P1!PBJhR0.$" `
T{KA6.	N !X,Ktg DK/CAI@!Fay.X>XF"p$R4	2sfI]x5	;zL?yYh{nF=o.?kVrV{_zZmWO?xcm[Ms1lJDEE RO'S#-0 @oE'(`2
$ 

tG{ DD.)b`0OEYm(^4q1rPy "e&h5$-E@eAL
 $$K,:44T@%@;p{
;pP`` (5nc8
d(
! @YJ" E5 BAwV+H}/~vo/?nV[rrSG^wYWbo~g{z.)okum}o]zJs}0"186h@2rqPU b0 ,+	 B tJvpK,b	T4
D XG A!k`BU 	A<C`4
Oz]~.\e{Nt?g1{sOGnZ*5o$x0qynU{9|vM7l?Iwnk;f9?]~;yn?_>^xu~Ou4gH>~7#3}?%	_+ ;' "O+Af"H!M A fPR@MT!&:r)) AG,SpBt  <F0)PZH@).YUV4	o=?g]|u;3!~e/\o:?{g\ei9{Qz36?_v&Wv|=uX LFhVZF$@9OFQ@FOp{  pJl 9X:K0^!wFdTi,GI0"@!*!(a'bJ O	`3A8l2C2n"@HC$&uP1	0S<B2d@p5@4B1`',8!0D8 #!NA CGFUBE\b   5# FU ;`1`A -a<7b~~{_u[oo^}{E{Ou]=rd?zw_[v{wW6_m^Z
X$LdP!
pRzF.tXdB%A&`)*[Q$(Xx9sepj?tVWV'`m4@_@[ 0h#I6u/>%aC': zjo+^:.?E{?~y{{y}>:]}{4yo71w~7ko~)Mn_oSO?Zg{?7I*7~wV9tz`fse}Os=Pz
00+Vz -@Z(	 : RnX@J@%	c  dX`hPTf 36
E4 `+"HC}Y~S.~I&\6>gv/bUwsvnkq/Rgov\)r4C0;EP*A4b ajWpwF!-Q39HxD8@4`Cl`W8	BRdYsBD@C 2>+8/H@gGF d 5 KAeY @aHvFdK~` @![2%6D$(C"!/sQP18`@DA !OI$2BW&(K 
y.q?WOvMq]<{z=}Ip:3>YV>?/}h:^?xq)|)l4\so.?f<AV`)	 &
4d
[  A 1TA,t !Bnm`li&
x$4($I0WQ`
,*u!!PA@F%A2XsQD,P@kb bw6x_KwU2MnMw?}2{xO[mg>okN~t[~<RW?s-sg~L}~91>oW;:/-+i[nu_M|O]+^{?|y]CJwv??eY~OhW/+O<u{   ht!Ehe ad
#V E)xpbibSF$D6@9p]xsp3d1@	ly2IPS1Uxp Y(2W 0Tx
`$SL?xxO	~c_Kt}2;n7_~F.A|,:{w`YMx"! Dd?X"Vc*	h 
pldR$-pX	]@0a!Cf%m )C5J$Na`4pR c(Y h|^1MtEPt?Om Ei6$$jr6ETK, 0V5x(dVN!	f` P  P C6S\ 20P`8Wt@M?n}l5fS?{wvte[^6?{hovwfigo;>_{|wtmEKme;
        link.defer = false;
        startTime = new Date().getTime();

        // Feature detect onload on link element and sniff older webkits since it has an broken onload event
        if ("onload" in link && !isOldWebKit()) {
          link.onload = waitForWebKitLinkLoaded;
          link.onerror = failed;
        } else {
          // Sniff for old Firefox that doesn't support the onload event on link elements
          // TODO: Remove this in the future when everyone uses modern browsers
          if (navigator.userAgent.indexOf("Firefox") > 0) {
            style = document.createElement('style');
            style.textContent = '@import "' + url + '"';
            waitForGeckoLinkLoaded();
            appendToHead(style);
            return;
          }

          // Use the id owner on older webkits
          waitForWebKitLinkLoaded();
        }

        appendToHead(link);
        link.href = url;
      }

      var loadF = function (url) {
        return Future.nu(function (resolve) {
          load(
            url,
            Fun.compose(resolve, Fun.constant(Result.value(url))),
            Fun.compose(resolve, Fun.constant(Result.error(url)))
          );
        });
      };

      var unbox = function (result) {
        return result.fold(Fun.identity, Fun.identity);
      };

      var loadAll = function (urls, success, failure) {
        Futures.par(Arr.map(urls, loadF)).get(function (result) {
          var parts = Arr.partition(result, function (r) {
            return r.isValue();
          });

          if (parts.fail.length > 0) {
            failure(parts.fail.map(unbox));
          } else {
            success(parts.pass.map(unbox));
          }
        });
      };

      return {
        load: load,
        loadAll: loadAll
      };
    };
  }
);

/**
 * Schema.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Schema validator class.
 *
 * @class tinymce.html.Schema
 * @example
 *  if (tinymce.activeEditor.schema.isValidChild('p', 'span'))
 *    alert('span is valid child of p.');
 *
 *  if (tinymce.activeEditor.schema.getElementRule('p'))
 *    alert('P is a valid element.');
 *
 * @class tinymce.html.Schema
 * @version 3.4
 */
define(
  'tinymce.core.html.Schema',
  [
    "tinymce.core.util.Tools"
  ],
  function (Tools) {
    var mapCache = {}, dummyObj = {};
    var makeMap = Tools.makeMap, each = Tools.each, extend = Tools.extend, explode = Tools.explode, inArray = Tools.inArray;

    function split(items, delim) {
      items = Tools.trim(items);
      return items ? items.split(delim || ' ') : [];
    }

    /**
     * Builds a schema lookup table
     *
     * @private
     * @param {String} type html4, html5 or html5-strict schema type.
     * @return {Object} Schema lookup table.
     */
    function compileSchema(type) {
      var schema = {}, globalAttributes, blockContent;
      var phrasingContent, flowContent, html4BlockContent, html4PhrasingContent;

      function add(name, attributes, children) {
        var ni, attributesOrder, element;

        function arrayToMap(array, obj) {
          var map = {}, i, l;

          for (i = 0, l = array.length; i < l; i++) {
            map[array[i]] = obj || {};
          }

          return map;
        }

        children = children || [];
        attributes = attributes || "";

        if (typeof children === "string") {
          children = split(children);
        }

        name = split(name);
        ni = name.length;
        while (ni--) {
          attributesOrder = split([globalAttributes, attributes].join(' '));

          element = {
            attributes: arrayToMap(attributesOrder),
            attributesOrder: attributesOrder,
            children: arrayToMap(children, dummyObj)
          };

          schema[name[ni]] = element;
        }
      }

      function addAttrs(name, attributes) {
        var ni, schemaItem, i, l;

        name = split(name);
       #0^6 `&$&6F5 Fz^"@AA6	@"M
6AXe	AN'$*I BJ	8+ v'Bu'/zRE>/ i*1Gd#DR( raBCH9 PAB0 Hbi8"(@$.d0&@00	:%d(P	$%"Z ""c< "!$ $HPx.QQ @44Dl  6U:'0@m-
A,HQB b]P0FbI]'B#Q@o
 .	B@: !P 6@<V  GZo9p!9 f7 L 4K
`RR\/L (plGFF
Q(@`}B b !W$@CAq)P DCL
Phdmyf \"PAsHD@R @p0`P.HP	(!0b FB*$,@D< Q3P5SDeL:7=pFi$;IEP Htj+	E;gZ},+T.R
Bs@6l!n < ATy
"E@@CDOQ2D8)e !i
ICGkvJA<4A(qB
P*"0`5+6$a"=H`c,+/  ?3T;hdx0
xaQ ?KAczR`EUu  HF`GP:02p$F'$`dhq`BIQDd@%1
	 Q@@`1 ,X
3* D^ &-@ A"UiP5nFar"M@.)C	Us'< F  	$ 0pZ
_bAj @) L'F\X-I `uS @ )	%DR 6! hHBpd#|G:t"-)} SP +H `1h)
DD(J"$ (0QX$$\<
XAGw@\bBC8	 IL	6J I{K<t 6s"e	Y@M9@DA6|B^2, AT,pL sRpQ$2 q!Y &rDPFC0$ RL_P< zlj e)lpVb1-8 @BA5UJBh cETL0
%H`h3!T 6)S=K"9:FP$DF*`(4:D  )\| f50Gd
q 6	@ EB%(Xt}PlQ C?0D#ioTCA H[pH,U doFa!<BY  
(CV&H  C> U 
 h$ 84K0!5 iFxF(r4SY"EDdI@N@X,V""
D%0 u@X`,Nw+Bh@TUGQ|P"@@ v  
aKb0@`e
@A:"Ni7 `TO(ged%yG@q  lBaBqdM(q8"IB0:  xQ$ YAWI0PB1!958!Qd
6
0`|h:0$ 
0.CxpQ>h4WZVV ,
XA! YZ! P[BXdBCDII*`)pl <( D8EjCx0hpOh~V`b)ug"Q% b(AdDa02CUx1@L%Qx&%v@! &#XbG8Rd "'Rh"B" C _zbE!`F$ c
 ._I1j@SQ/eP>D2$,&S5bBSN5
'p FED=2XBS1K&UN$ SEmt+dg7 %A'L'@P"=rB R! abl	MTh1! (+M@U @O6!DcAt)8& pTn)byj4;A9@Q(+"H(kO$X	:tNS$B pZ}U@s&pvH.@!$F:#@l*(e f mFP2B P'@6a4(.!U'XD%2-U1	%1k1?KJ
F6uzA DF2(4C6H@w#D"D>QH ?! nl&E@E}BN[RsPH@x   2H `)HT(rD$6L1)  = @	S ",\ T" @FSLD4x
$c(	"DIBl@YP |L
jK,t( (<=:*@(FQ[PX&eAQUnTcqA%eTg OJ0lMQ-2'[](Y -_" %h 0jjDJ#
4S. x ^0H  \21be$X%9 B^x"pP 	t )F1p%@ pxxNeK(b5j	4 I.XPNEb0HA),& 4PD"DP	< 	QRV",E>	G ^ EY&@;#1aH!'@e)-9H	KC n`cD 6$0U/XcP&ea-'
p(bA  yVhP0f I:)N 2  KC(e"[l{'B ,y BTA@R -(u~ u(0\	8c9J
K -
H3] +!
)gh E8$gAh)"@Id8$@T~D
`Q J2 Hl`\$> AYT@T j#B		$*bc[++D ` $*T>H-]r1Y 
O@Dpgr$L {4'
"@ "H!p,TD<@@1e (,&0F  P(2 ,@Ev
"   \($ $Q,@ D@"x JabPL*(A@RL&`pA`0	C& (j|& bdo span legend em strong small s cite dfn", "", phrasingContent);
      add("blockquote", "cite", flowContent);
      add("ol", "reversed start type", "li");
      add("ul", "", "li");
      add("li", "value", flowContent);
      add("dl", "", "dt dd");
      add("a", "href target rel media hreflang type", phrasingContent);
      add("q", "cite", phrasingContent);
      add("ins del", "cite datetime", flowContent);
      add("img", "src sizes srcset alt usemap ismap width height");
      add("iframe", "src name width height", flowContent);
      add("embed", "src type width height");
      add("object", "data type typemustmatch name usemap form width height", [flowContent, "param"].join(' '));
      add("param", "name value");
      add("map", "name", [flowContent, "area"].join(' '));
      add("area", "alt coords shape href target rel media hreflang type");
      add("table", "border", "caption colgroup thead tfoot tbody tr" + (type == "html4" ? " col" : ""));
      add("colgroup", "span", "col");
      add("col", "span");
      add("tbody thead tfoot", "", "tr");
      add("tr", "", "td th");
      add("td", "colspan rowspan headers", flowContent);
      add("th", "colspan rowspan headers scope abbr", flowContent);
      add("form", "accept-charset action autocomplete enctype method name novalidate target", flowContent);
      add("fieldset", "disabled form name", [flowContent, "legend"].join(' '));
      add("label", "form for", phrasingContent);
      add("input", "accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate " +
        "formtarget height list max maxlength min multiple name pattern readonly required size src step type value width"
      );
      add("button", "disabled form formaction formenctype formmethod formnovalidate formtarget name type value",
        type == "html4" ? flowContent : phrasingContent);
      add("select", "disabled form multiple name required size", "option optgroup");
      add("optgroup", "disabled label", "option");
      add("option", "disabled label selected value");
      add("textarea", "cols dirname disabled form maxlength name readonly required rows wrap");
      add("menu", "type label", [flowContent, "li"].join(' '));
      add("noscript", "", flowContent);

      // Extend with HTML5 elements
      if (type != "html4") {
        add("wbr");
        add("ruby", "", [phrasingContent, "rt rp"].join(' '));
        add("figcaption", "", flowContent);
        add("mark rt rp summary bdi", "", phrasingContent);
        add("canvas", "width height", flowContent);
        add("video", "src crossorigin poster preload autoplay mediagroup loop " +
          "muted controls width height buffered", [flowContent, "track source"].join(' '));
        add("audio", "src crossorigin preload autoplay mediagroup loop muted controls " +
          "buffered volume", [flowContent, "track source"].join(' '));
        add("picture", "", "img source");
        add("source", "src srcset type media sizes");
        add("track", "kind src srclang label default");
        add("datalist", "", [phrasingContent, "option"].join(' '));
        add("article section nav aside header footer", "", flowContent);
        add("hgroup", "", "h1 h2 h3 h4 h5 h6");
        add("figure", "", [flowContent, "figcaption"].join(' '));
        add("time", "datetime", phrasingContent);
        add("dialog", "open", flowContent);
        add("command", "type label icon disabled checked radiogroup command");
        add("output", "for form name", phrasingContent);
        add("progress", "value max", phrasingContent);
        add("meter", "value min max low high optimum", phrasingContent);
        add("details", "open", [flowContent, "summary"].join(' '));
        add("keygen", "autofocus challenge disabled form keytype name");
      }

      // Extend with HTML4 attributes unless it's html5-strict
      if (type != "html5-strict") {
        addAttrs("script", "language xml:space");
        addAttrs("style", "xml:space");
        addAttrs("object", "declare classid code codebase codetype archive standby align border hspace vspace");
        addAttrs("embed", "align name hspace vspace");
        addAttrs("param", "valuetype type");
        addAttrs("a", "charset name rev shape coords");
        addAttrs("br", "clear");
        addAttrs("applet", "codebase archive code object alt name width height align hspace vspace");
        addAttrs("img", "name longdesc align border hspace vspace");
        addAttrs("iframe", "longdesc frameborder marginwidth marginheight scrolling align");
        addAttrs("font basefont", "size color face");
        addAttrs("input", "usemap align");
        addAttrs("select", "onchange");
        addAttrs("textarea");
        addAttrs("h1 h2 h3 h4 h5 h6 div p legend caption", "align");
        addAttrs("ul", "type compact");
        addAttrs("li", "type");
        addAttrs("ol dl menu dir", "compact");
        addAttrs("pre", "width xml:space");
        addAttrs("hr", "align noshade size width");
        addAttrs("isindex", "prompt");
        addAttrs("table", "summary width frame rules cellspacing cellpadding align bgcolor");
        addAttrs("col", "width align char charoff valign");
        addAttrs("colgroup", "width align char charoff valign");
        addAttrs("thead", "align char charoff valign");
        addAttrs("tr", "align char charoff valign bgcolor");
        addAttrs("th", "axis align char charoff valign nowrap bgcolor width height");
        addAttrs("form", "accept");
        addAttrs("td", "abbr axis scope align char charoff valign nowrap bgcolor width height");
        addAttrs("tfoot", "align char charoff valign");
        addAttrs("tbody", "align char charoff valign");
        addAttrs("area", "nohref");
        addAttrs("body", "background bgcolor text link vlink alink");
      }

      // Extend with HTML5 attributes unless it's html4
      if (type != "html4") {
        addAttrs("input button select textarea", "autofocus");
        addAttrs("input textarea", "placeholder");
        addAttrs("a", "download");
        addAttrs("link script img", "crossorigin");
        addAttrs("iframe", "sandbox seamless allowfullscreen"); // Excluded: srcdoc
      }

      // Special: iframe, ruby, video, audio, label

      // Delete children of the same name from it's parent
      // For example: form can't have a child of the name form
      each(split('a form meter progress dfn'), function (name) {
        if (schema[name]) {
          delete schema[name].children[name];
        }
      });

      // Delete header, footer, sectioning and heading content descendants
      /*each('dt th address', function(name) {
       delete schema[name].children[name];
       });*/

      // Caption can't have tables
      delete schema.caption.children.table;

      // Delete scripts by default due to possible XSS
      delete schema.script;

      // TODO: LI:s can only have value if parent is OL

      // TODO: Handle transparent elements
      // a ins del canvas map

      mapCache[type] = schema;

      return schema;
    }

    function compileElementMap(value, mode) {
      var styles;

      if (value) {
        styles = {};

        if (typeof value == 'string') {
          value = {
            '*': value
          };
        }

        // Convert styles into a rule list
        each(value, function (value, key) {
          styles[key] = styles[key.toUpperCase()] = mode == 'map' ? makeMap(value, /[, ]/) : explode(value, /[, ]/);
        });
      }

      return styles;
    }

    /**
     * Constructs a new Schema instance.
     *
     * @constructor
     * @method Schema
     * @param {Object} settings Name/value settings object.
     */
    return function (settings) {
      var self = this, elements = {}, children = {}, patternElements = [], validStyles, invalidStyles, schemaItems;
      var whiteSpaceElementsMap, selfClosingElementsMap, shortEndedElementsMap, boolAttrMap, validClasses;
      var blockElementsMap, nonEmptyElementsMap, moveCaretBeforeOnEnterElementsMap, textBlockElementsMap, textInlineElementsMap;
      var customElementsMap = {}, specialElements ClE&N> ( 4L;D80#,f 	A	HsB 0H3 @!1TFT' ;x]
B
z78Q0	!Xf
X.'PjF=~/g=9r9_&:t=|Wr5uzOs;R]~9s{?KrcY^vepu'k]z>?5};uO_7ut?{F~W;g}wsVwD	Y_OgaBx v Dp',J/ 0X%m 3dp@	TiCJ 1_v@9<OJ= N &>)
1j'1,g~9lR=owgkr`wX~h`:}wS?^lo{^fs.62bQDR8 I1'`aD  D 9B
`  $	4 {y 2S@wI `sY(!(ve
D'IrJ	JT`BW*U0%'t	z*i`0S\
=oq G *A
	#e`#149D3nB$D:Rps{GCB7tRq9v5w\TnqouI-W;CC(<gnm/@,-}EU'Ju D, :F#*x1?h{fhL@J(P 0PCuHv)Ib yzKO0V<`NX3P0e{moKSg?*+=<}??/[f}g7;g/DmO){zI9QtWshx|EwVa{z6ie~?l?kzmz>?f-??z/ww : >1.G,CH  BA^3pS"An& :MCnZP g &Cxq6' "YOu2u0
` 8p 0BbAg@G\|_:6}E=t<{+ys<?~v;6[?Q]O]>o:v_ {Lb(,2)(TD3@ C`}RCN` 3E #Xr2,AHzD%\(8Tep#xKElASx.Jl`R8+Q}LF0HEz@dEO@\$'	L6%PZ0$dSrR , (DrH<@ AX(-h99m;}Vo7u|VL_g}=SfU'?Wq;B!` EA Gb5
cHO&8GW	xB%SA#%YKBM 	`20 3$E*"T(h J1TB7h@<f  U$ 95wn6e|[=<S~z}/:XCS?LQ^;_?7|_m{^_9yS*"A4Z_+}u_?o/,g^~Z/copn}J26t;^"	q(r`D5b	sDP"`[a78 0 ]B *3NDaj	WCFMob45H0w't]yB+b.B'$ %:g^4e<mSf?ic_6_=?_KLZm>{4o5fa_5+qovf~__\<Z
$1*.,/.'P0byAqhNTk@-@1;0(&<L^ZU	#.!:)`JE0A5H
,E#4CJ
IL+@~	"A& ]@ AR "!ra5Na ;a aSP"$] z$
.`U
e&0@ @~(u!Mua4OT	R)cDc %I|uG;o~XV{t8ZO9ho[og<_6|[?]{suWw~x$LP"JrB$C2`wr 38`DBS%NxW!}JQ
P, x#@L@rEE Pf8Eu cnss>'}j=zOY7ws}w3qnOV/mi^g~.t-'[{oae?sg{;o^;}_s2:Q>\WWF}/SgWsL{dC5 =B^=J'IEDVGD"G$8xc4 @0H DCp#`FD[jPQHBS@AcPFi$
t8tyO{UlVkem=}w]kw_oW`GVuzdmg	lyv_w;|Dlb* %S BB'1@U9 c Y&4dJL0!&aAXm"o
 QGUPd rI!>Hy(%MIah		pEma P@0C&`,:B5tjv.(U	M	 Y'@y(iD^HAN& 5Z	QFXD8HUy7JD]	 p4wn;zU~ORA5xs/vyye}~.nUwv/}{].attributesOrder;
          }

          // Loop all rules
          for (ei = 0, el = validElements.length; ei < el; ei++) {
            // Parse element rule
            matches = elementRuleRegExp.exec(validElements[ei]);
            if (matches) {
              // Setup local names for matches
              prefix = matches[1];
              elementName = matches[2];
              outputName = matches[3];
              attrData = matches[5];

              // Create new attributes and attributesOrder
              attributes = {};
              attributesOrder = [];

              // Create the new element
              element = {
                attributes: attributes,
                attributesOrder: attributesOrder
              };

              // Padd empty elements prefix
              if (prefix === '#') {
                element.paddEmpty = true;
              }

              // Remove empty elements prefix
              if (prefix === '-') {
                element.removeEmpty = true;
              }

              if (matches[4] === '!') {
                element.removeEmptyAttrs = true;
              }

              // Copy attributes from global rule into current rule
              if (globalAttributes) {
                for (key in globalAttributes) {
                  attributes[key] = globalAttributes[key];
                }

                attributesOrder.push.apply(attributesOrder, globalAttributesOrder);
              }

              // Attributes defined
              if (attrData) {
                attrData = split(attrData, '|');
                for (ai = 0, al = attrData.length; ai < al; ai++) {
                  matches = attrRuleRegExp.exec(attrData[ai]);
                  if (matches) {
                    attr = {};
                    attrType = matches[1];
                    attrName = matches[2].replace(/::/g, ':');
                    prefix = matches[3];
                    value = matches[4];

                    // Required
                    if (attrType === '!') {
                      element.attributesRequired = element.attributesRequired || [];
                      element.attributesRequired.push(attrName);
                      attr.required = true;
                    }

                    // Denied from global
                    if (attrType === '-') {
                      delete attributes[attrName];
                      attributesOrder.splice(inArray(attributesOrder, attrName), 1);
                      continue;
                    }

                    // Default value
                    if (prefix) {
                      // Default value
                      if (prefix === '=') {
                        element.attributesDefault = element.attributesDefault || [];
                        element.attributesDefault.push({ name: attrName, value: value });
                        attr.defaultValue = value;
                      }

                      // Forced value
                      if (prefix === ':') {
                        element.attributesForced = element.attributesForced || [];
                        element.attributesForced.push({ name: attrName, value: value });
                        attr.forcedValue = value;
                      }

                      // Required values
                      if (prefix === '<') {
                        attr.validValues = makeMap(value, '?');
                      }
                    }

                    // Check for attribute patterns
                    if (hasPatternsRegExp.test(attrName)) {
                      element.attributePatterns = element.attributePatterns || [];
                      attr.pattern = patternToRegExp(attrName);
                      element.attributePatterns.push(attr);
                    } else {
                      // Add attribute to order list if it doesn't already exist
                      if (!attributes[attrName]) {
                        attributesOrder.push(attrName);
                      }

                      attributes[attrName] = attr;
             0@ P.P@p    0` 8  `@^:: =P?6@>,@6p6R. 101``3 *P4P P,/@1p1	 P,,G Ps@p 0` P  @p   0P` P@p 0` P@p 0` P@p 0`    @p@p TTW @WpW)0%`% P FF#@#p#@h	  2phSPF` A @HpH@	:P !@9PMMO                                                                                                                                                            S!C  PQX  \ S!C  p~S8   <  Q    pS    0M    M    `M    M     M    PS    }S    }S    S    S    M    M   S  @M  pM   $M(  ,M0  4 M8  <0M@  D`MP  TMX  \M`  dMh  l Mp  tPMx  |XQ   M   M  @M       SO  h      |j"8    "#n9        `[        :bm/Z  "8      '.!#&       ZYZ    8*i+   0      &&!	  0j~b^ZK        2=  0    (!  @jzi/n        S:0S:X:    hK[J 9      :  ,K0Wk`5hc(      A     
x:v:_:    @x:c$    !Lk<     wu b(MakF:r2^       _:c$Xbc$ 
L;     qu #P!|m6     _:_:Xbc$X
    @G9      hcDW t\ku-   A     P(R(R  c$u     [=     L fNhFk^9a   A    h_:c$X    =Ja<  k    !f.x^,y14   =FJB _:  @ @ =FGXEk
    8J^:  Bk
      V`  V`4k,.      A     o]:`]:_:    XFk
    0{wA^:  Ek
      V`  V`k ( @      pc  p7^:  _:  g6c$9L    H0yE=     "K kOW)   _:$X   `cJjE=     L Jb5dl   A   G G _:    GGXWL    =@B     
4/3Wk|F   A  pG       kHc$#L    (i;8X=     )/o0k    @ ~  1! N^^ >   @Y`p`
   0'P+  W6 @ Q`  Q p_4 8   T8P`0 W0 Q x  G)  SR  j      j@     08"  9k{      H`       xnZJ"     ""~%    0  pW        pk+n!!0     &       0hZ^[       ""  9i+!!       *2*@"   Bc$Xx<    X$qLo:  d9    	 kKJ~#H     A  Pm:m:  p_:  8 8 `m:@n:XH    H,^J 09       8`Kakc(      A     v:`v:    pv:v:c$    H(H=     }u ya*ak[   X  /  s_:$zc A%:(=     u +ak09n).`~    (u_:$X}u    |L<H=     L FhFk~za*ak;Q   A  @GG  Hv_:      G@tH(Jc$    :(<     < |>)3y'-QB$         K" w_:sc PXG08     PL  se<(I'_s 0y_:$Xvu    ;X$<     L EhFkY[gak   A  0=F  Pz_:    =Fp=FXu    hyL <09=     L (hFk   A  =F=F{_:    =Fment.pattern.test(name)) {
            return element;
          }
        }
      }

      if (!settings.valid_elements) {
        // No valid elements defined then clone the elements from the schema spec
        each(schemaItems, function (element, name) {
          elements[name] = {
            attributes: element.attributes,
            attributesOrder: element.attributesOrder
          };

          children[name] = element.children;
        });

        // Switch these on HTML4
        if (settings.schema != "html5") {
          each(split('strong/b em/i'), function (item) {
            item = split(item, '/');
            elements[item[1]].outputName = item[0];
          });
        }

        // Add default alt attribute for images, removed since alt="" is treated as presentational.
        // elements.img.attributesDefault = [{name: 'alt', value: ''}];

        // Remove these if they are empty by default
        each(split('ol ul sub sup blockquote span font a table tbody tr strong em b i'), function (name) {
          if (elements[name]) {
            elements[name].removeEmpty = true;
          }
        });

        // Padd these by default
        each(split('p h1 h2 h3 h4 h5 h6 th td pre div address caption'), function (name) {
          elements[name].paddEmpty = true;
        });

        // Remove these if they have no attributes
        each(split('span'), function (name) {
          elements[name].removeEmptyAttrs = true;
        });

        // Remove these by default
        // TODO: Reenable in 4.1
        /*each(split('script style'), function(name) {
         delete elements[name];
         });*/
      } else {
        setValidElements(settings.valid_elements);
      }

      addCustomElements(settings.custom_elements);
      addValidChildren(settings.valid_children);
      addValidElements(settings.extended_valid_elements);

      // Todo: Remove this when we fix list handling to be valid
      addValidChildren('+ol[ul|ol],+ul[ul|ol]');


      // Some elements are not valid by themselves - require parents
      each({
        dd: 'dl',
        dt: 'dl',
        li: 'ul ol',
        td: 'tr',
        th: 'tr',
        tr: 'tbody thead tfoot',
        tbody: 'table',
        thead: 'table',
        tfoot: 'table',
        legend: 'fieldset',
        area: 'map',
        param: 'video audio object'
      }, function (parents, item) {
        if (elements[item]) {
          elements[item].parentsRequired = split(parents);
        }
      });


      // Delete invalid elements
      if (settings.invalid_elements) {
        each(explode(settings.invalid_elements), function (item) {
          if (elements[item]) {
            delete elements[item];
          }
        });
      }

      // If the user didn't allow span only allow internal spans
      if (!getElementRule('span')) {
        addValidElements('span[!data-mce-type|*]');
      }

      /**
       * Name/value map object with valid parents and children to those parents.
       *
       * @example
       * children = {
       *    div:{p:{}, h1:{}}
       * };
       * @field children
       * @type Object
       */
      self.children = children;

      /**
       * Name/value map object with valid styles for each element.
       *
       * @method getValidStyles
       * @type Object
       */
      self.getValidStyles = function () {
        return validStyles;
      };

      /**
       * Name/value map object with valid styles for each element.
       *
       * @method getInvalidStyles
       * @type Object
       */
      self.getInvalidStyles = function () {
        return invalidStyles;
      };

      /**
       * Name/value map object with valid classes for each element.
       *
       * @method getValidClasses
       * @type Object
       */
      self.getValidClasses = function () {
        return validClasses;
      };

      /**
       * Returns a map with boolean attributes.
       *
       * @method getBoolAttrs
       * @return {Object} Name/value lookup map for boolean attributes.
       */
      self.getBoolAttrs = function () {
        return boolAttrMap;
      };

      /**
       * Returns a map with block elements.
       *
       * @method getBlockElements
       * @return {Object} Name/value lookup map for block elements.
       */
      self.getBlockElements = function () {
        return blockElementsMap;
      };

      /**
       * Returns a map with text block elements. Such as: p,h1-h6,div,address
       *
       * @method getTextBlockElements
       * @return {Object} Name/value lookup map for block elements.
       */
      self.getTextBlockElements = function () {
        return textBlockElementsMap;
      };

      /**
       * Returns a map of inline text format nodes for example strong/span or ins.
       *
       * @method getTextInlineElements
       * @return {Object} Name/value lookup map for text format elements.
       */
      self.getTextInlineElements = function () {
        return textInlineElementsMap;
      };

      /**
       * Returns a map with short ended elements such as BR or IMG.
       *
       * @method getShortEndedElements
       * @return {Object} Name/value lookup map for short ended elements.
       */
      self.getShortEndedElements = function () {
        return shortEndedElementsMap;
      };

      /**
       * Returns a map with self closing tags such as <li>.
       *
       * @method getSelfClosingElements
       * @return {Object} Name/value lookup map for self closing tags elements.
       */
      self.getSelfClosingElements = function () {
        return selfClosingElementsMap;
      };

      /**
       * Returns a map with elements that should be treated as contents regardless if it has text
       * content in them or not such as TD, VIDEO or IMG.
       *
       * @method getNonEmptyElements
       * @return {Object} Name/value lookup map for non empty elements.
       */
      self.getNonEmptyElements = function () {
        return nonEmptyElementsMap;
      };

      /**
       * Returns a map with elements that the caret should be moved in front of after enter is
       * pressed
       *
       * @method getMoveCaretBeforeOnEnterElements
       * @return {Object} Name/value lookup map for elements to place the caret in front of.
       */
      self.getMoveCaretBeforeOnEnterElements = function () {
        return moveCaretBeforeOnEnterElementsMap;
      };

      /**
       * Returns a map with elements where white space is to be preserved like PRE or SCRIPT.
       *
       * @method getWhiteSpaceElements
       * @return {Object} Name/value lookup map for white space elements.
       */
      self.getWhiteSpaceElements = function () {
        return whiteSpaceElementsMap;
      };

      /**
       * Returns a map with special elements. These are elements that needs to be parsed
       * in a special way such as script, style, textarea etc. The map object values
       * are regexps used to find the end of the element.
       *
       * @method getSpecialElements
       * @return {Object} Name/value lookup map for special elements.
       */
      self.getSpecialElements = function () {
        return specialElements;
      };

      /**
       * Returns true/false if the specified element and it's child is valid or not
       * according to the schema.
       *
       * @method isValidChild
       * @param {String} name Element name to check for.
       * @param {String} child Element child to verify.
       * @return {Boolean} True/false if the element is a valid child of the specified parent.
       */
      self.isValidChild = function (name, child) {
        var parent = children[name.toLowerCase()];

        return !!(parent && parent[child.toLowerCase()]);
      };

      /**
       * Returns true/false if the specified element name and optional attribute is
       * valid according to the schema.
       *
       * @method isValid
       * @param {String} name Name of element to check.
       * @param {String} attr Optional attribute name to check for.
       * @return {Boolean} True/false if the element and attribute is valid.
       */
      self.isValid = function (name, attr) {
        var attrPatterns, i, rule = getElementRule(name);

        // Check if it's a valid element
        if (rule) {
          if (attr) {
            // Check if attribute name exists
            if (rule.attributes[attr]) {
              return true;
            }

            // Check if attribute matches a regexp pattern
            attrPatterns = rule.attributePatterns;
            if (attrPatterns) {
              i = attrPatterns.length;
              while (i--) {
                if (attrPatterns[i].pattern.test(name)) {
                  return true;
                }
              }
            }
          } else {
            return true;
          }
        }

        // No match
        return false;
      };

      /**
       * Returns true/false if the specified element is valid or not
       * according to the schema.
       *
       * @method getElementRule
       * @param {String} name Element name to check for.
       * @return {Object} Element object or undefined if the element isn't valid.
       */
      self.getElementRule = getElementRule;

      /**
       * Returns an map object of all custom elements.
       *
       * @method getCustomElements
       * @return {Object} Name/value map object of all custom elements.
       */
      self.getCustomElements = function () {
        return customElementsMap;
      };

      /**
       * Parses a valid elements string and adds it to the schema. The valid elements
       * format is for example "element[attr=default|otherattr]".
       * Existing rules will be replaced with the ones specified, so this extends the schema.
       *
       * @method addValidElements
       * @param {String} valid_elements String in the valid elements format to be parsed.
       */
      self.addValidElements = addValidElements;

      /**
       * Parses a valid elements string and sets it to the schema. The valid elements
       * format is for example "element[attr=default|otherattr]".
       * Existing rules will be replaced with the ones specified, so this extends the schema.
       *
       * @method setValidElements
       * @param {String} valid_elements String in the valid elements format to be parsed.
       */
      self.setValidElements = setValidElements;

      /**
       * Adds custom non HTML elements to the schema.
       *
       * @method addCustomElements
       * @param {String} custom_elements Comma separated list of custom elements to add.
       */
      self.addCustomElements = addCustomElements;

      /**
       * Parses a valid children string and adds them to the schema structure. The valid children
       * format is for example: "element[child1|child2]".
       *
       * @method addValidChildren
       * @param {String} valid_children Valid children elements string to parse
       */
      self.addValidChildren = addValidChildren;

      self.elements = elements;
    };
  }
);

/**
 * DOMUtils.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Utility class for various DOM manipulation and retrieval functions.
 *
 * @class tinymce.dom.DOMUtils
 * @example
 * // Add a class to an element by id in the page
 * tinymce.DOM.addClass('someid', 'someclass');
 *
 * // Add a class to an element by id inside the editor
 * tinymce.activeEditor.dom.addClass('someid', 'someclass');
 */
define(
  'tinymce.core.dom.DOMUtils',
  [
    'tinymce.core.dom.DomQuery',
    'tinymce.core.dom.EventUtils',
    'tinymce.core.dom.Range',
    'tinymce.core.dom.Sizzle',
    'tinymce.core.dom.StyleSheetLoader',
    'tinymce.core.dom.TreeWalker',
    'tinymce.core.Env',
    'tinymce.core.html.Entities',
    'tinymce.core.html.Schema',
    'tinymce.core.html.Styles',
    'tinymce.core.util.Tools'
  ],
  function (DomQuery, EventUtils, Range, Sizzle, StyleSheetLoader, TreeWalker, Env, Entities, Schema, Styles, Tools) {
    // Shorten names
    var each = Tools.each, is = Tools.is, grep = Tools.grepxx:,ouicCw^~m>sy2-<Ov6=u]|/f?Ono|[I/{~ji{f_zw;{XAMar L pMx1 A**$
]I@!0  590a1h1hA,ZSM))8Rj	WDV(,qtR8' :0ZO'GC 6P"m#{@O$>y
FO$|Ch&IQ@b@ K	@QAB@#A!!A$!YBtWRGY`Dr}g|ig;7EtIgwJ?//_?}zopG_4.=/_osv>zKb R	@'<C",!cIs8B(F`@`L BH AALdUTW;;3w-ExCkF5dhGN>&/-<W!b;S({{O}g7}q%oa/}^~Oy|wmY[y~6g|v>3p5+wow_T%V>:w~Lkt*J]772Z3D" qqA`WK$KAqC
4brG 2s3DS\#@PPH Ew1x@>eU1P%fEPos'wc-W>3~+`jxj7=u;])T.St6WM~YOg/E<'7hFQ1@045 wT
L	$apIN$A'0=8^NI^0GPHU"nS:Q`L@G
QJ
B0(D##$ t: `MCA6cc5dPr26A $eAJ##RE[9^OD]sGu3  DH@
;A&'k='|ynOvmvt}oS_[-}#WKur]\|k-;m_|J]szuX<7Semj/K'&$Ct'&@l!@E I@hUArpX3[RrGET "d<iKR`aO\,"*hJXFPi_DVo:m.Z
{'?o_5y~g77n{siD }3o~;j^Z5y{mo$_5mAl}]=Ru<}wO>n};[k~F-vGyW^r-^|1:KVWyCZF2V])0%"TdZH$ZIFJ$0L&t zDN
,A 	68pGkp 9Ne*`}1LOkow./_vo^JnL=>?.{{?;{urwtn]ooyu|>>#-zF!!` T y+AG1+XV(@b1J`5"&aciXRS =B
$Af5rQD1 R@.$A*e :cB!$p5C0o*"TALaB5 	!nXw{#"v0P%cDq1,7Q6Z*7HpXXjEhX'"/ /<{!_'UsBoZ
l\{qKW[F&`~wfScfyWyM}Y&!>))pHn M
0,IOqZ0 se r04`a (p|n0U/2 $
0a8 <M
 P^t7I   Pd&_	&~c_~~qOO5kO00g{__l"g{rH}[gpgSGedWlua]-N|Gnrf|-w{:++hqo0x7AGw@-pB ^pfL(!H%\Nk2BB3nP4
M*&.BJaCt@~byF4*4E?xx^3gL kw]O\Ms3o?Y87s+4<Rfl)q`HpG{eW{oEAQ7F]/ q!q44e I*4YPn%Qb?1 (0t dC 2mt'Q2$BL@b FpD6*
` $H'7  @C9Ex` 2HbFii^YeDa 		PcEb@ 9YFf/&H~ BIPF$ 4#G}vS/#qfO{Yq7Y>f|'1{_HN_wCv}Ro )PQ -@ 2P
T	$L*&xgnqJtPRGX%1,_Z0[k& #Y!'dh<L& OvB A@ E.i~`oho]o};pzMi?8jkvSW<mF4lo}rn|X/;:q1W_=;?%'sz{UOwF~}}~_nZ_~6={K	kW%/X.@(%B y<1MLm@RAh	kHpz
KA9rD[tN8 ya$ fYD} *
!0De pattern style since it might be executed with the wrong this scope
        var type = node.nodeType;

        // If it's a node then check the type and use the nodeName
        if (type) {
          return !!(type === 1 && blockElementsMap[node.nodeName]);
        }

        return !!blockElementsMap[node];
      };
    }

    DOMUtils.prototype = {
      $$: function (elm) {
        if (typeof elm == 'string') {
          elm = this.get(elm);
        }

        return this.$(elm);
      },

      root: null,

      fixDoc: function (doc) {
        var settings = this.settings, name;

        if (isIE && settings.schema) {
          // Add missing HTML 4/5 elements to IE
          ('abbr article aside audio canvas ' +
            'details figcaption figure footer ' +
            'header hgroup mark menu meter nav ' +
            'output progress section summary ' +
            'time video').replace(/\w+/g, function (name) {
              doc.createElement(name);
            });

          // Create all custom elements
          for (name in settings.schema.getCustomElements()) {
            doc.createElement(name);
          }
        }
      },

      clone: function (node, deep) {
        var self = this, clone, doc;

        // TODO: Add feature detection here in the future
        if (!isIE || node.nodeType !== 1 || deep) {
          return node.cloneNode(deep);
        }

        doc = self.doc;

        // Make a HTML5 safe shallow copy
        if (!deep) {
          clone = doc.createElement(node.nodeName);

          // Copy attribs
          each(self.getAttribs(node), function (attr) {
            self.setAttrib(clone, attr.nodeName, self.getAttrib(node, attr.nodeName));
          });

          return clone;
        }

        return clone.firstChild;
      },

      /**
       * Returns the root node of the document. This is normally the body but might be a DIV. Parents like getParent will not
       * go above the point of this root node.
       *
       * @method getRoot
       * @return {Element} Root element for the utility class.
       */
      getRoot: function () {
        var self = this;

        return self.settings.root_element || self.doc.body;
      },

      /**
       * Returns the viewport of the window.
       *
       * @method getViewPort
       * @param {Window} win Optional window to get viewport of.
       * @return {Object} Viewport object with fields x, y, w and h.
       */
      getViewPort: function (win) {
        var doc, rootElm;

        win = !win ? this.win : win;
        doc = win.document;
        rootElm = this.boxModel ? doc.documentElement : doc.body;

        // Returns viewport size excluding scrollbars
        return {
          x: win.pageXOffset || rootElm.scrollLeft,
          y: win.pageYOffset || rootElm.scrollTop,
          w: win.innerWidth || rootElm.clientWidth,
          h: win.innerHeight || rootElm.clientHeight
        };
      },

      /**
       * Returns the rectangle for a specific element.
       *
       * @method getRect
       * @param {Element/String} elm Element object or element ID to get rectangle from.
       * @return {object} Rectangle for specified element object with x, y, w, h fields.
       */
      getRect: function (elm) {
        var self = this, pos, size;

        elm = self.get(elm);
        pos = self.getPos(elm);
        size = self.getSize(elm);

        return {
          x: pos.x, y: pos.y,
          w: size.w, h: size.h
        };
      },

      /**
       * Returns the size dimensions of the specified element.
       *
       * @method getSize
       * @param {Element/String} elm Element object or element ID to get rectangle from.
       * @return {object} Rectangle for specified element object with w, h fields.
       */
      getSize: function (elm) {
        var self = this, w, h;

        elm = self.get(elm);
        w = self.getStyle(elm, 'width');
        h = self.getStyle(elm, 'height');

        // Non pixel value, then force offset/clientWidth
        if (w.indexOf('px') === -1) {
          w = 0;
        }

        // Non pixel value, then force offset/clientWidth
        if (h.indexOf('px') === -1) {
          h = 0;
        }

        return {
          w: parseInt(w, 10) || elm.offsetWidth || elm.clientWidth,
          h: parseInt(h, 10) || elm.offsetHeight || elm.clientHeight
        };
      },

      /**
       * Returns a node by the specified selector function. This function will
       * loop through all parent nodes and call the specified function for each node.
       * If the function then returns true indicating that it has found what it was looking for, the loop execution will then end
       * and the node it found will be returned.
       *
       * @method getParent
       * @param {Node/String} node DOM node to search parents on or ID string.
       * @param {function} selector Selection function or CSS selector to execute on each node.
       * @param {Node} root Optional root element, never go beyond this point.
       * @return {Node} DOM Node or null if it wasn't found.
       */
      getParent: function (node, selector, root) {
        return this.getParents(node, selector, root, false);
      },

      /**
       * Returns a node list of all parents matching the specified selector function or pattern.
       * If the function then returns true indicating that it has found what it was looking for and that node will be collected.
       *
       * @method getParents
       * @param {Node/String} node DOM node to search parents on or ID string.
       * @param {function} selector Selection function to execute on each node or CSS pattern.
       * @param {Node} root Optional root element, never go beyond this point.
       * @return {Array} Array of nodes or null if it wasn't found.
       */
      getParents: function (node, selector, root, collect) {
        var self = this, selectorVal, result = [];

        node = self.get(node);
        collect = collect === undefined;

        // Default root on inline mode
        root = root || (self.getRoot().nodeName != 'BODY' ? self.getRoot().parentNode : null);

        // Wrap node name as func
        if (is(selector, 'string')) {
          selectorVal = selector;

          if (selector === '*') {
            selector = function (node) {
              return node.nodeType == 1;
            };
          } else {
            selector = function (node) {
              return self.is(node, selectorVal);
            };
          }
        }

        while (node) {
          if (node == root || !node.nodeType || node.nodeType === 9) {
            break;
          }

          if (!selector || selector(node)) {
            if (collect) {
              result.push(node);
            } else {
              return node;
            }
          }

          node = node.parentNode;
        }

        return collect ? result : null;
      },

      /**
       * Returns the specified element by ID or the input element if it isn't a string.
       *
       * @method get
       * @param {String/Element} n Element id to look for or element to just pass though.
       * @return {Element} Element matching the specified id or null if it wasn't found.
       */
      get: function (elm) {
        var name;

        if (elm && this.doc && typeof elm == 'string') {
          name = elm;
          elm = this.doc.getElementById(elm);

          // IE and Opera returns meta elements when they match the specified input ID, but getElementsByName seems to do the trick
          if (elm && elm.id !== name) {
            return this.doc.getElementsByName(name)[1];
          }
        }

        return elm;
      },

      /**
       * Returns the next node that matches selector or function
       *
       * @method getNext
       * @param {Node} node Node to find siblings from.
       * @param {String/function} selector Selector CSS expression or function.
       * @return {Node} Next node item matching the selector or null if it wasn't found.
       */
      getNext: function (node, selector) {
        return this._findSib(node, selector, 'nextSibling');
      },

      /**
       * Returns the previous node that matches selector or function
       *
       * @method getPrev
       * @param {Node} node Node to find siblings from.
       * @param {String/function} selector Selector CSS expression or function.
       * @return {Node} Previous node item matching the selector or null if it wasn't found.
       */
      getPrev: function (node, selector) {
        return this._findSib(node, selector, 'previousSibling');
      },

      // #ifndef jquery

      /**
       * Selects specific elements by a CSS level 3 pattern. For example "div#a1 p.test".
       * This function is optimized for the most common patterns needed in TinyMCE but it also performs well enough
       * on more complex patterns.
       *
       * @method select
       * @param {String} selector CSS level 3 pattern to select/find elements by.
       * @param {Object} scope Optional root element/scope element to search in.
       * @return {Array} Array with all matched elements.
       * @example
       * // Adds a class to all paragraphs in the currently active editor
       * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'someclass');
       *
       * // Adds a class to all spans that have the test class in the currently active editor
       * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('span.test'), 'someclass')
       */
      select: function (selector, scope) {
        var self = this;

        /*eslint new-cap:0 */
        return Sizzle(selector, self.get(scope) || self.settings.root_element || self.doc, []);
      },

      /**
       * Returns true/false if the specified element matches the specified css pattern.
       *
       * @method is
       * @param {Node/NodeList} elm DOM node to match or an array of nodes to match.
       * @param {String} selector CSS pattern to match the element against.
       */
      is: function (elm, selector) {
        var i;

        if (!elm) {
          return false;
        }

        // If it isn't an array then try to do some simple selectors instead of Sizzle for to boost performance
        if (elm.length === undefined) {
          // Simple all selector
          if (selector === '*') {
            return elm.nodeType == 1;
          }

          // Simple selector just elements
          if (simpleSelectorRe.test(selector)) {
            selector = selector.toLowerCase().split(/,/);
            elm = elm.nodeName.toLowerCase();

            for (i = selector.length - 1; i >= 0; i--) {
              if (selector[i] == elm) {
                return true;
              }
            }

            return false;
          }
        }

        // Is non element
        if (elm.nodeType && elm.nodeType != 1) {
          return false;
        }

        var elms = elm.nodeType ? [elm] : elm;

        /*eslint new-cap:0 */
        return Sizzle(selector, elms[0].ownerDocument || elms[0], null, elms).length > 0;
      },

      // #endif

      /**
       * Adds the specified element to another element or elements.
       *
       * @method add
       * @param {String/Element/Array} parentElm Element id string, DOM node element or array of ids or elements to add to.
       * @param {String/Element} name Name of new element to add or existing element to add.
       * @param {Object} attrs Optional object collection with arguments to add to the new element(s).
       * @param {String} html Optional inner HTML contents to add for each element.
       * @param {Boolean} create Optional flag if the element should be created or added.
       * @return {Element/Array} Element that got created, or an array of created elements if multiple input elements
       * were passed in.
       * @example
       * // Adds a new paragraph to the end of the active editor
       * tinymce.activeEditor.dom.add(tinymce.activeEditor.getBody(), 'p', {title: 'my title'}, 'Some content');
       */
      add: function (parentElm, name, attrs, html, create) {
        var self = this;

        return this.run(parentElm, function (parentElm) {
          var newElm;

          a 6HPD% f1	)4@@M
B4@ n@BA(	$RQS?G4 "4	,"Bh
BuR;`B%,3H!jq8<|-*]~^)^E[lgm<kqf/9Y:SMm9
V_Knc[& js3Yy}{[:KMhGbw7Mq}uOc_qw]|l[:MbwozeSpf=mG< I"G@W*  	Pb(G"|	!34a[#;3,R!%P* l$BL@'8* =d! P 4 XZE|2.jgx~xy_0_vJ-o};-.)'?c^w^oh>{Y;nE2UWeG7H?G8w~B 4Nd" + #I
 "5 dDAesn@Ip$.He H$; y!DA"F mP@h-#`P*1(X < !Q @9T@I1	5"db2W! !NT	d"<0- 6  "i`J@KR!B 	[#0,aB P 4u8MW^wwk}ut~gk:r}kS'zO}/?[A2wu>5D|&=I'~:$(r P	
T lH)!D   i	/
X^@S8X250@0*Z@"8@Hp($P1|*4$1A`8 Ong^oub>i?_eZ.{5NWW6_~\&;jW`BwH[_Bsvz]rSfSbOEMo'>c{RYs'*|w{{Mwso]uwo"75Wfww{U2qbS1}{#&?snO-NTAtD HT% `0 AB k A  
` 	mC*D,2 	e  tBp
PX$ 0|aB"@#c;=7G>)-FxgrS!{xNV^[q/yM?mH\|/>d7>jy^GbDVjXD ! 0Dh
hmB
D1@l  @k( 	 0(5H$D@	p FD0"8B
$B@P"Z Jb%`d=P$cA"	<6Iqx(Ea$)A @$/(dQ@T
d-\`..iC62C!S@@` ^E(o
vuITUra>gWo_GtoRU?^7N7z:<_z~+~0?;?Y_/|S_osz.7 B|r 
}@L@42hE R* \  PTNF4h2d
 D LaE"c
 pKX	 v" - bt*v[u.^W6=+vOwV}?;}oVPG5c}=FmWiu~G]xy+A8:[Lwj)]M{3rj\S.OMo<O8Nk?`mzu+s}H	Gp5kmug;W]v9&{s:sqY? LA # `Be	!
 Bbj	%W"%DdKW@jF|&`Q0!XX8HSS0)C0e@%ABF`@F al,orIwx\#c3U+{AIuP6R%fDO,B_
;$go\u-X]% h'd=PPrt0` 0YeAdmDVJ<@X<,!P! N!#A@	HSB:PUQP&	b$A (+R,S D1 G  5  2%Ix`LLR`DXTDT 644  &@ A `BQ  :8! L!$`@@bK0
 E@ B\]#y)> p1w(?gy4N{~3xD^#_O7x1>*.O+w?>eLkW^w:~g@ E"MT#= QAl"%i4TR@iC wP"A2Q*P@Q % .f,$) 0@@!  h '3H( H@BK,  I Cqv~-Pgw_lu_|ok_?_eO.y1]T>b|_o4[x_[!\|N?+[os
<|oob{bz[a7-|UsXf_9FEw^>h//.VMoMto7<mMbK5w
zo|W\	
RHI0 =kbGD@@bBH`A.hXY1@@ d[` E@( LV-P |A H; _,'t*HH)0(H 4dMM.]&?=r=4]OK7bW77cjl2t}y_7;:LtOE:~/?^FuI#DPf"A-It% f BBPV% 
tRG$H(C } 
<C3 , Dp!_5 LN@dZB &-JL(0`!$h `J(9DUB&&I% '@`8``BT	 SdAh24@!("QxB2Z*& 3p-#  %xs|hLvy^fo?w,/3_cgO[k-362_w9j^_[s'v?(^yj?yml  var child;

            while ((child = this.firstChild)) {
              if (child.nodeType == 3 && child.data.length === 0) {
                this.removeChild(child);
              } else {
                this.parentNode.insertBefore(child, this);
              }
            }
          }).remove();
        } else {
          node.remove();
        }

        return node.length > 1 ? node.toArray() : node[0];
      },

      /**
       * Sets the CSS style value on a HTML element. The name can be a camelcase string
       * or the CSS style name like background-color.
       *
       * @method setStyle
       * @param {String/Element/Array} elm HTML element/Array of elements to set CSS style value on.
       * @param {String} name Name of the style value to set.
       * @param {String} value Value to set on the style.
       * @example
       * // Sets a style value on all paragraphs in the currently active editor
       * tinymce.activeEditor.dom.setStyle(tinymce.activeEditor.dom.select('p'), 'background-color', 'red');
       *
       * // Sets a style value to an element by id in the current document
       * tinymce.DOM.setStyle('mydiv', 'background-color', 'red');
       */
      setStyle: function (elm, name, value) {
        elm = this.$$(elm).css(name, value);

        if (this.settings.update_styles) {
          updateInternalStyleAttr(this, elm);
        }
      },

      /**
       * Returns the current style or runtime/computed value of an element.
       *
       * @method getStyle
       * @param {String/Element} elm HTML element or element id string to get style from.
       * @param {String} name Style name to return.
       * @param {Boolean} computed Computed style.
       * @return {String} Current style or computed style value of an element.
       */
      getStyle: function (elm, name, computed) {
        elm = this.$$(elm);

        if (computed) {
          return elm.css(name);
        }

        // Camelcase it, if needed
        name = name.replace(/-(\D)/g, function (a, b) {
          return b.toUpperCase();
        });

        if (name == 'float') {
          name = Env.ie && Env.ie < 12 ? 'styleFloat' : 'cssFloat';
        }

        return elm[0] && elm[0].style ? elm[0].style[name] : undefined;
      },

      /**
       * Sets multiple styles on the specified element(s).
       *
       * @method setStyles
       * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set styles on.
       * @param {Object} styles Name/Value collection of style items to add to the element(s).
       * @example
       * // Sets styles on all paragraphs in the currently active editor
       * tinymce.activeEditor.dom.setStyles(tinymce.activeEditor.dom.select('p'), {'background-color': 'red', 'color': 'green'});
       *
       * // Sets styles to an element by id in the current document
       * tinymce.DOM.setStyles('mydiv', {'background-color': 'red', 'color': 'green'});
       */
      setStyles: function (elm, styles) {
        elm = this.$$(elm).css(styles);

        if (this.settings.update_styles) {
          updateInternalStyleAttr(this, elm);
        }
      },

      /**
       * Removes all attributes from an element or elements.
       *
       * @method removeAllAttribs
       * @param {Element/String/Array} e DOM element, element id string or array of elements/ids to remove attributes from.
       */
      removeAllAttribs: function (e) {
        return this.run(e, function (e) {
          var i, attrs = e.attributes;
          for (i = attrs.length - 1; i >= 0; i--) {
            e.removeAttributeNode(attrs.item(i));
          }
        });
      },

      /**
       * Sets the specified attribute of an element or elements.
       *
       * @method setAttrib
       * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set attribute on.
       * @param {String} name Name of attribute to set.
       * @param {String} value Value to set on the attribute - if this value is falsy like null, 0 or '' it will remove
       * the attribute instead.
       * @example
       * // Sets class attribute on all paragraphs in the active editor
       * tinymce.activeEditor.dom.setAttrib(tinymce.activeEditor.dom.select('p'), 'class', 'myclass');
       *
       * // Sets class attribute on a specific element in the current page
       * tinymce.dom.setAttrib('mydiv', 'class', 'myclass');
       */
      setAttrib: function (elm, name, value) {
        var self = this, originalValue, hook, settings = self.settings;

        if (value === '') {
          value = null;
        }

        elm = self.$$(elm);
        originalValue = elm.attr(name);

        if (!elm.length) {
          return;
        }

        hook = self.attrHooks[name];
        if (hook && hook.set) {
          hook.set(elm, value, name);
        } else {
          elm.attr(name, value);
        }

        if (originalValue != value && settings.onSetAttrib) {
          settings.onSetAttrib({
            attrElm: elm,
            attrName: name,
            attrValue: value
          });
        }
      },

      /**
       * Sets two or more specified attributes of an element or elements.
       *
       * @method setAttribs
       * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set attributes on.
       * @param {Object} attrs Name/Value collection of attribute items to add to the element(s).
       * @example
       * // Sets class and title attributes on all paragraphs in the active editor
       * tinymce.activeEditor.dom.setAttribs(tinymce.activeEditor.dom.select('p'), {'class': 'myclass', title: 'some title'});
       *
       * // Sets class and title attributes on a specific element in the current page
       * tinymce.DOM.setAttribs('mydiv', {'class': 'myclass', title: 'some title'});
       */
      setAttribs: function (elm, attrs) {
        var self = this;

        self.$$(elm).each(function (i, node) {
          each(attrs, function (value, name) {
            self.setAttrib(node, name, value);
          });
        });
      },

      /**
       * Returns the specified attribute by name.
       *
       * @method getAttrib
       * @param {String/Element} elm Element string id or DOM element to get attribute from.
       * @param {String} name Name of attribute to get.
       * @param {String} defaultVal Optional default value to return if the attribute didn't exist.
       * @return {String} Attribute value string, default value or null if the attribute wasn't found.
       */
      getAttrib: function (elm, name, defaultVal) {
        var self = this, hook, value;

        elm = self.$$(elm);

        if (elm.length) {
          hook = self.attrHooks[name];

          if (hook && hook.get) {
            value = hook.get(elm, name);
          } else {
            value = elm.attr(name);
          }
        }

        if (typeof value == 'undefined') {
          value = defaultVal || '';
        }

        return value;
      },

      /**
       * Returns the absolute x, y position of a node. The position will be returned in an object with x, y fields.
       *
       * @method getPos
       * @param {Element/String} elm HTML element or element id to get x, y position from.
       * @param {Element} rootElm Optional root element to stop calculations at.
       * @return {object} Absolute position of the specified element object with x, y fields.
       */
      getPos: function (elm, rootElm) {
        var self = this, x = 0, y = 0, offsetParent, doc = self.doc, body = doc.body, pos;

        elm = self.get(elm);
        rootElm = rootElm || body;

        if (elm) {
          // Use getBoundingClientRect if it exists since it's faster than looping offset nodes
          // Fallback to offsetParent calculations if the body isn't static better since it stops at the body root
          if (rootElm === body && elm.getBoundingClientRect && DomQuery(body).css('position') === 'static') {
            pos = elm.getBoundingClientRect();
            rootElm = self.boxModel ? doc.documentElement : body;

            // Add scroll offsets from documentElement or body since IE with the wrong box model will use d.body and so do WebKit
            // Also remove the body/documentelement clientTop/clientLeft on IE 6, 7 since they offset the position
            x = pos.left + (doc.documentElement.scrollLeft || body.scrollLeft) - rootElm.clientLeft;
            y = pos.top + (doc.documentElement.scrollTop || body.scrollTop) - rootElm.clientTop;

            return { x: x, y: y };
          }

          offsetParent = elm;
          while (offsetParent && offsetParent != rootElm && offsetParent.nodeType) {
            x += offsetParent.offsetLeft || 0;
            y += offsetParent.offsetTop || 0;
            offsetParent = offsetParent.offsetParent;
          }

          offsetParent = elm.parentNode;
          while (offsetParent && offsetParent != rootElm && offsetParent.nodeType) {
            x -= offsetParent.scrollLeft || 0;
            y -= offsetParent.scrollTop || 0;
            offsetParent = offsetParent.parentNode;
          }
        }

        return { x: x, y: y };
      },

      /**
       * Parses the specified style value into an object collection. This parser will also
       * merge and remove any redundant items that browsers might have added. It will also convert non-hex
       * colors to hex values. Urls inside the styles will also be converted to absolute/relative based on settings.
       *
       * @method parseStyle
       * @param {String} cssText Style value to parse, for example: border:1px solid red;.
       * @return {Object} Object representation of that style, for example: {border: '1px solid red'}
       */
      parseStyle: function (cssText) {
        return this.styles.parse(cssText);
      },

      /**
       * Serializes the specified style object into a string.
       *
       * @method serializeStyle
       * @param {Object} styles Object to serialize as string, for example: {border: '1px solid red'}
       * @param {String} name Optional element name.
       * @return {String} String representation of the style object, for example: border: 1px solid red.
       */
      serializeStyle: function (styles, name) {
        return this.styles.serialize(styles, name);
      },

      /**
       * Adds a style element at the top of the document with the specified cssText content.
       *
       * @method addStyle
       * @param {String} cssText CSS Text style to add to top of head of document.
       */
      addStyle: function (cssText) {
        var self = this, doc = self.doc, head, styleElm;

        // Prevent inline from loading the same styles twice
        if (self !== DOMUtils.DOM && doc === document) {
          var addedStyles = DOMUtils.DOM.addedStyles;

          addedStyles = addedStyles || [];
          if (addedStyles[cssText]) {
            return;
          }

          addedStyles[cssText] = true;
          DOMUtils.DOM.addedStyles = addedStyles;
        }

        // Create style element if needed
        styleElm = doc.getElementById('mceDefaultStyles');
        if (!styleElm) {
          styleElm = doc.createElement('style');
          styleElm.id = 'mceDefaultStyles';
          styleElm.type = 'text/css';

          head = doc.getElementsByTagName('head')[0];
          if (head.firstChild) {
            head.insertBefore(styleElm, head.firstChild);
          } else {
            head.appendChild(styleElm);
          }
        }

        // Append style data to old or new style element
        if (styleElm.styleSheet) {
          styleElm.styleSheet.cssText += cssText;
        } else {
          styleElm.appendChild(doc.createTextNode(cssText));
        }
      },

      /**
       * Imports/loads the specified CSS file into the document bound to the class.
       *
       * @method loadCSS
       * @param {String} url URL to CSS file to load.
       * @example
       * // Loads a CSS file dynamically into the current document
       * tinymce.DOM.loadCSS('somepath/some.css');
       *
       * // Loads a CSS file into the currently active editor instance
       * tinymce.activeEditor.dom.loadCSS('somepath/some.css');
       *
       * // Loads a CSS file into an editor instance by id
       * tinymce.get('someid').dom.loadCSS('somepath/some.css');
       *
       * // Loads multiple CSS files into the current document
       * tinymce.DOM.loadCSS('somepath/some.css,somepath/someother.css');
       */
      loadCSS: function (url) {
        var self = this, doc = self.doc, head;

        // Prevent inline from loading the same CSS file twice
        if (self !== DOMUtils.DOM && doc === document) {
          DOMUtils.DOM.loadCSS(url);
          return;
        }

        if (!url) {
          url = '';
        }

        head = doc.getElementsByTagName('head')[0];

        each(url.split(','), function (url) {
          var link;

          url = Tools._addCacheSuffix(url);

          if (self.files[url]) {
            return;
          }

          self.files[url] = true;
          link = self.create('link', { rel: 'stylesheet', href: url });

          // IE 8 has a bug where dynamically loading stylesheets would produce a 1 item remaining bug
          // This fix seems to resolve that issue by recalcing the document once a stylesheet finishes loading
          // It's ugly but it seems to work fine.
          if (isIE && doc.documentMode && doc.recalc) {
            link.onload = function () {
              if (doc.recalc) {
                doc.recalc();
              }

              link.onload = null;
            };
          }

          head.appendChild(link);
        });
      },

      /**
       * Adds a class to the specified element or elements.
       *
       * @method addClass
       * @param {String/Element/Array} elm Element ID string or DOM element or array with elements or IDs.
       * @param {String} cls Class name to add to each element.
       * @return {String/Array} String with new class value or array with new class values for all elements.
       * @example
       * // Adds a class to all paragraphs in the active editor
       * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'myclass');
       *
       * // Adds a class to a specific element in the current page
       * tinymce.DOM.addClass('mydiv', 'myclass');
       */
      addClass: function (elm, cls) {
        this.$$(elm).addClass(cls);
      },

      /**
       * Removes a class from the specified element or elements.
       *
       * @method removeClass
       * @param {String/Element/Array} elm Element ID string or DOM element or array with elements or IDs.
       * @param {String} cls Class name to remove from each element.
       * @return {String/Array} String of remaining class name(s), or an array of strings if multiple input elements
       * were passed in.
       * @example
       * // Removes a class from all paragraphs in the active editor
       * tinymce.activeEditor.dom.removeClass(tinymce.activeEditor.dom.select('p'), 'myclass');
       *
       * // Removes a class from a specific element in the current page
       * tinymce.DOM.removeClass('mydiv', 'myclass');
       */
      removeClass: function (elm, cls) {
        this.toggleClass(elm, cls, false);
      },

      /**
       * Returns true if the specified element has the specified class.
       *
       * @method hasClass
       * @param {String/Element} elm HTML element or element id string to check CSS class on.
       * @param {String} cls CSS class to check for.
       * @return {Boolean} true/false if the specified element has the specified class.
       */
      hasClass: function (elm, cls) {
        return this.$$(elm).hasClass(cls);
      },

      /**
       * Toggles the specified class on/off.
       *
       * @method toggleClass
       * @param {Element} elm Element to toggle class on.
       * @param {[type]} cls Class to toggle on/off.
       * @param {[type]} state Optional state to set.
       */
      toggleClass: function (elm, cls, state) {
        this.$$(elm).toggleClass(cls, state).each(function () {
          if (this.className === '') {
            DomQuery(this).attr('class', null);
          }
        });
      },

      /**
       * Shows the specified element(s) by ID by setting the "display" style.
       *
       * @method show
       * @param {String/Element/Array} elm ID of DOM element or DOM element or array with elements or IDs to show.
       */
      show: function (elm) {
        this.$$(elm).show();
      },

      /**
       * Hides the specified element(s) by ID by setting the "display" style.
       *
       * @method hide
       * @param {String/Element/Array} elm ID of DOM element or DOM element or array with elements or IDs to hide.
       * @example
       * // Hides an element by id in the document
       * tinymce.DOM.hide('myid');
       */
      hide: function (elm) {
        this.$$(elm).hide();
      },

      /**
       * Returns true/false if the element is hidden or not by checking the "display" style.
       *
       * @method isHidden
       * @param {String/Element} elm Id or element to check display state on.
       * @return {Boolean} true/false if the element is hidden or not.
       */
      isHidden: function (elm) {
        return this.$$(elm).css('display') == 'none';
      },

      /**
       * Returns a unique id. This can be useful when generating elements on the fly.
       * This method will not check if the element already exists.
       *
       * @method uniqueId
       * @param {String} prefix Optional prefix to add in front of all ids - defaults to "mce_".
       * @return {String} Unique id.
       */
      uniqueId: function (prefix) {
        return (!prefix ? 'mce_' : prefix) + (this.counter++);
      },

      /**
       * Sets the specified HTML content inside the element or elements. The HTML will first be processed. This means
       * URLs will get converted, hex color values fixed etc. Check processHTML for details.
       *
       * @method setHTML
       * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set HTML inside of.
       * @param {String} html HTML content to set as inner HTML of the element.
       * @example
       * // Sets the inner HTML of all paragraphs in the active editor
       * tinymce.activeEditor.dom.setHTML(tinymce.activeEditor.dom.select('p'), 'some inner html');
       *
       * // Sets the inner HTML of an element by id in the document
       * tinymce.DOM.setHTML('mydiv', 'some inner html');
       */
      setHTML: function (elm, html) {
        elm = this.$$(elm);

        if (isIE) {
          elm.each(function (i, target) {
            if (target.canHaveHTML === false) {
              return;
            }

            // Remove all child nodes, IE keeps empty text nodes in DOM
            while (target.firstChild) {
              target.removeChild(target.firstChild);
            }

            try {
              // IE will remove comments from the beginning
              // unless you padd the contents with something
              target.innerHTML = '<br>' + html;
              target.removeChild(target.firstChild);
            } catch (ex) {
              // IE sometimes produces an unknown runtime error on innerHTML if it's a div inside a p
              DomQuery('<div></div>').html('<br>' + html).contents().slice(1).appendTo(target);
            }

            return html;
          });
        } else {
          elm.html(html);
        }
      },

      /**
       * Returns the outer HTML of an element.
       *
       * @method getOuterHTML
       * @param {String/Element} elm Element ID or element object to get outer HTML from.
       * @return {String} Outer HTML string.
       * @example
       * tinymce.DOM.getOuterHTML(editorElement);
       * tinymce.activeEditor.getOuterHTML(tinymce.activeEditor.getBody());
       */
      getOuterHTML: function (elm) {
        elm = this.get(elm);

        // Older FF doesn't have outerHTML 3.6 is still used by some orgaizations
        return elm.nodeType == 1 && "outerHTML" in elm ? elm.outerHTML : DomQuery('<div></div>').append(DomQuery(elm).clone()).html();
      },

      /**
       * Sets the specified outer HTML on an element or elements.
       *
       * @method setOuterHTML
       * @param {Element/String/Array} elm DOM element, element id string or array of elements/ids to set outer HTML on.
       * @param {Object} html HTML code to set as outer value for the element.
       * @example
       * // Sets the outer HTML of all paragraphs in the active editor
       * tinymce.activeEditor.dom.setOuterHTML(tinymce.activeEditor.dom.select('p'), '<div>some html</div>');
       *
       * // Sets the outer HTML of an element by id in the document
       * tinymce.DOM.setOuterHTML('mydiv', '<div>some html</div>');
       */
      setOuterHTML: function (elm, html) {
        var self = this;

        self.$$(elm).each(function () {
          try {
            // Older FF doesn't have outerHTML 3.6 is still used by some organizations
            if ("outerHTML" in this) {
              this.outerHTML = html;
              return;
            }
          } catch (ex) {
            // Ignore
          }

          // OuterHTML for IE it sometimes produces an "unknown runtime error"
          self.remove(DomQuery(this).html(html), true);
        });
      },

      /**
       * Entity decodes a string. This method decodes any HTML entities, such as &aring;.
       *
       * @method decode
       * @param {String} s String to decode entities on.
       * @return {String} Entity decoded string.
       */
      decode: Entities.decode,

      /**
       * Entity encodes a string. This method encodes the most common entities, such as <>"&.
       *
       * @method encode
       * @param {String} text String to encode with entities.
       * @return {String} Entity encoded string.
       */
      encode: Entities.encodeAllRaw,

      /**
       * Inserts an element after the reference element.
       *
       * @method insertAfter
       * @param {Element} node Element to insert after the reference.
       * @param {Element/String/Array} referenceNode Reference element, element id or array of elements to insert after.
       * @return {Element/Array} Element that got added or an array with elements.
       */
      insertAfter: function (node, referenceNode) {
        referenceNode = this.get(referenceNode);

        return this.run(node, function (node) {
          var parent, nextSibling;

          parent = referenceNode.parentNode;
          nextSibling = referenceNode.nextSibling;

          if (nextSibling) {
            parent.insertBefore(node, nextSibling);
          } else {
            parent.appendChild(node);
          }

          return node;
        });
      },

      /**
       * Replaces the specified element or elements with the new element specified. The new element will
       * be cloned if multiple input elements are passed in.
       *
       * @method replace
       * @param {Element} newElm New element to replace old ones with.
       * @param {Element/String/Array} oldElm Element DOM node, element id or array of elements or ids to replace.
       * @param {Boolean} keepChildren Optional keep children state, if set to true child nodes from the old object will be added
       * to new ones.
       */
      replace: function (newElm, oldElm, keepChildren) {
        var self = this;

        return self.run(oldElm, function (oldElm) {
          if (is(oldElm, 'array')) {
            newElm = newElm.cloneNode(true);
          }

          if (keepChildren) {
            each(grep(oldElm.childNodes), function (node) {
              newElm.appendChild(node);
            });
          }

          return oldElm.parentNode.replaceChild(newElm, oldElm);
        });
      },

      /**
       * Renames the specified element and keeps its attributes and children.
       *
       * @method rename
       * @param {Element} elm Element to rename.
       * @param {String} name Name of the new element.
       * @return {Element} New element or the old element if it needed renaming.
       */
      rename: function (elm, name) {
        var self = this, newElm;

        if (elm.nodeName != name.toUpperCase()) {
          // Rename block element
          newElm = self.create(name);

          // Copy attribs to new block
          each(self.getAttribs(elm), function (attrNode) {
            self.setAttrib(newElm, attrNode.nodeName, self.getAttrib(elm, attrNode.nodeName));
          });

          // Replace block
          self.replace(newElm, elm, 1);
        }

        return newElm || elm;
      },

      /**
       * Find the common ancestor of two elements. This is a shorter method than using the DOM Range logic.
       *
       * @method findCommonAncestor
       * @param {Element} a Element to find common ancestor of.
       * @param {Element} b Element to find common ancestor of.
       * @return {Element} Common ancestor element of the two input elements.
       */
      findCommonAncestor: function (a, b) {
        var ps = a, pe;

        while (ps) {
          pe = b;

          while (pe && ps != pe) {
            pe = pe.parentNode;
          }

          if (ps == pe) {
            break;
          }

          ps = ps.parentNode;
        }

        if (!ps && a.ownerDocument) {
          return a.ownerDocument.documentElement;
        }

        return ps;
      },

      /**
       * Parses the specified RGB color value and returns a hex version of that color.
       *
       * @method toHex
       * @param {String} rgbVal RGB string value like rgb(1,2,3)
       * @return {String} Hex version of that RGB value like #FF00FF.
       */
      toHex: function (rgbVal) {
        return this.styles.toHex(Tools.trim(rgbVal));
      },

      /**
       * Executes the specified function on the element by id or dom element node or array of elements/id.
       *
       * @method run
       * @param {String/Element/Array} elm ID or DOM element object or array with ids or elements.
       * @param {function} func Function to execute for each item.
       * @param {Object} scope Optional scope to execute the function in.
       * @return {Object/Array} Single object, or an array of objects if multiple input elements were passed in.
       */
      run: function (elm, func, scope) {
        var self = this, result;

        if (typeof elm === 'string') {
          elm = self.get(elm);
        }

        if (!elm) {
          return false;
        }

        scope = scope || this;
        if (!elm.nodeType && (elm.length || elm.length === 0)) {
          result = [];

          each(elm, function (elm, i) {
            if (elm) {
              if (typeof elm == 'string') {
                elm = self.get(elm);
              }

              result.push(func.call(scope, elm, i));
            }
          });

          return result;
        }

        return func.call(scope, elm);
      },

      /**
       * Returns a NodeList with attributes for the element.
       *
       * @method getAttribs
       * @param {HTMLElement/string} elm Element node or string id to get attributes from.
       * @return {NodeList} NodeList with attributes.
       */
      getAttribs: function (elm) {
        var attrs;

        elm = this.get(elm);

        if (!elm) {
          return [];
        }

        if (isIE) {
          attrs = [];

          // Object will throw exception in IE
          if (elm.nodeName == 'OBJECT') {
            return elm.attributes;
          }

          // IE doesn't keep the selected attribute if you clone option elements
          if (elm.nodeName === 'OPTION' && this.getAttrib(elm, 'selected')) {
            attrs.push({ specified: 1, nodeName: 'selected' });
          }

          // It's crazy that this is faster in IE but it's because it returns all attributes all the time
          var attrRegExp = /<\/?[\w:\-]+ ?|=[\"][^\"]+\"|=\'[^\']+\'|=[\w\-]+|>/gi;
          elm.cloneNode(false).outerHTML.replace(attrRegExp, '').replace(/[\w:\-]+/gi, function (a) {
            attrs.push({ specified: 1, nodeName: a });
          });

          return attrs;
        }

        return elm.attributes;
      },

      /**
       * Returns true/false if the specified node is to be considered empty or not.
       *
       * @example
       * tinymce.DOM.isEmpty(node, {img: true});
       * @method isEmpty
       * @param {Object} elements Optional name/value object with elements that are automatically treated as non-empty elements.
       * @return {Boolean} true/false if the node is empty or not.
       */
      isEmpty: function (node, elements) {
        var self = this, i, attributes, type, whitespace, walker, name, brCount = 0;

        node = node.firstChild;
        if (node) {
          walker = new TreeWalker(node, node.parentNode);
          elements = elements || (self.schema ? self.schema.getNonEmptyElements() : null);
          whitespace = self.schema ? self.schema.getWhiteSpaceElements() : {};

          do {
            type = node.nodeType;

            if (type === 1) {
              // Ignore bogus elements
              var bogusVal = node.getAttribute('data-mce-bogus');
              if (bogusVal) {
                node = walker.next(bogusVal === 'all');
                continue;
              }

              // Keep empty elements like <img />
              name = node.nodeName.toLowerCase();
              if (elements && elements[name]) {
                // Ignore single BR elements in blocks like <p><br /></p> or <p><span><br /></span></p>
                if (name === 'br') {
                  brCount++;
                  node = walker.next();
                  continue;
                }

                return false;
              }

              // Keep elements with data-bookmark attributes or name attribute like <a name="1"></a>
              attributes = self.getAttribs(node);
              i = attributes.length;
              while (i--) {
                name = attributes[i].nodeName;
                if (name === "name" || name === 'data-mce-bookmark') {
                  return false;
                }
              }
            }

            // Keep comment nodes
            if (type == 8) {
              return false;
            }

            // Keep non whitespace text nodes
            if (type === 3 && !whiteSpaceRegExp.test(node.nodeValue)) {
              return false;
            }

            // Keep whitespace preserve elements
            if (type === 3 && node.parentNode && whitespace[node.parentNode.nodeName] && whiteSpaceRegExp.test(node.nodeValue)) {
              return false;
            }

            node = walker.next();
          } while (node);
        }

        return brCount <= 1;
      },

      /**
       * Creates a new DOM Range object. This will use the native DOM Range API if it's
       * available. If it's not, it will fall back to the custom TinyMCE implementation.
       *
       * @method createRng
       * @return {DOMRange} DOM Range object.
       * @example
       * var rng = tinymce.DOM.createRng();
       * alert(rng.startContainer + "," + rng.startOffset);
       */
      createRng: function () {
        var doc = this.doc;

        return doc.createRange ? doc.createRange() : new Range(this);
      },

      /**
       * Returns the index of the specified node within its parent.
       *
       * @method nodeIndex
       * @param {Node} node Node to look for.
       * @param {boolean} normalized Optional true/false state if the index is what it would be after a normalization.
       * @return {Number} Index of the specified node.
       */
      nodeIndex: nodeIndex,

      /**
       * Splits an element into two new elements and places the specified split
       * element or elements between the new ones. For example splitting the paragraph at the bold element in
       * this example <p>abc<b>abc</b>123</p> would produce <p>abc</p><b>abc</b><p>123</p>.
       *
       * @method split
       * @param {Element} parentElm Parent element to split.
       * @param {Element} splitElm Element to split at.
       * @param {Element} replacementElm Optional replacement element to replace the split element with.
       * @return {Element} Returns the split element or the replacement element if that is specified.
       */
      split: function (parentElm, splitElm, replacementElm) {
        var self = this, r = self.createRng(), bef, aft, pa;

        // W3C valid browsers tend to leave empty nodes to the left/right side of the contents - this makes sense
        // but we don't want that in our code since it serves no purpose for the end user
        // For example splitting this html at the bold element:
        //   <p>text 1<span><b>CHOP</b></span>text 2</p>
        // would produce:
        //   <p>text 1<span></span></p><b>CHOP</b><p><span></span>text 2</p>
        // this function will then trim off empty edges and produce:
        //   <p>text 1</p><b>CHOP</b><p>text 2</p>
        function trimNode(node) {
          var i, children = node.childNodes, type = node.nodeType;

          function surroundedBySpans(node) {
            var previousIsSpan = node.previousSibling && node.previousSibling.nodeName == 'SPAN';
            var nextIsSpan = node.nextSibling && node.nextSibling.nodeName == 'SPAN';
            return previousIsSpan && nextIsSpan;
          }

          if (type == 1 && node.getAttribute('data-mce-type') == 'bookmark') {
            return;
          }

          for (i = children.length - 1; i >= 0; i--) {
            trimNode(children[i]);
          }

          if (type != 9) {
            // Keep non whitespace text nodes
            if (type == 3 && node.nodeValue.length > 0) {
              // If parent element isn't a block or there isn't any useful contents for example "<p>   </p>"
              // Also keep text nodes with only spaces if surrounded by spans.
              // eg. "<p><span>a</span> <span>b</span></p>" should keep space between a and b
              var trimmedLength = trim(node.nodeValue).length;
              if (!self.isBlock(node.parentNode) || trimmedLength > 0 || trimmedLength === 0 && surroundedBySpans(node)) {
                return;
              }
            } else if (type == 1) {
              // If the only child is a bookmark then move it up
              children = node.childNodes;

              // TODO fix this complex if
              if (children.length == 1 && children[0] && children[0].nodeType == 1 &&
                children[0].getAttribute('data-mce-type') == 'bookmark') {
                node.parentNode.insertBefore(children[0], node);
              }

              // Keep non empty elements or img, hr etc
              if (children.length || /^(br|hr|input|img)$/i.test(node.nodeName)) {
                return;
              }
            }

            self.remove(node);
          }

          return node;
        }

        if (parentElm && splitElm) {
          // Get before chunk
          r.setStart(parentElm.parentNode, self.nodeIndex(parentElm));
          r.setEnd(splitElm.parentNode, self.nodeIndex(splitElm));
          bef = r.extractContents();

          // Get after chunk
          r = self.createRng();
          r.setStart(splitElm.parentNode, self.nodeIndex(splitElm) + 1);
          r.setEnd(parentElm.parentNode, self.nodeIndex(parentElm) + 1);
          aft = r.extractContents();

          // Insert before chunk
          pa = parentElm.parentNode;
          pa.insertBefore(trimNode(bef), parentElm);

          // Insert middle chunk
          if (replacementElm) {
            pa.insertBefore(replacementElm, parentElm);
            //pa.replaceChild(replacementElm, splitElm);
          } else {
            pa.insertBefore(splitElm, parentElm);
          }

          // Insert after chunk
          pa.insertBefore(trimNode(aft), parentElm);
          self.remove(parentElm);

          return replacementElm || splitElm;
        }
      },

      /**
       * Adds an event handler to the specified object.
       *
       * @method bind
       * @param {Element/Document/Window/Array} target Target element to bind events to.
       * handler to or an array of elements/ids/documents.
       * @param {String} name Name of event handler to add, for example: click.
       * @param {function} func Function to execute when the event occurs.
       * @param {Object} scope Optional scope to execute the function in.
       * @return {function} Function callback handler the same as the one passed in.
       */
      bind: function (target, name, func, scope) {
        var self = this;

        if (Tools.isArray(target)) {
          var i = target.length;

          while (i--) {
            target[i] = self.bind(target[i], name, func, scope);
          }

          return target;
        }

        // Collect all window/document events bound by editor instance
        if (self.settings.collect && (target === self.doc || target === self.win)) {
          self.boundEvents.push([target, name, func, scope]);
        }

        return self.events.bind(target, name, func, scope || self);
      },

      /**
       * Removes the specified event handler by name and function from an element or collection of elements.
       *
       * @method unbind
       * @param {Element/Document/Window/Array} target Target element to unbind events on.
       * @param {String} name Event handler name, for example: "click"
       * @param {function} func Function to remove.
       * @return {bool/Array} Bool state of true if the handler was removed, or an array of states if multiple input elements
       * were passed in.
       */
      unbind: function (target, name, func) {
        var self = this, i;

        if (Tools.isArray(target)) {
          i = target.length;

          while (i--) {
            target[i] = self.unbind(target[i], name, func);
          }

          return target;
        }

        // Remove any bound events matching the input
        if (self.boundEvents && (target === self.doc || target === self.win)) {
          i = self.boundEvents.length;

          while (i--) {
            var item = self.boundEvents[i];

            if (target == item[0] && (!name || name == item[1]) && (!func || func == item[2])) {
              this.events.unbind(item[0], item[1], item[2]);
            }
          }
        }

        return this.events.unbind(target, name, func);
      },

      /**
       * Fires the specified event name with object on target.
       *
       * @method fire
       * @param {Node/Document/Window} target Target element or object to fire event on.
       * @param {String} name Name of the event to fire.
       * @param {Object} evt Event object to send.
       * @return {Event} Event object.
       */
      fire: function (target, name, evt) {
        return this.events.fire(target, name, evt);
      },

      // Returns the content editable state of a node
      getContentEditable: function (node) {
        var contentEditable;

        // Check type
        if (!node || node.nodeType != 1) {
          return null;
        }

        // Check for fake content editable
        contentEditable = node.getAttribute("data-mce-contenteditable");
        if (contentEditable && contentEditable !== "inherit") {
          return contentEditable;
        }

        // Check for real content editable
        return node.contentEditable !== "inherit" ? node.contentEditable : null;
      },

      getContentEditableParent: function (node) {
        var root = this.getRoot(), state = null;

        for (; node && node !== root; node = node.parentNode) {
          state = this.getContentEditable(node);

          if (state !== null) {
            break;
          }
        }

        return state;
      },

      /**
       * Destroys all internal references to the DOM to solve IE leak issues.
       *
       * @method destroy
       */
      destroy: function () {
        var self = this;

        // Unbind all events bound to window/document by editor instance
        if (self.boundEvents) {
          var i = self.boundEvents.length;

          while (i--) {
            var item = self.boundEvents[i];
            this.events.unbind(item[0], item[1], item[2]);
          }

          self.boundEvents = null;
        }

        // Restore sizzle document to window.document
        // Since the current document might be removed producing "Permission denied" on IE see #6325
        if (Sizzle.setDocument) {
          Sizzle.setDocument();
        }

        self.win = self.doc = self.root = self.events = self.frag = null;
      },

      isChildOf: function (node, parent) {
        while (node) {
          if (parent === node) {
            return true;
          }

          node = node.parentNode;
        }

        return false;
      },

      // #ifdef debug

      dumpRng: function (r) {
        return (
          'startContainer: ' + r.startContainer.nodeName +
          ', startOffset: ' + r.startOffset +
          ', endContainer: ' + r.endContainer.nodeName +
          ', endOffset: ' + r.endOffset
        );
      },

      // #endif

      _findSib: function (node, selector, name) {
        var self = this, func = selector;

        if (node) {
          // If expression make a function of it using is
          if (typeof func == 'string') {
            func = function (node) {
              return self.is(node, selector);
            };
          }

          // Loop all siblings
          for (node = node[name]; node; node = node[name]) {
            if (func(node)) {
              return node;
            }
          }
        }

        return null;
      }
    };

    /**
     * Instance of DOMUtils for the current document.
     *
     * @static
     * @property DOM
     * @type tinymce.dom.DOMUtils
     * @example
     * // Example of how to add a class to some element by id
     * tinymce.DOM.addClass('someid', 'someclass');
     */
    DOMUtils.DOM = new DOMUtils(document);
    DOMUtils.nodeIndex = nodeIndex;

    return DOMUtils;
  }
);

/**
 * ScriptLoader.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/*globals console*/

/**
 * This class handles asynchronous/synchronous loading of JavaScript files it will execute callbacks
 * when various items gets loaded. This class is useful to load external JavaScript files.
 *
 * @class tinymce.dom.ScriptLoader
 * @example
 * // Load a script from a specific URL using the global script loader
 * tinymce.ScriptLoader.load('somescript.js');
 *
 * // Load a script using a unique instance of the script loader
 * var scriptLoader = new tinymce.dom.ScriptLoader();
 *
 * scriptLoader.load('somescript.js');
 *
 * // Load multiple scripts
 * var scriptLoader = new tinymce.dom.ScriptLoader();
 *
 * scriptLoader.add('somescript1.js');
 * scriptLoader.add('somescript2.js');
 * scriptLoader.add('somescript3.js');
 *
 * scriptLoader.loadQueue(function() {
 *    alert('All scripts are now loaded.');
 * });
 */
define(
  'tinymce.core.dom.ScriptLoader',
  [
    "tinymce.core.dom.DOMUtils",
    "tinymce.core.util.Tools"
  ],
  function (DOMUtils, Tools) {
    var DOM = DOMUtils.DOM;
    var each = Tools.each, grep = Tools.grep;

    var isFunction = function (f) {
      return typeof f === 'function';
    };

    function ScriptLoader() {
      var QUEUED = 0,
        LOADING = 1,
        LOADED = 2,
        FAILED = 3,
        states = {},
        queue = [],
        scriptLoadedCallbacks = {},
        queueLoadedCallbacks = [],
        loading = 0,
        undef;

      /**
       * Loads a specific script directly without adding it to the load queue.
       *
       * @method load
       * @param {String} url Absolute URL to script to add.
       * @param {function} callback Optional success callback function when the script loaded successfully.
       * @param {function} callback Optional failure callback function when the script failed to load.
       */
      function loadScript(url, success, failure) {
        var dom = DOM, elm, id;

        // Execute callback when script is loaded
        function done() {
          dom.remove(id);

          if (elm) {
            elm.onreadystatechange = elm.onload = elm = null;
          }

          success();
        }

        function error() {
          /*eslint no-console:0 */

          // We can't mark it as done if there is a load error since
          // A) We don't want to produce 404 errors on the server and
          // B) the onerror event won't fire on all browsers.
          // done();

          if (isFunction(failure)) {
            failure();
          } else {
            // Report the error so it's easier for people to spot loading errors
            if (typeof console !== "undefined" && console.log) {
              console.log("Failed to load script: " + url);
            }
          }
        }

        id = dom.uniqueId();

        // Create new script element
        elm = document.createElement('script');
        elm.id = id;
        elm.type = 'text/javascript';
        elm.src = Tools._addCacheSuffix(url);

        // Seems that onreadystatechange works better on IE 10 onload seems to fire incorrectly
        if ("onreadystatechange" in elm) {
          elm.onreadystatechange = function () {
            if (/loaded|complete/.test(elm.readyState)) {
              done();
            }
          };
        } else {
          elm.onload = done;
        }

        // Add onerror event will get fired on some browsers but not all of them
        elm.onerror = error;

        // Add script to document
        (document.getElementsByTagName('head')[0] || document.body).appendChild(elm);
      }

      /**
       * Returns true/false if a script has been loaded or not.
       *
       * @method isDone
       * @param {String} url URL to check for.
       * @return {Boolean} true/false if the URL is loaded.
       */
      this.isDone = function (url) {
        return states[url] == LOADED;
      };

      /**
       * Marks a specific script to be loaded. This can be useful if a script got loaded outside
       * the script loader or to skip it from loading some script.
       *
       * @method markDone
       * @param {string} url Absolute URL to the script to mark as loaded.
       */
      this.markDone = function (url) {
        states[url] = LOADED;
      };

      /**
       * Adds a specific script to the load queue of the script loader.
       *
       * @method add
       * @param {String} url Absolute URL to script to add.
       * @param {function} success Optional success callback function to execute when the script loades successfully.
       * @param {Object} scope Optional scope to execute callback in.
       * @param {function} failure Optional failure callback function to execute when the script failed to load.
       */
      this.add = this.load = function (url, success, scope, failure) {
        var state = states[url];

        // Add url to load queue
        if (state == undef) {
          queue.push(url);
          states[url] = QUEUED;
        }

        if (success) {
          // Store away callback for later execution
          if (!scriptLoadedCallbacks[url]) {
            scriptLoadedCallbacks[url] = [];
          }

          scriptLoadedCallbacks[url].push({
            success: success,
            failure: failure,
            scope: scope || this
          });
        }
      };

      this.remove = function (url) {
        delete states[url];
        delete scriptLoadedCallbacks[url];
      };

      /**
       * Starts the loading of the queue.
       *
       * @method loadQueue
       * @param {function} success Optional callback to execute when all queued items are loaded.
       * @param {function} failure Optional callback to execute when queued items failed to load.
       * @param {Object} scope Optional scope to execute the callback in.
       */
      this.loadQueue = function (success, scope, failure) {
        this.loadScripts(queue, success, scope, failure);
      };

      /**
       * Loads the specified queue of files and executes the callback ones they are loaded.
       * This method is generally not used outside this class but it might be useful in some scenarios.
       *
       * @method loadScripts
       * @param {Array} scripts Array of queue items to load.
       * @param {function} callback Optional callback to execute when scripts is loaded successfully.
       * @param {Object} scope Optional scope to execute callback in.
       * @param {function} callback Optional callback to execute if scripts failed to load.
       */
      this.loadScripts = function (scripts, success, scope, failure) {
        var loadScripts, failures = [];

        function execCallbacks(name, url) {
          // Execute URL callback functions
          each(scriptLoadedCallbacks[url], function (callback) {
            if (isFunction(callback[name])) {
              callback[name].call(callback.scope);
            }
          });

          scriptLoadedCallbacks[url] = undef;
        }

        queueLoadedCallbacks.push({
          success: success,
          failure: failure,
          scope: scope || this
        });

        loadScripts = function () {
          var loadingScripts = grep(scripts);

          // Current scripts has been handled
          scripts.length = 0;

          // Load scripts that needs to be loaded
          each(loadingScripts, function (url) {
            // Script is already loaded then execute script callbacks directly
            if (states[url] === LOADED) {
              execCallbacks('success', url);
              return;
            }

            if (states[url] === FAILED) {
              execCallbacks('failure', url);
              return;
            }

            // Is script not loading then start loading it
            if (states[url] !== LOADING) {
              states[url] = LOADING;
              loading++;

              loadScript(url, function () {
                states[url] = LOADED;
                loading--;

                execCallbacks('success', url);

                // Load more scripts if they where added by the recently loaded script
                loadScripts();
              }, function () {
                states[url] = FAILED;
                loading--;

                failures.push(url);
                execCallbacks('failure', url);

                // Load more scripts if they where added by the recently loaded script
                loadScripts();
              });
            }
          });

          // No scripts are currently loading then execute all pending queue loaded callbacks
          if (!loading) {
            each(queueLoadedCallbacks, function (callback) {
              if (failures.length === 0) {
                if (isFunction(callback.success)) {
                  callback.success.call(callback.scope);
                }
              } else {
                if (isFunction(callback.failure)) {
                  callback.failure.call(callback.scope, failures);
                }
              }
            });

            queueLoadedCallbacks.length = 0;
          }
        };

        loadScripts();
      };
    }

    ScriptLoader.ScriptLoader = new ScriptLoader();

    return ScriptLoader;
  }
);

/**
 * AddOnManager.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class handles the loading of themes/plugins or other add-ons and their language packs.
 *
 * @class tinymce.AddOnManager
 */
define(
  'tinymce.core.AddOnManager',
  [
    "tinymce.core.dom.ScriptLoader",
    "tinymce.core.util.Tools"
  ],
  function (ScriptLoader, Tools) {
    var each = Tools.each;

    function AddOnManager() {
      var self = this;

      self.items = [];
      self.urls = {};
      self.lookup = {};
    }

    AddOnManager.prototype = {
      /**
       * Returns the specified add on by the short name.
       *
       * @method get
       * @param {String} name Add-on to look for.
       * @return {tinymce.Theme/tinymce.Plugin} Theme or plugin add-on instance or undefined.
       */
      get: function (name) {
        if (this.lookup[name]) {
          return this.lookup[name].instance;
        }

        return undefined;
      },

      dependencies: function (name) {
        var result;

        if (this.lookup[name]) {
          result = this.lookup[name].dependencies;
        }

        return result || [];
      },

      /**
       * Loads a language pack for the specified add-on.
       *
       * @method requireLangPack
       * @param {String} name Short name of the add-on.
       * @param {String} languages Optional comma or space separated list of languages to check if it matches the name.
       */
      requireLangPack: function (name, languages) {
        var language = AddOnManager.language;

        if (language && AddOnManager.languageLoad !== false) {
          if (languages) {
            languages = ',' + languages + ',';

            // Load short form sv.js or long form sv_SE.js
            if (languages.indexOf(',' + language.substr(0, 2) + ',') != -1) {
              language = language.substr(0, 2);
            } else if (languages.indexOf(',' + language + ',') == -1) {
              return;
            }
          }

          ScriptLoader.ScriptLoader.add(this.urls[name] + '/langs/' + language + '.js');
        }
      },

      /**
       * Adds a instance of the add-on by it's short name.
       *
       * @method add
       * @param {String} id Short name/id for the add-on.
       * @param {tinymce.Theme/tinymce.Plugin} addOn Theme or plugin to add.
       * @return {tinymce.Theme/tinymce.Plugin} The same theme or plugin instance that got passed in.
       * @example
       * // Create a simple plugin
       * tinymce.create('tinymce.plugins.TestPlugin', {
       *   TestPlugin: function(ed, url) {
       *   ed.on('click', function(e) {
       *      ed.windowManager.alert('Hello World!');
       *   });
       *   }
       * });
       *
       * // Register plugin using the add method
       * tinymce.PluginManager.add('test', tinymce.plugins.TestPlugin);
       *
       * // Initialize TinyMCE
       * tinymce.init({
       *  ...
       *  plugins: '-test' // Init the plugin but don't try to load it
       * });
       */
      add: function (id, addOn, dependencies) {
        this.items.push(addOn);
        this.lookup[id] = { instance: addOn, dependencies: dependencies };

        return addOn;
      },

      remove: function (name) {
        delete this.urls[name];
        delete this.lookup[name];
      },

      createUrl: function (baseUrl, dep) {
        if (typeof dep === "object") {
          return dep;
        }

        return { prefix: baseUrl.prefix, resource: dep, suffix: baseUrl.suffix };
      },

      /**
       * Add a set of components that will make up the add-on. Using the url of the add-on name as the base url.
       * This should be used in development mode.  A new compressor/javascript munger process will ensure that the
       * components are put together into the plugin.js file and compressed correctly.
       *
       * @method addComponents
       * @param {String} pluginName name of the plugin to load scripts from (will be used to get the base url for the plugins).
       * @param {Array} scripts Array containing the names of the scripts to load.
       */
      addComponents: function (pluginName, scripts) {
        var pluginUrl = this.urls[pluginName];

        each(scripts, function (script) {
          ScriptLoader.ScriptLoader.add(pluginUrl + "/" + script);
        });
      },

      /**
       * Loads an add-on from a specific url.
       *
       * @method load
       * @param {String} name Short name of the add-on that gets loaded.
       * @param {String} addOnUrl URL to the add-on that will get loaded.
       * @param {function} success Optional success callback to execute when an add-on is loaded.
       * @param {Object} scope Optional scope to execute the callback in.
       * @param {function} failure Optional failure callback to execute when an add-on failed to load.
       * @example
       * // Loads a plugin from an external URL
       * tinymce.PluginManager.load('myplugin', '/some/dir/someplugin/plugin.js');
       *
       * // Initialize TinyMCE
       * tinymce.init({
       *  ...
       *  plugins: '-myplugin' // Don't try to load it again
       * });
       */
      load: function (name, addOnUrl, success, scope, failure) {
        var self = this, url = addOnUrl;

        function loadDependencies() {
          var dependencies = self.dependencies(name);

          each(dependencies, function (dep) {
            var newUrl = self.createUrl(addOnUrl, dep);

            self.load(newUrl.resource, newUrl, undefined, undefined);
          });

          if (success) {
            if (scope) {
              success.call(scope);
            } else {
              success.call(ScriptLoader);
            }
          }
        }

        if (self.urls[name]) {
          return;
        }

        if (typeof addOnUrl === "object") {
          url = addOnUrl.prefix + addOnUrl.resource + addOnUrl.suffix;
        }

        if (url.indexOf('/') !== 0 && url.indexOf('://') == -1) {
          url = AddOnManager.baseURL + '/' + url;
        }

        self.urls[name] = url.substring(0, url.lastIndexOf('/'));

        if (self.lookup[name]) {
          loadDependencies();
        } else {
          ScriptLoader.ScriptLoader.add(url, loadDependencies, scope, failure);
        }
      }
    };

    AddOnManager.PluginManager = new AddOnManager();
    AddOnManager.ThemeManager = new AddOnManager();

    return AddOnManager;
  }
);

/**
 * TinyMCE theme class.
 *
 * @class tinymce.Theme
 */

/**
 * This method is responsible for rendering/generating the overall user interface with toolbars, buttons, iframe containers etc.
 *
 * @method renderUI
 * @param {Object} obj Object parameter containing the targetNode DOM node that will be replaced visually with an editor instance.
 * @return {Object} an object with items like iframeContainer, editorContainer, sizeContainer, deltaWidth, deltaHeight.
 */

/**
 * Plugin base class, this is a pseudo class that describes how a plugin is to be created for TinyMCE. The methods below are all optional.
 *
 * @class tinymce.Plugin
 * @example
 * tinymce.PluginManager.add('example', function(editor, url) {
 *     // Add a button that opens a window
 *     editor.addButton('example', {
 *         text: 'My button',
 *         icon: false,
 *         onclick: function() {
 *             // Open window
 *             editor.windowManager.open({
 *                 title: 'Example plugin',
 *                 body: [
 *                     {type: 'textbox', name: 'title', label: 'Title'}
 *                 ],
 *                 onsubmit: function(e) {
 *                     // Insert content when the window form is submitted
 *                     editor.insertContent('Title: ' + e.data.title);
 *                 }
 *             });
 *         }
 *     });
 *
 *     // Adds a menu item to the tools menu
 *     editor.addMenuItem('example', {
 *         text: 'Example plugin',
 *         context: 'tools',
 *         onclick: function() {
 *             // Open window with a specific url
 *             editor.windowManager.open({
 *                 title: 'TinyMCE site',
 *                 url: 'http://www.tinymce.com',
 *                 width: 800,
 *                 height: 600,
 *                 buttons: [{
 *                     text: 'Close',
 *                     onclick: 'close'
 *                 }]
 *             });
 *         }
 *     });
 * });
 */

/**
 * NodeType.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Contains various node validation functions.
 *
 * @private
 * @class tinymce.dom.NodeType
 */
define(
  'tinymce.core.dom.NodeType',
  [
  ],
  function () {
    function isNodeType(type) {
      return function (node) {
        return !!node && node.nodeType == type;
      };
    }

    var isElement = isNodeType(1);

    function matchNodeNames(names) {
      names = names.toLowerCase().split(' ');

      return function (node) {
        var i, name;

        if (node && node.nodeType) {
          name = node.nodeName.toLowerCase();

          for (i = 0; i < names.length; i++) {
            if (name === names[i]) {
              return true;
            }
          }
        }

        return false;
      };
    }

    function matchStyleValues(name, values) {
      values = values.toLowerCase().split(' ');

      return function (node) {
        var i, cssValue;

        if (isElement(node)) {
          for (i = 0; i < values.length; i++) {
            cssValue = node.ownerDocument.defaultView.getComputedStyle(node, null).getPropertyValue(name);
            if (cssValue === values[i]) {
              return true;
            }
          }
        }

        return false;
      };
    }

    function hasPropValue(propName, propValue) {
      return function (node) {
        return isElement(node) && node[propName] === propValue;
      };
    }

    function hasAttribute(attrName, attrValue) {
      return function (node) {
        return isElement(node) && node.hasAttribute(attrName);
      };
    }

    function hasAttributeValue(attrName, attrValue) {
      return function (node) {
        return isElement(node) && node.getAttribute(attrName) === attrValue;
      };
    }

    function isBogus(node) {
      return isElement(node) && node.hasAttribute('data-mce-bogus');
    }

    function hasContentEditableState(value) {
      return function (node) {
        if (isElement(node)) {
          if (node.contentEditable === value) {
            return true;
          }

          if (node.getAttribute('data-mce-contenteditable') === value) {
            return true;
          }
        }

        return false;
      };
    }

    return {
      isText: isNodeType(3),
      isElement: isElement,
      isComment: isNodeType(8),
      isBr: matchNodeNames('br'),
      isContentEditableTrue: hasContentEditableState('true'),
      isContentEditableFalse: hasContentEditableState('false'),
      matchNodeNames: matchNodeNames,
      hasPropValue: hasPropValue,
      hasAttribute: hasAttribute,
      hasAttributeValue: hasAttributeValue,
      matchStyleValues: matchStyleValues,
      isBogus: isBogus
    };
  }
);
/**
 * Zwsp.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Utility functions for working with zero width space
 * characters used as character containers etc.
 *
 * @private
 * @class tinymce.text.Zwsp
 * @example
 * var isZwsp = Zwsp.isZwsp('\uFEFF');
 * var abc = Zwsp.trim('a\uFEFFc');
 */
define(
  'tinymce.core.text.Zwsp',
  [
  ],
  function () {
    // This is technically not a ZWSP but a ZWNBSP or a BYTE ORDER MARK it used to be a ZWSP
    var ZWSP = '\uFEFF';

    var isZwsp = function (chr) {
      return chr === ZWSP;
    };

    var trim = function (text) {
      return text.replace(new RegExp(ZWSP, 'g'), '');
    };

    return {
      isZwsp: isZwsp,
      ZWSP: ZWSP,
      trim: trim
    };
  }
);
/**
 * CaretContainer.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This module handles caret containers. A caret container is a node that
 * holds the caret for positional purposes.
 *
 * @private
 * @class tinymce.caret.CaretContainer
 */
define(
  'tinymce.core.caret.CaretContainer',
  [
    "tinymce.core.dom.NodeType",
    "tinymce.core.text.Zwsp"
  ],
  function (NodeType, Zwsp) {
    var isElement = NodeType.isElement,
      isText = NodeType.isText;

    function isCaretContainerBlock(node) {
      if (isText(node)) {
        node = node.parentNode;
      }

      return isElement(node) && node.hasAttribute('data-mce-caret');
    }

    function isCaretContainerInline(node) {
      return isText(node) && Zwsp.isZwsp(node.data);
    }

    function isCaretContainer(node) {
      return isCaretContainerBlock(node) || isCaretContainerInline(node);
    }

    var hasContent = function (node) {
      return node.firstChild !== node.lastChild || !NodeType.isBr(node.firstChild);
    };

    function insertInline(node, before) {
      var doc, sibling, textNode, parentNode;

      doc = node.ownerDocument;
      textNode = doc.createTextNode(Zwsp.ZWSP);
      parentNode = node.parentNode;

      if (!before) {
        sibling = node.nextSibling;
        if (isText(sibling)) {
          if (isCaretContainer(sibling)) {
            return sibling;
          }

          if (startsWithCaretContainer(sibling)) {
            sibling.splitText(1);
            return sibling;
          }
        }

        if (node.nextSibling) {
          parentNode.insertBefore(textNode, node.nextSibling);
        } else {
          parentNode.appendChild(textNode);
        }
      } else {
        sibling = node.previousSibling;
        if (isText(sibling)) {
          if (isCaretContainer(sibling)) {
            return sibling;
          }

          if (endsWithCaretContainer(sibling)) {
            return sibling.splitText(sibling.data.length - 1);
          }
        }

        parentNode.insertBefore(textNode, node);
      }

      return textNode;
    }

    var prependInline = function (node) {
      if (NodeType.isText(node)) {
        var data = node.data;
        if (data.length > 0 && data.charAt(0) !== Zwsp.ZWSP) {
          node.insertData(0, Zwsp.ZWSP);
        }
        return node;
      } else {
        return null;
      }
    };

    var appendInline = function (node) {
      if (NodeType.isText(node)) {
        var data = node.data;
        if (data.length > 0 && data.charAt(data.length - 1) !== Zwsp.ZWSP) {
          node.insertData(data.length, Zwsp.ZWSP);
        }
        return node;
      } else {
        return null;
      }
    };

    var isBeforeInline = function (pos) {
      return pos && NodeType.isText(pos.container()) && pos.container().data.charAt(pos.offset()) === Zwsp.ZWSP;
    };

    var isAfterInline = function (pos) {
      return pos && NodeType.isText(pos.container()) && pos.container().data.charAt(pos.offset() - 1) === Zwsp.ZWSP;
    };

    function createBogusBr() {
      var br = document.createElement('br');
      br.setAttribute('data-mce-bogus', '1');
      return br;
    }

    function insertBlock(blockName, node, before) {
      var doc, blockNode, parentNode;

      doc = node.ownerDocument;
      blockNode = doc.createElement(blockName);
      blockNode.setAttribute('data-mce-caret', before ? 'before' : 'after');
      blockNode.setAttribute('data-mce-bogus', 'all');
      blockNode.appendChild(createBogusBr());
      parentNode = node.parentNode;

      if (!before) {
        if (node.nextSibling) {
          parentNode.insertBefore(blockNode, node.nextSibling);
        } else {
          parentNode.appendChild(blockNode);
        }
      } else {
        parentNode.insertBefore(blockNode, node);
      }

      return blockNode;
    }

    function startsWithCaretContainer(node) {
      return isText(node) && node.data[0] == Zwsp.ZWSP;
    }

    function endsWithCaretContainer(node) {
      return isText(node) && node.data[node.data.length - 1] == Zwsp.ZWSP;
    }

    function trimBogusBr(elm) {
      var brs = elm.getElementsByTagName('br');
      var lastBr = brs[brs.length - 1];
      if (NodeType.isBogus(lastBr)) {
        lastBr.parentNode.removeChild(lastBr);
      }
    }

    function showCaretContainerBlock(caretContainer) {
      if (caretContainer && caretContainer.hasAttribute('data-mce-caret')) {
        trimBogusBr(caretContainer);
        caretContainer.removeAttribute('data-mce-caret');
        caretContainer.removeAttribute('data-mce-bogus');
        caretContainer.removeAttribute('style');
        caretContainer.removeAttribute('_moz_abspos');
        return caretContainer;
      }

      return null;
    }

    return {
      isCaretContainer: isCaretContainer,
      isCaretContainerBlock: isCaretContainerBlock,
      isCaretContainerInline: isCaretContainerInline,
      showCaretContainerBlock: showCaretContainerBlock,
      insertInline: insertInline,
      prependInline: prependInline,
      appendInline: appendInline,
      isBeforeInline: isBeforeInline,
      isAfterInline: isAfterInline,
      insertBlock: insertBlock,
      hasContent: hasContent,
      startsWithCaretContainer: startsWithCaretContainer,
      endsWithCaretContainer: endsWithCaretContainer
    };
  }
);
/**
 * RangeUtils.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class contains a few utility methods for ranges.
 *
 * @class tinymce.dom.RangeUtils
 */
define(
  'tinymce.core.dom.RangeUtils',
  [
    "tinymce.core.util.Tools",
    "tinymce.core.dom.TreeWalker",
    "tinymce.core.dom.NodeType",
    "tinymce.core.dom.Range",
    "tinymce.core.caret.CaretContainer"
  ],
  function (Tools, TreeWalker, NodeType, Range, CaretContainer) {
    var each = Tools.each,
      isContentEditableTrue = NodeType.isContentEditableTrue,
      isContentEditableFalse = NodeType.isContentEditableFalse,
      isCaretContainer = CaretContainer.isCaretContainer;

    function hasCeProperty(node) {
      return isContentEditableTrue(node) || isContentEditableFalse(node);
    }

    function getEndChild(container, index) {
      var childNodes = container.childNodes;

      index--;

      if (index > childNodes.length - 1) {
        index = childNodes.length - 1;
      } else if (index < 0) {
        index = 0;
      }

      return childNodes[index] || container;
    }

    function findParent(node, rootNode, predicate) {
      while (node && node !== rootNode) {
        if (predicate(node)) {
          return node;
        }

        node = node.parentNode;
      }

      return null;
    }

    function hasParent(node, rootNode, predicate) {
      return findParent(node, rootNode, predicate) !== null;
    }

    function hasParentWithName(node, rootNode, name) {
      return hasParent(node, rootNode, function (node) {
        return node.nodeName === name;
      });
    }

    function isFormatterCaret(node) {
      return node.id === '_mce_caret';
    }

    function isCeFalseCaretContainer(node, rootNode) {
      return isCaretContainer(node) && hasParent(node, rootNode, isFormatterCaret) === false;
    }

    function RangeUtils(dom) {
      /**
       * Walks the specified range like object and executes the callback for each sibling collection it finds.
       *
       * @private
       * @method walk
       * @param {Object} rng Range like object.
       * @param {function} callback Callback function to execute for each sibling collection.
       */
      this.walk = function (rng, callback) {
        var startContainer = rng.startContainer,
          startOffset = rng.startOffset,
          endContainer = rng.endContainer,
          endOffset = rng.endOffset,
          ancestor, startPoint,
          endPoint, node, parent, siblings, nodes;

        // Handle table cell selection the table plugin enables
        // you to fake select table cells and perform formatting actions on them
        nodes = dom.select('td[data-mce-selected],th[data-mce-selected]');
        if (nodes.length > 0) {
          each(nodes, function (node) {
            callback([node]);
          });

          return;
        }

        /**
         * Excludes start/end text node if they are out side the range
         *
         * @private
         * @param {Array} nodes Nodes to exclude items from.
         * @return {Array} Array with nodes excluding the start/end container if needed.
         */
        function exclude(nodes) {
          var node;

          // First node is excluded
          node = nodes[0];
          if (node.nodeType === 3 && node === startContainer && startOffset >= node.nodeValue.length) {
            nodes.splice(0, 1);
          }

          // Last node is excluded
          node = nodes[nodes.length - 1];
          if (endOffset === 0 && nodes.length > 0 && node === endContainer && node.nodeType === 3) {
            nodes.splice(nodes.length - 1, 1);
          }

          return nodes;
        }

        /**
         * Collects siblings
         *
         * @private
         * @param {Node} node Node to collect siblings from.
         * @param {String} name Name of the sibling to check for.
         * @param {Node} endNode
         * @return {Array} Array of collected siblings.
         */
        function collectSiblings(node, name, endNode) {
          var siblings = [];

          for (; node && node != endNode; node = node[name]) {
            siblings.push(node);
          }

          return siblings;
        }

        /**
         * Find an end point this is the node just before the common ancestor root.
         *
         * @private
         * @param {Node} node Node to start at.
         * @param {Node} root Root/ancestor element to stop just before.
         * @return {Node} Node just before the root element.
         */
        function findEndPoint(node, root) {
          do {
            if (node.parentNode == root) {
              return node;
            }

            node = node.parentNode;
          } while (node);
        }

        function walkBoundary(startNode, endNode, next) {
          var siblingName = next ? 'nextSibling' : 'previousSibling';

          for (node = startNode, parent = node.parentNode; node && node != endNode; node = parent) {
            parent = node.parentNode;
            siblings = collectSiblings(node == startNode ? node : node[siblingName], siblingName);

            if (siblings.length) {
              if (!next) {
                siblings.reverse();
              }

              callback(exclude(siblings));
            }
          }
        }

        // If index based start position then resolve it
        if (startContainer.nodeType == 1 && startContainer.hasChildNodes()) {
          startContainer = startContainer.childNodes[startOffset];
        }

        // If index based end position then resolve it
        if (endContainer.nodeType == 1 && endContainer.hasChildNodes()) {
          endContainer = getEndChild(endContainer, endOffset);
        }

        // Same container
        if (startContainer == endContainer) {
          return callback(exclude([startContainer]));
        }

        // Find common ancestor and end points
        ancestor = dom.findCommonAncestor(startContainer, endContainer);

        // Process left side
        for (node = startContainer; node; node = node.parentNode) {
          if (node === endContainer) {
            return walkBoundary(startContainer, ancestor, true);
          }

          if (node === ancestor) {
            break;
          }
        }

        // Process right side
        for (node = endContainer; node; node = node.parentNode) {
          if (node === startContainer) {
            return walkBoundary(endContainer, ancestor);
          }

          if (node === ancestor) {
            break;
          }
        }

        // Find start/end point
        startPoint = findEndPoint(startContainer, ancestor) || startContainer;
        endPoint = findEndPoint(endContainer, ancestor) || endContainer;

        // Walk left leaf
        walkBoundary(startContainer, startPoint, true);

        // Walk the middle from start to end point
        siblings = collectSiblings(
          startPoint == startContainer ? startPoint : startPoint.nextSibling,
          'nextSibling',
          endPoint == endContainer ? endPoint.nextSibling : endPoint
        );

        if (siblings.length) {
          callback(exclude(siblings));
        }

        // Walk right leaf
        walkBoundary(endContainer, endPoint);
      };

      /**
       * Splits the specified range at it's start/end points.
       *
       * @private
       * @param {Range/RangeObject} rng Range to split.
       * @return {Object} Range position object.
       */
      this.split = function (rng) {
        var startContainer = rng.startContainer,
          startOffset = rng.startOffset,
          endContainer = rng.endContainer,
          endOffset = rng.endOffset;

        function splitText(node, offset) {
          return node.splitText(offset);
        }

        // Handle single text node
        if (startContainer == endContainer && startContainer.nodeType == 3) {
          if (startOffset > 0 && startOffset < startContainer.nodeValue.length) {
            endContainer = splitText(startContainer, startOffset);
            startContainer = endContainer.previousSibling;

            if (endOffset > startOffset) {
              endOffset = endOffset - startOffset;
              startContainer = endContainer = splitText(endContainer, endOffset).previousSibling;
              endOffset = endContainer.nodeValue.length;
              startOffset = 0;
            } else {
              endOffset = 0;
            }
          }
        } else {
          // Split startContainer text node if needed
          if (startContainer.nodeType == 3 && startOffset > 0 && startOffset < startContainer.nodeValue.length) {
            startContainer = splitText(startContainer, startOffset);
            startOffset = 0;
          }

          // Split endContainer text node if needed
          if (endContainer.nodeType == 3 && endOffset > 0 && endOffset < endContainer.nodeValue.length) {
            endContainer = splitText(endContainer, endOffset).previousSibling;
            endOffset = endContainer.nodeValue.length;
          }
        }

        return {
          startContainer: startContainer,
          startOffset: startOffset,
          endContainer: endContainer,
          endOffset: endOffset
        };
      };

      /**
       * Normalizes the specified range by finding the closest best suitable caret location.
       *
       * @private
       * @param {Range} rng Range to normalize.
       * @return {Boolean} True/false if the specified range was normalized or not.
       */
      this.normalize = function (rng) {
        var normalized = false, collapsed;

        function normalizeEndPoint(start) {
          var container, offset, walker, body = dom.getRoot(), node, nonEmptyElementsMap;
          var directionLeft, isAfterNode;

          function isTableCell(node) {
            return node && /^(TD|TH|CAPTION)$/.test(node.nodeName);
          }

          function hasBrBeforeAfter(node, left) {
            var walker = new TreeWalker(node, dom.getParent(node.parentNode, dom.isBlock) || body);

            while ((node = walker[left ? 'prev' : 'next']())) {
              if (node.nodeName === "BR") {
                return true;
              }
            }
          }

          function hasContentEditableFalseParent(node) {
            while (node && node != body) {
              if (isContentEditableFalse(node)) {
                return true;
              }

              node = node.parentNode;
            }

            return false;
          }

          function isPrevNode(node, name) {
            return node.previousSibling && node.previousSibling.nodeName == name;
          }

          // Walks the dom left/right to find a suitable text node to move the endpoint into
          // It will only walk within the current parent block or body and will stop if it hits a block or a BR/IMG
          function findTextNodeRelative(left, startNode) {
            var walker, lastInlineElement, parentBlockContainer;

            startNode = startNode || container;
            parentBlockContainer = dom.getParent(startNode.parentNode, dom.isBlock) || body;

            // Lean left before the BR element if it's the only BR within a block element. Gecko bug: #6680
            // This: <p><br>|</p> becomes <p>|<br></p>
            if (left && startNode.nodeName == 'BR' && isAfterNode && dom.isEmpty(parentBlockContainer)) {
              container = startNode.parentNode;
              offset = dom.nodeIndex(startNode);
              normalized = true;
              return;
            }

            // Walk left until we hit a text node we can move to or a block/br/img
            walker = new TreeWalker(startNode, parentBlockContainer);
            while ((node = walker[left ? 'prev' : 'next']())) {
              // Break if we hit a non content editable node
              if (dom.getContentEditableParent(node) === "false" || isCeFalseCaretContainer(node, dom.getRoot())) {
                return;
              }

              // Found text node that has a length
              if (node.nodeType === 3 && node.nodeValue.length > 0) {
                if (hasParentWithName(node, body, 'A') === false) {
                  container = node;
                  offset = left ? node.nodeValue.length : 0;
                  normalized = true;
                }

                return;
              }

              // Break if we find a block or a BR/IMG/INPUT etc
              if (dom.isBlock(node) || nonEmptyElementsMap[node.nodeName.toLowerCase()]) {
                return;
              }

              lastInlineElement = node;
            }

            // Only fetch the last inline element when in caret mode for now
            if (collapsed && lastInlineElement) {
              container = lastInlineElement;
              normalized = true;
              offset = 0;
            }
          }

          container = rng[(start ? 'start' : 'end') + 'Container'];
          offset = rng[(start ? 'start' : 'end') + 'Offset'];
          isAfterNode = container.nodeType == 1 && offset === container.childNodes.length;
          nonEmptyElementsMap = dom.schema.getNonEmptyElements();
          directionLeft = start;

          if (isCaretContainer(container)) {
            return;
          }

          if (container.nodeType == 1 && offset > container.childNodes.length - 1) {
            directionLeft = false;
          }

          // If the container is a document move it to the body element
          if (container.nodeType === 9) {
            container = dom.getRoot();
            offset = 0;
          }

          // If the container is body try move it into the closest text node or position
          if (container === body) {
            // If start is before/after a image, table etc
            if (directionLeft) {
              node = container.childNodes[offset > 0 ? offset - 1 : 0];
              if (node) {
                if (isCaretContainer(node)) {
                  return;
                }

                if (nonEmptyElementsMap[node.nodeName] || node.nodeName == "TABLE") {
                  return;
                }
              }
            }

            // Resolve the index
            if (container.hasChildNodes()) {
              offset = Math.min(!directionLeft && offset > 0 ? offset - 1 : offset, container.childNodes.length - 1);
              container = container.childNodes[offset];
              offset = 0;

              // Don't normalize non collapsed selections like <p>[a</p><table></table>]
              if (!collapsed && container === body.lastChild && container.nodeName === 'TABLE') {
                return;
              }

              if (hasContentEditableFalseParent(container) || isCaretContainer(container)) {
                return;
              }

              // Don't walk into elements that doesn't have any child nodes like a IMG
              if (container.hasChildNodes() && !/TABLE/.test(container.nodeName)) {
                // Walk the DOM to find a text node to place the caret at or a BR
                node = container;
                walker = new TreeWalker(container, body);

                do {
                  if (isContentEditableFalse(node) || isCaretContainer(node)) {
                    normalized = false;
                    break;
                  }

                  // Found a text node use that position
                  if (node.nodeType === 3 && node.nodeValue.length > 0) {
                    offset = directionLeft ? 0 : node.nodeValue.length;
                    container = node;
                    normalized = true;
                    break;
                  }

                  // Found a BR/IMG element that we can place the caret before
                  if (nonEmptyElementsMap[node.nodeName.toLowerCase()] && !isTableCell(node)) {
                    offset = dom.nodeIndex(node);
                    container = node.parentNode;

                    // Put caret after image when moving the end point
                    if (node.nodeName == "IMG" && !directionLeft) {
                      offset++;
                    }

                    normalized = true;
                    break;
                  }
                } while ((node = (directionLeft ? walker.next() : walker.prev())));
              }
            }
          }

          // Lean the caret to the left if possible
          if (collapsed) {
            // So this: <b>x</b><i>|x</i>
            // Becomes: <b>x|</b><i>x</i>
            // Seems that only gecko has issues with this
            if (container.nodeType === 3 && offset === 0) {
              findTextNodeRelative(true);
            }

            // Lean left into empty inline elements when the caret is before a BR
            // So this: <i><b></b><i>|<br></i>
            // Becomes: <i><b>|</b><i><br></i>
            // Seems that only gecko has issues with this.
            // Special edge case for <p><a>x</a>|<br></p> since we don't want <p><a>x|</a><br></p>
            if (container.nodeType === 1) {
              node = container.childNodes[offset];

              // Offset is after the containers last child
              // then use the previous child for normalization
              if (!node) {
                node = container.childNodes[offset - 1];
              }

              if (node && node.nodeName === 'BR' && !isPrevNode(node, 'A') &&
                !hasBrBeforeAfter(node) && !hasBrBeforeAfter(node, true)) {
                findTextNodeRelative(true, node);
              }
            }
          }

          // Lean the start of the selection right if possible
          // So this: x[<b>x]</b>
          // Becomes: x<b>[x]</b>
          if (directionLeft && !collapsed && container.nodeType === 3 && offset === container.nodeValue.length) {
            findTextNodeRelative(false);
          }

          // Set endpoint if it was normalized
          if (normalized) {
            rng['set' + (start ? 'Start' : 'End')](container, offset);
          }
        }

        collapsed = rng.collapsed;

        normalizeEndPoint(true);

        if (!collapsed) {
          normalizeEndPoint();
        }

        // If it was collapsed then make sure it still is
        if (normalized && collapsed) {
          rng.collapse(true);
        }

        return normalized;
      };
    }

    /**
     * Compares two ranges and checks if they are equal.
     *
     * @static
     * @method compareRanges
     * @param {DOMRange} rng1 First range to compare.
     * @param {DOMRange} rng2 First range to compare.
     * @return {Boolean} true/false if the ranges are equal.
     */
    RangeUtils.compareRanges = function (rng1, rng2) {
      if (rng1 && rng2) {
        // Compare native IE ranges
        if (rng1.item || rng1.duplicate) {
          // Both are control ranges and the selected element matches
          if (rng1.item && rng2.item && rng1.item(0) === rng2.item(0)) {
            return true;
          }

          // Both are text ranges and the range matches
          if (rng1.isEqual && rng2.isEqual && rng2.isEqual(rng1)) {
            return true;
          }
        } else {
          // Compare w3c ranges
          return rng1.startContainer == rng2.startContainer && rng1.startOffset == rng2.startOffset;
        }
      }

      return false;
    };

    /**
     * Finds the closest selection rect tries to get the range from that.
     */
    function findClosestIeRange(clientX, clientY, doc) {
      var element, rng, rects;

      element = doc.elementFromPoint(clientX, clientY);
      rng = doc.body.createTextRange();

      if (!element || element.tagName == 'HTML') {
        element = doc.body;
      }

      rng.moveToElementText(element);
      rects = Tools.toArray(rng.getClientRects());

      rects = rects.sort(function (a, b) {
        a = Math.abs(Math.max(a.top - clientY, a.bottom - clientY));
        b = Math.abs(Math.max(b.top - clientY, b.bottom - clientY));

        return a - b;
      });

      if (rects.length > 0) {
        clientY = (rects[0].bottom + rects[0].top) / 2;

        try {
          rng.moveToPoint(clientX, clientY);
          rng.collapse(true);

          return rng;
        } catch (ex) {
          // At least we tried
        }
      }

      return null;
    }

    function moveOutOfContentEditableFalse(rng, rootNode) {
      var parentElement = rng && rng.parentElement ? rng.parentElement() : null;
      return isContentEditableFalse(findParent(parentElement, rootNode, hasCeProperty)) ? null : rng;
    }

    /**
     * Gets the caret range for the given x/y location.
     *
     * @static
     * @method getCaretRangeFromPoint
     * @param {Number} clientX X coordinate for range
     * @param {Number} clientY Y coordinate for range
     * @param {Document} doc Document that x/y are relative to
     * @returns {Range} caret range
     */
    RangeUtils.getCaretRangeFromPoint = function (clientX, clientY, doc) {
      var rng, point;

      if (doc.caretPositionFromPoint) {
        point = doc.caretPositionFromPoint(clientX, clientY);
        rng = doc.createRange();
        rng.setStart(point.offsetNode, point.offset);
        rng.collapse(true);
      } else if (doc.caretRangeFromPoint) {
        rng = doc.caretRangeFromPoint(clientX, clientY);
      } else if (doc.body.createTextRange) {
        rng = doc.body.createTextRange();

        try {
          rng.moveToPoint(clientX, clientY);
          rng.collapse(true);
        } catch (ex) {
          rng = findClosestIeRange(clientX, clientY, doc);
        }

        return moveOutOfContentEditableFalse(rng, doc.body);
      }

      return rng;
    };

    RangeUtils.getSelectedNode = function (range) {
      var startContainer = range.startContainer,
        startOffset = range.startOffset;

      if (startContainer.hasChildNodes() && range.endOffset == startOffset + 1) {
        return startContainer.childNodes[startOffset];
      }

      return null;
    };

    RangeUtils.getNode = function (container, offset) {
      if (container.nodeType == 1 && container.hasChildNodes()) {
        if (offset >= container.childNodes.length) {
          offset = container.childNodes.length - 1;
        }

        container = container.childNodes[offset];
      }

      return container;
    };

    return RangeUtils;
  }
);

/**
 * Node.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class is a minimalistic implementation of a DOM like node used by the DomParser class.
 *
 * @example
 * var node = new tinymce.html.Node('strong', 1);
 * someRoot.append(node);
 *
 * @class tinymce.html.Node
 * @version 3.4
 */
define(
  'tinymce.core.html.Node',
  [
  ],
  function () {
    var whiteSpaceRegExp = /^[ \t\r\n]*$/;
    var typeLookup = {
      '#text': 3,
      '#comment': 8,
      '#cdata': 4,
      '#pi': 7,
      '#doctype': 10,
      '#document-fragment': 11
    };

    // Walks the tree left/right
    function walk(node, rootNode, prev) {
      var sibling, parent, startName = prev ? 'lastChild' : 'firstChild', siblingName = prev ? 'prev' : 'next';

      // Walk into nodes if it has a start
      if (node[startName]) {
        return node[startName];
      }

      // Return the sibling if it has one
      if (node !== rootNode) {
        sibling = node[siblingName];

        if (sibling) {
          return sibling;
        }

        // Walk up the parents to look for siblings
        for (parent = node.parent; parent && parent !== rootNode; parent = parent.parent) {
          sibling = parent[siblingName];

          if (sibling) {
            return sibling;
          }
        }
      }
    }

    /**
     * Constructs a new Node instance.
     *
     * @constructor
     * @method Node
     * @param {String} name Name of the node type.
     * @param {Number} type Numeric type representing the node.
     */
    function Node(name, type) {
      this.name = name;
      this.type = type;

      if (type === 1) {
        this.attributes = [];
        this.attributes.map = {};
      }
    }

    Node.prototype = {
      /**
       * Replaces the current node with the specified one.
       *
       * @example
       * someNode.replace(someNewNode);
       *
       * @method replace
       * @param {tinymce.html.Node} node Node to replace the current node with.
       * @return {tinymce.html.Node} The old node that got replaced.
       */
      replace: function (node) {
        var self = this;

        if (node.parent) {
          node.remove();
        }

        self.insert(node, self);
        self.remove();

        return self;
      },

      /**
       * Gets/sets or removes an attribute by name.
       *
       * @example
       * someNode.attr("name", "value"); // Sets an attribute
       * console.log(someNode.attr("name")); // Gets an attribute
       * someNode.attr("name", null); // Removes an attribute
       *
       * @method attr
       * @param {String} name Attribute name to set or get.
       * @param {String} value Optional value to set.
       * @return {String/tinymce.html.Node} String or undefined on a get operation or the current node on a set operation.
       */
      attr: function (name, value) {
        var self = this, attrs, i, undef;

        if (typeof name !== "string") {
          for (i in name) {
            self.attr(i, name[i]);
          }

          return self;
        }

        if ((attrs = self.attributes)) {
          if (value !== undef) {
            // Remove attribute
            if (value === null) {
              if (name in attrs.map) {
                delete attrs.map[name];

                i = attrs.length;
                while (i--) {
                  if (attrs[i].name === name) {
                    attrs = attrs.splice(i, 1);
                    return self;
                  }
                }
              }

              return self;
            }

            // Set attribute
            if (name in attrs.map) {
              // Set attribute
              i = attrs.length;
              while (i--) {
                if (attrs[i].name === name) {
                  attrs[i].value = value;
                  break;
                }
              }
            } else {
              attrs.push({ name: name, value: value });
            }

            attrs.map[name] = value;

            return self;
          }

          return attrs.map[name];
        }
      },

      /**
       * Does a shallow clones the node into a new node. It will also exclude id attributes since
       * there should only be one id per document.
       *
       * @example
       * var clonedNode = node.clone();
       *
       * @method clone
       * @return {tinymce.html.Node} New copy of the original node.
       */
      clone: function () {
        var self = this, clone = new Node(self.name, self.type), i, l, selfAttrs, selfAttr, cloneAttrs;

        // Clone element attributes
        if ((selfAttrs = self.attributes)) {
          cloneAttrs = [];
          cloneAttrs.map = {};

          for (i = 0, l = selfAttrs.length; i < l; i++) {
            selfAttr = selfAttrs[i];

            // Clone everything except id
            if (selfAttr.name !== 'id') {
              cloneAttrs[cloneAttrs.length] = { name: selfAttr.name, value: selfAttr.value };
              cloneAttrs.map[selfAttr.name] = selfAttr.value;
            }
          }

          clone.attributes = cloneAttrs;
        }

        clone.value = self.value;
        clone.shortEnded = self.shortEnded;

        return clone;
      },

      /**
       * Wraps the node in in another node.
       *
       * @example
       * node.wrap(wrapperNode);
       *
       * @method wrap
       */
      wrap: function (wrapper) {
        var self = this;

        self.parent.insert(wrapper, self);
        wrapper.append(self);

        return self;
      },

      /**
       * Unwraps the node in other words it removes the node but keeps the children.
       *
       * @example
       * node.unwrap();
       *
       * @method unwrap
       */
      unwrap: function () {
        var self = this, node, next;

        for (node = self.firstChild; node;) {
          next = node.next;
          self.insert(node, self, true);
          node = next;
        }

        self.remove();
      },

      /**
       * Removes the node from it's parent.
       *
       * @example
       * node.remove();
       *
       * @method remove
       * @return {tinymce.html.Node} Current node that got removed.
       */
      remove: function () {
        var self = this, parent = self.parent, next = self.next, prev = self.prev;

        if (parent) {
          if (parent.firstChild === self) {
            parent.firstChild = next;

            if (next) {
              next.prev = null;
            }
          } else {
            prev.next = next;
          }

          if (parent.lastChild === self) {
            parent.lastChild = prev;

            if (prev) {
              prev.next = null;
            }
          } else {
            next.prev = prev;
          }

          self.parent = self.next = self.prev = null;
        }

        return self;
      },

      /**
       * Appends a new node as a child of the current node.
       *
       * @example
       * node.append(someNode);
       *
       * @method append
       * @param {tinymce.html.Node} node Node to append as a child of the current one.
       * @return {tinymce.html.Node} The node that got appended.
       */
      append: function (node) {
        var self = this, last;

        if (node.parent) {
          node.remove();
        }

        last = self.lastChild;
        if (last) {
          last.next = node;
          node.prev = last;
          self.lastChild = node;
        } else {
          self.lastChild = self.firstChild = node;
        }

        node.parent = self;

        return node;
      },

      /**
       * Inserts a node at a specific position as a child of the current node.
       *
       * @example
       * parentNode.insert(newChildNode, oldChildNode);
       *
       * @method insert
       * @param {tinymce.html.Node} node Node to insert as a child of the current node.
       * @param {tinymce.html.Node} refNode Reference node to set node before/after.
       * @param {Boolean} before Optional state to insert the node before the reference node.
       * @return {tinymce.html.Node} The node that got inserted.
       */
      insert: function (node, refNode, before) {
        var parent;

        if (node.parent) {
          node.remove();
        }

        parent = refNode.parent || this;

        if (before) {
          if (refNode === parent.firstChild) {
            parent.firstChild = node;
          } else {
            refNode.prev.next = node;
          }

          node.prev = refNode.prev;
          node.next = refNode;
          refNode.prev = node;
        } else {
          if (refNode === parent.lastChild) {
            parent.lastChild = node;
          } else {
            refNode.next.prev = node;
          }

          node.next = refNode.next;
          node.prev = refNode;
          refNode.next = node;
        }

        node.parent = parent;

        return node;
      },

      /**
       * Get all children by name.
       *
       * @method getAll
       * @param {String} name Name of the child nodes to collect.
       * @return {Array} Array with child nodes matchin the specified name.
       */
      getAll: function (name) {
        var self = this, node, collection = [];

        for (node = self.firstChild; node; node = walk(node, self)) {
          if (node.name === name) {
            collection.push(node);
          }
        }

        return collection;
      },

      /**
       * Removes all children of the current node.
       *
       * @method empty
       * @return {tinymce.html.Node} The current node that got cleared.
       */
      empty: function () {
        var self = this, nodes, i, node;

        // Remove all children
        if (self.firstChild) {
          nodes = [];

          // Collect the children
          for (node = self.firstChild; node; node = walk(node, self)) {
            nodes.push(node);
          }

          // Remove the children
          i = nodes.length;
          while (i--) {
            node = nodes[i];
            node.parent = node.firstChild = node.lastChild = node.next = node.prev = null;
          }
        }

        self.firstChild = self.lastChild = null;

        return self;
      },

      /**
       * Returns true/false if the node is to be considered empty or not.
       *
       * @example
       * node.isEmpty({img: true});
       * @method isEmpty
       * @param {Object} elements Name/value object with elements that are automatically treated as non empty elements.
       * @param {Object} whitespace Name/value object with elements that are automatically treated whitespace preservables.
       * @return {Boolean} true/false if the node is empty or not.
       */
      isEmpty: function (elements, whitespace) {
        var self = this, node = self.firstChild, i, name;

        whitespace = whitespace || {};

        if (node) {
          do {
            if (node.type === 1) {
              // Ignore bogus elements
              if (node.attributes.map['data-mce-bogus']) {
                continue;
              }

              // Keep empty elements like <img />
              if (elements[node.name]) {
                return false;
              }

              // Keep bookmark nodes and name attribute like <a name="1"></a>
              i = node.attributes.length;
              while (i--) {
                name = node.attributes[i].name;
                if (name === "name" || name.indexOf('data-mce-bookmark') === 0) {
                  return false;
                }
              }
            }

            // Keep comments
            if (node.type === 8) {
              return false;
            }

            // Keep non whitespace text nodes
            if (node.type === 3 && !whiteSpaceRegExp.test(node.value)) {
              return false;
            }

            // Keep whitespace preserve elements
            if (node.type === 3 && node.parent && whitespace[node.parent.name] && whiteSpaceRegExp.test(node.value)) {
              return false;
            }
          } while ((node = walk(node, self)));
        }

        return true;
      },

      /**
       * Walks to the next or previous node and returns that node or null if it wasn't found.
       *
       * @method walk
       * @param {Boolean} prev Optional previous node state defaults to false.
       * @return {tinymce.html.Node} Node that is next to or previous of the current node.
       */
      walk: function (prev) {
        return walk(this, null, prev);
      }
    };

    /**
     * Creates a node of a specific type.
     *
     * @static
     * @method create
     * @param {String} name Name of the node type to create for example "b" or "#text".
     * @param {Object} attrs Name/value collection of attributes that will be applied to elements.
     */
    Node.create = function (name, attrs) {
      var node, attrName;

      // Create node
      node = new Node(name, typeLookup[name] || 1);

      // Add attributes if needed
      if (attrs) {
        for (attrName in attrs) {
          node.attr(attrName, attrs[attrName]);
        }
      }

      return node;
    };

    return Node;
  }
);

/**
 * SaxParser.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/*eslint max-depth:[2, 9] */

/**
 * This class parses HTML code using pure JavaScript and executes various events for each item it finds. It will
 * always execute the events in the right order for tag soup code like <b><p></b></p>. It will also remove elements
 * and attributes that doesn't fit the schema if the validate setting is enabled.
 *
 * @example
 * var parser = new tinymce.html.SaxParser({
 *     validate: true,
 *
 *     comment: function(text) {
 *         console.log('Comment:', text);
 *     },
 *
 *     cdata: function(text) {
 *         console.log('CDATA:', text);
 *     },
 *
 *     text: function(text, raw) {
 *         console.log('Text:', text, 'Raw:', raw);
 *     },
 *
 *     start: function(name, attrs, empty) {
 *         console.log('Start:', name, attrs, empty);
 *     },
 *
 *     end: function(name) {
 *         console.log('End:', name);
 *     },
 *
 *     pi: function(name, text) {
 *         console.log('PI:', name, text);
 *     },
 *
 *     doctype: function(text) {
 *         console.log('DocType:', text);
 *     }
 * }, schema);
 * @class tinymce.html.SaxParser
 * @version 3.4
 */
define(
  'tinymce.core.html.SaxParser',
  [
    "tinymce.core.html.Schema",
    "tinymce.core.html.Entities",
    "tinymce.core.util.Tools"
  ],
  function (Schema, Entities, Tools) {
    var each = Tools.each;

    var isValidPrefixAttrName = function (name) {
      return name.indexOf('data-') === 0 || name.indexOf('aria-') === 0;
    };

    var trimComments = function (text) {
      return text.replace(/<!--|-->/g, '');
    };

    /**
     * Returns the index of the end tag for a specific start tag. This can be
     * used to skip all children of a parent element from being processed.
     *
     * @private
     * @method findEndTag
     * @param {tinymce.html.Schema} schema Schema instance to use to match short ended elements.
     * @param {String} html HTML string to find the end tag in.
     * @param {Number} startIndex Indext to start searching at should be after the start tag.
     * @return {Number} Index of the end tag.
     */
    function findEndTag(schema, html, startIndex) {
      var count = 1, index, matches, tokenRegExp, shortEndedElements;

      shortEndedElements = schema.getShortEndedElements();
      tokenRegExp = /<([!?\/])?([A-Za-z0-9\-_\:\.]+)((?:\s+[^"\'>]+(?:(?:"[^"]*")|(?:\'[^\']*\')|[^>]*))*|\/|\s+)>/g;
      tokenRegExp.lastIndex = index = startIndex;

      while ((matches = tokenRegExp.exec(html))) {
        index = tokenRegExp.lastIndex;

        if (matches[1] === '/') { // End element
          count--;
        } else if (!matches[1]) { // Start element
          if (matches[2] in shortEndedElements) {
            continue;
          }

          count++;
        }

        if (count === 0) {
          break;
        }
      }

      return index;
    }

    /**
     * Constructs a new SaxParser instance.
     *
     * @constructor
     * @method SaxParser
     * @param {Object} settings Name/value collection of settings. comment, cdata, text, start and end are callbacks.
     * @param {tinymce.html.Schema} schema HTML Schema class to use when parsing.
     */
    function SaxParser(settings, schema) {
      var self = this;

      function noop() { }

      settings = settings || {};
      self.schema = schema = schema || new Schema();

      if (settings.fix_self_closing !== false) {
        settings.fix_self_closing = true;
      }

      // Add handler functions from settings and setup default handlers
      each('comment cdata text start end pi doctype'.split(' '), function (name) {
        if (name) {
          self[name] = settings[name] || noop;
        }
      });

      /**
       * Parses the specified HTML string and executes the callbacks for each item it finds.
       *
       * @example
       * new SaxParser({...}).parse('<b>text</b>');
       * @method parse
       * @param {String} html Html string to sax parse.
       */
      self.parse = function (html) {
        var self = this, matches, index = 0, value, endRegExp, stack = [], attrList, i, text, name;
        var isInternalElement, removeInternalElements, shortEndedElements, fillAttrsMap, isShortEnded;
        var validate, elementRule, isValidElement, attr, attribsValue, validAttributesMap, validAttributePatterns;
        var attributesRequired, attributesDefault, attributesForced, processHtml;
        var anyAttributesRequired, selfClosing, tokenRegExp, attrRegExp, specialElements, attrValue, idCount = 0;
        var decode = Entities.decode, fixSelfClosing, filteredUrlAttrs = Tools.makeMap('src,href,data,background,formaction,poster');
        var scriptUriRegExp = /((java|vb)script|mhtml):/i, dataUriRegExp = /^data:/i;

        function processEndTag(name) {
          var pos, i;

          // Find position of parent of the same type
          pos = stack.length;
          while (pos--) {
            if (stack[pos].name === name) {
              break;
            }
          }

          // Found parent
          if (pos >= 0) {
            // Close all the open elements
            for (i = stack.length - 1; i >= pos; i--) {
              name = stack[i];

              if (name.valid) {
                self.end(name.name);
              }
            }

            // Remove the open elements from the stack
            stack.length = pos;
          }
        }

        function parseAttribute(match, name, value, val2, val3) {
          var attrRule, i, trimRegExp = /[\s\u0000-\u001F]+/g;

          name = name.toLowerCase();
          value = name in fillAttrsMap ? name : decode(value || val2 || val3 || ''); // Handle boolean attribute than value attribute

          // Validate name and value pass through all data- attributes
          if (validate && !isInternalElement && isValidPrefixAttrName(name) === false) {
            attrRule = validAttributesMap[name];

            // Find rule by pattern matching
            if (!attrRule && validAttributePatterns) {
              i = validAttributePatterns.length;
              while (i--) {
                attrRule = validAttributePatterns[i];
                if (attrRule.pattern.test(name)) {
                  break;
                }
              }

              // No rule matched
              if (i === -1) {
                attrRule = null;
              }
            }

            // No attribute rule found
            if (!attrRule) {
              return;
            }

            // Validate value
            if (attrRule.validValues && !(value in attrRule.validValues)) {
              return;
            }
          }

          // Block any javascript: urls or non image data uris
          if (filteredUrlAttrs[name] && !settings.allow_script_urls) {
            var uri = value.replace(trimRegExp, '');

            try {
              // Might throw malformed URI sequence
              uri = decodeURIComponent(uri);
            } catch (ex) {
              // Fallback to non UTF-8 decoder
              uri = unescape(uri);
            }

            if (scriptUriRegExp.test(uri)) {
              return;
            }

            if (!settings.allow_html_data_urls && dataUriRegExp.test(uri) && !/^data:image\//i.test(uri)) {
              return;
            }
          }

          // Block data or event attributes on elements marked as internal
          if (isInternalElement && (name in filteredUrlAttrs || name.indexOf('on') === 0)) {
            return;
          }

          // Add attribute to list and map
          attrList.map[name] = value;
          attrList.push({
            name: name,
            value: value
          });
        }

        // Precompile RegExps and map objects
        tokenRegExp = new RegExp('<(?:' +
          '(?:!--([\\w\\W]*?)-->)|' + // Comment
          '(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|' + // CDATA
          '(?:!DOCTYPE([\\w\\W]*?)>)|' + // DOCTYPE
          '(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|' + // PI
          '(?:\\/([A-Za-z][A-Za-z0-9\\-_\\:\\.]*)>)|' + // End element
          '(?:([A-Za-z][A-Za-z0-9\\-_\\:\\.]*)((?:\\s+[^"\'>]+(?:(?:"[^"]*")|(?:\'[^\']*\')|[^>]*))*|\\/|\\s+)>)' + // Start element
          ')', 'g');

        attrRegExp = /([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g;

        // Setup lookup tables for empty elements and boolean attributes
        shortEndedElements = schema.getShortEndedElements();
        selfClosing = settings.self_closing_elements || schema.getSelfClosingElements();
        fillAttrsMap = schema.getBoolAttrs();
        validate = settings.validate;
        removeInternalElements = settings.remove_internals;
        fixSelfClosing = settings.fix_self_closing;
        specialElements = schema.getSpecialElements();
        processHtml = html + '>';

        while ((matches = tokenRegExp.exec(processHtml))) { // Adds and extra '>' to keep regexps from doing catastrofic backtracking on malformed html
          // Text
          if (index < matches.index) {
            self.text(decode(html.substr(index, matches.index - index)));
          }

          if ((value = matches[6])) { // End element
            value = value.toLowerCase();

            // IE will add a ":" in front of elements it doesn't understand like custom elements or HTML5 elements
            if (value.charAt(0) === ':') {
              value = value.substr(1);
            }

            processEndTag(value);
          } else if ((value = matches[7])) { // Start element
            // Did we consume the extra character then treat it as text
            // This handles the case with html like this: "text a<b text"
            if (matches.index + matches[0].length > html.length) {
              self.text(decode(html.substr(matches.index)));
              index = matches.index + matches[0].length;
              continue;
            }

            value = value.toLowerCase();

            // IE will add a ":" in front of elements it doesn't understand like custom elements or HTML5 elements
            if (value.charAt(0) === ':') {
              value = value.substr(1);
            }

            isShortEnded = value in shortEndedElements;

            // Is self closing tag for example an <li> after an open <li>
            if (fixSelfClosing && selfClosing[value] && stack.length > 0 && stack[stack.length - 1].name === value) {
              processEndTag(value);
            }

            // Validate element
            if (!validate || (elementRule = schema.getElementRule(value))) {
              isValidElement = true;

              // Grab attributes map and patters when validation is enabled
              if (validate) {
                validAttributesMap = elementRule.attributes;
                validAttributePatterns = elementRule.attributePatterns;
              }

              // Parse attributes
              if ((attribsValue = matches[8])) {
                isInternalElement = attribsValue.indexOf('data-mce-type') !== -1; // Check if the element is an internal element

                // If the element has internal attributes then remove it if we are told to do so
                if (isInternalElement && removeInternalElements) {
                  isValidElement = false;
                }

                attrList = [];
                attrList.map = {};

                attribsValue.replace(attrRegExp, parseAttribute);
              } else {
                attrList = [];
                attrList.map = {};
              }

              // Process attributes if validation is enabled
              if (validate && !isInternalElement) {
                attributesRequired = elementRule.attributesRequired;
                attributesDefault = elementRule.attributesDefault;
                attributesForced = elementRule.attributesForced;
                anyAttributesRequired = elementRule.removeEmptyAttrs;

                // Check if any attribute exists
                if (anyAttributesRequired && !attrList.length) {
                  isValidElement = false;
                }

                // Handle forced attributes
                if (attributesForced) {
                  i = attributesForced.length;
                  while (i--) {
                    attr = attributesForced[i];
                    name = attr.name;
                    attrValue = attr.value;

                    if (attrValue === '{$uid}') {
                      attrValue = 'mce_' + idCount++;
                    }

                    attrList.map[name] = attrValue;
                    attrList.push({ name: name, value: attrValue });
                  }
                }

                // Handle default attributes
                if (attributesDefault) {
                  i = attributesDefault.length;
                  while (i--) {
                    attr = attributesDefault[i];
                    name = attr.name;

                    if (!(name in attrList.map)) {
                      attrValue = attr.value;

                      if (attrValue === '{$uid}') {
                        attrValue = 'mce_' + idCount++;
                      }

                      attrList.map[name] = attrValue;
                      attrList.push({ name: name, value: attrValue });
                    }
                  }
                }

                // Handle required attributes
                if (attributesRequired) {
                  i = attributesRequired.length;
                  while (i--) {
                    if (attributesRequired[i] in attrList.map) {
                      break;
                    }
                  }

                  // None of the required attributes where found
                  if (i === -1) {
                    isValidElement = false;
                  }
                }

                // Invalidate element if it's marked as bogus
                if ((attr = attrList.map['data-mce-bogus'])) {
                  if (attr === 'all') {
                    index = findEndTag(schema, html, tokenRegExp.lastIndex);
                    tokenRegExp.lastIndex = index;
                    continue;
                  }

                  isValidElement = false;
                }
              }

              if (isValidElement) {
                self.start(value, attrList, isShortEnded);
              }
            } else {
              isValidElement = false;
            }

            // Treat script, noscript and style a bit different since they may include code that looks like elements
            if ((endRegExp = specialElements[value])) {
              endRegExp.lastIndex = index = matches.index + matches[0].length;

              if ((matches = endRegExp.exec(html))) {
                if (isValidElement) {
                  text = html.substr(index, matches.index - index);
                }

                index = matches.index + matches[0].length;
              } else {
                text = html.substr(index);
                index = html.length;
              }

              if (isValidElement) {
                if (text.length > 0) {
                  self.text(text, true);
                }

                self.end(value);
              }

              tokenRegExp.lastIndex = index;
              continue;
            }

            // Push value on to stack
            if (!isShortEnded) {
              if (!attribsValue || attribsValue.indexOf('/') != attribsValue.length - 1) {
                stack.push({ name: value, valid: isValidElement });
              } else if (isValidElement) {
                self.end(value);
              }
            }
          } else if ((value = matches[1])) { // Comment
            // Padd comment value to avoid browsers from parsing invalid comments as HTML
            if (value.charAt(0) === '>') {
              value = ' ' + value;
            }

            if (!settings.allow_conditional_comments && value.substr(0, 3).toLowerCase() === '[if') {
              value = ' ' + value;
            }

            self.comment(value);
          } else if ((value = matches[2])) { // CDATA
            self.cdata(trimComments(value));
          } else if ((value = matches[3])) { // DOCTYPE
            self.doctype(value);
          } else if ((value = matches[4])) { // PI
            self.pi(value, matches[5]);
          }

          index = matches.index + matches[0].length;
        }

        // Text
        if (index < html.length) {
          self.text(decode(html.substr(index)));
        }

        // Close any open elements
        for (i = stack.length - 1; i >= 0; i--) {
          value = stack[i];

          if (value.valid) {
            self.end(value.name);
          }
        }
      };
    }

    SaxParser.findEndTag = findEndTag;

    return SaxParser;
  }
);
/**
 * DomParser.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class parses HTML code into a DOM like structure of nodes it will remove redundant whitespace and make
 * sure that the node tree is valid according to the specified schema.
 * So for example: <p>a<p>b</p>c</p> will become <p>a</p><p>b</p><p>c</p>
 *
 * @example
 * var parser = new tinymce.html.DomParser({validate: true}, schema);
 * var rootNode = parser.parse('<h1>content</h1>');
 *
 * @class tinymce.html.DomParser
 * @version 3.4
 */
define(
  'tinymce.core.html.DomParser',
  [
    "tinymce.core.html.Node",
    "tinymce.core.html.Schema",
    "tinymce.core.html.SaxParser",
    "tinymce.core.util.Tools"
  ],
  function (Node, Schema, SaxParser, Tools) {
    var makeMap = Tools.makeMap, each = Tools.each, explode = Tools.explode, extend = Tools.extend;

    var paddEmptyNode = function (settings, node) {
      if (settings.padd_empty_with_br) {
        node.empty().append(new Node('br', '1')).shortEnded = true;
      } else {
        node.empty().append(new Node('#text', '3')).value = '\u00a0';
      }
    };

    var hasOnlyChild = function (node, name) {
      return node && node.firstChild === node.lastChild && node.firstChild.name === name;
    };

    /**
     * Constructs a new DomParser instance.
     *
     * @constructor
     * @method DomParser
     * @param {Object} settings Name/value collection of settings. comment, cdata, text, start and end are callbacks.
     * @param {tinymce.html.Schema} schema HTML Schema class to use when parsing.
     */
    return function (settings, schema) {
      var self = this, nodeFilters = {}, attributeFilters = [], matchedNodes = {}, matchedAttributes = {};

      settings = settings || {};
      settings.validate = "validate" in settings ? settings.validate : true;
      settings.root_name = settings.root_name || 'body';
      self.schema = schema = schema || new Schema();

      function fixInvalidChildren(nodes) {
        var ni, node, parent, parents, newParent, currentNode, tempNode, childNode, i;
        var nonEmptyElements, whitespaceElements, nonSplitableElements, textBlockElements, specialElements, sibling, nextNode;

        nonSplitableElements = makeMap('tr,td,th,tbody,thead,tfoot,table');
        nonEmptyElements = schema.getNonEmptyElements();
        whitespaceElements = schema.getWhiteSpaceElements();
        textBlockElements = schema.getTextBlockElements();
        specialElements = schema.getSpecialElements();

        for (ni = 0; ni < nodes.length; ni++) {
          node = nodes[ni];

          // Already removed or fixed
          if (!node.parent || node.fixed) {
            continue;
          }

          // If the invalid element is a text block and the text block is within a parent LI element
          // Then unwrap the first text block and convert other sibling text blocks to LI elements similar to Word/Open Office
          if (textBlockElements[node.name] && node.parent.name == 'li') {
            // Move sibling text blocks after LI element
            sibling = node.next;
            while (sibling) {
              if (textBlockElements[sibling.name]) {
                sibling.name = 'li';
                sibling.fixed = true;
                node.parent.insert(sibling, node.parent);
              } else {
                break;
              }

              sibling = sibling.next;
            }

            // Unwrap current text block
            node.unwrap(node);
            continue;
          }

          // Get list of all parent nodes until we find a valid parent to stick the child into
          parents = [node];
          for (parent = node.parent; parent && !schema.isValidChild(parent.name, node.name) &&
            !nonSplitableElements[parent.name]; parent = parent.parent) {
            parents.push(parent);
          }

          // Found a suitable parent
          if (parent && parents.length > 1) {
            // Reverse the array since it makes looping easier
            parents.reverse();

            // Clone the related parent and insert that after the moved node
            newParent = currentNode = self.filterNode(parents[0].clone());

            // Start cloning and moving children on the left side of the target node
            for (i = 0; i < parents.length - 1; i++) {
              if (schema.isValidChild(currentNode.name, parents[i].name)) {
                tempNode = self.filterNode(parents[i].clone());
                currentNode.append(tempNode);
              } else {
                tempNode = currentNode;
              }

              for (childNode = parents[i].firstChild; childNode && childNode != parents[i + 1];) {
                nextNode = childNode.next;
                tempNode.append(childNode);
                childNode = nextNode;
              }

              currentNode = tempNode;
            }

            if (!newParent.isEmpty(nonEmptyElements, whitespaceElements)) {
              parent.insert(newParent, parents[0], true);
              parent.insert(node, newParent);
            } else {
              parent.insert(node, parents[0], true);
            }

            // Check if the element is empty by looking through it's contents and special treatment for <p><br /></p>
            parent = parents[0];
            if (parent.isEmpty(nonEmptyElements, whitespaceElements) || hasOnlyChild(parent, 'br')) {
              parent.empty().remove();
            }
          } else if (node.parent) {
            // If it's an LI try to find a UL/OL for it or wrap it
            if (node.name === 'li') {
              sibling = node.prev;
              if (sibling && (sibling.name === 'ul' || sibling.name === 'ul')) {
                sibling.append(node);
                continue;
              }

              sibling = node.next;
              if (sibling && (sibling.name === 'ul' || sibling.name === 'ul')) {
                sibling.insert(node, sibling.firstChild, true);
                continue;
              }

              node.wrap(self.filterNode(new Node('ul', 1)));
              continue;
            }

            // Try wrapping the element in a DIV
            if (schema.isValidChild(node.parent.name, 'div') && schema.isValidChild('div', node.name)) {
              node.wrap(self.filterNode(new Node('div', 1)));
            } else {
              // We failed wrapping it, then remove or unwrap it
              if (specialElements[node.name]) {
                node.empty().remove();
              } else {
                node.unwrap();
              }
            }
          }
        }
      }

      /**
       * Runs the specified node though the element and attributes filters.
       *
       * @method filterNode
       * @param {tinymce.html.Node} Node the node to run filters on.
       * @return {tinymce.html.Node} The passed in node.
       */
      self.filterNode = function (node) {
        var i, name, list;

        // Run element filters
        if (name in nodeFilters) {
          list = matchedNodes[name];

          if (list) {
            list.push(node);
          } else {
            matchedNodes[name] = [node];
          }
        }

        // Run attribute filters
        i = attributeFilters.length;
        while (i--) {
          name = attributeFilters[i].name;

          if (name in node.attributes.map) {
            list = matchedAttributes[name];

            if (list) {
              list.push(node);
            } else {
              matchedAttributes[name] = [node];
            }
          }
        }

        return node;
      };

      /**
       * Adds a node filter function to the parser, the parser will collect the specified nodes by name
       * and then execute the callback ones it has finished parsing the document.
       *
       * @example
       * parser.addNodeFilter('p,h1', function(nodes, name) {
       *  for (var i = 0; i < nodes.length; i++) {
       *   console.log(nodes[i].name);
       *  }
       * });
       * @method addNodeFilter
       * @method {String} name Comma separated list of nodes to collect.
       * @param {function} callback Callback function to execute once it has collected nodes.
       */
      self.addNodeFilter = function (name, callback) {
        each(explode(name), function (name) {
          var list = nodeFilters[name];

          if (!list) {
            nodeFilters[name] = list = [];
          }

          list.push(callback);
        });
      };

      /**
       * Adds a attribute filter function to the parser, the parser will collect nodes that has the specified attributes
       * and then execute the callback ones it has finished parsing the document.
       *
       * @example
       * parser.addAttributeFilter('src,href', function(nodes, name) {
       *  for (var i = 0; i < nodes.length; i++) {
       *   console.log(nodes[i].name);
       *  }
       * });
       * @method addAttributeFilter
       * @method {String} name Comma separated list of nodes to collect.
       * @param {function} callback Callback function to execute once it has collected nodes.
       */
      self.addAttributeFilter = function (name, callback) {
        each(explode(name), function (name) {
          var i;

          for (i = 0; i < attributeFilters.length; i++) {
            if (attributeFilters[i].name === name) {
              attributeFilters[i].callbacks.push(callback);
              return;
            }
          }

          attributeFilters.push({ name: name, callbacks: [callback] });
        });
      };

      /**
       * Parses the specified HTML string into a DOM like node tree and returns the result.
       *
       * @example
       * var rootNode = new DomParser({...}).parse('<b>text</b>');
       * @method parse
       * @param {String} html Html string to sax parse.
       * @param {Object} args Optional args object that gets passed to all filter functions.
       * @return {tinymce.html.Node} Root node containing the tree.
       */
      self.parse = function (html, args) {
        var parser, rootNode, node, nodes, i, l, fi, fl, list, name, validate;
        var blockElements, startWhiteSpaceRegExp, invalidChildren = [], isInWhiteSpacePreservedElement;
        var endWhiteSpaceRegExp, allWhiteSpaceRegExp, isAllWhiteSpaceRegExp, whiteSpaceElements;
        var children, nonEmptyElements, rootBlockName;

        args = args || {};
        matchedNodes = {};
        matchedAttributes = {};
        blockElements = extend(makeMap('script,style,head,html,body,title,meta,param'), schema.getBlockElements());
        nonEmptyElements = schema.getNonEmptyElements();
        children = schema.children;
        validate = settings.validate;
        rootBlockName = "forced_root_block" in args ? args.forced_root_block : settings.forced_root_block;

        whiteSpaceElements = schema.getWhiteSpaceElements();
        startWhiteSpaceRegExp = /^[ \t\r\n]+/;
        endWhiteSpaceRegExp = /[ \t\r\n]+$/;
        allWhiteSpaceRegExp = /[ \t\r\n]+/g;
        isAllWhiteSpaceRegExp = /^[ \t\r\n]+$/;

        function addRootBlocks() {
          var node = rootNode.firstChild, next, rootBlockNode;

          // Removes whitespace at beginning and end of block so:
          // <p> x </p> -> <p>x</p>
          function trim(rootBlockNode) {
            if (rootBlockNode) {
              node = rootBlockNode.firstChild;
              if (node && node.type == 3) {
                node.value = node.value.replace(startWhiteSpaceRegExp, '');
              }

              node = rootBlockNode.lastChild;
              if (node && node.type == 3) {
                node.value = node.value.replace(endWhiteSpaceRegExp, '');
              }
            }
          }

          // Check if rootBlock is valid within rootNode for example if P is valid in H1 if H1 is the contentEditabe root
          if (!schema.isValidChild(rootNode.name, rootBlockName.toLowerCase())) {
            return;
          }

          while (node) {
            next = node.next;

            if (node.type == 3 || (node.type == 1 && node.name !== 'p' &&
              !blockElements[node.name] && !node.attr('data-mce-type'))) {
              if (!rootBlockNode) {
                // Create a new root block element
                rootBlockNode = createNode(rootBlockName, 1);
                rootBlockNode.attr(settings.forced_root_block_attrs);
                rootNode.insert(rootBlockNode, node);
                rootBlockNode.append(node);
              } else {
                rootBlockNode.append(node);
              }
            } else {
              trim(rootBlockNode);
              rootBlockNode = null;
            }

            node = next;
          }

          trim(rootBlockNode);
        }

        function createNode(name, type) {
          var node = new Node(name, type), list;

          if (name in nodeFilters) {
            list = matchedNodes[name];

            if (list) {
              list.push(node);
            } else {
              matchedNodes[name] = [node];
            }
          }

          return node;
        }

        function removeWhitespaceBefore(node) {
          var textNode, textNodeNext, textVal, sibling, blockElements = schema.getBlockElements();

          for (textNode = node.prev; textNode && textNode.type === 3;) {
            textVal = textNode.value.replace(endWhiteSpaceRegExp, '');

            // Found a text node with non whitespace then trim that and break
            if (textVal.length > 0) {
              textNode.value = textVal;
              return;
            }

            textNodeNext = textNode.next;

            // Fix for bug #7543 where bogus nodes would produce empty
            // text nodes and these would be removed if a nested list was before it
            if (textNodeNext) {
              if (textNodeNext.type == 3 && textNodeNext.value.length) {
                textNode = textNode.prev;
                continue;
              }

              if (!blockElements[textNodeNext.name] && textNodeNext.name != 'script' && textNodeNext.name != 'style') {
                textNode = textNode.prev;
                continue;
              }
            }

            sibling = textNode.prev;
            textNode.remove();
            textNode = sibling;
          }
        }

        function cloneAndExcludeBlocks(input) {
          var name, output = {};

          for (name in input) {
            if (name !== 'li' && name != 'p') {
              output[name] = input[name];
            }
          }

          return output;
        }

        parser = new SaxParser({
          validate: validate,
          allow_script_urls: settings.allow_script_urls,
          allow_conditional_comments: settings.allow_conditional_comments,

          // Exclude P and LI from DOM parsing since it's treated better by the DOM parser
          self_closing_elements: cloneAndExcludeBlocks(schema.getSelfClosingElements()),

          cdata: function (text) {
            node.append(createNode('#cdata', 4)).value = text;
          },

          text: function (text, raw) {
            var textNode;

            // Trim all redundant whitespace on non white space elements
            if (!isInWhiteSpacePreservedElement) {
              text = text.replace(allWhiteSpaceRegExp, ' ');

              if (node.lastChild && blockElements[node.lastChild.name]) {
                text = text.replace(startWhiteSpaceRegExp, '');
              }
            }

            // Do we need to create the node
            if (text.length !== 0) {
              textNode = createNode('#text', 3);
              textNode.raw = !!raw;
              node.append(textNode).value = text;
            }
          },

          comment: function (text) {
            node.append(createNode('#comment', 8)).value = text;
          },

          pi: function (name, text) {
            node.append(createNode(name, 7)).value = text;
            removeWhitespaceBefore(node);
          },

          doctype: function (text) {
            var newNode;

            newNode = node.append(createNode('#doctype', 10));
            newNode.value = text;
            removeWhitespaceBefore(node);
          },

          start: function (name, attrs, empty) {
            var newNode, attrFiltersLen, elementRule, attrName, parent;

            elementRule = validate ? schema.getElementRule(name) : {};
            if (elementRule) {
              newNode = createNode(elementRule.outputName || name, 1);
              newNode.attributes = attrs;
              newNode.shortEnded = empty;

              node.append(newNode);

              // Check if node is valid child of the parent node is the child is
              // unknown we don't collect it since it's probably a custom element
              parent = children[node.name];
              if (parent && children[newNode.name] && !parent[newNode.name]) {
                invalidChildren.push(newNode);
              }

              attrFiltersLen = attributeFilters.length;
              while (attrFiltersLen--) {
                attrName = attributeFilters[attrFiltersLen].name;

                if (attrName in attrs.map) {
                  list = matchedAttributes[attrName];

                  if (list) {
                    list.push(newNode);
                  } else {
                    matchedAttributes[attrName] = [newNode];
                  }
                }
              }

              // Trim whitespace before block
              if (blockElements[name]) {
                removeWhitespaceBefore(newNode);
              }

              // Change current node if the element wasn't empty i.e not <br /> or <img />
              if (!empty) {
                node = newNode;
              }

              // Check if we are inside a whitespace preserved element
              if (!isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {
                isInWhiteSpacePreservedElement = true;
              }
            }
          },

          end: function (name) {
            var textNode, elementRule, text, sibling, tempNode;

            elementRule = validate ? schema.getElementRule(name) : {};
            if (elementRule) {
              if (blockElements[name]) {
                if (!isInWhiteSpacePreservedElement) {
                  // Trim whitespace of the first node in a block
                  textNode = node.firstChild;
                  if (textNode && textNode.type === 3) {
                    text = textNode.value.replace(startWhiteSpaceRegExp, '');

                    // Any characters left after trim or should we remove it
                    if (text.length > 0) {
                      textNode.value = text;
                      textNode = textNode.next;
                    } else {
                      sibling = textNode.next;
                      textNode.remove();
                      textNode = sibling;

                      // Remove any pure whitespace siblings
                      while (textNode && textNode.type === 3) {
                        text = textNode.value;
                        sibling = textNode.next;

                        if (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {
                          textNode.remove();
                          textNode = sibling;
                        }

                        textNode = sibling;
                      }
                    }
                  }

                  // Trim whitespace of the last node in a block
                  textNode = node.lastChild;
                  if (textNode && textNode.type === 3) {
                    text = textNode.value.replace(endWhiteSpaceRegExp, '');

                    // Any characters left after trim or should we remove it
                    if (text.length > 0) {
                      textNode.value = text;
                      textNode = textNode.prev;
                    } else {
                      sibling = textNode.prev;
                      textNode.remove();
                      textNode = sibling;

                      // Remove any pure whitespace siblings
                      while (textNode && textNode.type === 3) {
                        text = textNode.value;
                        sibling = textNode.prev;

                        if (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {
                          textNode.remove();
                          textNode = sibling;
                        }

                        textNode = sibling;
                      }
                    }
                  }
                }

                // Trim start white space
                // Removed due to: #5424
                /*textNode = node.prev;
                if (textNode && textNode.type === 3) {
                  text = textNode.value.replace(startWhiteSpaceRegExp, '');

                  if (text.length > 0)
                    textNode.value = text;
                  else
                    textNode.remove();
                }*/
              }

              // Check if we exited a whitespace preserved element
              if (isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {
                isInWhiteSpacePreservedElement = false;
              }

              // Handle empty nodes
              if (elementRule.removeEmpty || elementRule.paddEmpty) {
                if (node.isEmpty(nonEmptyElements, whiteSpaceElements)) {
                  if (elementRule.paddEmpty) {
                    paddEmptyNode(settings, node);
                  } else {
                    // Leave nodes that have a name like <a name="name">
                    if (!node.attributes.map.name && !node.attributes.map.id) {
                      tempNode = node.parent;

                      if (blockElements[node.name]) {
                        node.empty().remove();
                      } else {
                        node.unwrap();
                      }

                      node = tempNode;
                      return;
                    }
                  }
                }
              }

              node = node.parent;
            }
          }
        }, schema);

        rootNode = node = new Node(args.context || settings.root_name, 11);

        parser.parse(html);

        // Fix invalid children or report invalid children in a contextual parsing
        if (validate && invalidChildren.length) {
          if (!args.context) {
            fixInvalidChildren(invalidChildren);
          } else {
            args.invalid = true;
          }
        }

        // Wrap nodes in the root into block elements if the root is body
        if (rootBlockName && (rootNode.name == 'body' || args.isRootContent)) {
          addRootBlocks();
        }

        // Run filters only when the contents is valid
        if (!args.invalid) {
          // Run node filters
          for (name in matchedNodes) {
            list = nodeFilters[name];
            nodes = matchedNodes[name];

            // Remove already removed children
            fi = nodes.length;
            while (fi--) {
              if (!nodes[fi].parent) {
                nodes.splice(fi, 1);
              }
            }

            for (i = 0, l = list.length; i < l; i++) {
              list[i](nodes, name, args);
            }
          }

          // Run attribute filters
          for (i = 0, l = attributeFilters.length; i < l; i++) {
            list = attributeFilters[i];

            if (list.name in matchedAttributes) {
              nodes = matchedAttributes[list.name];

              // Remove already removed children
              fi = nodes.length;
              while (fi--) {
                if (!nodes[fi].parent) {
                  nodes.splice(fi, 1);
                }
              }

              for (fi = 0, fl = list.callbacks.length; fi < fl; fi++) {
                list.callbacks[fi](nodes, list.name, args);
              }
            }
          }
        }

        return rootNode;
      };

      // Remove <br> at end of block elements Gecko and WebKit injects BR elements to
      // make it possible to place the caret inside empty blocks. This logic tries to remove
      // these elements and keep br elements that where intended to be there intact
      if (settings.remove_trailing_brs) {
        self.addNodeFilter('br', function (nodes) {
          var i, l = nodes.length, node, blockElements = extend({}, schema.getBlockElements());
          var nonEmptyElements = schema.getNonEmptyElements(), parent, lastParent, prev, prevName;
          var whiteSpaceElements = schema.getNonEmptyElements();
          var elementRule, textNode;

          // Remove brs from body element as well
          blockElements.body = 1;

          // Must loop forwards since it will otherwise remove all brs in <p>a<br><br><br></p>
          for (i = 0; i < l; i++) {
            node = nodes[i];
            parent = node.parent;

            if (blockElements[node.parent.name] && node === parent.lastChild) {
              // Loop all nodes to the left of the current node and check for other BR elements
              // excluding bookmarks since they are invisible
              prev = node.prev;
              while (prev) {
                prevName = prev.name;

                // Ignore bookmarks
                if (prevName !== "span" || prev.attr('data-mce-type') !== 'bookmark') {
                  // Found a non BR element
                  if (prevName !== "br") {
                    break;
                  }

                  // Found another br it's a <br><br> structure then don't remove anything
                  if (prevName === 'br') {
                    node = null;
                    break;
                  }
                }

                prev = prev.prev;
              }

              if (node) {
                node.remove();

                // Is the parent to be considered empty after we removed the BR
                if (parent.isEmpty(nonEmptyElements, whiteSpaceElements)) {
                  elementRule = schema.getElementRule(parent.name);

                  // Remove or padd the element depending on schema rule
                  if (elementRule) {
                    if (elementRule.removeEmpty) {
                      parent.remove();
                    } else if (elementRule.paddEmpty) {
                      paddEmptyNode(settings, parent);
                    }
                  }
                }
              }
            } else {
              // Replaces BR elements inside inline elements like <p><b><i><br></i></b></p>
              // so they become <p><b><i>&nbsp;</i></b></p>
              lastParent = node;
              while (parent && parent.firstChild === lastParent && parent.lastChild === lastParent) {
                lastParent = parent;

                if (blockElements[parent.name]) {
                  break;
                }

                parent = parent.parent;
              }

              if (lastParent === parent && settings.padd_empty_with_br !== true) {
                textNode = new Node('#text', 3);
                textNode.value = '\u00a0';
                node.replace(textNode);
              }
            }
          }
        });
      }


      self.addAttributeFilter('href', function (nodes) {
        var i = nodes.length, node;

        var appendRel = function (rel) {
          var parts = rel.split(' ').filter(function (p) {
            return p.length > 0;
          });
          return parts.concat(['noopener']).sort().join(' ');
        };

        var addNoOpener = function (rel) {
          var newRel = rel ? Tools.trim(rel) : '';
          if (!/\b(noopener)\b/g.test(newRel)) {
            return appendRel(newRel);
          } else {
            return newRel;
          }
        };

        if (!settings.allow_unsafe_link_target) {
          while (i--) {
            node = nodes[i];
            if (node.name === 'a' && node.attr('target') === '_blank') {
              node.attr('rel', addNoOpener(node.attr('rel')));
            }
          }
        }
      });

      // Force anchor names closed, unless the setting "allow_html_in_named_anchor" is explicitly included.
      if (!settings.allow_html_in_named_anchor) {
        self.addAttributeFilter('id,name', function (nodes) {
          var i = nodes.length, sibling, prevSibling, parent, node;

          while (i--) {
            node = nodes[i];
            if (node.name === 'a' && node.firstChild && !node.attr('href')) {
              parent = node.parent;

              // Move children after current node
              sibling = node.lastChild;
              do {
                prevSibling = sibling.prev;
                parent.insert(sibling, node);
                sibling = prevSibling;
              } while (sibling);
            }
          }
        });
      }

      if (settings.fix_list_elements) {
        self.addNodeFilter('ul,ol', function (nodes) {
          var i = nodes.length, node, parentNode;

          while (i--) {
            node = nodes[i];
            parentNode = node.parent;

            if (parentNode.name === 'ul' || parentNode.name === 'ol') {
              if (node.prev && node.prev.name === 'li') {
                node.prev.append(node);
              } else {
                var li = new Node('li', 1);
                li.attr('style', 'list-style-type: none');
                node.wrap(li);
              }
            }
          }
        });
      }

      if (settings.validate && schema.getValidClasses()) {
        self.addAttributeFilter('class', function (nodes) {
          var i = nodes.length, node, classList, ci, className, classValue;
          var validClasses = schema.getValidClasses(), validClassesMap, valid;

          while (i--) {
            node = nodes[i];
            classList = node.attr('class').split(' ');
            classValue = '';

            for (ci = 0; ci < classList.length; ci++) {
              className = classList[ci];
              valid = false;

              validClassesMap = validClasses['*'];
              if (validClassesMap && validClassesMap[className]) {
                valid = true;
              }

              validClassesMap = validClasses[node.name];
              if (!valid && validClassesMap && validClassesMap[className]) {
                valid = true;
              }

              if (valid) {
                if (classValue) {
                  classValue += ' ';
                }

                classValue += className;
              }
            }

            if (!classValue.length) {
              classValue = null;
            }

            node.attr('class', classValue);
          }
        });
      }
    };
  }
);

/**
 * Writer.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class is used to write HTML tags out it can be used with the Serializer or the SaxParser.
 *
 * @class tinymce.html.Writer
 * @example
 * var writer = new tinymce.html.Writer({indent: true});
 * var parser = new tinymce.html.SaxParser(writer).parse('<p><br></p>');
 * console.log(writer.getContent());
 *
 * @class tinymce.html.Writer
 * @version 3.4
 */
define(
  'tinymce.core.html.Writer',
  [
    "tinymce.core.html.Entities",
    "tinymce.core.util.Tools"
  ],
  function (Entities, Tools) {
    var makeMap = Tools.makeMap;

    /**
     * Constructs a new Writer instance.
     *
     * @constructor
     * @method Writer
     * @param {Object} settings Name/value settings object.
     */
    return function (settings) {
      var html = [], indent, indentBefore, indentAfter, encode, htmlOutput;

      settings = settings || {};
      indent = settings.indent;
      indentBefore = makeMap(settings.indent_before || '');
      indentAfter = makeMap(settings.indent_after || '');
      encode = Entities.getEncodeFunc(settings.entity_encoding || 'raw', settings.entities);
      htmlOutput = settings.element_format == "html";

      return {
        /**
         * Writes the a start element such as <p id="a">.
         *
         * @method start
         * @param {String} name Name of the element.
         * @param {Array} attrs Optional attribute array or undefined if it hasn't any.
         * @param {Boolean} empty Optional empty state if the tag should end like <br />.
         */
        start: function (name, attrs, empty) {
          var i, l, attr, value;

          if (indent && indentBefore[name] && html.length > 0) {
            value = html[html.length - 1];

            if (value.length > 0 && value !== '\n') {
              html.push('\n');
            }
          }

          html.push('<', name);

          if (attrs) {
            for (i = 0, l = attrs.length; i < l; i++) {
              attr = attrs[i];
              html.push(' ', attr.name, '="', encode(attr.value, true), '"');
            }
          }

          if (!empty || htmlOutput) {
            html[html.length] = '>';
          } else {
            html[html.length] = ' />';
          }

          if (empty && indent && indentAfter[name] && html.length > 0) {
            value = html[html.length - 1];

            if (value.length > 0 && value !== '\n') {
              html.push('\n');
            }
          }
        },

        /**
         * Writes the a end element such as </p>.
         *
         * @method end
         * @param {String} name Name of the element.
         */
        end: function (name) {
          var value;

          /*if (indent && indentBefore[name] && html.length > 0) {
            value = html[html.length - 1];

            if (value.length > 0 && value !== '\n')
              html.push('\n');
          }*/

          html.push('</', name, '>');

          if (indent && indentAfter[name] && html.length > 0) {
            value = html[html.length - 1];

            if (value.length > 0 && value !== '\n') {
              html.push('\n');
            }
          }
        },

        /**
         * Writes a text node.
         *
         * @method text
         * @param {String} text String to write out.
         * @param {Boolean} raw Optional raw state if true the contents wont get encoded.
         */
        text: function (text, raw) {
          if (text.length > 0) {
            html[html.length] = raw ? text : encode(text);
          }
        },

        /**
         * Writes a cdata node such as <![CDATA[data]]>.
         *
         * @method cdata
         * @param {String} text String to write out inside the cdata.
         */
        cdata: function (text) {
          html.push('<![CDATA[', text, ']]>');
        },

        /**
         * Writes a comment node such as <!-- Comment -->.
         *
         * @method cdata
         * @param {String} text String to write out inside the comment.
         */
        comment: function (text) {
          html.push('<!--', text, '-->');
        },

        /**
         * Writes a PI node such as <?xml attr="value" ?>.
         *
         * @method pi
         * @param {String} name Name of the pi.
         * @param {String} text String to write out inside the pi.
         */
        pi: function (name, text) {
          if (text) {
            html.push('<?', name, ' ', encode(text), '?>');
          } else {
            html.push('<?', name, '?>');
          }

          if (indent) {
            html.push('\n');
          }
        },

        /**
         * Writes a doctype node such as <!DOCTYPE data>.
         *
         * @method doctype
         * @param {String} text String to write out inside the doctype.
         */
        doctype: function (text) {
          html.push('<!DOCTYPE', text, '>', indent ? '\n' : '');
        },

        /**
         * Resets the internal buffer if one wants to reuse the writer.
         *
         * @method reset
         */
        reset: function () {
          html.length = 0;
        },

        /**
         * Returns the contents that got serialized.
         *
         * @method getContent
         * @return {String} HTML contents that got written down.
         */
        getContent: function () {
          return html.join('').replace(/\n$/, '');
        }
      };
    };
  }
);
/**
 * Serializer.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class is used to serialize down the DOM tree into a string using a Writer instance.
 *
 *
 * @example
 * new tinymce.html.Serializer().serialize(new tinymce.html.DomParser().parse('<p>text</p>'));
 * @class tinymce.html.Serializer
 * @version 3.4
 */
define(
  'tinymce.core.html.Serializer',
  [
    "tinymce.core.html.Writer",
    "tinymce.core.html.Schema"
  ],
  function (Writer, Schema) {
    /**
     * Constructs a new Serializer instance.
     *
     * @constructor
     * @method Serializer
     * @param {Object} settings Name/value settings object.
     * @param {tinymce.html.Schema} schema Schema instance to use.
     */
    return function (settings, schema) {
      var self = this, writer = new Writer(settings);

      settings = settings || {};
      settings.validate = "validate" in settings ? settings.validate : true;

      self.schema = schema = schema || new Schema();
      self.writer = writer;

      /**
       * Serializes the specified node into a string.
       *
       * @example
       * new tinymce.html.Serializer().serialize(new tinymce.html.DomParser().parse('<p>text</p>'));
       * @method serialize
       * @param {tinymce.html.Node} node Node instance to serialize.
       * @return {String} String with HTML based on DOM tree.
       */
      self.serialize = function (node) {
        var handlers, validate;

        validate = settings.validate;

        handlers = {
          // #text
          3: function (node) {
            writer.text(node.value, node.raw);
          },

          // #comment
          8: function (node) {
            writer.comment(node.value);
          },

          // Processing instruction
          7: function (node) {
            writer.pi(node.name, node.value);
          },

          // Doctype
          10: function (node) {
            writer.doctype(node.value);
          },

          // CDATA
          4: function (node) {
            writer.cdata(node.value);
          },

          // Document fragment
          11: function (node) {
            if ((node = node.firstChild)) {
              do {
                walk(node);
              } while ((node = node.next));
            }
          }
        };

        writer.reset();

        function walk(node) {
          var handler = handlers[node.type], name, isEmpty, attrs, attrName, attrValue, sortedAttrs, i, l, elementRule;

          if (!handler) {
            name = node.name;
            isEmpty = node.shortEnded;
            attrs = node.attributes;

            // Sort attributes
            if (validate && attrs && attrs.length > 1) {
              sortedAttrs = [];
              sortedAttrs.map = {};

              elementRule = schema.getElementRule(node.name);
              if (elementRule) {
                for (i = 0, l = elementRule.attributesOrder.length; i < l; i++) {
                  attrName = elementRule.attributesOrder[i];

                  if (attrName in attrs.map) {
                    attrValue = attrs.map[attrName];
                    sortedAttrs.map[attrName] = attrValue;
                    sortedAttrs.push({ name: attrName, value: attrValue });
                  }
                }

                for (i = 0, l = attrs.length; i < l; i++) {
                  attrName = attrs[i].name;

                  if (!(attrName in sortedAttrs.map)) {
                    attrValue = attrs.map[attrName];
                    sortedAttrs.map[attrName] = attrValue;
                    sortedAttrs.push({ name: attrName, value: attrValue });
                  }
                }

                attrs = sortedAttrs;
              }
            }

            writer.start(node.name, attrs, isEmpty);

            if (!isEmpty) {
              if ((node = node.firstChild)) {
                do {
                  walk(node);
                } while ((node = node.next));
              }

              writer.end(name);
            }
          } else {
            handler(node);
          }
        }

        // Serialize element and treat all non elements as fragments
        if (node.type == 1 && !settings.inner) {
          walk(node);
        } else {
          handlers[11](node);
        }

        return writer.getContent();
      };
    };
  }
);

/**
 * Serializer.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class is used to serialize DOM trees into a string. Consult the TinyMCE Wiki API for
 * more details and examples on how to use this class.
 *
 * @class tinymce.dom.Serializer
 */
define(
  'tinymce.core.dom.Serializer',
  [
    "tinymce.core.dom.DOMUtils",
    "tinymce.core.html.DomParser",
    "tinymce.core.html.SaxParser",
    "tinymce.core.html.Entities",
    "tinymce.core.html.Serializer",
    "tinymce.core.html.Node",
    "tinymce.core.html.Schema",
    "tinymce.core.Env",
    "tinymce.core.util.Tools",
    "tinymce.core.text.Zwsp"
  ],
  function (DOMUtils, DomParser, SaxParser, Entities, Serializer, Node, Schema, Env, Tools, Zwsp) {
    var each = Tools.each, trim = Tools.trim;
    var DOM = DOMUtils.DOM;

    /**
     * IE 11 has a fantastic bug where it will produce two trailing BR elements to iframe bodies when
     * the iframe is hidden by display: none on a parent container. The DOM is actually out of sync
     * with innerHTML in this case. It's like IE adds shadow DOM BR elements that appears on innerHTML
     * but not as the lastChild of the body. So this fix simply removes the last two
     * BR elements at the end of the document.
     *
     * Example of what happens: <body>text</body> becomes <body>text<br><br></body>
     */
    function trimTrailingBr(rootNode) {
      var brNode1, brNode2;

      function isBr(node) {
        return node && node.name === 'br';
      }

      brNode1 = rootNode.lastChild;
      if (isBr(brNode1)) {
        brNode2 = brNode1.prev;

        if (isBr(brNode2)) {
          brNode1.remove();
          brNode2.remove();
        }
      }
    }

    /**
     * Constructs a new DOM serializer class.
     *
     * @constructor
     * @method Serializer
     * @param {Object} settings Serializer settings object.
     * @param {tinymce.Editor} editor Optional editor to bind events to and get schema/dom from.
     */
    return function (settings, editor) {
      var dom, schema, htmlParser, tempAttrs = ["data-mce-selected"];

      if (editor) {
        dom = editor.dom;
        schema = editor.schema;
      }

      function trimHtml(html) {
        var trimContentRegExp = new RegExp([
          '<span[^>]+data-mce-bogus[^>]+>[\u200B\uFEFF]+<\\/span>', // Trim bogus spans like caret containers
          '\\s?(' + tempAttrs.join('|') + ')="[^"]+"' // Trim temporaty data-mce prefixed attributes like data-mce-selected
        ].join('|'), 'gi');

        html = Zwsp.trim(html.replace(trimContentRegExp, ''));

        return html;
      }

      function trimContent(html) {
        var content = html;
        var bogusAllRegExp = /<(\w+) [^>]*data-mce-bogus="all"[^>]*>/g;
        var endTagIndex, index, matchLength, matches, shortEndedElements, schema = editor.schema;

        content = trimHtml(content);
        shortEndedElements = schema.getShortEndedElements();

        // Remove all bogus elements marked with "all"
        while ((matches = bogusAllRegExp.exec(content))) {
          index = bogusAllRegExp.lastIndex;
          matchLength = matches[0].length;

          if (shortEndedElements[matches[1]]) {
            endTagIndex = index;
          } else {
            endTagIndex = SaxParser.findEndTag(schema, content, index);
          }

          content = content.substring(0, index - matchLength) + content.substring(endTagIndex);
          bogusAllRegExp.lastIndex = index - matchLength;
        }

        return content;
      }

      /**
       * Returns a trimmed version of the editor contents to be used for the undo level. This
       * will remove any data-mce-bogus="all" marked elements since these are used for UI it will also
       * remove the data-mce-selected attributes used for selection of objects and caret containers.
       * It will keep all data-mce-bogus="1" elements since these can be used to place the caret etc and will
       * be removed by the serialization logic when you save.
       *
       * @private
       * @return {String} HTML contents of the editor excluding some internal bogus elements.
       */
      function getTrimmedContent() {
        return trimContent(editor.getBody().innerHTML);
      }

      function addTempAttr(name) {
        if (Tools.inArray(tempAttrs, name) === -1) {
          htmlParser.addAttributeFilter(name, function (nodes, name) {
            var i = nodes.length;

            while (i--) {
              nodes[i].attr(name, null);
            }
          });

          tempAttrs.push(name);
        }
      }

      // Default DOM and Schema if they are undefined
      dom = dom || DOM;
      schema = schema || new Schema(settings);
      settings.entity_encoding = settings.entity_encoding || 'named';
      settings.remove_trailing_brs = "remove_trailing_brs" in settings ? settings.remove_trailing_brs : true;

      htmlParser = new DomParser(settings, schema);

      // Convert tabindex back to elements when serializing contents
      htmlParser.addAttributeFilter('data-mce-tabindex', function (nodes, name) {
        var i = nodes.length, node;

        while (i--) {
          node = nodes[i];
          node.attr('tabindex', node.attributes.map['data-mce-tabindex']);
          node.attr(name, null);
        }
      });

      // Convert move data-mce-src, data-mce-href and data-mce-style into nodes or process them if needed
      htmlParser.addAttributeFilter('src,href,style', function (nodes, name) {
        var i = nodes.length, node, value, internalName = 'data-mce-' + name;
        var urlConverter = settings.url_converter, urlConverterScope = settings.url_converter_scope, undef;

        while (i--) {
          node = nodes[i];

          value = node.attributes.map[internalName];
          if (value !== undef) {
            // Set external name to internal value and remove internal
            node.attr(name, value.length > 0 ? value : null);
            node.attr(internalName, null);
          } else {
            // No internal attribute found then convert the value we have in the DOM
            value = node.attributes.map[name];

            if (name === "style") {
              value = dom.serializeStyle(dom.parseStyle(value), node.name);
            } else if (urlConverter) {
              value = urlConverter.call(urlConverterScope, value, name, node.name);
            }

            node.attr(name, value.length > 0 ? value : null);
          }
        }
      });

      // Remove internal classes mceItem<..> or mceSelected
      htmlParser.addAttributeFilter('class', function (nodes) {
        var i = nodes.length, node, value;

        while (i--) {
          node = nodes[i];
          value = node.attr('class');

          if (value) {
            value = node.attr('class').replace(/(?:^|\s)mce-item-\w+(?!\S)/g, '');
            node.attr('class', value.length > 0 ? value : null);
          }
        }
      });

      // Remove bookmark elements
      htmlParser.addAttributeFilter('data-mce-type', function (nodes, name, args) {
        var i = nodes.length, node;

        while (i--) {
          node = nodes[i];

          if (node.attributes.map['data-mce-type'] === 'bookmark' && !args.cleanup) {
            node.remove();
          }
        }
      });

      htmlParser.addNodeFilter('noscript', function (nodes) {
        var i = nodes.length, node;

        while (i--) {
          node = nodes[i].firstChild;

          if (node) {
            node.value = Entities.decode(node.value);
          }
        }
      });

      // Force script into CDATA sections and remove the mce- prefix also add comments around styles
      htmlParser.addNodeFilter('script,style', function (nodes, name) {
        var i = nodes.length, node, value, type;

        function trim(value) {
          /*jshint maxlen:255 */
          /*eslint max-len:0 */
          return value.replace(/(<!--\[CDATA\[|\]\]-->)/g, '\n')
            .replace(/^[\r\n]*|[\r\n]*$/g, '')
            .replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi, '')
            .replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g, '');
        }

        while (i--) {
          node = nodes[i];
          value = node.firstChild ? node.firstChild.value : '';

          if (name === "script") {
            // Remove mce- prefix from script elements and remove default type since the user specified
            // a script element without type attribute
            type = node.attr('type');
            if (type) {
              node.attr('type', type == 'mce-no/type' ? null : type.replace(/^mce\-/, ''));
            }

            if (value.length > 0) {
              node.firstChild.value = '// <![CDATA[\n' + trim(value) + '\n// ]]>';
            }
          } else {
            if (value.length > 0) {
              node.firstChild.value = '<!--\n' + trim(value) + '\n-->';
            }
          }
        }
      });

      // Convert comments to cdata and handle protected comments
      htmlParser.addNodeFilter('#comment', function (nodes) {
        var i = nodes.length, node;

        while (i--) {
          node = nodes[i];

          if (node.value.indexOf('[CDATA[') === 0) {
            node.name = '#cdata';
            node.type = 4;
            node.value = node.value.replace(/^\[CDATA\[|\]\]$/g, '');
          } else if (node.value.indexOf('mce:protected ') === 0) {
            node.name = "#text";
            node.type = 3;
            node.raw = true;
            node.value = unescape(node.value).substr(14);
          }
        }
      });

      htmlParser.addNodeFilter('xml:namespace,input', function (nodes, name) {
        var i = nodes.length, node;

        while (i--) {
          node = nodes[i];
          if (node.type === 7) {
            node.remove();
          } else if (node.type === 1) {
            if (name === "input" && !("type" in node.attributes.map)) {
              node.attr('type', 'text');
            }
          }
        }
      });

      // Remove internal data attributes
      htmlParser.addAttributeFilter(
        'data-mce-src,data-mce-href,data-mce-style,' +
        'data-mce-selected,data-mce-expando,' +
        'data-mce-type,data-mce-resize',

        function (nodes, name) {
          var i = nodes.length;

          while (i--) {
            nodes[i].attr(name, null);
          }
        }
      );

      // Return public methods
      return {
        /**
         * Schema instance that was used to when the Serializer was constructed.
         *
         * @field {tinymce.html.Schema} schema
         */
        schema: schema,

        /**
         * Adds a node filter function to the parser used by the serializer, the parser will collect the specified nodes by name
         * and then execute the callback ones it has finished parsing the document.
         *
         * @example
         * parser.addNodeFilter('p,h1', function(nodes, name) {
         *  for (var i = 0; i < nodes.length; i++) {
         *   console.log(nodes[i].name);
         *  }
         * });
         * @method addNodeFilter
         * @method {String} name Comma separated list of nodes to collect.
         * @param {function} callback Callback function to execute once it has collected nodes.
         */
        addNodeFilter: htmlParser.addNodeFilter,

        /**
         * Adds a attribute filter function to the parser used by the serializer, the parser will
         * collect nodes that has the specified attributes
         * and then execute the callback ones it has finished parsing the document.
         *
         * @example
         * parser.addAttributeFilter('src,href', function(nodes, name) {
         *  for (var i = 0; i < nodes.length; i++) {
         *   console.log(nodes[i].name);
         *  }
         * });
         * @method addAttributeFilter
         * @method {String} name Comma separated list of nodes to collect.
         * @param {function} callback Callback function to execute once it has collected nodes.
         */
        addAttributeFilter: htmlParser.addAttributeFilter,

        /**
         * Serializes the specified browser DOM node into a HTML string.
         *
         * @method serialize
         * @param {DOMNode} node DOM node to serialize.
         * @param {Object} args Arguments option that gets passed to event handlers.
         */
        serialize: function (node, args) {
          var self = this, impl, doc, oldDoc, htmlSerializer, content, rootNode;

          // Explorer won't clone contents of script and style and the
          // selected index of select elements are cleared on a clone operation.
          if (Env.ie && dom.select('script,style,select,map').length > 0) {
            content = node.innerHTML;
            node = node.cloneNode(false);
            dom.setHTML(node, content);
          } else {
            node = node.cloneNode(true);
          }

          // Nodes needs to be attached to something in WebKit/Opera
          // This fix will make DOM ranges and make Sizzle happy!
          impl = document.implementation;
          if (impl.createHTMLDocument) {
            // Create an empty HTML document
            doc = impl.createHTMLDocument("");

            // Add the element or it's children if it's a body element to the new document
            each(node.nodeName == 'BODY' ? node.childNodes : [node], function (node) {
              doc.body.appendChild(doc.importNode(node, true));
            });

            // Grab first child or body element for serialization
            if (node.nodeName != 'BODY') {
              node = doc.body.firstChild;
            } else {
              node = doc.body;
            }

            // set the new document in DOMUtils so createElement etc works
            oldDoc = dom.doc;
            dom.doc = doc;
          }

          args = args || {};
          args.format = args.format || 'html';

          // Don't wrap content if we want selected html
          if (args.selection) {
            args.forced_root_block = '';
          }

          // Pre process
          if (!args.no_events) {
            args.node = node;
            self.onPreProcess(args);
          }

          // Parse HTML
          rootNode = htmlParser.parse(trim(args.getInner ? node.innerHTML : dom.getOuterHTML(node)), args);
          trimTrailingBr(rootNode);

          // Serialize HTML
          htmlSerializer = new Serializer(settings, schema);
          args.content = htmlSerializer.serialize(rootNode);

          // Replace all BOM characters for now until we can find a better solution
          if (!args.cleanup) {
            args.content = Zwsp.trim(args.content);
            args.content = args.content.replace(/\uFEFF/g, '');
          }

          // Post process
          if (!args.no_events) {
            self.onPostProcess(args);
          }

          // Restore the old document if it was changed
          if (oldDoc) {
            dom.doc = oldDoc;
          }

          args.node = null;

          return args.content;
        },

        /**
         * Adds valid elements rules to the serializers schema instance this enables you to specify things
         * like what elements should be outputted and what attributes specific elements might have.
         * Consult the Wiki for more details on this format.
         *
         * @method addRules
         * @param {String} rules Valid elements rules string to add to schema.
         */
        addRules: function (rules) {
          schema.addValidElements(rules);
        },

        /**
         * Sets the valid elements rules to the serializers schema instance this enables you to specify things
         * like what elements should be outputted and what attributes specific elements might have.
         * Consult the Wiki for more details on this format.
         *
         * @method setRules
         * @param {String} rules Valid elements rules string.
         */
        setRules: function (rules) {
          schema.setValidElements(rules);
        },

        onPreProcess: function (args) {
          if (editor) {
            editor.fire('PreProcess', args);
          }
        },

        onPostProcess: function (args) {
          if (editor) {
            editor.fire('PostProcess', args);
          }
        },

        /**
         * Adds a temporary internal attribute these attributes will get removed on undo and
         * when getting contents out of the editor.
         *
         * @method addTempAttr
         * @param {String} name string
         */
        addTempAttr: addTempAttr,

        // Internal
        trimHtml: trimHtml,
        getTrimmedContent: getTrimmedContent,
        trimContent: trimContent
      };
    };
  }
);

/**
 * VK.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This file exposes a set of the common KeyCodes for use. Please grow it as needed.
 */
define(
  'tinymce.core.util.VK',
  [
    "tinymce.core.Env"
  ],
  function (Env) {
    return {
      BACKSPACE: 8,
      DELETE: 46,
      DOWN: 40,
      ENTER: 13,
      LEFT: 37,
      RIGHT: 39,
      SPACEBAR: 32,
      TAB: 9,
      UP: 38,

      modifierPressed: function (e) {
        return e.shiftKey || e.ctrlKey || e.altKey || this.metaKeyPressed(e);
      },

      metaKeyPressed: function (e) {
        // Check if ctrl or meta key is pressed. Edge case for AltGr on Windows where it produces ctrlKey+altKey states
        return (Env.mac ? e.metaKey : e.ctrlKey && !e.altKey);
      }
    };
  }
);

/**
 * ClientRect.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Utility functions for working with client rects.
 *
 * @private
 * @class tinymce.geom.ClientRect
 */
define(
  'tinymce.core.geom.ClientRect',
  [
  ],
  function () {
    var round = Math.round;

    function clone(rect) {
      if (!rect) {
        return { left: 0, top: 0, bottom: 0, right: 0, width: 0, height: 0 };
      }

      return {
        left: round(rect.left),
        top: round(rect.top),
        bottom: round(rect.bottom),
        right: round(rect.right),
        width: round(rect.width),
        height: round(rect.height)
      };
    }

    function collapse(clientRect, toStart) {
      clientRect = clone(clientRect);

      if (toStart) {
        clientRect.right = clientRect.left;
      } else {
        clientRect.left = clientRect.left + clientRect.width;
        clientRect.right = clientRect.left;
      }

      clientRect.width = 0;

      return clientRect;
    }

    function isEqual(rect1, rect2) {
      return (
        rect1.left === rect2.left &&
        rect1.top === rect2.top &&
        rect1.bottom === rect2.bottom &&
        rect1.right === rect2.right
      );
    }

    function isValidOverflow(overflowY, clientRect1, clientRect2) {
      return overflowY >= 0 && overflowY <= Math.min(clientRect1.height, clientRect2.height) / 2;

    }

    function isAbove(clientRect1, clientRect2) {
      if ((clientRect1.bottom - clientRect1.height / 2) < clientRect2.top) {
        return true;
      }

      if (clientRect1.top > clientRect2.bottom) {
        return false;
      }

      return isValidOverflow(clientRect2.top - clientRect1.bottom, clientRect1, clientRect2);
    }

    function isBelow(clientRect1, clientRect2) {
      if (clientRect1.top > clientRect2.bottom) {
        return true;
      }

      if (clientRect1.bottom < clientRect2.top) {
        return false;
      }

      return isValidOverflow(clientRect2.bottom - clientRect1.top, clientRect1, clientRect2);
    }

    function isLeft(clientRect1, clientRect2) {
      return clientRect1.left < clientRect2.left;
    }

    function isRight(clientRect1, clientRect2) {
      return clientRect1.right > clientRect2.right;
    }

    function compare(clientRect1, clientRect2) {
      if (isAbove(clientRect1, clientRect2)) {
        return -1;
      }

      if (isBelow(clientRect1, clientRect2)) {
        return 1;
      }

      if (isLeft(clientRect1, clientRect2)) {
        return -1;
      }

      if (isRight(clientRect1, clientRect2)) {
        return 1;
      }

      return 0;
    }

    function containsXY(clientRect, clientX, clientY) {
      return (
        clientX >= clientRect.left &&
        clientX <= clientRect.right &&
        clientY >= clientRect.top &&
        clientY <= clientRect.bottom
      );
    }

    return {
      clone: clone,
      collapse: collapse,
      isEqual: isEqual,
      isAbove: isAbove,
      isBelow: isBelow,
      isLeft: isLeft,
      isRight: isRight,
      compare: compare,
      containsXY: containsXY
    };
  }
);

/**
 * RangePoint.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.dom.RangePoint',
  [
    'ephox.katamari.api.Arr',
    'tinymce.core.geom.ClientRect'
  ],
  function (Arr, ClientRect) {
    var isXYWithinRange = function (clientX, clientY, range) {
      if (range.collapsed) {
        return false;
      }

      return Arr.foldl(range.getClientRects(), function (state, rect) {
        return state || ClientRect.containsXY(rect, clientX, clientY);
      }, false);
    };

    return {
      isXYWithinRange: isXYWithinRange
    };
  }
);
/**
 * ControlSelection.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class handles control selection of elements. Controls are elements
 * that can be resized and needs to be selected as a whole. It adds custom resize handles
 * to all browser engines that support properly disabling the built in resize logic.
 *
 * @class tinymce.dom.ControlSelection
 */
define(
  'tinymce.core.dom.ControlSelection',
  [
    'ephox.katamari.api.Fun',
    'tinymce.core.dom.NodeType',
    'tinymce.core.dom.RangePoint',
    'tinymce.core.Env',
    'tinymce.core.util.Delay',
    'tinymce.core.util.Tools',
    'tinymce.core.util.VK'
  ],
  function (Fun, NodeType, RangePoint, Env, Delay, Tools, VK) {
    var isContentEditableFalse = NodeType.isContentEditableFalse;
    var isContentEditableTrue = NodeType.isContentEditableTrue;

    function getContentEditableRoot(root, node) {
      while (node && node != root) {
        if (isContentEditableTrue(node) || isContentEditableFalse(node)) {
          return node;
        }

        node = node.parentNode;
      }

      return null;
    }

    var isImage = function (elm) {
      return elm && elm.nodeName === 'IMG';
    };

    var isEventOnImageOutsideRange = function (evt, range) {
      return isImage(evt.target) && !RangePoint.isXYWithinRange(evt.clientX, evt.clientY, range);
    };

    var contextMenuSelectImage = function (editor, evt) {
      var target = evt.target;

      if (isEventOnImageOutsideRange(evt, editor.selection.getRng()) && !evt.isDefaultPrevented()) {
        evt.preventDefault();
        editor.selection.select(target);
      }
    };

    return function (selection, editor) {
      var dom = editor.dom, each = Tools.each;
      var selectedElm, selectedElmGhost, resizeHelper, resizeHandles, selectedHandle, lastMouseDownEvent;
      var startX, startY, selectedElmX, selectedElmY, startW, startH, ratio, resizeStarted;
      var width, height, editableDoc = editor.getDoc(), rootDocument = document, isIE = Env.ie && Env.ie < 11;
      var abs = Math.abs, round = Math.round, rootElement = editor.getBody(), startScrollWidth, startScrollHeight;

      // Details about each resize handle how to scale etc
      resizeHandles = {
        // Name: x multiplier, y multiplier, delta size x, delta size y
        /*n: [0.5, 0, 0, -1],
        e: [1, 0.5, 1, 0],
        s: [0.5, 1, 0, 1],
        w: [0, 0.5, -1, 0],*/
        nw: [0, 0, -1, -1],
        ne: [1, 0, 1, -1],
        se: [1, 1, 1, 1],
        sw: [0, 1, -1, 1]
      };

      // Add CSS for resize handles, cloned element and selected
      var rootClass = '.mce-content-body';
      editor.contentStyles.push(
        rootClass + ' div.mce-resizehandle {' +
        'position: absolute;' +
        'border: 1px solid black;' +
        'box-sizing: box-sizing;' +
        'background: #FFF;' +
        'width: 7px;' +
        'height: 7px;' +
        'z-index: 10000' +
        '}' +
        rootClass + ' .mce-resizehandle:hover {' +
        'background: #000' +
        '}' +
        rootClass + ' img[data-mce-selected],' + rootClass + ' hr[data-mce-selected] {' +
        'outline: 1px solid black;' +
        'resize: none' + // Have been talks about implementing this in browsers
        '}' +
        rootClass + ' .mce-clonedresizable {' +
        'position: absolute;' +
        (Env.gecko ? '' : 'outline: 1px dashed black;') + // Gecko produces trails while resizing
        'opacity: .5;' +
        'filter: alpha(opacity=50);' +
        'z-index: 10000' +
        '}' +
        rootClass + ' .mce-resize-helper {' +
        'background: #555;' +
        'background: rgba(0,0,0,0.75);' +
        'border-radius: 3px;' +
        'border: 1px;' +
        'color: white;' +
        'display: none;' +
        'font-family: sans-serif;' +
        'font-size: 12px;' +
        'white-space: nowrap;' +
        'line-height: 14px;' +
        'margin: 5px 10px;' +
        'padding: 5px;' +
        'position: absolute;' +
        'z-index: 10001' +
        '}'
      );

      function isResizable(elm) {
        var selector = editor.settings.object_resizing;

        if (selector === false || Env.iOS) {
          return false;
        }

        if (typeof selector != 'string') {
          selector = 'table,img,div';
        }

        if (elm.getAttribute('data-mce-resize') === 'false') {
          return false;
        }

        if (elm == editor.getBody()) {
          return false;
        }

        return editor.dom.is(elm, selector);
      }

      function resizeGhostElement(e) {
        var deltaX, deltaY, proportional;
        var resizeHelperX, resizeHelperY;

        // Calc new width/height
        deltaX = e.screenX - startX;
        deltaY = e.screenY - startY;

        // Calc new size
        width = deltaX * selectedHandle[2] + startW;
        height = deltaY * selectedHandle[3] + startH;

        // Never scale down lower than 5 pixels
        width = width < 5 ? 5 : width;
        height = height < 5 ? 5 : height;

        if (selectedElm.nodeName == "IMG" && editor.settings.resize_img_proportional !== false) {
          proportional = !VK.modifierPressed(e);
        } else {
          proportional = VK.modifierPressed(e) || (selectedElm.nodeName == "IMG" && selectedHandle[2] * selectedHandle[3] !== 0);
        }

        // Constrain proportions
        if (proportional) {
          if (abs(deltaX) > abs(deltaY)) {
            height = round(width * ratio);
            width = round(height / ratio);
          } else {
            width = round(height / ratio);
            height = round(width * ratio);
          }
        }

        // Update ghost size
        dom.setStyles(selectedElmGhost, {
          width: width,
          height: height
        });

        // Update resize helper position
        resizeHelperX = selectedHandle.startPos.x + deltaX;
        resizeHelperY = selectedHandle.startPos.y + deltaY;
        resizeHelperX = resizeHelperX > 0 ? resizeHelperX : 0;
        resizeHelperY = resizeHelperY > 0 ? resizeHelperY : 0;

        dom.setStyles(resizeHelper, {
          left: resizeHelperX,
          top: resizeHelperY,
          display: 'block'
        });

        resizeHelper.innerHTML = width + ' &times; ' + height;

        // Update ghost X position if needed
        if (selectedHandle[2] < 0 && selectedElmGhost.clientWidth <= width) {
          dom.setStyle(selectedElmGhost, 'left', selectedElmX + (startW - width));
        }

        // Update ghost Y position if needed
        if (selectedHandle[3] < 0 && selectedElmGhost.clientHeight <= height) {
          dom.setStyle(selectedElmGhost, 'top', selectedElmY + (startH - height));
        }

        // Calculate how must overflow we got
        deltaX = rootElement.scrollWidth - startScrollWidth;
        deltaY = rootElement.scrollHeight - startScrollHeight;

        // Re-position the resize helper based on the overflow
        if (deltaX + deltaY !== 0) {
          dom.setStyles(resizeHelper, {
            left: resizeHelperX - deltaX,
            top: resizeHelperY - deltaY
          });
        }

        if (!resizeStarted) {
          editor.fire('ObjectResizeStart', { target: selectedElm, width: startW, height: startH });
          resizeStarted = true;
        }
      }

      function endGhostResize() {
        resizeStarted = false;

        function setSizeProp(name, value) {
          if (value) {
            // Resize by using style or attribute
            if (selectedElm.style[name] || !editor.schema.isValid(selectedElm.nodeName.toLowerCase(), name)) {
              dom.setStyle(selectedElm, name, value);
            } else {
              dom.setAttrib(selectedElm, name, value);
            }
          }
        }

        // Set width/height properties
        setSizeProp('width', width);
        setSizeProp('height', height);

        dom.unbind(editableDoc, 'mousemove', resizeGhostElement);
        dom.unbind(editableDoc, 'mouseup', endGhostResize);

        if (rootDocument != editableDoc) {
          dom.unbind(rootDocument, 'mousemove', resizeGhostElement);
          dom.unbind(rootDocument, 'mouseup', endGhostResize);
        }

        // Remove ghost/helper and update resize handle positions
        dom.remove(selectedElmGhost);
        dom.remove(resizeHelper);

        if (!isIE || selectedElm.nodeName == "TABLE") {
          showResizeRect(selectedElm);
        }

        editor.fire('ObjectResized', { target: selectedElm, width: width, height: height });
        dom.setAttrib(selectedElm, 'style', dom.getAttrib(selectedElm, 'style'));
        editor.nodeChanged();
      }

      function showResizeRect(targetElm, mouseDownHandleName, mouseDownEvent) {
        var position, targetWidth, targetHeight, e, rect;

        hideResizeRect();
        unbindResizeHandleEvents();

        // Get position and size of target
        position = dom.getPos(targetElm, rootElement);
        selectedElmX = position.x;
        selectedElmY = position.y;
        rect = targetElm.getBoundingClientRect(); // Fix for Gecko offsetHeight for table with caption
        targetWidth = rect.width || (rect.right - rect.left);
        targetHeight = rect.height || (rect.bottom - rect.top);

        // Reset width/height if user selects a new image/table
        if (selectedElm != targetElm) {
          detachResizeStartListener();
          selectedElm = targetElm;
          width = height = 0;
        }

        // Makes it possible to disable resizing
        e = editor.fire('ObjectSelected', { target: targetElm });

        if (isResizable(targetElm) && !e.isDefaultPrevented()) {
          each(resizeHandles, function (handle, name) {
            var handleElm;

            function startDrag(e) {
              startX = e.screenX;
              startY = e.screenY;
              startW = selectedElm.clientWidth;
              startH = selectedElm.clientHeight;
              ratio = startH / startW;
              selectedHandle = handle;

              handle.startPos = {
                x: targetWidth * handle[0] + selectedElmX,
                y: targetHeight * handle[1] + selectedElmY
              };

              startScrollWidth = rootElement.scrollWidth;
              startScrollHeight = rootElement.scrollHeight;

              selectedElmGhost = selectedElm.cloneNode(true);
              dom.addClass(selectedElmGhost, 'mce-clonedresizable');
              dom.setAttrib(selectedElmGhost, 'data-mce-bogus', 'all');
              selectedElmGhost.contentEditable = false; // Hides IE move layer cursor
              selectedElmGhost.unSelectabe = true;
              dom.setStyles(selectedElmGhost, {
                left: selectedElmX,
                top: selectedElmY,
                margin: 0
              });

              selectedElmGhost.removeAttribute('data-mce-selected');
              rootElement.appendChild(selectedElmGhost);

              dom.bind(editableDoc, 'mousemove', resizeGhostElement);
              dom.bind(editableDoc, 'mouseup', endGhostResize);

              if (rootDocument != editableDoc) {
                dom.bind(rootDocument, 'mousemove', resizeGhostElement);
                dom.bind(rootDocument, 'mouseup', endGhostResize);
              }

              resizeHelper = dom.add(rootElement, 'div', {
                'class': 'mce-resize-helper',
                'data-mce-bogus': 'all'
              }, startW + ' &times; ' + startH);
            }

            if (mouseDownHandleName) {
              // Drag started by IE native resizestart
              if (name == mouseDownHandleName) {
                startDrag(mouseDownEvent);
              }

              return;
            }

            // Get existing or render resize handle
            handleElm = dom.get('mceResizeHandle' + name);
            if (handleElm) {
              dom.remove(handleElm);
            }

            handleElm = dom.add(rootElement, 'div', {
              id: 'mceResizeHandle' + name,
              'data-mce-bogus': 'all',
              'class': 'mce-resizehandle',
              unselectable: true,
              style: 'cursor:' + name + '-resize; margin:0; padding:0'
            });

            // Hides IE move layer cursor
            // If we set it on Chrome we get this wounderful bug: #6725
            if (Env.ie) {
              handleElm.contentEditable = false;
            }

            dom.bind(handleElm, 'mousedown', function (e) {
              e.stopImmediatePropagation();
              e.preventDefault();
              startDrag(e);
            });

            handle.elm = handleElm;

            // Position element
            dom.setStyles(handleElm, {
              left: (targetWidth * handle[0] + selectedElmX) - (handleElm.offsetWidth / 2),
              top: (targetHeight * handle[1] + selectedElmY) - (handleElm.offsetHeight / 2)
            });
          });
        } else {
          hideResizeRect();
        }

        selectedElm.setAttribute('data-mce-selected', '1');
      }

      function hideResizeRect() {
        var name, handleElm;

        unbindResizeHandleEvents();

        if (selectedElm) {
          selectedElm.removeAttribute('data-mce-selected');
        }

        for (name in resizeHandles) {
          handleElm = dom.get('mceResizeHandle' + name);
          if (handleElm) {
            dom.unbind(handleElm);
            dom.remove(handleElm);
          }
        }
      }

      function updateResizeRect(e) {
        var startElm, controlElm;

        function isChildOrEqual(node, parent) {
          if (node) {
            do {
              if (node === parent) {
                return true;
              }
            } while ((node = node.parentNode));
          }
        }

        // Ignore all events while resizing or if the editor instance was removed
        if (resizeStarted || editor.removed) {
          return;
        }

        // Remove data-mce-selected from all elements since they might have been copied using Ctrl+c/v
        each(dom.select('img[data-mce-selected],hr[data-mce-selected]'), function (img) {
          img.removeAttribute('data-mce-selected');
        });

        controlElm = e.type == 'mousedown' ? e.target : selection.getNode();
        controlElm = dom.$(controlElm).closest(isIE ? 'table' : 'table,img,hr')[0];

        if (isChildOrEqual(controlElm, rootElement)) {
          disableGeckoResize();
          startElm = selection.getStart(true);

          if (isChildOrEqual(startElm, controlElm) && isChildOrEqual(selection.getEnd(true), controlElm)) {
            if (!isIE || (controlElm != startElm && startElm.nodeName !== 'IMG')) {
              showResizeRect(controlElm);
              return;
            }
          }
        }

        hideResizeRect();
      }

      function attachEvent(elm, name, func) {
        if (elm && elm.attachEvent) {
          elm.attachEvent('on' + name, func);
        }
      }

      function detachEvent(elm, name, func) {
        if (elm && elm.detachEvent) {
          elm.detachEvent('on' + name, func);
        }
      }

      function resizeNativeStart(e) {
        var target = e.srcElement, pos, name, corner, cornerX, cornerY, relativeX, relativeY;

        pos = target.getBoundingClientRect();
        relativeX = lastMouseDownEvent.clientX - pos.left;
        relativeY = lastMouseDownEvent.clientY - pos.top;

        // Figure out what corner we are draging on
        for (name in resizeHandles) {
          corner = resizeHandles[name];

          cornerX = target.offsetWidth * corner[0];
          cornerY = target.offsetHeight * corner[1];

          if (abs(cornerX - relativeX) < 8 && abs(cornerY - relativeY) < 8) {
            selectedHandle = corner;
            break;
          }
        }

        // Remove native selection and let the magic begin
        resizeStarted = true;
        editor.fire('ObjectResizeStart', {
          target: selectedElm,
          width: selectedElm.clientWidth,
          height: selectedElm.clientHeight
        });
        editor.getDoc().selection.empty();
        showResizeRect(target, name, lastMouseDownEvent);
      }

      function preventDefault(e) {
        if (e.preventDefault) {
          e.preventDefault();
        } else {
          e.returnValue = false; // IE
        }
      }

      function isWithinContentEditableFalse(elm) {
        return isContentEditableFalse(getContentEditableRoot(editor.getBody(), elm));
      }

      function nativeControlSelect(e) {
        var target = e.srcElement;

        if (isWithinContentEditableFalse(target)) {
          preventDefault(e);
          return;
        }

        if (target != selectedElm) {
          editor.fire('ObjectSelected', { target: target });
          detachResizeStartListener();

          if (target.id.indexOf('mceResizeHandle') === 0) {
            e.returnValue = false;
            return;
          }

          if (target.nodeName == 'IMG' || target.nodeName == 'TABLE') {
            hideResizeRect();
            selectedElm = target;
            attachEvent(target, 'resizestart', resizeNativeStart);
          }
        }
      }

      function detachResizeStartListener() {
        detachEvent(selectedElm, 'resizestart', resizeNativeStart);
      }

      function unbindResizeHandleEvents() {
        for (var name in resizeHandles) {
          var handle = resizeHandles[name];

          if (handle.elm) {
            dom.unbind(handle.elm);
            delete handle.elm;
          }
        }
      }

      function disableGeckoResize() {
        try {
          // Disable object resizing on Gecko
          editor.getDoc().execCommand('enableObjectResizing', false, false);
        } catch (ex) {
          // Ignore
        }
      }

      function controlSelect(elm) {
        var ctrlRng;

        if (!isIE) {
          return;
        }

        ctrlRng = editableDoc.body.createControlRange();

        try {
          ctrlRng.addElement(elm);
          ctrlRng.select();
          return true;
        } catch (ex) {
          // Ignore since the element can't be control selected for example a P tag
        }
      }

      editor.on('init', function () {
        if (isIE) {
          // Hide the resize rect on resize and reselect the image
          editor.on('ObjectResized', function (e) {
            if (e.target.nodeName != 'TABLE') {
              hideResizeRect();
              controlSelect(e.target);
            }
          });

          attachEvent(rootElement, 'controlselect', nativeControlSelect);

          editor.on('mousedown', function (e) {
            lastMouseDownEvent = e;
          });
        } else {
          disableGeckoResize();

          // Sniff sniff, hard to feature detect this stuff
          if (Env.ie >= 11) {
            // NeeH 0 	`Cr E-@B$TrH!rk `m,Fp,"
m
d@ d@@ hZP1   &QeI
(";6,

P{PK8P O%3P* C 'D;)	HA NJD[J G>-ZGHZ6TH:"
U#3VIc3	%;.!U 
&GP-*QdE/(om8C!1pGCdalC- @
J&   RcRDS9jgIaN@L>R<,P00+ &R	T 	S Q H<NQA 	,lAh	Iu5P:=! @:i DAt8D2!#$ 6"*G"@S3`@"	&H0H%lOoBB3cEc
 c( z'F0b!U5L.L7F{S?`t$Qa-0]GW&N" WN_`Bf b!G8 
H,"nh&Q$0eH m
$g@0t$D@_c|"q@#
8,H a!2 `p @1,0(	P A; @B 8#BY-NtXV!,?!@dED
 da
H4L@L@!`pLbq p &
ap2B DmN)MQ ?1&CdE|zX$[& t
dD
bXR&p`Kp$S*b$RCG $6-l%SPDc`@ d2D..(b"%\AZ]\PrfzAT0$"P8k;4  
q `$A0q& K6yQ 2IP :D dpW$(4,Aq(R^sD]2h 0JHvMw"0B. t/TLCl-"C@$]!0!G!&}Pi&P" !H<yf1%CjXTglwg?V@#6;HPsHx+7F  (ap6! (MTDt	T"e: 3# @E1D`# @ c`;#8 M"2P0 422, $
]a"  	 EHx"!A  XTB@:C#uM-0R$<G)5VDa|"@`@luC8pA@=@E&Gi@@
 *C ,Qj `MrQ"1|A@)j@H	kb@|2jJ0 I0<S
NH52C (H -C1MLD	Oj(!P<  b bpa(D$@U(z)c@	HEAUDDK`!E $  Wt@JBhA0BM$ |@CpH5DKn0 .puRI		BDX
XW 	  il$T&F @RId"D!1uQkE q! :CZuP6T|]l!Lxpa2Cv:  *g	XH1R E(n `, 8D  2B5:L")&U+( TE@S.  D:@yq5P  
K  D 44SFRC@r>ZuK Z5+HF#/RP!i
.av*+.:A
 V$kPB iPL
@%h K2c%)X"0x6#L3\d!$FEJAFAB
D!)kHrK Oep
X =M%!$(P 1KI	0c@+@>EBC`7zE,@0 Hl$&H`Ki<$(D&U#DafF
AH&8h+PpBj	,Uj  D@5HD& #+%pH"H $oe4k4c+er%! ;mEHxG8_ &Q8GbMn1 !$GBVg VM dL6	R9Y g\N5U@u@()@b z5 KF4;1 

	#
	d@Q*$8@C)p@!@	&$B`\9$ D'  4DB` NQ& "5!2 m Z+3		
  A%@&!&@L@B uV! ,D3UHOB@ zVRP	B0rL&U B"$r`h (LDZC@:E*08HLb%5n> V. 	$&}\413  = |aOyR I 3 /@S0&EEFi4$FCzI8L1V@  &S@2;+8"PPk	
 < u QL$x
**Ba0 $A!pZd>Le@J(dxE:I
$s@ANLlC  bj-0 C4 #U#k	FKdq C#X5J&#8ss$ EE j4c# [$lPO@$P	x rq $NR@U7bZBJ lp#`'N T. VDr&{c8GPl0	Yhs@`l#E 0Y
C m h!a # k@tCw `RPE @?)	Tp@#bhPPT1!MAW| !D p@(ff "< 'e%) 4T @/	Q/8@0d$i**.Bj	 F '@V,)FZ
)bBml%an Cf "@Z~F.|nB1j.BYE @% !&P0   @CXbTQ0HF@ZQ $P 	T- HL@B&.0BH BH&,`$ @ 2EHL!KY%$(A0 3 pL C@Dr@G	DP"0AULdaJ"f3AC p@@$&
*4 C IDI8w0%e)XoA	Qli^0o   DXMT$ /m:|, o " A!V
C`E Uh; i++) {
          if (!args[i](x)) {
            return false;
          }
        }

        return true;
      };
    }

    function curry(fn) {
      var args = slice.call(arguments);

      if (args.length - 1 >= fn.length) {
        return fn.apply(this, args.slice(1));
      }

      return function () {
        var tempArgs = args.concat([].slice.call(arguments));
        return curry.apply(this, tempArgs);
      };
    }

    function noop() {
    }

    return {
      constant: constant,
      negate: negate,
      and: and,
      or: or,
      curry: curry,
      compose: compose,
      noop: noop
    };
  }
);
/**
 * CaretCandidate.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This module contains logic for handling caret candidates. A caret candidate is
 * for example text nodes, images, input elements, cE=false elements etc.
 *
 * @private
 * @class tinymce.caret.CaretCandidate
 */
define(
  'tinymce.core.caret.CaretCandidate',
  [
    "tinymce.core.dom.NodeType",
    "tinymce.core.util.Arr",
    "tinymce.core.caret.CaretContainer"
  ],
  function (NodeType, Arr, CaretContainer) {
    var isContentEditableTrue = NodeType.isContentEditableTrue,
      isContentEditableFalse = NodeType.isContentEditableFalse,
      isBr = NodeType.isBr,
      isText = NodeType.isText,
      isInvalidTextElement = NodeType.matchNodeNames('script style textarea'),
      isAtomicInline = NodeType.matchNodeNames('img input textarea hr iframe video audio object'),
      isTable = NodeType.matchNodeNames('table'),
      isCaretContainer = CaretContainer.isCaretContainer;

    function isCaretCandidate(node) {
      if (isCaretContainer(node)) {
        return false;
      }

      if (isText(node)) {
        if (isInvalidTextElement(node.parentNode)) {
          return false;
        }

        return true;
      }

      return isAtomicInline(node) || isBr(node) || isTable(node) || isContentEditableFalse(node);
    }

    function isInEditable(node, rootNode) {
      for (node = node.parentNode; node && node != rootNode; node = node.parentNode) {
        if (isContentEditableFalse(node)) {
          return false;
        }

        if (isContentEditableTrue(node)) {
          return true;
        }
      }

      return true;
    }

    function isAtomicContentEditableFalse(node) {
      if (!isContentEditableFalse(node)) {
        return false;
      }

      return Arr.reduce(node.getElementsByTagName('*'), function (result, elm) {
        return result || isContentEditableTrue(elm);
      }, false) !== true;
    }

    function isAtomic(node) {
      return isAtomicInline(node) || isAtomicContentEditableFalse(node);
    }

    function isEditableCaretCandidate(node, rootNode) {
      return isCaretCandidate(node) && isInEditable(node, rootNode);
    }

    return {
      isCaretCandidate: isCaretCandidate,
      isInEditable: isInEditable,
      isAtomic: isAtomic,
      isEditableCaretCandidate: isEditableCaretCandidate
    };
  }
);
/**
 * ExtendingChar.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class contains logic for detecting extending characters.
 *
 * @private
 * @class tinymce.text.ExtendingChar
 * @example
 * var isExtending = ExtendingChar.isExtendingChar('a');
 */
define(
  'tinymce.core.text.ExtendingChar',
  [
  ],
  function () {
    // Generated from: http://www.unicode.org/Public/UNIDATA/DerivedCoreProperties.txt
    // Only includes the characters in that fit into UCS-2 16 bit
    var extendingChars = new RegExp(
      "[\u0300-\u036F\u0483-\u0487\u0488-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A" +
      "\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0" +
      "\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08E3-\u0902\u093A\u093C" +
      "\u0941-\u0948\u094D\u0951-\u0957\u0962-\u0963\u0981\u09BC\u09BE\u09C1-\u09C4\u09CD\u09D7\u09E2-\u09E3" +
      "\u0A01-\u0A02\u0A3C\u0A41-\u0A42\u0A47-\u0A48\u0A4B-\u0A4D\u0A51\u0A70-\u0A71\u0A75\u0A81-\u0A82\u0ABC" +
      "\u0AC1-\u0AC5\u0AC7-\u0AC8\u0ACD\u0AE2-\u0AE3\u0B01\u0B3C\u0B3E\u0B3F\u0B41-\u0B44\u0B4D\u0B56\u0B57" +
      "\u0B62-\u0B63\u0B82\u0BBE\u0BC0\u0BCD\u0BD7\u0C00\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55-\u0C56" +
      "\u0C62-\u0C63\u0C81\u0CBC\u0CBF\u0CC2\u0CC6\u0CCC-\u0CCD\u0CD5-\u0CD6\u0CE2-\u0CE3\u0D01\u0D3E\u0D41-\u0D44" +
      "\u0D4D\u0D57\u0D62-\u0D63\u0DCA\u0DCF\u0DD2-\u0DD4\u0DD6\u0DDF\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9" +
      "\u0EBB-\u0EBC\u0EC8-\u0ECD\u0F18-\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86-\u0F87\u0F8D-\u0F97" +
      "\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039-\u103A\u103D-\u103E\u1058-\u1059\u105E-\u1060\u1071-\u1074" +
      "\u1082\u1085-\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752-\u1753\u1772-\u1773\u17B4-\u17B5" +
      "\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u18A9\u1920-\u1922\u1927-\u1928\u1932\u1939-\u193B\u1A17-\u1A18" +
      "\u1A1B\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1AB0-\u1ABD\u1ABE\u1B00-\u1B03\u1B34" +
      "\u1B36-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80-\u1B81\u1BA2-\u1BA5\u1BA8-\u1BA9\u1BAB-\u1BAD\u1BE6\u1BE8-\u1BE9" +
      "\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1CF8-\u1CF9" +
      "\u1DC0-\u1DF5\u1DFC-\u1DFF\u200C-\u200D\u20D0-\u20DC\u20DD-\u20E0\u20E1\u20E2-\u20E4\u20E5-\u20F0\u2CEF-\u2CF1" +
      "\u2D7F\u2DE0-\u2DFF\u302A-\u302D\u302E-\u302F\u3099-\u309A\uA66F\uA670-\uA672\uA674-\uA67D\uA69E-\uA69F\uA6F0-\uA6F1" +
      "\uA802\uA806\uA80B\uA825-\uA826\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC" +
      "\uA9E5\uAA29-\uAA2E\uAA31-\uAA32\uAA35-\uAA36\uAA43\uAA4C\uAA7C\uAAB0\uAAB2-\uAAB4\uAAB7-\uAAB8\uAABE-\uAABF\uAAC1" +
      "\uAAEC-\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFF9E-\uFF9F]"
    );

    function isExtendingChar(ch) {
      return typeof ch == "string" && ch.charCodeAt(0) >= 768 && extendingChars.test(ch);
    }

    return {
      isExtendingChar: isExtendingChar
    };
  }
);
/**
 * CaretPosition.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This module contains logic for creating caret positions within a document a caretposition
 * is similar to a DOMRange object but it doesn't have two endpoints and is also more lightweight
 * since it's now updated live when the DOM changes.
 *
 * @private
 * @class tinymce.caret.CaretPosition
 * @example
 * var caretPos1 = new CaretPosition(container, offset);
 * var caretPos2 = CaretPosition.fromRangeStart(someRange);
 */
define(
  'tinymce.core.caret.CaretPosition',
  [
    "tinymce.core.util.Fun",
    "tinymce.core.dom.NodeType",
    "tinymce.core.dom.DOMUtils",
    "tinymce.core.dom.RangeUtils",
    "tinymce.core.caret.CaretCandidate",
    "tinymce.core.geom.ClientRect",
    "tinymce.core.text.ExtendingChar"
  ],
  function (Fun, NodeType, DOMUtils, RangeUtils, CaretCandidate, ClientRect, ExtendingChar) {
    var isElement = NodeType.isElement,
      isCaretCandidate = CaretCandidate.isCaretCandidate,
      isBlock = NodeType.matchStyleValues('display', 'block table'),
      isFloated = NodeType.matchStyleValues('float', 'left right'),
      isValidElementCaretCandidate = Fun.and(isElement, isCaretCandidate, Fun.negate(isFloated)),
      isNotPre = Fun.negate(NodeType.matchStyleValues('white-space', 'pre pre-line pre-wrap')),
      isText = NodeType.isText,
      isBr = NodeType.isBr,
      nodeIndex = DOMUtils.nodeIndex,
      resolveIndex = RangeUtils.getNode;

    function createRange(doc) {
      return "createRange" in doc ? doc.createmI?UdW]RSy?7ok'_6+{om?8]|Bwk=O~aIsKmo6_wo(L<]h-<{
SV_:m!YI[EVFv|sz}l;3|zkCGn3m	1yKoeWWz2) <~Mwy:vf->4MlL;4vHuf>s<`isv8|jJr{;>ow}=7gT_{]?w?]nNgC;y\n|uwg?\6]E'Z?n?2c_Ro.ou:/2;egq+d%<_+:V;qq|m?1RNV;ww=:z}wt:-O}_9YOlj>Og+O~?S{*Oo[-}RW|_^hnsgWT=-^0-;kn?|=Zu=_<e~r7=S?zkF{{|y/S-	_xs{77z?%{Y'G3_Vz	,_>s7TmM\R 3}o7SobsmM{x'^~yo[7:vcIun[x?U67~(>TloYa|/3i[\GdW{_Wk(??z?omdrY{wuZSrqWrs4Z/xryx[YA"^h&g~~WjtcY:u;Wt8}[Vbww~{(?V|k:/TO/nMv^O#kcw_}|]Z3M}/N_g?;7Krsds4PJO{I]	qu}w7vn\{go	VLsi?~PBSw}fugo{'}+>6{w;O*T{~~W]7sWs3\'};ly|?{t_w[Is]>g=~V<;tWw=2uK}e^\8-.KKtquxw}Y?85f?p'9?]`i'toUoU)G_{?p?w:{FkO*O|?~J<Zw?_!W_{Gn{O7.+1]w[}o <{_{wZ~7klo[$WoMU/]VM]9Z]7pps[	WzS{sw_..xu-~s)].}okLy}+{goXUo"kbzu_jK}A|~O3KLcYp8OO|tSzw953?~w=o{~x}w]?K~~16[Gu'*w!b|5oqso^w}\wm#;r{6m=Oy9n^pXzC7xWWwyy}d}-u^Nrk4z>~~?wm[Xbs?dnww=~W[-Gz}_mzong?oup=_?W FRI*?56]+>hWg:(KW.twF~}0:789 NO9jyyf]CsoUg;j}{2gZ/]Wbww/[%^T}EvmVfVn%WY%NXw7]w3wYu_}<7~6?nc1K?v]zN25W3StgvgZ}C[s3>r]nw|6Yw^?]wuR#=w?ZB~vo6(l=W=U^/,9on:t+=/vNR_n;v}G<{-o?{y_FGl>+~/yB_Z=\>M[l+l~!o3.W>nOnW7Bw}|?}_Ga(Yr?/7O.-Z}mo{\;}_/z;6jkb]RN/o*)};kPv39]izE7X{xg~Syx[kS@\J9?&W!:C9g2dR-1I}yI7MWCxwoqSowVWTI! ^E>QwF?DS;F^f.#@@(C
` D A ,Q
H[ F*0  Hb$ FBl	)(@")7%`Z>$#3P)"p]qB Zj_.	TsS]z+woy=ds3kv|Zm0^SxBZS~}Kh[[Vw{+Wow}	;k>]O,}kQn{07W!`_O~=w
g@`(gG@S @a%c+ B"	.pR".@=   H O
cAdT8  /p-A1p pQ(JGN_|^GfqO,Juh,k.%9??=q|G?vVlQ;yyz5z 
 B
89 ;!Q:#ENQ QV #p Au a
 D<!:(&&6^IR-
F" DN	I,F@AB!vi   F;A 3CBD 1`	(<@eLP I:Qxj "0/`@!lP
L! !@pA  JTsngx=KRddwj&^U;Uw=?+WXSGYT^UbMb{~APE$` 7`8  I@$BB4GE
DTAb$E7D	j 
`LKh$^ Ty0dPQQcI#=T
P:59.>GFxek>eVYUw']Odu7xW$L_?]5vowi6/=[bn-o5}g_9g)yRok-k	n>?Lnw~>Yiyu}{O?hxDja a-@'q2D`S3 d?
  h\0BM`4`t _K pJ4"!$8J Ib@H"A(a 
  KD1\
JTVmV}/yo7U_Wl}d}yZ[w:}J9Esf_[p>Oz7}/F/_vmG4~7|@
FJ*p~ :R(Z\v(@`M $dG90I]
Wd) @%"	m}%fI9+H dF8 !r"Hd j"|2B ,$	>D&  
B
#(Kx 
r 15) Bt00,	pLJBJJC50xD(FFsTGq;rE6rVEwl^_R{

KLxY_ef]K{fm#NWoUy?~iwnf_M7]#?N];R@Bb@j1Tg(c#	$QpB(Xe,@D@gH7` .H4` PIz !	#@Bp	DR(PP:q9b_WK|{sot|/cM#J~=D}>ed|VO>-65;j_<>CgP?{LYuo~F6}'{O7={S#]{7Go{n!q #"!Kq 0)A  %j@Dt7Ga p`p	Y@	 8H 8U"*AAb!`A 0(6) xg$1eT:}5^|?J_i}?G0_}e_>/qhj>`*_^SOSLH HCp<``! [ @HY0KJ"a X8!@4Ta@4\ 8p 0&0 X efB 10,0.!G X#pa	<x G`P fS+#Z`A,8IX=P2QZJ(<&F 
)R7ScsZ;n]nwNu +,\r[iz-YkzoPm}0kiog^7=*I+=;}
B  A9 '$"C $)e`@ -m Pep
 2@d B@q@<LAu<8,`GIV`- D Rta)n2oom~Ls~W])v=k;-~*ws{#w_g(pg*FZOUMy7_=jWOou'j]^Z:CKO}{N54mmQ_pxY[amr?pB$@( '1ph0RD 1>&P  D AQz	
D "`"! ! (-t `4KeEP]@QU  Vz:vwgumw^eo>?>=w`yzi?d$q7&LDyrk??_ZrN tHj3E@
hCPPB	R` 4h@F 5'GPR@  "BVDA  h'=@p9fQ$Q X(0yR#%(B0D*"CD cI WIp)d 2eda )h #.L 1PD,i#&F k<
AKAB)@%:18&!t8q(qBqID&>z<<n\];;6ofv5c}+66|#op{:bNptB)Gp( 0P0@u6!K@6(A0H8	@LHPadr#FE>O` TH
r3B*4VJ[tUQE$ u0 tlVL_cc?-Es+gMF]es|o0nzN2sy_/?TOo>oU=7?{Oz?4F~k[wZK>F2}w{=fvou'w-s^]gm|7_o4_D,R ]@A!QQ  @pi\YO p@. c"&u`D8 j #<Wc( xPR!Z,2q   2&IIT\lB-()w~,w~y_~~gYzmz>4J{k'+gW]_7{ToXP458U/s?-+` (I@"
|ZHDJ"]A"t b (Bb`" .
&
	PD48Q2$?C0 `cB@# 
]SP0a4R2I`pG6HHP6BA2S@PG `"@P (`T'"`S`HLX R	QAZ!SDPB|A+E	 1#	xAIm`9j=}]R'a-_gPUu86}7oSy[V_1wg{W]sya^Ev>}>'EbrN`  +I0`NYh  a(UP]R-laD
@(L
FB,&-Q!A ypH@8{j|GWcogk5uUcNnK>wKqxo}e9rywv^c/wvJqGN%6Xe^}vpO~!7_Xtc[]tG?M'UOGoG#WBr$MpA*
J%= #80`8EDRDH  
):fPH|@j"H	e)IlrBB6 WD  KpG0 j	z @	@thIjg*zd{5+o8VM8e%9W&.ajoWU1O's/*5uu I&VTp  1B@0Xe	XHqB l 1)
*i 6|3
 aQt  3%p`DA MmXd U2$Cy5c(d<P
p@`$JB,C0 ,0i<b"p@D(!=
541@D*Q  @  #9 |goG"/~q[M=_]_qL?`/[_sN(=Z`Pkk7Si5G~Gn?50!@  p%Q L5 0(Q"x@@0SHB 
@9KB1J k$B 	hD!A$xb@8 8.HB#
.Y  +s18p s?twJ^{?z6{w}7Sf+];5SU+w~->1h1Cz{WW|+;s;P{"O:=S|8sk:<efn\gE{i}?IDid}wGkw^zvN=oz>V}X"
/8fvL@BB"F*h )E IJmL` BL&1kJSXD@#	
|a+!4 l kW $."T*E d
I  d02 ~y5sOy~yW$|ewRNI?s=P+G4`>S|2O0]_cFmFW?P d0("	9F4 5
#D+KL5T
H
D @ r  "dix G8!58%P_`Q@AQ '
<Cc Bb 
 8 @P}@@Gd5P`h
@% % b@a8	,2K@(#"i(8)$p i5
HA@	 Q_oP=79vGU	}:O6Ss([n=a.g.V~Kg{myW] $!Tf&JBd%R!MpA$!0	*lR3 @SD$zdAD.KE 
<	#  $hP( n&!    X2`D<({l9c>QG'7Xo>unfcS~>>[E~]rsPnS^KwY~?{w?w+YO >}X:]U8w{?wq^e3$|~6OO'7}
}1rk)=~ ` &LPbp0V  Bo!$c$##DeaBBW5	-%*l B"6 $(TDR'X1|\;n?pqw=]z!:Hz~crqWW/BzgIktK]Wkniv.*Hs~0u`Y j#  )JB0aB j` P &	K)!< q8NiQ*@"f>r\@`g@  6026*$)&(2!AAARij01xBcN@&tJP\B`GH, 	".	 H5Hu`FP!:\ 
 HZ>8N`a uNwGL=zNogzxnOo4G3|s^j{:[~)Y%6wwv7z]O   var parentNode = node.parentNode;

      if (isBogus(parentNode)) {
        return normalizedParent(parentNode);
      }

      return parentNode;
    }

    function getChildNodes(node) {
      if (!node) {
        return [];
      }

      return Arr.reduce(node.childNodes, function (result, node) {
        if (isBogus(node) && node.nodeName != 'BR') {
          result = result.concat(getChildNodes(node));
        } else {
          result.push(node);
        }

        return result;
      }, []);
    }

    function normalizedTextOffset(textNode, offset) {
      while ((textNode = textNode.previousSibling)) {
        if (!isText(textNode)) {
          break;
        }

        offset += textNode.data.length;
      }

      return offset;
    }

    function equal(targetValue) {
      return function (value) {
        return targetValue === value;
      };
    }

    function normalizedNodeIndex(node) {
      var nodes, index, numTextFragments;

      nodes = getChildNodes(normalizedParent(node));
      index = Arr.findIndex(nodes, equal(node), node);
      nodes = nodes.slice(0, index + 1);
      numTextFragments = Arr.reduce(nodes, function (result, node, i) {
        if (isText(node) && isText(nodes[i - 1])) {
          result++;
        }

        return result;
      }, 0);

      nodes = Arr.filter(nodes, NodeType.matchNodeNames(node.nodeName));
      index = Arr.findIndex(nodes, equal(node), node);

      return index - numTextFragments;
    }

    function createPathItem(node) {
      var name;

      if (isText(node)) {
        name = 'text()';
      } else {
        name = node.nodeName.toLowerCase();
      }

      return name + '[' + normalizedNodeIndex(node) + ']';
    }

    function parentsUntil(rootNode, node, predicate) {
      var parents = [];

      for (node = node.parentNode; node != rootNode; node = node.parentNode) {
        if (predicate && predicate(node)) {
          break;
        }

        parents.push(node);
      }

      return parents;
    }

    function create(rootNode, caretPosition) {
      var container, offset, path = [],
        outputOffset, childNodes, parents;

      container = caretPosition.container();
      offset = caretPosition.offset();

      if (isText(container)) {
        outputOffset = normalizedTextOffset(container, offset);
      } else {
        childNodes = container.childNodes;
        if (offset >= childNodes.length) {
          outputOffset = 'after';
          offset = childNodes.length - 1;
        } else {
          outputOffset = 'before';
        }

        container = childNodes[offset];
      }

      path.push(createPathItem(container));
      parents = parentsUntil(rootNode, container);
      parents = Arr.filter(parents, Fun.negate(NodeType.isBogus));
      path = path.concat(Arr.map(parents, function (node) {
        return createPathItem(node);
      }));

      return path.reverse().join('/') + ',' + outputOffset;
    }

    function resolvePathItem(node, name, index) {
      var nodes = getChildNodes(node);

      nodes = Arr.filter(nodes, function (node, index) {
        return !isText(node) || !isText(nodes[index - 1]);
      });

      nodes = Arr.filter(nodes, NodeType.matchNodeNames(name));
      return nodes[index];
    }

    function findTextPosition(container, offset) {
      var node = container, targetOffset = 0, dataLen;

      while (isText(node)) {
        dataLen = node.data.length;

        if (offset >= targetOffset && offset <= targetOffset + dataLen) {
          container = node;
          offset = offset - targetOffset;
          break;
        }

        if (!isText(node.nextSibling)) {
          container = node;
          offset = dataLen;
          break;
        }

        targetOffset += dataLen;
        node = node.nextSibling;
      }

      if (offset > container.data.length) {
        offset = container.data.length;
      }

      return new CaretPosition(container, offset);
    }

    function resolve(rootNode, path) {
      var parts, container, offset;

      if (!path) {
        return null;
      }

      parts = path.split(',');
      path = parts[0].split('/');
      offset = parts.length > 1 ? parts[1] : 'before';

      container = Arr.reduce(path, function (result, value) {
        value = /([\w\-\(\)]+)\[([0-9]+)\]/.exec(value);
        if (!value) {
          return null;
        }

        if (value[1] === 'text()') {
          value[1] = '#text';
        }

        return resolvePathItem(result, value[1], parseInt(value[2], 10));
      }, rootNode);

      if (!container) {
        return null;
      }

      if (!isText(container)) {
        if (offset === 'after') {
          offset = nodeIndex(container) + 1;
        } else {
          offset = nodeIndex(container);
        }

        return new CaretPosition(container.parentNode, offset);
      }

      return findTextPosition(container, parseInt(offset, 10));
    }

    return {
      /**
       * Create a xpath bookmark location for the specified caret position.
       *
       * @method create
       * @param {Node} rootNode Root node to create bookmark within.
       * @param {tinymce.caret.CaretPosition} caretPosition Caret position within the root node.
       * @return {String} String xpath like location of caret position.
       */
      create: create,

      /**
       * Resolves a xpath like bookmark location to the a caret position.
       *
       * @method resolve
       * @param {Node} rootNode Root node to resolve xpath bookmark within.
       * @param {String} bookmark Bookmark string to resolve.
       * @return {tinymce.caret.CaretPosition} Caret position resolved from xpath like bookmark.
       */
      resolve: resolve
    };
  }
);
/**
 * BookmarkManager.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class handles selection bookmarks.
 *
 * @class tinymce.dom.BookmarkManager
 */
define(
  'tinymce.core.dom.BookmarkManager',
  [
    'tinymce.core.caret.CaretBookmark',
    'tinymce.core.caret.CaretContainer',
    'tinymce.core.caret.CaretPosition',
    'tinymce.core.dom.NodeType',
    'tinymce.core.dom.RangeUtils',
    'tinymce.core.Env',
    'tinymce.core.text.Zwsp',
    'tinymce.core.util.Tools'
  ],
  function (CaretBookmark, CaretContainer, CaretPosition, NodeType, RangeUtils, Env, Zwsp, Tools) {
    var isContentEditableFalse = NodeType.isContentEditableFalse;

    var getNormalizedTextOffset = function (container, offset) {
      var node, trimmedOffset;

      trimmedOffset = Zwsp.trim(container.data.slice(0, offset)).length;
      for (node = container.previousSibling; node && node.nodeType === 3; node = node.previousSibling) {
        trimmedOffset += Zwsp.trim(node.data).length;
      }

      return trimmedOffset;
    };

    /**
     * Constructs a new BookmarkManager instance for a specific selection instance.
     *
     * @constructor
     * @method BookmarkManager
     * @param {tinymce.dom.Selection} selection Selection instance to handle bookmarks for.
     */
    function BookmarkManager(selection) {
      var dom = selection.dom;

      /**
       * Returns a bookmark location for the current selection. This bookmark object
       * can then be used to restore the selection after some content modification to the document.
       *
       * @method getBookmark
       * @param {Number} type Optional state if the bookmark should be simple or not. Default is complex.
       * @param {Boolean} normalized Optional state that enables you to get a position that it would be after normalization.
       * @return {Object} Bookmark object, use moveToBookmark with this object to restore the selection.
       * @example
       * // Stores a bookmark of the current selection
       * var bm = tinymce.activeEditor.selection.getBookmark();
       *
       * tinymce.activeEditor.setContent(tinymce.activeEditor.getContent() + 'Some new content');
       *
       * // Restore the selection bookmark
       * tinymce.activeEditor.selection.moveToBookmark(bm);
       */
      t}'Y?9{Sm-KvWT_}O}y/23<j6gW]wXs}`uW%_!&P `@*	N-J
IH<X!0 B6#P  Pg@AI&`'QTV%3Y `LzQe V22)Bbd@v1drQ+dcHC`FB$5	b	BY0"PBS F1Y?KePL5BU;tX*.RQBEt
MB>c(v)@;{b/~s<wx5=Ye<~[nC~?w?~3[Z~];	N7?{?u#iu Hn`HP`Ib9)D$b FcB B@)y@H+A@d	ke|*A/:`6+R!@'#@`':!Uh/tz]O}{	][}?_{ofz5S^[}fjn3~{=Uy5!lytv~j9G'J%}.V[wn{v~_vyz_=:~^/[-@LBAht[hDY22	0A `&C!$$ Qp	}wE"UE|hPHJ)QM#HJa"BAp41x&zsmr:iYv|/'Myj[ans;oL_ugv/Ozte QC a:;P<-tb![.&cBIabC<#	ROi1$"	 CUff"2S0$65x\@!E%Xa   R@28C`OAP 85OF!@!QZ "9v`Vp5)103I:(DX8IIjy*F Z  Ohx5	1%sH97Xdc@wcoY3m=nDx6YgD;u+?e8?wgK2<wK6M  !RP#6HR kV7G5	]}w))I@c  KT+iFp`TAyW F,,-h,6
 oV%9<Y=]y_{u~__Gum}V_i)i/cm?'y>;XgTr8X-\Oo]u^Vm\>xtEX?~/^u_Soe1'oSYu8j@& P [J@6(RXmQ	F6Nw/33	B`,FBit 'R@LF `hv1tlRwjZ!pDeE,1_"Pc fYs!kwI7_+>]F}{Was+.}Wr6J}4ssb|Gy?qt(!]RT##Pv FP,C5 y;iAce#	`PY!K(p@5""DMAPg@)19,4WPV=T8Xg&<$In@K2:@%I8Ae`$ aPFG:*CDh#*@p 8HSL#@f)oRVgnBv `auQ8RST.! XtYq,:_ot_MZniO[j^/_j>z^oyyu;=?v]-73Z1g'oX}oxkv(-RB84HZ0`L*GpFfp9 (eam2JI
@.I #%(h!AxE !@`3U)AJ(3I Hdnk}gGOW=Zq7G{~q=[~g5?KP{m[gtUl9_5z}:~\\v.^7SS#}^W!^~rxFV|w0N?
?fz:g C'WB*x !DIl)0QHmiG(
tmetfBEH
0DJA4^BH@`pP^__lg$w/s7.cwO]ky_+n9jR~~{) 46
1A"@&GY2a<L$$fT
Q C!BJ0PDTZQA& "@i
X $|AE3ER^at S+BT"Lb@RMs`@ m FLq.g[ B	d
B	J5CA+ CX9JT"ND(
.)DP D@LR2 "n9ok{?~n{m^WTo:{s{/k[un<qqpy|n/~/ SFBr2 s-@5:@ u (D$"1`C@u`j2Ab2pP#A T!LDIb,6@ DlNE=-z}OwlKoJz<{;<}|?m<1=ys:f~o-z^OLr=K	d|k?>j /~jwJf}{vw>>5}_}4>{%*.d 8B0/
 \bQ#CU, 8f4%@%"D09 Jh'&|D/J@PnQA<u2A 'Ub@D9V- rKkI3ows~r__r7{[e6{_W:P~w.ilYkH|=#u-GwoiZFIz7}>bRCt?TgrZf	WVWzngoVsu>g_/g1|hM,9cV{}\Js.]U;qj_goxem#^;w?uo(mz;r8hOU[>A?^ju/9]{;'{v1k{1&O*~O}C^g/t5Wc|3M?K}9M}g_gmD&9_|/Fg??yenu-da/]s|yZ;WgcsngW7&==OgezZ+4t.1?~_?Wn{=n}6awGz9,'nGtnJ7oN#`.bo|xyo{D_2;Or/MZ~o?}oa-Yo_W]p=g7/;wg'\G-k2m9O-e%GOo[_^~W_u16j}J7o&/ua];^_h|<>}r|3\_2~~uk~;{~=boz~yoO+Bsfu*5S8~'%_#w[_{~;w?ld)+{uuw~MwG*-[7]w~cK<;tu9/?;[e?_Lg]vW{V_wzke~nVsO_~+x_i(w{-i}r[S.+}Pz}U,o=#W=i)~9_W=3W=5=.0~o:~U;>m8lb6|6t1<vh{ T[+mboA#]]]q||/glz=%4tzr|{FkSyn5]WB=tb}~wg~so|?[}+_~4//wSuu3vh|oYyl]dI5^Z?=_^wo[~Z8?s~'g~Igi4?Z6{5~=;I?=gxs:]7u]_;_MOu%q'_w|8*O{qi-msk^{{;?z.M?}}UngK4_ZN?|o^*sq8>lC?]_s{i![G/L[(}eewu'Mt7F>~7Iuj~WlG[Gl	W~ye>ynYWy&\8Wpkm6ST??o_=?]o]=M+_O~-z^O\I~n<.qo?^vo8^VnxNNGMCnn|ef1SKBwE{ojz&Nj/on?g1_r'yNbCoNK>%m[recS=Z&o dy>WnV[uOW_zwOm1rO}|y|Mj?O_<Bl?Y~?]T]~{u6tZo-FGl{]>nZvi/vo~~L 7vOYdno&5]2[[n#jk'']$F/^.^,gk7~=Y?fUst{k~)lz}~]}gv{<omu}!O/3>,Wwk~8'x<];4;~.k>m-n,f|zt{+io{\~oO/c?;P?B8xy~w_4gCgguk?wWD??kGz'Oog7\}nW=?ZNSm,RPq[n/F))wK{?GKmvO*_Cj{uN@_2nww]S?}z-{M;~o~.h-uHONwnbms?zI+}tP;c}G}nSN5a_Z,}~_/
'U~wmt)O?ufc~yre+w$S$Wr3[w~}9|#?O_?w>G_jGn_jEgWg%^q=7}sbVuQQ3_+9Isf+}?u_R]=~.i`osSbw/-32vx=U^?oPve5	]1O}__r9t;yv_]wo}}Xqm        }

            // Move element offset to best suitable location
            if (node.nodeType === 1) {
              offset = Math.min(point[0], node.childNodes.length);
            }

            // Set offset within container node
            if (start) {
              rng.setStart(node, offset);
            } else {
              rng.setEnd(node, offset);
            }
          }

          return true;
        }

        function restoreEndPoint(suffix) {
          var marker = dom.get(bookmark.id + '_' + suffix), node, idx, next, prev, keep = bookmark.keep;

          if (marker) {
            node = marker.parentNode;

            if (suffix == 'start') {
              if (!keep) {
                idx = dom.nodeIndex(marker);
              } else {
                node = marker.firstChild;
                idx = 1;
              }

              startContainer = endContainer = node;
              startOffset = endOffset = idx;
            } else {
              if (!keep) {
                idx = dom.nodeIndex(marker);
              } else {
                node = marker.firstChild;
                idx = 1;
              }

              endContainer = node;
              endOffset = idx;
            }

            if (!keep) {
              prev = marker.previousSibling;
              next = marker.nextSibling;

              // Remove all marker text nodes
              Tools.each(Tools.grep(marker.childNodes), function (node) {
                if (node.nodeType == 3) {
                  node.nodeValue = node.nodeValue.replace(/\uFEFF/g, '');
                }
              });

              // Remove marker but keep children if for example contents where inserted into the marker
              // Also remove duplicated instances of the marker for example by a
              // split operation or by WebKit auto split on paste feature
              while ((marker = dom.get(bookmark.id + '_' + suffix))) {
                dom.remove(marker, 1);
              }

              // If siblings are text nodes then merge them unless it's Opera since it some how removes the node
              // and we are sniffing since adding a lot of detection code for a browser with 3% of the market
              // isn't worth the effort. Sorry, Opera but it's just a fact
              if (prev && next && prev.nodeType == next.nodeType && prev.nodeType == 3 && !Env.opera) {
                idx = prev.nodeValue.length;
                prev.appendData(next.nodeValue);
                dom.remove(next);

                if (suffix == 'start') {
                  startContainer = endContainer = prev;
                  startOffset = endOffset = idx;
                } else {
                  endContainer = prev;
                  endOffset = idx;
                }
              }
            }
          }
        }

        function addBogus(node) {
          // Adds a bogus BR element for empty block elements
          if (dom.isBlock(node) && !node.innerHTML && !Env.ie) {
            node.innerHTML = '<br data-mce-bogus="1" />';
          }

          return node;
        }

        function resolveCaretPositionBookmark() {
          var rng, pos;

          rng = dom.createRng();
          pos = CaretBookmark.resolve(dom.getRoot(), bookmark.start);
          rng.setStart(pos.container(), pos.offset());

          pos = CaretBookmark.resolve(dom.getRoot(), bookmark.end);
          rng.setEnd(pos.container(), pos.offset());

          return rng;
        }

        if (bookmark) {
          if (Tools.isArray(bookmark.start)) {
            rng = dom.createRng();
            root = dom.getRoot();

            if (selection.tridentSel) {
              return selection.tridentSel.moveToBookmark(bookmark);
            }

            if (setEndPoint(true) && setEndPoint()) {
              selection.setRng(rng);
            }
          } else if (typeof bookmark.start == 'string') {
            selection.setRng(resolveCaretPositionBookmark(bookmark));
          } else if (bookmark.id) {
            // Restore start/end points
            restoreEndPoint('start');
            restoreEndPoint('end');

            if (startContainer) {
              rng = dom.createRng();
              rng.setStart(addBogus(startContainer), startOffset);
              rng.setEnd(addBogus(endContainer), endOffset);
              selection.setRng(rng);
            }
          } else if (bookmark.name) {
            selection.select(dom.select(bookmark.name)[bookmark.index]);
          } else if (bookmark.rng) {
            selection.setRng(bookmark.rng);
          }
        }
      };
    }

    /**
     * Returns true/false if the specified node is a bookmark node or not.
     *
     * @static
     * @method isBookmarkNode
     * @param {DOMNode} node DOM Node to check if it's a bookmark node or not.
     * @return {Boolean} true/false if the node is a bookmark node or not.
     */
    BookmarkManager.isBookmarkNode = function (node) {
      return node && node.tagName === 'SPAN' && node.getAttribute('data-mce-type') === 'bookmark';
    };

    return BookmarkManager;
  }
);
define(
  'ephox.katamari.api.Global',

  [
  ],

  function () {
    // Use window object as the global if it's available since CSP will block script evals
    if (typeof window !== 'undefined') {
      return window;
    } else {
      return Function('return this;')();
    }
  }
);


define(
  'ephox.katamari.api.Resolve',

  [
    'ephox.katamari.api.Global'
  ],

  function (Global) {
    /** path :: ([String], JsObj?) -> JsObj */
    var path = function (parts, scope) {
      var o = scope !== undefined ? scope : Global;
      for (var i = 0; i < parts.length && o !== undefined && o !== null; ++i)
        o = o[parts[i]];
      return o;
    };

    /** resolve :: (String, JsObj?) -> JsObj */
    var resolve = function (p, scope) {
      var parts = p.split('.');
      return path(parts, scope);
    };

    /** step :: (JsObj, String) -> JsObj */
    var step = function (o, part) {
      if (o[part] === undefined || o[part] === null)
        o[part] = {};
      return o[part];
    };

    /** forge :: ([String], JsObj?) -> JsObj */
    var forge = function (parts, target) {
      var o = target !== undefined ? target : Global;      
      for (var i = 0; i < parts.length; ++i)
        o = step(o, parts[i]);
      return o;
    };

    /** namespace :: (String, JsObj?) -> JsObj */
    var namespace = function (name, target) {
      var parts = name.split('.');
      return forge(parts, target);
    };

    return {
      path: path,
      resolve: resolve,
      forge: forge,
      namespace: namespace
    };
  }
);


define(
  'ephox.sand.util.Global',

  [
    'ephox.katamari.api.Resolve'
  ],

  function (Resolve) {
    var unsafe = function (name, scope) {
      return Resolve.resolve(name, scope);
    };

    var getOrDie = function (name, scope) {
      var actual = unsafe(name, scope);

      if (actual === undefined) throw name + ' not available on this browser';
      return actual;
    };

    return {
      getOrDie: getOrDie
    };
  }
);
define(
  'ephox.sand.api.Node',

  [
    'ephox.sand.util.Global'
  ],

  function (Global) {
    /*
     * MDN says (yes) for IE, but it's undefined on IE8
     */
    var node = function () {
      var f = Global.getOrDie('Node');
      return f;
    };

    /*
     * Most of numerosity doesn't alter the methods on the object.
     * We're making an exception for Node, because bitwise and is so easy to get wrong.
     *
     * Might be nice to ADT this at some point instead of having individual methods.
     */

    var compareDocumentPosition = function (a, b, match) {
      // Returns: 0 if e1 and e2 are the same node, or a bitmask comparing the positions
      // of nodes e1 and e2 in their documents. See the URL below for bitmask interpretation
      // https://developer.mozilla.org/en-US/docs/Web/API/Node/compareDocumentPosition
      return (a.compareDocumentPosition(b) & match) !== 0;
    };

    var documentPositionPreceding = function (a, b) {
      return compareDocumentPosition(a, b, node().DOCUMENT_POSITION_PRECEDING);
    };

    var docum1Z 5		3E(x1\b, B`#Cv!&!ULBa#adCUA O	B51E> I0/bU^~Nz-XO-S~kl_^w[=am}Moj}M^w<;_T?w_nG?9]f`{6]n,uUpOx~+{]qv/B_Wo%9L.8tH#'Y5?GOFHB!gC` aIb!eJ8(Q D0(L!T'-AD+c"5rmNa"F\g>	/`D]/ztn;w?"=>{;>Wz?}^xo?Z}~[3 x+~ex{W P1E#7#9 X%'4$jY 	g*VM(\@5#o
iqII7A /2!SAH~)Q d25;P  SM?h,#*' ^2 ;QRW*U3
&WK; Y&gf)0+@A2@" (U
yz'1CinE	*	2
obH9ihUp&8uT?,7t}Kx~'5^_}y\~6:Y]lbV].g|O}wRz/9_{ (qYbN 8N?kFBSNP@F*F"G$ANhO#RpA Z8PDHf-4SBN$XNLVYC$ 
tG}lox,Z=g~|^{}_ZQSi.]>&\yK|\Y8nP-}i{;noZ{|@}f/vmwM;$he@EB
h~i0 '&CT)qC!,:H4Q,E
w02|Lx%`a+2aM)~{8T BD`OCr#J- {./R_~w,KHeJrn]<)o1?wT{k/g-Xy$@| qp `WHMK.E2#xZzUBi^"'%Sn?B&)sZbJNH;#q$`1>MD&PIcB@3D!@&C	~'9H>6*<6a7DeBbBN$THsXSld)AaLPfBJ $T(cI* L(Bz%8]!U)(?AUsypj{|_w?k_^{_9|x_#lzm}nO_>DG_~/?g~S^W?;PFlS1lw{W.CaLr	Ci6Kc`$mY'VH,@eA.'*h"yMZ
pn*
6d1D"WjeDRf"vEz3k^;\=\l3Yi]/K}m^sw=qZfnK>v	`^v{]7wj^5&:_oT}7_k9ZS{wO<g;n~^gz>?1ox@G'@h@9
\G_jy!	6!L5C,cs
	'6R$P!1CC(P	]@TAHbE`/!a	`6i_|N=g}~[.soM`/iS}>;TyWG<'crj{R+O@0 @zAo+V\ A>2BJ.2U	nO1LFlGN+AH I $JmC" ZgDcx,|\@B#=)`	P1d:P@}Z$5A}Ne   BXA"C
t)` uB
)`{I#)7/a%	A0,P,fAES}
NP,E4a*]|s~'_9z~jzZn}{E5/ruWy?cG=R|/'u}|=lN{l  i'72-5#M9bp#$%`v$GAHH4bw$F9<@Hd&VbNh8r $l2D
)D zp8 ;M/v'm;o/c?O}or_kHwoz;,*f?[tl~$O>Gmfx_i{*"q.}~{U~oh7{'Og~{_|}#=Itz/ar_NAzFvRXsTgPT&~ V;j&F [C'bj!Pz
{@	YD3eJGe"Rf8)AyUT0ZE8OA$`'d^ue]y}Oi??[Gr}s-e~~?[uwnc}^Z}a;?_? !7W0E@T(5UDjF&Yp
\6 [f"3   FAF( j	$c1"Gxq
%!t.O	zY( U
lD"@Y"#)%x4C$ $Y2* XP> !2D
P`%@*0@bH`,"YHgsE 8}|g}e,fugu>;p_MtQ~z~giktxXF%_O}~/Jw}=z>}%ZX4Du@j09S. F		0"`\,Ma&F j'E`BaZ$
	 tU:Ar8	j,bZDF	 :-b*,IdZ)B A D5) L P
XP
 $R2a4PUGhTP&PXIcw,&P  Q"( Z1H"D^ P@[
!	wF!-)APD\@ LQm2D0 <@$ ]R`( QD)Ae	kdH @`IP"Y   -"IDOO( &8@
$F) %bKz*\?HA&:8N9 +sPF0,	`@`HRF#"!pa"srR#  j P'h	`YM*" 	!H A@ ;d'YEtB	
_-5 K4 370D, @A8Q"EDpXZieAX
TG>@dtCpXB:4]lf34M]@#D&I Goqx\-fQC?nUu1+G3tdO'+Ff>$Mvrb\t<@UHM	
&o%QKPPA@CF*#A Ji621">.9'd D.r#B9o3 DvBg'C  ((21
d @LcD D608VH`K$!
,B #WC.` iH TO@.RG81 EnaS,#!S"U"l#SPn<|PZ"6pyVh12YQ@.>I!Z  	KVp(~#(*i PB#gVyK6`L	G  F$ 0H0@'   A`OD8:B#HJ(Pu "j,|q S (5 Tc@@JA	EbvRd8lU !@x 1
@ *5.14( Xb )	S @ &	0 ;G
"AA`C` J	 !
Pp xB3aP+an@*eL2}4Zl
F
 &)q4:$}HqBf[}zl	> XD3}r'(`YH/9aAS:F6 $\PUD @  X na
wA(~"  0!=@@H$0Dd@'Dp H80jT1Y11$j < !@j @Rl@fYD 
'CS&!BZJ"T@!\BBpSJF3pXkS+4A<bz#P[9@q$`!%A-L Gqk`PpQ@`2#.zO H RB> kQvpVPfR	)APj18ED  E@|)L9Q ` ALKX8@X\"< d8B0@8^F(@ #PHhbTB"[`4YBU]p`ZDgU0;BGJoP"	JP'(>&$3"$bNh)GHukI0 hAHR_2AEP  F"I( qeBc(L@78HhHj4#c4KWGaA9  a$!B, 	 &	B:d  #{"	 
Mb-V A  s:D4C `l 190X(
G $,fEj0+Pa@(PiH
Q!@QaQ02PD A&"!^ 8-rG (JX,   ""X  dicR#`zeCV@20Z+>Y 7k@DFT" RM!&@rXPEF) 
&x
-4oR	@	5R6ZXnAt<!`&ZCb,$#!a 9A
#aA!	D  UH  0N5@HT(h)*8@	`!%@hL $v@`@
[Gat@I@'u 	;T ^#\E/bX``tETPqzpM+%`PTK [ d'rn\ D@ro_0*nwG*TabtgVA3L e~pG=G
MCIRJv\HC	h.@3$EB@"\t"Q)G`	06blU	V LxdbiX&<&2H $C6 B2 $`=dIAx^8Fp HQMi"JX"bP
02H( A*A@]:EpJpc8
BI\iaI(2bTPD@& a&g& @d"p<c! I$~Pc1 I0lDXe$B@`	e   CF%dA@A=Pv4	  b6,1B CG@Pa!Z$  \Th@(-0Pt@A E
aX`4 D  A
AAnB@8D h  I	T  BXK0BRT(BH d 5 @qB D9# .L 
8Z 
P x!
XYFAA&`-94F%Vi>UdJ=Mb@!#M;)p	`UT$#`OVt-dN|:$qTO wDR!& 8D@lErP +zRi	"	4"T
f(ZYC `T@G)I$`f,(	9R	03RW""%pBpB$ NP$2u  cB5AHam5XYD@H q<@6&JQ" !JK
`rYt6zS	 3"&CBQ$
EpH2e!DTFY5FfTaG,dTFa aXMUB` Be!0 p   J4  2;:2td 6.@ `% 
E2(SD  -	%D@(( 80B "(Z `(@@GP!@ P
 D%`@! *jd: head,
      tail: tail
    };
  }
);
define(
  'ephox.katamari.api.Strings',

  [
    'ephox.katamari.str.StrAppend',
    'ephox.katamari.str.StringParts',
    'global!Error'
  ],

  function (StrAppend, StringParts, Error) {
    var checkRange = function(str, substr, start) {
      if (substr === '') return true;
      if (str.length < substr.length) return false;
      var x = str.substr(start, start + substr.length);
      return x === substr;
    };

    /** Given a string and object, perform template-replacements on the string, as specified by the object.
     * Any template fields of the form ${name} are replaced by the string or number specified as obj["name"]
     * Based on Douglas Crockford's 'supplant' method for template-replace of strings. Uses different template format.
     */
    var supplant = function(str, obj) {
      var isStringOrNumber = function(a) {
        var t = typeof a;
        return t === 'string' || t === 'number';
      };

      return str.replace(/\${([^{}]*)}/g,
        function (a, b) {
          var value = obj[b];
          return isStringOrNumber(value) ? value : a;
        }
      );
    };

    var removeLeading = function (str, prefix) {
      return startsWith(str, prefix) ? StrAppend.removeFromStart(str, prefix.length) : str;
    };

    var removeTrailing = function (str, prefix) {
      return endsWith(str, prefix) ? StrAppend.removeFromEnd(str, prefix.length) : str;
    };

    var ensureLeading = function (str, prefix) {
      return startsWith(str, prefix) ? str : StrAppend.addToStart(str, prefix);
    };

    var ensureTrailing = function (str, prefix) {
      return endsWith(str, prefix) ? str : StrAppend.addToEnd(str, prefix);
    };
 
    var contains = function(str, substr) {
      return str.indexOf(substr) !== -1;
    };

    var capitalize = function(str) {
      return StringParts.head(str).bind(function (head) {
        return StringParts.tail(str).map(function (tail) {
          return head.toUpperCase() + tail;
        });
      }).getOr(str);
    };

    /** Does 'str' start with 'prefix'?
     *  Note: all strings start with the empty string.
     *        More formally, for all strings x, startsWith(x, "").
     *        This is so that for all strings x and y, startsWith(y + x, y)
     */
    var startsWith = function(str, prefix) {
      return checkRange(str, prefix, 0);
    };

    /** Does 'str' end with 'suffix'?
     *  Note: all strings end with the empty string.
     *        More formally, for all strings x, endsWith(x, "").
     *        This is so that for all strings x and y, endsWith(x + y, y)
     */
    var endsWith = function(str, suffix) {
      return checkRange(str, suffix, str.length - suffix.length);
    };

   
    /** removes all leading and trailing spaces */
    var trim = function(str) {
      return str.replace(/^\s+|\s+$/g, '');
    };

    var lTrim = function(str) {
      return str.replace(/^\s+/g, '');
    };

    var rTrim = function(str) {
      return str.replace(/\s+$/g, '');
    };

    return {
      supplant: supplant,
      startsWith: startsWith,
      removeLeading: removeLeading,
      removeTrailing: removeTrailing,
      ensureLeading: ensureLeading,
      ensureTrailing: ensureTrailing,
      endsWith: endsWith,
      contains: contains,
      trim: trim,
      lTrim: lTrim,
      rTrim: rTrim,
      capitalize: capitalize
    };
  }
);

define(
  'ephox.sand.info.PlatformInfo',

  [
    'ephox.katamari.api.Fun',
    'ephox.katamari.api.Strings'
  ],

  function (Fun, Strings) {
    var normalVersionRegex = /.*?version\/\ ?([0-9]+)\.([0-9]+).*/;

    var checkContains = function (target) {
      return function (uastring) {
        return Strings.contains(uastring, target);
      };
    };

    var browsers = [
      {
        name : 'Edge',
        versionRegexes: [/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],
        search: function (uastring) {
          var monstrosity = Strings.contains(uastring, 'edge/') && Strings.contains(uastring, 'chrome') && Strings.contains(uastring, 'safari') && Strings.contains(uastring, 'applewebkit');
          return monstrosity;
        }
      },
      {
        name : 'Chrome',
        versionRegexes: [/.*?chrome\/([0-9]+)\.([0-9]+).*/, normalVersionRegex],
        search : function (uastring) {
          return Strings.contains(uastring, 'chrome') && !Strings.contains(uastring, 'chromeframe');
        }
      },
      {
        name : 'IE',
        versionRegexes: [/.*?msie\ ?([0-9]+)\.([0-9]+).*/, /.*?rv:([0-9]+)\.([0-9]+).*/],
        search: function (uastring) {
          return Strings.contains(uastring, 'msie') || Strings.contains(uastring, 'trident');
        }
      },
      // INVESTIGATE: Is this still the Opera user agent?
      {
        name : 'Opera',
        versionRegexes: [normalVersionRegex, /.*?opera\/([0-9]+)\.([0-9]+).*/],
        search : checkContains('opera')
      },
      {
        name : 'Firefox',
        versionRegexes: [/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],
        search : checkContains('firefox')
      },
      {
        name : 'Safari',
        versionRegexes: [normalVersionRegex, /.*?cpu os ([0-9]+)_([0-9]+).*/],
        search : function (uastring) {
          return (Strings.contains(uastring, 'safari') || Strings.contains(uastring, 'mobile/')) && Strings.contains(uastring, 'applewebkit');
        }
      }
    ];

    var oses = [
      {
        name : 'Windows',
        search : checkContains('win'),
        versionRegexes: [/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]
      },
      {
        name : 'iOS',
        search : function (uastring) {
          return Strings.contains(uastring, 'iphone') || Strings.contains(uastring, 'ipad');
        },
        versionRegexes: [/.*?version\/\ ?([0-9]+)\.([0-9]+).*/, /.*cpu os ([0-9]+)_([0-9]+).*/, /.*cpu iphone os ([0-9]+)_([0-9]+).*/]
      },
      {
        name : 'Android',
        search : checkContains('android'),
        versionRegexes: [/.*?android\ ?([0-9]+)\.([0-9]+).*/]
      },
      {
        name : 'OSX',
        search : checkContains('os x'),
        versionRegexes: [/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]
      },
      {
        name : 'Linux',
        search : checkContains('linux'),
        versionRegexes: [ ]
      },
      { name : 'Solaris',
        search : checkContains('sunos'),
        versionRegexes: [ ]
      },
      {
       name : 'FreeBSD',
       search : checkContains('freebsd'),
       versionRegexes: [ ]
      }
    ];

    return {
      browsers: Fun.constant(browsers),
      oses: Fun.constant(oses)
    };
  }
);
define(
  'ephox.sand.core.PlatformDetection',

  [
    'ephox.sand.core.Browser',
    'ephox.sand.core.OperatingSystem',
    'ephox.sand.detect.DeviceType',
    'ephox.sand.detect.UaString',
    'ephox.sand.info.PlatformInfo'
  ],

  function (Browser, OperatingSystem, DeviceType, UaString, PlatformInfo) {
    var detect = function (userAgent) {
      var browsers = PlatformInfo.browsers();
      var oses = PlatformInfo.oses();

      var browser = UaString.detectBrowser(browsers, userAgent).fold(
        Browser.unknown,
        Browser.nu
      );
      var os = UaString.detectOs(oses, userAgent).fold(
        OperatingSystem.unknown,
        OperatingSystem.nu
      );
      var deviceType = DeviceType(os, browser, userAgent);

      return {
        browser: browser,
        os: os,
        deviceType: deviceType
      };
    };

    return {
      detect: detect
    };
  }
);
defineGlobal("global!navigator", navigator);
define(
  'ephox.sand.api.PlatformDetection',

  [
    'ephox.katamari.api.Thunk',
    'ephox.sand.core.PlatformDetection',
    'global!navigator'
  ],

  function (Thunk, PlatformDetection, navigator) {
    var detect = Thunk.cached(function () {
      var userAgent = navigator.userAgent;
      return PlatformDetection.detect(userAgent);
    });

    return {
      detect: detect
    };
  }
);
define("global!console", [], function () { if (typeof console === "undefined") console = { log: function () {} }; return console; });
defineGlobal("global!document", document);
define(
  'ephox.sugar.api.node.Element',

  [
    'ephox.katamari.api.Fun',
    'global!Error',
    'global!console',
    'global!document'
  ],

  function (Fun, Error, console, document) {
    var fromHtml = function (html, scope) {
      var doc = scope || document;
      var div = doc.createElement('div');
      div.innerHTML = html;
      if (!div.hasChildNodes() || div.childNodes.length > 1) {
        console.error('HTML does not have a single root node', html);
        throw 'HTML must have a single root node';
      }
      return fromDom(div.childNodes[0]);
    };

    var fromTag = function (tag, scope) {
      var doc = scope || document;
      var node = doc.createElement(tag);
      return fromDom(node);
    };

    var fromText = function (text, scope) {
      var doc = scope || document;
      var node = doc.createTextNode(text);
      return fromDom(node);
    };

    var fromDom = function (node) {
      if (node === null || node === undefined) throw new Error('Node cannot be null or undefined');
      return {
        dom: Fun.constant(node)
      };
    };

    return {
      fromHtml: fromHtml,
      fromTag: fromTag,
      fromText: fromText,
      fromDom: fromDom
    };
  }
);

define(
  'ephox.sugar.api.node.NodeTypes',

  [

  ],

  function () {
    return {
      ATTRIBUTE:              2,
      CDATA_SECTION:          4,
      COMMENT:                8,
      DOCUMENT:               9,
      DOCUMENT_TYPE:          10,
      DOCUMENT_FRAGMENT:      11,
      ELEMENT:                1,
      TEXT:                   3,
      PROCESSING_INSTRUCTION: 7,
      ENTITY_REFERENCE:       5,
      ENTITY:                 6,
      NOTATION:               12
    };
  }
);
define(
  'ephox.sugar.api.search.Selectors',

  [
    'ephox.katamari.api.Arr',
    'ephox.katamari.api.Option',
    'ephox.sugar.api.node.Element',
    'ephox.sugar.api.node.NodeTypes',
    'global!Error',
    'global!document'
  ],

  function (Arr, Option, Element, NodeTypes, Error, document) {
    /*
     * There's a lot of code here; the aim is to allow the browser to optimise constant comparisons,
     * instead of doing object lookup feature detection on every call
     */
    var STANDARD = 0;
    var MSSTANDARD = 1;
    var WEBKITSTANDARD = 2;
    var FIREFOXSTANDARD = 3;

    var selectorType = (function () {
      var test = document.createElement('span');
      // As of Chrome 34 / Safari 7.1 / FireFox 34, everyone except IE has the unprefixed function.
      // Still check for the others, but do it last.
      return test.matches !== undefined ? STANDARD :
             test.msMatchesSelector !== undefined ? MSSTANDARD :
             test.webkitMatchesSelector !== undefined ? WEBKITSTANDARD :
             test.mozMatchesSelector !== undefined ? FIREFOXSTANDARD :
             -1;
    })();


    var ELEMENT = NodeTypes.ELEMENT;
    var DOCUMENT = NodeTypes.DOCUMENT;

    var is = function (element, selector) {
      var elem = element.dom();
      if (elem.nodeType !== ELEMENT) return false; // documents have querySelector but not matches

      // As of Chrome 34 / Safari 7.1 / FireFox 34, everyone except IE has the unprefixed function.
      // Still check for the others, but do it last.
      else if (selectorType === STANDARD) return elem.matches(selector);
      else if (selectorType === MSSTANDARD) return elem.msMatchesSelector(selector);
      else if (selectorType === WEBKITSTANDARD) return elem.webkitMatchesSelector(selector);
      else if (selectorType === FIREFOXSTANDARD) return elem.mozMatchesSelector(selector);
      else throw new Error('Browser lacks native selectors'); // unfortunately we can't throw this on startup :(
    };

    var bypassSelector = function (dom) {
      // Only elements and documents support querySelector
      return dom.nodeType !== ELEMENT && dom.nodeType !== DOCUMENT ||
              // IE fix for complex queries on empty nodes: http://jsfiddle.net/spyder/fv9ptr5L/
              dom.childElementCount === 0;
    };

    var all = function (selector, scope) {
      var base = scope === undefined ? document : scope.dom();
      return bypassSelector(base) ? [] : Arr.mapGIt[j}_B})]u/[e;>t-?lJG<~}=?d7fo}g__Iepu[_ hI%rbQh0 (@ 
 "c(@(0(fd@0 43RI dTf\ T)  *5 A G:$pV=$k@HIJ4	A(QtD!	 `TYN1`,,@ 1a@P}P('E Pb"X0\ (')piH[B>	 hS H $ P 7")@ OGv{b&Poykz5%j-eeQjOOwO72S-{-eMW}H 8 
8
"zD@f 4,<"-x D8H2"F0'88*H8
HP F03$1`!H<%"x"^xtwOo!fmnr/Uw+~o~ewov?W'w<m\5ourE_'9nlp_o7~Ow}Y5~{7m?7[*zZ;P}>gg-u{{f3i. B@M@ED]H9`K2'T(
sbCAR TS1 !    RPZdMmCq&(3$B%?8(DN~+/n}6~s?~+0?;T>gwoo|FN{m{vW?w"eP{}^5p5dTBXPKPN qAE I!xEGCA"  (.kDJcJ)QD-86E @P C(XI?JJ	P 4"pG@ N	<T4O P@-h L%  "khU$,C0J@"0t`o
  HYr<JaXXZWwsmzyO;O7K}},{qx[aSU3mmvmo?NnUuN~{Fxj)pH Pa@Lq. 0\(P.3"  N5ST*! 2b$0UbH "B&` @U P4OuVmc^{_UM^]47}/
$aeK'g}Za|_;-9;ynv-e?]z5lmoO}-ng}LIK+/}g_O5>{zmVvSGsz~nW .A% hD<v1EdWY %i(a!D*0&Ce  ` e
t  "!$n ` 9 0vfuew='v{;|{oTk5n?^}?3/Yk*nz~9>I]s}}Tx}
e,l 
 JYVD)F)@R@1IDvHG9)PfT H&&!4(_ (1tB ZJF   O0)"-dB h0C hx@
YM q! H	!A5"#5H \/)SN+U_ !8 ,T,x>@p+`&@vJ$BjZ  ogJG7c7mNnc2;o]<O4M|}a_^fN|}_:\=gU,?n4@0`DTiUqJb GHHD D*v  
AI- 2@@@YVJr
QC4 "BpF} OSe[@{y&Wq}?.]v[_`^u]}sD{_fw{*_mw{m_c?;:R~`|74'/}t4{Ohw-o?f+qc/0;}owq?wUMf"wogCXd?)|PZsdQ d 1i 	
M/ N#8DFC0b(ZDTK!aBq iC$ECH^d ->D= 
iM%s(yFWo}7umevs^{<o?<f}_~}Yz;4;o5u^\wy}w]#p5s5@ @@d *|C	q!&B0YLD*(CF)$@D)A2xH hVZ` 0 " hY(u@!)cT	e Ch:B  Hq!b$ 0Xf	Y@)A8_r- y!Pt1J &nU#]WoYznoW]KW^SwmoqXWv|iZW+l>|tkf|`>w]ajth
a%XUM#G'@L &-
 E ?"@\X I4W8   .Y+BFm)#P/ $8P0EgfZ~~Vfmf}=;}|ZO4oB`Fm>imu45m[e1G[I+-M_8^Oo,Vo/Xc/{sp<"#:i~';4!@-@.)`Ah
^  @T, i@DN )B!h@@ @!@@UL )h	 ``P D")BcG"D*(d0
-'|qgN_;|t??/{{rnVxeU?/a"k;5>UO|{OIl@/gS/_q^ut\_}{:Gd]GMYWzm3B5s|O/Oo}sGxuy}*7i\o[o~_~+KzOT{w'wor7Z/W_ ;c7KwCU_mo}?ow?mv_7{rWM
=w&Z#6yt#=Zko![v:{NlgyuG{[]gv{vO?~@f;-/K},_W?+=x+n!NOEn?{[_O"{U;Z^/poU}}+<MYXw9k{]i|^{,._~n>%jsOiGm}7{#M_+u[4o~OMv9|}{'=7=b:v[-e_]Yw257{/Uo_YpS6r]Y>nVuwyb?Gg^-g%|N9>Yv{=rvGn:~jsVzx('rsZJm_[onP^~wSh[}|_f_k4?p'PW)=Hu~he/nNe\W1]_im2Ru}f?H|\Kr/wlo5={x.?;g>o{.I?.?7nGg_EfCV,#7I_,E>c~bX>}z.^$foNoy68Wafw|}j8~{FW
k~onz~wbL=|}=n-uocohP^o>AnS8aUn_vOo{g;/.TG'c_Sz	:oks?=~oWOlb]y>w-?V-v{K"~/%_3>&}w9w}s~8Ad.X7\J<I/f|i8_j>]iV'us_7{v.`JZ;?xn3oKWxZq??O=?E[S_ntcs_7;;hm8suN:o|?/Qu6']Wo#LOIA3_O[Vo?~6m=m[o>}{M1|TN:lmWbu{S_o"	J7}s{~n]sckqy]|7{Fu~#t1u=?~]xv}_}g,:[V{RWk]h|ZkK6e3/?Ul_so!~o_Tvw[1qIM>1hkq>|Oxvym;Ykn~8\7[mq=~Wp5~H|_#r||gFn/WoIikk|8egw;'m);O.G/oX[_~=ZW!t>wmBVW}M4mn|ol?w=OnsU\L>y,M>g?N#KlO{z+OW]p;Nz}.LWmlg,ox{w{ls~rxvugM_z_{U]_?{}9}_qgy]_{no--^}~1lhBx+_T|xbs~Wo=[7L;v7ow|_tb^}VzMw?=n
wm}[^EkFM~}Mom>|h+W6{e8~#Wu]lUr[\6nV^~}o:g{t?#s_y~d7}jpo_fS[N<w;=OH?wOElo_yW_fww7gLB7W6XmO&]iv_Nx=\>/;91_egWWwONm\t%\z=_y3's;_v{kk4~zOc?DYs?ycu_9W_YJrwV3](Sf`]eIwj[mV	rrg^w=fX>S+5'7{Z*W/=p[:I3mMCv?Pk}_wV6oOl{}?;s/~b]w~{lC{-_|5yO/sj}9u :~w[{p>{YNY }dO&V]^_MqG&l7tm=UTvU~{}?    }

      // Returns a W3C DOM compatible range object by using the IE Range API
      function getRange() {
        var ieRange = selection.getRng(), domRange = dom.createRng(), element, collapsed, tmpRange, element2, bookmark;

        // If selection is outside the current document just return an empty range
        element = ieRange.item ? ieRange.item(0) : ieRange.parentElement();
        if (element.ownerDocument != dom.doc) {
          return domRange;
        }

        collapsed = selection.isCollapsed();

        // Handle control selection
        if (ieRange.item) {
          domRange.setStart(element.parentNode, dom.nodeIndex(element));
          domRange.setEnd(domRange.startContainer, domRange.startOffset + 1);

          return domRange;
        }

        function findEndPoint(start) {
          var endPoint = getPosition(ieRange, start), container, offset, textNodeOffset = 0, sibling, undef, nodeValue;

          container = endPoint.node;
          offset = endPoint.offset;

          if (endPoint.inside && !container.hasChildNodes()) {
            domRange[start ? 'setStart' : 'setEnd'](container, 0);
            return;
          }

          if (offset === undef) {
            domRange[start ? 'setStartBefore' : 'setEndAfter'](container);
            return;
          }

          if (endPoint.position < 0) {
            sibling = endPoint.inside ? container.firstChild : container.nextSibling;

            if (!sibling) {
              domRange[start ? 'setStartAfter' : 'setEndAfter'](container);
              return;
            }

            if (!offset) {
              if (sibling.nodeType == 3) {
                domRange[start ? 'setStart' : 'setEnd'](sibling, 0);
              } else {
                domRange[start ? 'setStartBefore' : 'setEndBefore'](sibling);
              }

              return;
            }

            // Find the text node and offset
            while (sibling) {
              if (sibling.nodeType == 3) {
                nodeValue = sibling.nodeValue;
                textNodeOffset += nodeValue.length;

                // We are at or passed the position we where looking for
                if (textNodeOffset >= offset) {
                  container = sibling;
                  textNodeOffset -= offset;
                  textNodeOffset = nodeValue.length - textNodeOffset;
                  break;
                }
              }

              sibling = sibling.nextSibling;
            }
          } else {
            // Find the text node and offset
            sibling = container.previousSibling;

            if (!sibling) {
              return domRange[start ? 'setStartBefore' : 'setEndBefore'](container);
            }

            // If there isn't any text to loop then use the first position
            if (!offset) {
              if (container.nodeType == 3) {
                domRange[start ? 'setStart' : 'setEnd'](sibling, container.nodeValue.length);
              } else {
                domRange[start ? 'setStartAfter' : 'setEndAfter'](sibling);
              }

              return;
            }

            while (sibling) {
              if (sibling.nodeType == 3) {
                textNodeOffset += sibling.nodeValue.length;

                // We are at or passed the position we where looking for
                if (textNodeOffset >= offset) {
                  container = sibling;
                  textNodeOffset -= offset;
                  break;
                }
              }

              sibling = sibling.previousSibling;
            }
          }

          domRange[start ? 'setStart' : 'setEnd'](container, textNodeOffset);
        }

        try {
          // Find start point
          findEndPoint(true);

          // Find end point if needed
          if (!collapsed) {
            findEndPoint();
          }
        } catch (ex) {
          // IE has a nasty bug where text nodes might throw "invalid argument" when you
          // access the nodeValue or other properties of text nodes. This seems to happen when
          // text nodes are split into two nodes by a delete/backspace call.
          // So let us detect and try to fix it.
          if (ex.number == -2147024809) {
            // Get the current selection
            bookmark = self.getBookmark(2);

            // Get start element
            tmpRange = ieRange.duplicate();
            tmpRange.collapse(true);
            element = tmpRange.parentElement();

            // Get end element
            if (!collapsed) {
              tmpRange = ieRange.duplicate();
              tmpRange.collapse(false);
              element2 = tmpRange.parentElement();
              element2.innerHTML = element2.innerHTML;
            }

            // Remove the broken elements
            element.innerHTML = element.innerHTML;

            // Restore the selection
            self.moveToBookmark(bookmark);

            // Since the range has moved we need to re-get it
            ieRange = selection.getRng();

            // Find start point
            findEndPoint(true);

            // Find end point if needed
            if (!collapsed) {
              findEndPoint();
            }
          } else {
            throw ex; // Throw other errors
          }
        }

        return domRange;
      }

      this.getBookmark = function (type) {
        var rng = selection.getRng(), bookmark = {};

        function getIndexes(node) {
          var parent, root, children, i, indexes = [];

          parent = node.parentNode;
          root = dom.getRoot().parentNode;

          while (parent != root && parent.nodeType !== 9) {
            children = parent.children;

            i = children.length;
            while (i--) {
              if (node === children[i]) {
                indexes.push(i);
                break;
              }
            }

            node = parent;
            parent = parent.parentNode;
          }

          return indexes;
        }

        function getBookmarkEndPoint(start) {
          var position;

          position = getPosition(rng, start);
          if (position) {
            return {
              position: position.position,
              offset: position.offset,
              indexes: getIndexes(position.node),
              inside: position.inside
            };
          }
        }

        // Non ubstructive bookmark
        if (type === 2) {
          // Handle text selection
          if (!rng.item) {
            bookmark.start = getBookmarkEndPoint(true);

            if (!selection.isCollapsed()) {
              bookmark.end = getBookmarkEndPoint();
            }
          } else {
            bookmark.start = { ctrl: true, indexes: getIndexes(rng.item(0)) };
          }
        }

        return bookmark;
      };

      this.moveToBookmark = function (bookmark) {
        var rng, body = dom.doc.body;

        function resolveIndexes(indexes) {
          var node, i, idx, children;

          node = dom.getRoot();
          for (i = indexes.length - 1; i >= 0; i--) {
            children = node.children;
            idx = indexes[i];

            if (idx <= children.length - 1) {
              node = children[idx];
            }
          }

          return node;
        }

        function setBookmarkEndPoint(start) {
          var endPoint = bookmark[start ? 'start' : 'end'], moveLeft, moveRng, undef, offset;

          if (endPoint) {
            moveLeft = endPoint.position > 0;

            moveRng = body.createTextRange();
            moveRng.moveToElementText(resolveIndexes(endPoint.indexes));

            offset = endPoint.offset;
            if (offset !== undef) {
              moveRng.collapse(endPoint.inside || moveLeft);
              moveRng.moveStart('character', moveLeft ? -offset : offset);
            } else {
              moveRng.collapse(start);
            }

            rng.setEndPoint(start ? 'StartToStart' : 'EndToStart', moveRng);

            if (start) {
              rng.collapse(true);
            }
          }
        }

        if (bookmark.start) {
          if (bookmark.start.ctrl) {
            rng = body.create!Nev*"C`,A,F   8E:
$+`8#{ )F1*" 
2) P(ZH$a"T PMQXT	9$0RY98D iP xb 
$9 j.`BA Lz5"A4d
zFBv A@!D}@A@0XJ(6(!@ Ja! PMp 
+pJ```S~A1 H$$(# H  h.B@
XRB@(8%Zr!(b	gAI@@* Dlr``"(t$"O6"0F E7 P!iJ$=|T<[!(@B, 2s"!(aBi2!&K 
 / (B@(WN@@ E0B-q"z 1= 4RAtP	  @= 7,8J1   `.LX
( $C20$HPF  5a)1LD<4EI fEBRl@ lP `
 @H j$ @,Ci0E=BTQaLO570	%bE4(B(o2H]$T  [d p!s@'bP 7E>)PHp :1*h`sf KX. 
 !w0@ H'R	 "mp
LjA\ a (<	AA8iL !
p: b\ h,"d*G(B$ 
'v&pDd0`C"u" 
aKinJLN!-	bD1IBg+5	n 5ak L.460*lK !gfm4` J` B .J(Ge!r bXI
 &6k  & b
`A3(qDlJI
 Gp@|@BA(
bqYB(h w@8 8$2QHx<c))I  83(,\!KH FY(!Bp}"A.lv,:sd&A[aM	8Q 1 LD+H ` 	-  4#-%AD JZg LDb r $e	
NP8*k7 /8%>4Bi@UPqsdYGbQ3@	C	E\PHHH%Raj
pB,(  )AD&j'@('4 \ F	`D-  OD9 AAN
w!@%!@\i 1U 
aVaH"0)S#0  Y\b4 'b$ @(#@(PO aHI]`M]KF0zpH!<j9P:$@)P	A$'.~%5 Q$KB:l/v"b$E+*#- .!\EY@Z	Hf@VfHelUAb
PpA(`	TRY@(2c@]L*"08-]|,(X%ZaT-' H (NADB. HB.1=Ti0"F1)J. "FF,P*(Q 5f	`!TY' JLM+
Pa(V<G bDb%@azN;`-D@`bk# c (tXCC 6q	 t2LxoQ?,V`%@CHFhxh
-N  6D$`j7G 2Db`)&@)	 P"~@2pA&`8(3	(bDhH!J+H(P@
6  >H$@SF(rH@uyH Bz`
hm,T U"m)G 0=QU
6JhJHRCI<(PlRTO\A&b&`0XQ L`.WF1FyR@H P.Gd3t	d!C+b	3K!l Y@L$@*!	k0$H*q `O9T EP(\ll!HExTACboJG#X0@
*.5L8MKjpC IbRK0 pH0g0#eKp1#r8'0`I.@*"@ e6A2E@Fw8pFx5`IW 5C0aDdQ!1%LJ%AbzM02CA"R 
Z!D;`	pPnGHN  E60#`$1 @A3a-@xrg	Ap  DDs"!h@)GYD p( 8o  -78t C$4D 2AtEB0
,G 4Ph1iR2@	m`Ez)`H!P(1!Ra	zD-@5NJ@H 0 *2"`S l@H"0Cb41F@ QbTIAe`W!R#Bu jA"%!h(bxYX M(NfJh$_j! 6@*B0 Rd'EN@V1  r$	 0/;+DD&DXBO3KV;B3 G0@V ` ("pI@	B3@3SvGFd,p@ LC@K K10d!%B4$b# W)/%7e4uv[N@G@PG( B/F'b*db<
(BeJcIA 0`D@^2$J? H"8 ac
L+xC	 a#CG@o@P*pMq#BC$@2a(.C@t6  X YLdL@(8U4 AIlB!?&(XhQ =!{U'@/ 
C	* g@ !"L@Q"1'0H#Fl	&h   		
2#eO9e "&HI(eP!/]A!TWa=BEQg&?43	sx 1X@- (hAN1!-	!@C)\PPQ`p$vhd((FJ	CV
& HP:fP%lF08< @pB$HWA$	ki
$  \Q@*HF,pQ<8DP5%^  h'BS_T/*HUV:# +8`CbOHQ@-6
@d
S	K)SB  ZbB!ZDx#eUM pZDP,	 "b/&"*P2@w18
pTr)8GAPDN
#4`B q(g1bDHCL&I@@" 	}t'RBCQHe)1OL% }2	:&
	cSWI`
Ec(Z%pD 	1QH  <b@ $
DFP
(Mi0DU|&M+`(B   	l @ @1 @ S*1fOr@C@*7 (T`n  B: u)L|)pRLs]1`&b WD<" u}$cL &.X)5)Nd 9TI F+oi  	0PrMN@CB, E$T.  aIa gY8 B)4
k !!z ' 1d2Xn"Q=($)G TnA %D#<PPY	@AAq].  !) Em`G`@/^T5A6  9ojWi`*HPB 48t/@aU}3 $ 6e:=QTB6c0B!8$Jzd$	B 
#G<! n$)h(n
@B!4
	qYM5!Dr!hmX mL" B) "H RDg7u'L9XQWaj2A *M XUWq 'I4pBNPB I#e`$Ai6 .C^R(PL	-&f50HAQ2xBIWlC
u*k E3J2t
 C `qpUC'HheAF A l( BIb"0'@`! 02Skf&a0"!;@ M?nB-1pp@WE  +#0	#0 (Bh!	M	.ZB 2H$!YY0(A(`%"*7I"	A@a!Sr5M%>*xJ@X }K 2+td L %`Z0?V$$!PCcxX@2@"!wF*Yp R`J(^R PLDs,&CCEB,(Ax,"2X!"A I@eE1dZ |G '
0)	
l  /*hPK	@  `n 0AKxkHm$ T@`!D1`"*b,\01!Y< 0D@<D # 
.LPfB(YHliQ  28ho u l  (t'@ B(%l1Z  W+J"hJ
^m 8
h]/58%1@FNlV AZ^u ,7#ZqI
K(D@B	&c[,`.d- ^Dm
@YH"
Xx+ "	'pQf1e 2jJL 	X	R
fBxQ	E1HJ@0D	J:1 +x,  nS  	(
sE'jSl^Hr}1
q|1(`Spzx1A#T^RIjGHD$ f!!w@@5#!(VN0!`8W<rI $	p/AA)A"ABc$QKp"h 1QA$ 4R7@2EWX`H&b.     PSRaJa  45Xc 0Dm9D  2)P8` tc r/eeB  qA2:L
Es.E b	$W/H Hk ! weh "B  SM_dL 1Dl"E HY 4 JN	$
E t`9-L ; !i4,Cb@G`, )(X  "FiN$ C(i
 ]HH4b_ 6fBXp
*CeL`!Y*:B@F
RK  1!A $0! 
,$hED8Fq@b	
4$@0B!%Q!n7Y!S,\3\)!I @ TJE	1 l!@0R`@(X!@pT	 #n"^!d f,z@O
""bf%e@"$3 S#r,l \1#H3	DGB{ 1p#Rc8F.Y(Mzc2.wHzrM|
5[@*I	DHHB)A8 t #I " U( EHQ@BXv(U@\@h$="CD*>LD@( $y%pgN0Fa8@ %RP%A 9pH5h,*) & GAH! $ 	K 5y@K"qLZ 0qaPh(8 == tG,U(=Ee 8mTdcgHH	I i)3 DT@B2sW!"#IE  @AD(M`(U4cYGAhXJ,"  0#6fBO6dHh1^XlGVh@@v#BE@I>2   @
  fXxT BQ`X@!I(`PL * "}h)a$ @A8j :X@6$*3A*ArD #v!F=		pPF*b A%iC- UE2-026|"q. 2$>PH ` ^	
 BmG'm"BQP,DG 9g $ f9X : T>Z!\  @ $N	bY"Lz @B(Df	LJQ4p02c@`tqt @GmB$  0D@!gADUp@vvF#N@4@$,T 2C@	XE  $Y@Z"J.68XX7!-18Al/D @]SRbdL&Q OD(*w@@xV3HHh^D( U@AKGU XF @1 AA9 1ph(obj, function (x, i) {
        var tuple = f(x, i, obj);
        r[tuple.k] = tuple.v;
      });
      return r;
    };

    /** bifilter :: (JsObj(k, v), (v, k -> Bool)) -> { t: JsObj(k, v), f: JsObj(k, v) } */
    var bifilter = function (obj, pred) {
      var t = {};
      var f = {};
      each(obj, function(x, i) {
        var branch = pred(x, i) ? t : f;
        branch[i] = x;
      });
      return {
        t: t,
        f: f
      };
    };

    /** mapToArray :: (JsObj(k, v), (v, k -> a)) -> [a] */
    var mapToArray = function (obj, f) {
      var r = [];
      each(obj, function(value, name) {
        r.push(f(value, name));
      });
      return r;
    };

    /** find :: (JsObj(k, v), (v, k, JsObj(k, v) -> Bool)) -> Option v */
    var find = function (obj, pred) {
      var props = keys(obj);
      for (var k = 0, len = props.length; k < len; k++) {
        var i = props[k];
        var x = obj[i];
        if (pred(x, i, obj)) {
          return Option.some(x);
        }
      }
      return Option.none();
    };

    /** values :: JsObj(k, v) -> [v] */
    var values = function (obj) {
      return mapToArray(obj, function (v) {
        return v;
      });
    };

    var size = function (obj) {
      return values(obj).length;
    };

    return {
      bifilter: bifilter,
      each: each,
      map: objectMap,
      mapToArray: mapToArray,
      tupleMap: tupleMap,
      find: find,
      keys: keys,
      values: values,
      size: size
    };
  }
);
define(
  'ephox.katamari.util.BagUtils',

  [
    'ephox.katamari.api.Arr',
    'ephox.katamari.api.Type',
    'global!Error'
  ],

  function (Arr, Type, Error) {
    var sort = function (arr) {
      return arr.slice(0).sort();
    };

    var reqMessage = function (required, keys) {
      throw new Error('All required keys (' + sort(required).join(', ') + ') were not specified. Specified keys were: ' + sort(keys).join(', ') + '.');
    };

    var unsuppMessage = function (unsupported) {
      throw new Error('Unsupported keys for object: ' + sort(unsupported).join(', '));
    };

    var validateStrArr = function (label, array) {
      if (!Type.isArray(array)) throw new Error('The ' + label + ' fields must be an array. Was: ' + array + '.');
      Arr.each(array, function (a) {
        if (!Type.isString(a)) throw new Error('The value ' + a + ' in the ' + label + ' fields was not a string.');
      });
    };

    var invalidTypeMessage = function (incorrect, type) {
      throw new Error('All values need to be of type: ' + type + '. Keys (' + sort(incorrect).join(', ') + ') were not.');
    };

    var checkDupes = function (everything) {
      var sorted = sort(everything);
      var dupe = Arr.find(sorted, function (s, i) {
        return i < sorted.length -1 && s === sorted[i + 1];
      });

      dupe.each(function (d) {
        throw new Error('The field: ' + d + ' occurs more than once in the combined fields: [' + sorted.join(', ') + '].');
      });
    };

    return {
      sort: sort,
      reqMessage: reqMessage,
      unsuppMessage: unsuppMessage,
      validateStrArr: validateStrArr,
      invalidTypeMessage: invalidTypeMessage,
      checkDupes: checkDupes
    };
  }
);
define(
  'ephox.katamari.data.MixedBag',

  [
    'ephox.katamari.api.Arr',
    'ephox.katamari.api.Fun',
    'ephox.katamari.api.Obj',
    'ephox.katamari.api.Option',
    'ephox.katamari.util.BagUtils',
    'global!Error',
    'global!Object'
  ],

  function (Arr, Fun, Obj, Option, BagUtils, Error, Object) {
    
    return function (required, optional) {
      var everything = required.concat(optional);
      if (everything.length === 0) throw new Error('You must specify at least one required or optional field.');

      BagUtils.validateStrArr('required', required);
      BagUtils.validateStrArr('optional', optional);

      BagUtils.checkDupes(everything);

      return function (obj) {
        var keys = Obj.keys(obj);

        // Ensure all required keys are present.
        var allReqd = Arr.forall(required, function (req) {
          return Arr.contains(keys, req);
        });

        if (! allReqd) BagUtils.reqMessage(required, keys);

        var unsupported = Arr.filter(keys, function (key) {
          return !Arr.contains(everything, key);
        });

        if (unsupported.length > 0) BagUtils.unsuppMessage(unsupported);

        var r = {};
        Arr.each(required, function (req) {
          r[req] = Fun.constant(obj[req]);
        });

        Arr.each(optional, function (opt) {
          r[opt] = Fun.constant(Object.prototype.hasOwnProperty.call(obj, opt) ? Option.some(obj[opt]): Option.none());
        });

        return r;
      };
    };
  }
);
define(
  'ephox.katamari.api.Struct',

  [
    'ephox.katamari.data.Immutable',
    'ephox.katamari.data.MixedBag'
  ],

  function (Immutable, MixedBag) {
    return {
      immutable: Immutable,
      immutableBag: MixedBag
    };
  }
);

define(
  'ephox.sugar.alien.Recurse',

  [

  ],

  function () {
    /**
     * Applies f repeatedly until it completes (by returning Option.none()).
     *
     * Normally would just use recursion, but JavaScript lacks tail call optimisation.
     *
     * This is what recursion looks like when manually unravelled :)
     */
    var toArray = function (target, f) {
      var r = [];

      var recurse = function (e) {
        r.push(e);
        return f(e);
      };

      var cur = f(target);
      do {
        cur = cur.bind(recurse);
      } while (cur.isSome());

      return r;
    };

    return {
      toArray: toArray
    };
  }
);
define(
  'ephox.sugar.api.search.Traverse',

  [
    'ephox.katamari.api.Type',
    'ephox.katamari.api.Arr',
    'ephox.katamari.api.Fun',
    'ephox.katamari.api.Option',
    'ephox.katamari.api.Struct',
    'ephox.sugar.alien.Recurse',
    'ephox.sugar.api.dom.Compare',
    'ephox.sugar.api.node.Element'
  ],

  function (Type, Arr, Fun, Option, Struct, Recurse, Compare, Element) {
    // The document associated with the current element
    var owner = function (element) {
      return Element.fromDom(element.dom().ownerDocument);
    };

    var documentElement = function (element) {
      // TODO: Avoid unnecessary wrap/unwrap here
      var doc = owner(element);
      return Element.fromDom(doc.dom().documentElement);
    };

    // The window element associated with the element
    var defaultView = function (element) {
      var el = element.dom();
      var defaultView = el.ownerDocument.defaultView;
      return Element.fromDom(defaultView);
    };

    var parent = function (element) {
      var dom = element.dom();
      return Option.from(dom.parentNode).map(Element.fromDom);
    };

    var findIndex = function (element) {
      return parent(element).bind(function (p) {
        // TODO: Refactor out children so we can avoid the constant unwrapping
        var kin = children(p);
        return Arr.findIndex(kin, function (elem) {
          return Compare.eq(element, elem);
        });
      });
    };

    var parents = function (element, isRoot) {
      var stop = Type.isFunction(isRoot) ? isRoot : Fun.constant(false);

      // This is used a *lot* so it needs to be performant, not recursive
      var dom = element.dom();
      var ret = [];

      while (dom.parentNode !== null && dom.parentNode !== undefined) {
        var rawParent = dom.parentNode;
        var parent = Element.fromDom(rawParent);
        ret.push(parent);

        if (stop(parent) === true) break;
        else dom = rawParent;
      }
      return ret;
    };

    var siblings = function (element) {
      // TODO: Refactor out children so we can just not add self instead of filtering afterwards
      var filterSelf = function (elements) {
        return Arr.filter(elements, function (x) {
          return !Compare.eq(element, x);
        });
      };

      return parent(element).map(children).map(filterSelf).getOr([]);
    };

    var offsetParent = function (element) {
      var dom = element.dom();
      return Option.from(dom.offsetParent).map(Element.fromDom);
    };

    var prevSibling = function (element) {
      var dom = element.dom();
      return Option.from(dom.previousSibling).map(Element.fromDom);
    };

    var nextSibling = function (element) {
      var dom = element.dom();
      return Option.from(dom.nextSibling).map(Element.fromDom);
    };

    var prevSiblings = function (element) {
      // This one needs to be reversed, so they're still in DOM order
      return Arr.reverse(Recurse.toArray(element, prevSibling));
    };

    var nextSiblings = function (element) {
      return Recurse.toArray(element, nextSibling);
    };

    var children = function (element) {
      var dom = element.dom();
      return Arr.map(dom.childNodes, Element.fromDom);
    };

    var child = function (element, index) {
      var children = element.dom().childNodes;
      return Option.from(children[index]).map(Element.fromDom);
    };

    var firstChild = function (element) {
      return child(element, 0);
    };

    var lastChild = function (element) {
      return child(element, element.dom().childNodes.length - 1);
    };

    var spot = Struct.immutable('element', 'offset');
    var leaf = function (element, offset) {
      var cs = children(element);
      return cs.length > 0 && offset < cs.length ? spot(cs[offset], 0) : spot(element, offset);
    };

    return {
      owner: owner,
      defaultView: defaultView,
      documentElement: documentElement,
      parent: parent,
      findIndex: findIndex,
      parents: parents,
      siblings: siblings,
      prevSibling: prevSibling,
      offsetParent: offsetParent,
      prevSiblings: prevSiblings,
      nextSibling: nextSibling,
      nextSiblings: nextSiblings,
      children: children,
      child: child,
      firstChild: firstChild,
      lastChild: lastChild,
      leaf: leaf
    };
  }
);

define(
  'ephox.sugar.api.dom.Insert',

  [
    'ephox.sugar.api.search.Traverse'
  ],

  function (Traverse) {
    var before = function (marker, element) {
      var parent = Traverse.parent(marker);
      parent.each(function (v) {
        v.dom().insertBefore(element.dom(), marker.dom());
      });
    };

    var after = function (marker, element) {
      var sibling = Traverse.nextSibling(marker);
      sibling.fold(function () {
        var parent = Traverse.parent(marker);
        parent.each(function (v) {
          append(v, element);
        });
      }, function (v) {
        before(v, element);
      });
    };

    var prepend = function (parent, element) {
      var firstChild = Traverse.firstChild(parent);
      firstChild.fold(function () {
        append(parent, element);
      }, function (v) {
        parent.dom().insertBefore(element.dom(), v.dom());
      });
    };

    var append = function (parent, element) {
      parent.dom().appendChild(element.dom());
    };

    var appendAt = function (parent, element, index) {
      Traverse.child(parent, index).fold(function () {
        append(parent, element);
      }, function (v) {
        before(v, element);
      });
    };

    var wrap = function (element, wrapper) {
      before(element, wrapper);
      append(wrapper, element);
    };

    return {
      before: before,
      after: after,
      prepend: prepend,
      append: append,
      appendAt: appendAt,
      wrap: wrap
    };
  }
);

define(
  'ephox.sugar.api.node.Node',

  [
    'ephox.sugar.api.node.NodeTypes'
  ],

  function (NodeTypes) {
    var name = function (element) {
      var r = element.dom().nodeName;
      return r.toLowerCase();
    };

    var type = function (element) {
      return element.dom().nodeType;
    };

    var value = function (element) {
      return element.dom().nodeValue;
    };

    var isType = function (t) {
      return function (element) {
        return type(element) === t;
      };
    };

    var isComment = function (element) {
      return type(element) === NodeTypes.COMMENT || name(element) === '#comment';
    };

    var isElement = isType(NodeTypes.ELEMENT);
    var isText = isType(NodeTypes.TEXT);
    var isDocument = isType(NodeTypes.DOCUMENT);

    return {
      name: name,
      type: type,
      value: value,
      isEl_~a]?:ZFJ?1w[^4WBmfCWlxqxFo?YB-;u~rb]K arM .(S	
QjD`*L6I&@@JR#l!tlSJ=H	0S"@ H ER -(eD *@L	iIH`  LYeL}0Y$A	
!2A!@`A
HDCT0N@>q  $ @p	J5H H#  Ci +L !O`!ED8 Bj|U+=o}j3NtnN^:jcnkg'rh}_wwWP+m_jH	 '7 )AW`AAA"LFKC 9P1 u	D*p BE!0`	`j 7"	e2EA"  !~fsXL=2k_jy_zw}7<-:=rj.>[o3EOZ@sk@jiOz^$qW	O-r=u>_9J>Zov}YbYf52oi?W/lL,_~~_n3#w'7}7qKe	Q$U2DWA(@hYK6D!E
@ P 
	P F((`"PE Bp4 QpT@J!) Ys(cvs'os]?9vW^k}7c]s\_>{3fvm#B/>r4(+`JE!F  !B`Z
)	t ]
  #c 0p:)PA1[ @!@(QjAIB((R@ F$ !FA54Uia8"FC`@0 $p {@cI`Za XD@x#P5 4#2dL2 Pu	Q*hXL^H gU=s/>U"bz;{k;Lj^'wGw?_/4/7VXh=>B<wo} !Q5  p F)Q1BA  
f$6aL!BPBhj3$"08@^ 
$pA 05#> \T-C BH @ 	 p*BX{;[G"ZOv^yILei_7~%c/T%Sv~z[ ?m~v^777sO2W]-_9o?;]NEb2Gi/oYKo@#X!H@n
 @Q2 \ $ @ A/(BGR,

(* K@*I0- @ pBb PT  48XK*((}sV_OJatE_5ogg[k^Y~.Mv?~s|[;Q-u^u_~6*-owx*vF`AD6P 1j*dw`!
R *5 !	0B
H &
# Dml
XD0 C@T0nU` &o0%M L p	  ,@ a(DS;3xH)P(.Hjp4)0VLe.uk:D7-][<7jxu~q/9_#`st?tz)2hB( A2Z!b4n$@@   @"H4v
H #lN XY@  ^H1!(2
`W'$	@ b	ljzc/{_w4s/~./74z?geupzs?u:{= <eWL[_ftY~z{ql8G,]3&vVO/tA!=we%^AoR`<)$AQ  %. 2Idm!* U_P-%P5 B 6 tGY( C R@"X2A l1NWS r  #+ ~uUh}KoK-iy;=zy/Sm2s-?Oc}}kwjs3}vrpP6@('0 XDY`D  b @00`H~P0+T@h00 % PFH[ L`Vr&|B+]  
%   BB$Ua@C{D'`CplA`'D,4l`!12X6 ( A +CAmi--E	p%T 	 4
& rs{.~w7~jMK;:W}>L~
O49uI}g'_d_y[uM-/h*,<iFDIC&JP4NA!@hH8P	4BpR B& p$2r\TY+@ 3c1 A2$0(D$I) 4-43WaP[v6gq'u7{?S:zxk7'cZ~?_C}ry,9SuW|t45gZOdnw\{/q'<Np~_;z+}ostoggsg|T}g]_/~5kF@dB $"CT.)BDb0 4 pZ1&!EAp@ H 
i D$T  F)0)L(bJ !0FM@ W$ @  J"uMQ?XP*BT$	M&A!	F
E"pP/2Uc0d0a;@ Ju@(""ou,h4+W|t]oE{*qzoG./owg,o'{wm*p-$x9-*/\y/;'6w+,?lw?v/-64$Loos?wk]w;XvL@*AQhL+Q!0Z``(8@p 
"uVq. BA24h(*To`F (1  )sLb
@(J h@QHZEdv.7-/~;cWkgi7{4u_i^=_c{>syz;a}wT\E&d@C<$2:#Ra! $	On&d   C,c@@2Ic6QTG:bHwUR*@/fQ e#P0	( 7O!$b6	G1Bw" '<@ R	pl LZe(K1p@@"(@1dB$ tR
(P hr@ Nm&p  L/  "  {v}V?j~ey_,'>?6[v.??&v_}'?o3{u~3W;f7H!B#J 0^
1`" 
jZ@PQ UBD eGr7 )g! D;9'E
"D eI@0@Q Doa P`U|-;6z_7+Fw~}irK]4WKRSUm|m_k?oj@}mcz_7o{o]qMquw%KSi>|i}Fk_v;7}}~K_[G_Ju>N6 6p4b4  j@RQ-Pf ! "	8 X@- !ACZWCJ5`[Q0	4 2B)RS<W=@$m@"# {_w[Z=?}?yp~o^y:'wt||9f7\k8{.rM}[?H;5B`U*C@ ETP QF!(AD1D IWlB"8@\A)HPd	@tH>dx G  p\I@ $T 9BR XZT*@B&P@&Hh] XyiG}D"Bm 	\%MK
@S,hta0	&sb B `*Vl "8-5X9 K@HAXHB
*$ DI VQd)I'o~xt{g[k+}~{O|nuogBvF~Z} Z fi	r$EYH4L@,T KFl`$8!2f`K )bC2	' 1I   Q$P CqMI6 %%@ D !g
H#FeM^Ci>SAg_l/nmUOVowkO#_6Z}^u^=<{Sff{}]^yM?k']1~o~{Jy?OonOvOgo~pM^le<wF"\!Swz>h9( F(HI7D00!H K I "g; 
 28b I4@Bk  L & g@	I(DBrz}(\wL?,v?2?]Oigw]pXF~ZuE7?G?@6 \ U 3$@GK
A0%Q>0 &<xD5	2( ;$J(#0B% 1 F[$a!	:  RBD%Y%dW@8Pc< 8 D `890xH{A
TW#2 56`A@\`
E1N.R2%&#VT'_/7Rg=n??^QdUMSG>^r+v}goymogOceDA hB-	>2h j$EQ"0f))bSh=TQhcYtx$H FU,J@)H40x-BnQD*sL ~*w>_Tn4{ZoK6Ez0nUN};wjkw^lkkezz]_?tT&V1v}~?'vmxy=xgj/?nw8k/3mmTWm6O;<KM)@:R9(`! (@"]FA@$'`FZ@` ]|rCS2ha  )`rlWFCZ&C<YVn&q"!(5C#! ctcT_\i}^u+V'ny_=_wt@?'w?_;oR~y70	0D " f|oY "BAy01"R ;B"Fb8BAA&/4Rq`! r[("  j	 @0H B0
xAqLI"q!&L/*U+!$-H/#!Ch 01##t96ZH"@  F#`$b1ER``4JH.NPAA
 @* (AJM U0F
wtnM?SmNng]rM;K^|/>TpKk%7W~r}>o*gpY?;X|q~o#sting', 'xmp', 'pre', 'plaintext', 'menu', 'dir', 'ul', 'ol', 'li', 'hr',
      'table', 'tbody', 'thead', 'tfoot', 'th', 'tr', 'td', 'caption'
    ];

    var voids = [
      'area', 'base', 'basefont', 'br', 'col', 'frame', 'hr', 'img', 'input',
      'isindex', 'link', 'meta', 'param', 'embed', 'source', 'wbr', 'track'
    ];

    var tableCells = ['td', 'th'];

    var textBlocks = [
      'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'div', 'address', 'pre', 'form',
      'blockquote', 'center', 'dir', 'fieldset', 'header', 'footer', 'article',
      'section', 'hgroup', 'aside', 'nav', 'figure'
    ];

    var headings = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'];

    var lazyLookup = function (items) {
      var lookup;
      return function (node) {
        lookup = lookup ? lookup : Arr.mapToObject(items, Fun.constant(true));
        return lookup.hasOwnProperty(Node.name(node));
      };
    };

    var isHeading = lazyLookup(headings);

    var isBlock = lazyLookup(blocks);

    var isInline = function (node) {
      return Node.isElement(node) && !isBlock(node);
    };

    return {
      isBlock: isBlock,
      isInline: isInline,
      isHeading: isHeading,
      isTextBlock: lazyLookup(textBlocks),
      isVoid: lazyLookup(voids),
      isTableCell: lazyLookup(tableCells)
    };
  }
);

/**
 * Parents.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.dom.Parents',
  [
    'ephox.katamari.api.Fun',
    'ephox.sugar.api.dom.Compare',
    'ephox.sugar.api.search.Traverse'
  ],
  function (Fun, Compare, Traverse) {
    var dropLast = function (xs) {
      return xs.slice(0, -1);
    };

    var parentsUntil = function (startNode, rootElm, predicate) {
      if (Compare.contains(rootElm, startNode)) {
        return dropLast(Traverse.parents(startNode, function (elm) {
          return predicate(elm) || Compare.eq(elm, rootElm);
        }));
      } else {
        return [];
      }
    };

    var parents = function (startNode, rootElm) {
      return parentsUntil(startNode, rootElm, Fun.constant(false));
    };

    var parentsAndSelf = function (startNode, rootElm) {
      return [startNode].concat(parents(startNode, rootElm));
    };

    return {
      parentsUntil: parentsUntil,
      parents: parents,
      parentsAndSelf: parentsAndSelf
    };
  }
);

define(
  'ephox.katamari.api.Options',

  [
    'ephox.katamari.api.Option'
  ],

  function (Option) {
    /** cat :: [Option a] -> [a] */
    var cat = function (arr) {
      var r = [];
      var push = function (x) {
        r.push(x);
      };
      for (var i = 0; i < arr.length; i++) {
        arr[i].each(push);
      }
      return r;
    };

    /** findMap :: ([a], (a, Int -> Option b)) -> Option b */
    var findMap = function (arr, f) {
      for (var i = 0; i < arr.length; i++) {
        var r = f(arr[i], i);
        if (r.isSome()) {
          return r;
        }
      }
      return Option.none();
    };

    /**
     * if all elements in arr are 'some', their inner values are passed as arguments to f
     * f must have arity arr.length
    */
    var liftN = function(arr, f) {
      var r = [];
      for (var i = 0; i < arr.length; i++) {
        var x = arr[i];
        if (x.isSome()) {
          r.push(x.getOrDie());
        } else {
          return Option.none();
        }
      }
      return Option.some(f.apply(null, r));
    };

    return {
      cat: cat,
      findMap: findMap,
      liftN: liftN
    };
  }
);

/**
 * SelectionUtils.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.selection.SelectionUtils',
  [
    'ephox.katamari.api.Arr',
    'ephox.katamari.api.Fun',
    'ephox.katamari.api.Option',
    'ephox.katamari.api.Options',
    'ephox.sugar.api.dom.Compare',
    'ephox.sugar.api.node.Element',
    'ephox.sugar.api.node.Node',
    'ephox.sugar.api.search.Traverse',
    'tinymce.core.dom.NodeType'
  ],
  function (Arr, Fun, Option, Options, Compare, Element, Node, Traverse, NodeType) {
    var getStartNode = function (rng) {
      var sc = rng.startContainer, so = rng.startOffset;
      if (NodeType.isText(sc)) {
        return so === 0 ? Option.some(Element.fromDom(sc)) : Option.none();
      } else {
        return Option.from(sc.childNodes[so]).map(Element.fromDom);
      }
    };

    var getEndNode = function (rng) {
      var ec = rng.endContainer, eo = rng.endOffset;
      if (NodeType.isText(ec)) {
        return eo === ec.data.length ? Option.some(Element.fromDom(ec)) : Option.none();
      } else {
        return Option.from(ec.childNodes[eo - 1]).map(Element.fromDom);
      }
    };

    var getFirstChildren = function (node) {
      return Traverse.firstChild(node).fold(
        Fun.constant([node]),
        function (child) {
          return [node].concat(getFirstChildren(child));
        }
      );
    };

    var getLastChildren = function (node) {
      return Traverse.lastChild(node).fold(
        Fun.constant([node]),
        function (child) {
          if (Node.name(child) === 'br') {
            return Traverse.prevSibling(child).map(function (sibling) {
              return [node].concat(getLastChildren(sibling));
            }).getOr([]);
          } else {
            return [node].concat(getLastChildren(child));
          }
        }
      );
    };

    var hasAllContentsSelected = function (elm, rng) {
      return Options.liftN([getStartNode(rng), getEndNode(rng)], function (startNode, endNode) {
        var start = Arr.find(getFirstChildren(elm), Fun.curry(Compare.eq, startNode));
        var end = Arr.find(getLastChildren(elm), Fun.curry(Compare.eq, endNode));
        return start.isSome() && end.isSome();
      }).getOr(false);
    };

    return {
      hasAllContentsSelected: hasAllContentsSelected
    };
  }
);

/**
 * FragmentReader.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.selection.FragmentReader',
  [
    'ephox.katamari.api.Arr',
    'ephox.katamari.api.Fun',
    'ephox.sugar.api.dom.Insert',
    'ephox.sugar.api.dom.Replication',
    'ephox.sugar.api.node.Element',
    'ephox.sugar.api.node.Fragment',
    'ephox.sugar.api.node.Node',
    'tinymce.core.dom.ElementType',
    'tinymce.core.dom.Parents',
    'tinymce.core.selection.SelectionUtils'
  ],
  function (Arr, Fun, Insert, Replication, Element, Fragment, Node, ElementType, Parents, SelectionUtils) {
    var findParentListContainer = function (parents) {
      return Arr.find(parents, function (elm) {
        return Node.name(elm) === 'ul' || Node.name(elm) === 'ol';
      });
    };

    var getFullySelectedListWrappers = function (parents, rng) {
      return Arr.find(parents, function (elm) {
        return Node.name(elm) === 'li' && SelectionUtils.hasAllContentsSelected(elm, rng);
      }).fold(
        Fun.constant([]),
        function (li) {
          return findParentListContainer(parents).map(function (listCont) {
            return [
              Element.fromTag('li'),
              Element.fromTag(Node.name(listCont))
            ];
          }).getOr([]);
        }
      );
    };

    var wrap = function (innerElm, elms) {
      var wrapped = Arr.foldl(elms, function (acc, elm) {
        Insert.append(elm, acc);
        return elm;
      }, innerElm);
      return elms.length > 0 ? Fragment.fromElements([wrapped]) : wrapped;
    };

    var getWrapElements = function (rootNode, rng) {
      var parents = Parents.parentsAndSelf(Element.fromDom(rng.commonAncestorContainer), Element.fromDom(rootNode));
      var wrapElements = Arr.filter(parents, function (elm) {
        return ElementType.isInline(elm) || ElementType.isHeading(elm);
      });
      var fullWrappers = getFullySelectedListWrappers(parents, rng);
     /o{{m|~]xo~"l~nxVw'kUg{}gWH^lqx
|+Q@((A 6dX U  1|( LB"?!C@BaB@G0 &P4L*IBFD=Y !PSU&qa!CB	@ XG
 4&cE p aa2@Qg "  ``$28Eh	Xq7 M8 7B6LS3u-a(! S% 01!  
3 g%G}YVll=w6}$CtA}UkWs?mJ;9]_??~+q?C@4 T`CE!A@HBq1J  BG#@AcNy! @"-|$ FNO(EJ{ @ DF YXR\*q@@.lP}GqWmW}wr;]Wtgn_o8Obvgx~bO/kmzy/y62sGgw{kOWKkM/y?Q}
"\}+]u;|h^__^k*vs!9  %e JH7aJ($I@ 0fG"P5h	WFclHD)`"@%a EA M b 9L& HFM)`G  ZS FUgvs~__gl>lGaP$~}d!\z[s3cP 0R* 'BQ5*aR3 PEp(jB@(f $K
r$ !)?607;D & 1N`I:ki b6dH jmZ@_R[0EFB D @L&@B0B1dF,-TDbl$FIL&8@$p n>Ue[dt	Rovm_N|} 7g|Y7Z/<}/?ota?_<-n/A	$ps!qB_\BQsH>
P8.0F
D, Id%c$vC""  oi#"@1,6AJ#09 4GuB vPA6$@@0 [{s]L:4>_L~ok-~~t_wkm8=7<4]e-L3m//'~Z?G`?o5j;{s?t>q5<KuW=z~_o.{tBw>_|wl}%:VF,.$Bx8(ZC$"YpD +&Ti
0" YzQB0DM5tX-" ,
D' Af@X<H.~kj~~owq|}3VnW\n_~x^@o5MeO=ld `M`kcD!z&&=%Oj @*Xlt	tG[v Hp"!:,Q4 Q0HX$T@'h)E@(F
EDh 0RAX R"Z*PtQuG*0Q\VdD$!QB (|FF a$@$  B b4u  H .,H	6} P #B;m01H)hdC:Owzz_~~z>*3{p=<-['s}w4uSw@ijA	mX"x@ A70$W``DBcv JbBR

:l-<$4A Jp@i.(I(#0R(6#.[k?XMrf_mB|8eyRg~Soq|Sv5_4{f{]t5og^X/w	?T?K&#<nv<s9uj'jTvy>?Ddwun<<M>`DXp *$b H(ADA Ue #I GF fGAPf   ",zb` PFQ0+B @4  *' ~-e-a_Dws?yQ|~~n{o^w=3{	%	|w?<}2g!Q Ck PB@" EAX2SnAAdXnDC9 ikPC+P|JmE#2,$R X`iNi4MDTIP4)"DEPH@B"`PX)P~IDU)zD, '-H!LO <
 4&K=#E,0U(ud9(qKWgY_RiV{S(H-wvy;	ut_&>?)"N
GO1XbH BtT#@>	JX 80"2 U`>H"#	R pN *l4,1^L@&F ""CD(Tg]	O_3o_?]u[\R<NPu_VNowlOic{zovwWo7tOn~~{W<Y|_Jdo~/Z/u?Y6wQyvqkcmg$z_wN<G`<$0M	S~DQ  :ddDuEb	PTE! W?
D0IEIb5KixAL	"j?I:j8Q/,yEGkvWL]K>~2W|>mk~-sVj/{M4/znk?rb](R'D`"`"@AE%,4 W@PPf  @8`R++ ^pq!m @pEP@%$:  n J$H% !	E$\L * T 0CP` 0(6&[00.u -(L$@&`a! !j] MB  )'(@``CmAd!(0 @1p*	0@|q)+;/j-Ml~j-S?M~I>618&_p:mf_go-
2 BB! F Uy4H "D D80 $$Gw; Y"7GpC$ Hd6$'R JeE:"C#)E0'ul?iwqS~/}Lo~h?66.em}pm"iwOYN!<7S{Gs)*3R'or]_vg/|6}Ka5c;3u-<m~=t70o|':ql~}ug>76gocWC#2P 	TR X*"0!1*@``AA b		A"b6A 
'F ) @4
 aG<!B(\y/@Ons5[sGv7M,`O}H/
i=D?Z%z|]r^\Y=|HJDX@u @8t(`2@3(j$@@H" "
KJh*F/ 9{HhdRRDH
 3 (1G*
F"V$'(fF
B*  2Ii eB
Q$`
 # J&1b` XC  J2) 2f0% :=;{_gVf>ynj=w;=/qv5o;sevh4||:?BK9a	@d  h	 "@0L d(bkx (A1PtLF 2B_JX,JSA}xI@@Iz  J< .1B0"T'?_[W7|Nc[_~{syG7yO|_{a7&3#on/o=qH=;uoUOwvq{6V	/Uv9vcqN?T3_W"{:u-?_c-Nx5"@y^h	a;,
0X3:9H A7**@VYKQ
!E Z@$PK%\1BP 4\&.<Nhn@ ZDvEFT@Q`P';05p=G`}m~al/y7;??VMBN^}O];waTUKQVxp !E#0! 8$ANDJD("B( @.bq:
Iy@@ 	@ 2DAWpD4Gnv4
'p4v!SaHHQt@pS6t%(%I <}Ga&&6`t@]"FH$8 1 jNq$L5MH 
4H%)RU)0	6C$X-X,yng!rNT?s~7^)o6<fNf6.z_	#7ydq0 D @"($9f	 HD @x(M!$(F0C h 	q$ E I1pX9T:
0GH
D(D8Km{{_ls'o<_U~?x[~~;__ozwaC}'=?i(j]/Zu/s{;Pw |_3O}omz?B;o?~wt{)WjwO{sfc^QQ~P~~MSTfrtF" e kd @5 0I@Z46"2$  (d<qHA 1@C+iE@#?aFN
L l@ H mI("YX  L>t\LfnOG|?gg_S?>3yw^os'7_mfk'_dq)~o'^kg@$	Fs B v$'hBJHL A" O (LRV HD-[31c N#m	J!@Bcd@ kb*pF""i1B!I0eI@A9 	J|5&Bdd n
A4	8)bDE3 X@;va0"J@
hp\R	& Iv{L~smv_nn~6??k7:y'_soo:GPwNUJ{c r! (`H$H"DB#i8 `  $A`$%B  9 !]qt 	`  MZ$FPKi`a8P`:J *+ kSs34=+&u?N{|>Sww?OsCE87+oIfIwec_^F\-aY.xg|?{mHk_w-_=MI^_EyF{_wQ~\tvwitAX2wL2.u{'"$^1Z1 AX

Q  )$D   -K@H*(	@FL0 $ 1G$y Q%Ia AkB
BIE 9 DOMRanges
              if (rng.createContextualFragment) {
                rng.insertNode(rng.createContextualFragment(content));
              } else {
                // Fake createContextualFragment call in IE 9
                frag = doc.createDocumentFragment();
                temp = doc.createElement('div');

                frag.appendChild(temp);
                temp.outerHTML = content;

                rng.insertNode(frag);
              }
            }
          }

          // Move to caret marker
          caretNode = self.dom.get('__caret');

          // Make sure we wrap it compleatly, Opera fails with a simple select call
          rng = doc.createRange();
          rng.setStartBefore(caretNode);
          rng.setEndBefore(caretNode);
          self.setRng(rng);

          // Remove the caret position
          self.dom.remove('__caret');

          try {
            self.setRng(rng);
          } catch (ex) {
            // Might fail on Opera for some odd reason
          }
        } else {
          if (rng.item) {
            // Delete content and get caret text selection
            doc.execCommand('Delete', false, null);
            rng = self.getRng();
          }

          // Explorer removes spaces from the beginning of pasted contents
          if (/^\s+/.test(content)) {
            rng.pasteHTML('<span id="__mce_tmp">_</span>' + content);
            self.dom.remove('__mce_tmp');
          } else {
            rng.pasteHTML(content);
          }
        }

        // Dispatch set content event
        if (!args.no_events) {
          self.editor.fire('SetContent', args);
        }
      },

      /**
       * Returns the start element of a selection range. If the start is in a text
       * node the parent element will be returned.
       *
       * @method getStart
       * @param {Boolean} real Optional state to get the real parent when the selection is collapsed not the closest element.
       * @return {Element} Start element of selection range.
       */
      getStart: function (real) {
        var self = this, rng = self.getRng(), startElement, parentElement, checkRng, node;

        if (rng.duplicate || rng.item) {
          // Control selection, return first item
          if (rng.item) {
            return rng.item(0);
          }

          // Get start element
          checkRng = rng.duplicate();
          checkRng.collapse(1);
          startElement = checkRng.parentElement();
          if (startElement.ownerDocument !== self.dom.doc) {
            startElement = self.dom.getRoot();
          }

          // Check if range parent is inside the start element, then return the inner parent element
          // This will fix issues when a single element is selected, IE would otherwise return the wrong start element
          parentElement = node = rng.parentElement();
          while ((node = node.parentNode)) {
            if (node == startElement) {
              startElement = parentElement;
              break;
            }
          }

          return startElement;
        }

        startElement = rng.startContainer;

        if (startElement.nodeType == 1 && startElement.hasChildNodes()) {
          if (!real || !rng.collapsed) {
            startElement = startElement.childNodes[Math.min(startElement.childNodes.length - 1, rng.startOffset)];
          }
        }

        if (startElement && startElement.nodeType == 3) {
          return startElement.parentNode;
        }

        return startElement;
      },

      /**
       * Returns the end element of a selection range. If the end is in a text
       * node the parent element will be returned.
       *
       * @method getEnd
       * @param {Boolean} real Optional state to get the real parent when the selection is collapsed not the closest element.
       * @return {Element} End element of selection range.
       */
      getEnd: function (real) {
        var self = this, rng = self.getRng(), endElement, endOffset;

        if (rng.duplicate || rng.item) {
          if (rng.item) {
            return rng.item(~F =Ebc>}Z-Ole$&NU6+^l-|?ogwU/{cu|==^>?PE` btWB$ T@x0x*L0PD.`I4 JX(r
, R8 $ J@7"@5!"@6H DP)M,  ArHD0`<9 8(P!,GN!d	4XG? HJ"0%-)V8(FpH MI^*H 0AT
%,%00"p00 @Vv{?7fvme9sO6Q'N{>k6Io_ov['o^wP R "!0$0 P$@L% GR G)c AB $1mP `"AHMH`Tx
 81hL@B5@"I\hr 'B2OB<@-(!{VkMcTI&_q3SPslm4_&q6w=S9_-eXXQ'>s{Qy-Y>w=l^{uZxsw//q_g>-_>ffT_^k5QM{`5O];YnLOP%t'+sA_5k5w
ae0BJQ)
& 2A"@aR20h0|!
P(
J
 5  !FEXGZ`@X @@G(nNKH@@B"06?,ok6grEMlnOowj|y:sO2-o..kOcwMktpx,Z\{x;foN<<$% 	 .*{yo@^0I `"kZfDF$Hb#
.	aP@ )PI$ U j`XF ")@a(j ID  81BP $m/ *"x!	GHA#A XdhQP (0 Iw0D d1#$L  A Rh' MQY  I4 )jXy'{#7O:=MoG?Mxit{e?:}[=>x<=-ug:z?~}]. :M,Br PZ'	 "@Qp@ AB21 X*iQrL\Bq  EqPE
Dd@]@M0DQb %4^gin0n}O6;.2}+7g;DMoMwxRsuNhSr5teR[qwL_:yylo^/Fr;}c_{eU+|y'Gc$>d+ng~?[/3 w!'U`jT F)O! &	 B$2TD*ha#0(T@QB
p0`A*@
SA40t1xy ) 0kUCt[@?n.Y?7>L_gO_{?+O>e/-
Lj/d`o4wj$#w&k;/gw;ONh#`&"BaE{ Q`A  P#cF&
04;
 TSp(A$@ $P i $Qa%m`zA"ZB &#:@X QI (G L'.UT @c |2|A N 	ABPF8@	 KDV$`G4@ |JPH@B
$JhH|sKVJ4&Oo}sk}o~jw]Js7^R4pmjn#{>.>1$A B`I4(m"@H@A@4a8lBBAb J 4VF @4:4	c.F$"FZ1 hf O+i[=nMN}|]4Z.[+_#m~vWxOLGK;kg{~~o-']w/)km'Wj/|w;4U<[u3u.O>0t>U~G__g]vK:dS~op{p~5Gb'}?A2 d (  !:TB^T<;0a $!F$Sl	6(@F51`q@
 WL%
 D#%dN@ F{ %D&!%P (l'*]h2r?>MF=o_*z/ zrgxv}On}y}Wq711>A`3[( [0"$c K aD"A B #8E C	@(#  L 1
(RL$@F h,X" A@>(4" % !P M&`@( h"@r2-@@ ZO8@Z@aeA @ 3@hZ;;O]O_.Lw?;g/zL}w}~]ZNKi?mg|8:w&v6hks_(/G
Iz7HJ pA)4"6	,H0 ,%Nd-'b83 a8SA X	@`,!(
2q@!	$kF6cB0H
XWC{~4u?k>W+XHimvYtq>:~b[y~yz7?'|u~N*=ML^{E=%~u7'+~m.Vw~}Kn=}k::>M
}7X;D/Y;[UNGQP3jOWmycr.`)Aa!W P|rr4IWDY@)EL 

14  e@D  J|L^XhECLA@5Cmdk7Ml}~~x<<u}aavis9?k?c?nWhN,;m|/lR^fFfdgM-uV-aGJ{~U^+oeYwpWo*^_|tT>NRZO+jxOW*9oSU_;LXg~	OBZSk^_(_~}OGvx~7~:s_whfGzKA]o~Yn<yvn:_k|MwCUS?~fTd/X_|N}r9owxn29x5KgzHNKp>n_ z}_+.VsTg>u?{>JN5)s;Glq
V+~?/{o:g\s'*yF6}\fwVfT_m{{}={KmSes>xi\E(Y.?S[>W",#o?\u.;{
=h?IXg3oLhk=Y{Mks@`.{w?{7l|ZO(^Uujen{Q>-7GGg
sSsQ}y]t
w=M|v/l/oknu_8~qS7]oo.>87_W:o{f>mn|c}|f}O|:_>}>[moOG0v|fsq=~=YS.n	EY6En_Wea]kW>vR]}i2?eZwrwX7Au}PYcytM%
>>k4~\o_9vjjw.ZOl{3?]U~qr-Zn~`*Hou3{mp6}{zno8]p[oV'_gVVL1i)|f:{ksggO93;ko_U_MUo}0Ou}L+Yg_3};r7_nxo{=f_{%Ox2o>v7vNgz3{SE>]o_=e0o_of)?{	?.IVny^<:?]k}7W=e_s/o|k5[n^vN+?rGy?|;%9E?WYoO
f0R)Zl?w|p?S__Gs?kVyNUMv*Gvno?iwkv{QDbO}<_.[,;m?/n_?~+z=_}O{s_Cnh6V.X)}6>Nz?w=)[s/}gW0=MO^P}yL14=x8cs~\1u3( Z?|GKWxAA59oj\H }3?KN,f}O?NNjo|:z7BlM{Kx?qvvn=_kwj[}w7pBko.l{x>Y3{.Mo~__{_J}ktg;n_sSEv*kksOYw+w/q/n{^{-Wf{7oQl?}L-A}=/\g7#gD}E_My/,/2/s.fh o{xUSmUO}EIsi??VkNdjo.Sgt>Mjquo%o/]ug/'h+xSuo$wv{kuOpn;R{qv[moQn;o$lq/._[YqRwjG}Ge#_z+:^D;t]gcEu{6J=>|=u>6OEry}_2a_r7]wQ^j}N}/[?rk="()e:KVn}m~8y:U\Ryojxrmw3^w_El7-M:V}_}oZa{c_tE^_Vomz!?2wKw;;N x|Dg}I^}y7wLlF#O>_OY6wwu^tvsZ{~c?{u]yW?Oi7/{%wW'[b;v5D]2vE~PO}\vVm[?+U{Mv[s5W<xiL~w9+iOy.M=zm.u}[m}S|nw_MN_Om]oQ}o^u~m}Y^/bOJ~Kog_U7{KwN58e>>su}\*}_Vsk-L?wVRy%7WLo>%Kad\]~K*~}c.x_vas_9 doesn't handle that correctly yet
        // IE 11 doesn't support the selection object so we check for that as well
        if (isIE && rng && rng.setStart && doc.selection) {
          try {
            // IE will sometimes throw an exception here
            ieRng = doc.selection.createRange();
          } catch (ex) {
            // Ignore
          }

          if (ieRng && ieRng.item) {
            elm = ieRng.item(0);
            rng = doc.createRange();
            rng.setStartBefore(elm);
            rng.setEndAfter(elm);
          }
        }

        // No range found then create an empty one
        // This can occur when the editor is placed in a hidden container element on Gecko
        // Or on IE when there was an exception
        if (!rng) {
          rng = doc.createRange ? doc.createRange() : doc.body.createTextRange();
        }

        // If range is at start of document then move it to start of body
        if (rng.setStart && rng.startContainer.nodeType === 9 && rng.collapsed) {
          elm = self.dom.getRoot();
          rng.setStart(elm, 0);
          rng.setEnd(elm, 0);
        }

        if (self.selectedRange && self.explicitRange) {
          if (tryCompareBoundaryPoints(rng.START_TO_START, rng, self.selectedRange) === 0 &&
            tryCompareBoundaryPoints(rng.END_TO_END, rng, self.selectedRange) === 0) {
            // Safari, Opera and Chrome only ever select text which causes the range to change.
            // This lets us use the originally set range if the selection hasn't been changed by the user.
            rng = self.explicitRange;
          } else {
            self.selectedRange = null;
            self.explicitRange = null;
          }
        }

        return rng;
      },

      /**
       * Changes the selection to the specified DOM range.
       *
       * @method setRng
       * @param {Range} rng Range to select.
       * @param {Boolean} forward Optional boolean if the selection is forwards or backwards.
       */
      setRng: function (rng, forward) {
        var self = this, sel, node, evt;

        if (!isValidRange(rng)) {
          return;
        }

        // Is IE specific range
        if (rng.select) {
          self.explicitRange = null;

          try {
            rng.select();
          } catch (ex) {
            // Needed for some odd IE bug #1843306
          }

          return;
        }

        if (!self.tridentSel) {
          sel = self.getSel();

          evt = self.editor.fire('SetSelectionRange', { range: rng, forward: forward });
          rng = evt.range;

          if (sel) {
            self.explicitRange = rng;

            try {
              sel.removeAllRanges();
              sel.addRange(rng);
            } catch (ex) {
              // IE might throw errors here if the editor is within a hidden container and selection is changed
            }

            // Forward is set to false and we have an extend function
            if (forward === false && sel.extend) {
              sel.collapse(rng.endContainer, rng.endOffset);
              sel.extend(rng.startContainer, rng.startOffset);
            }

            // adding range isn't always successful so we need to check range count otherwise an exception can occur
            self.selectedRange = sel.rangeCount > 0 ? sel.getRangeAt(0) : null;
          }

          // WebKit egde case selecting images works better using setBaseAndExtent when the image is floated
          if (!rng.collapsed && rng.startContainer === rng.endContainer && sel.setBaseAndExtent && !Env.ie) {
            if (rng.endOffset - rng.startOffset < 2) {
              if (rng.startContainer.hasChildNodes()) {
                node = rng.startContainer.childNodes[rng.startOffset];
                if (node && node.tagName === 'IMG') {
                  sel.setBaseAndExtent(
                    rng.startContainer,
                    rng.startOffset,
                    rng.endContainer,
                    rng.endOffset
                  );

                  // Since the setBaseAndExtent is fixed in more recent Blink versions we
                  // need to detect if it's doing the wrong thing and falling back to the
                  // crazy incorrect behavior api call since that seems to be the only way
                  // to get it to work on Safari WebKit as of 2017-02-23
                  if (sel.anchorNode !== rng.startContainer || sel.focusNode !== rng.endContainer) {
                    sel.setBaseAndExtent(node, 0, node, 1);
                  }
                }
              }
            }
          }

          self.editor.fire('AfterSetSelectionRange', { range: rng, forward: forward });
        } else {
          // Is W3C Range fake range on IE
          if (rng.cloneRange) {
            try {
              self.tridentSel.addRange(rng);
            } catch (ex) {
              //IE9 throws an error here if called before selection is placed in the editor
            }
          }
        }
      },

      /**
       * Sets the current selection to the specified DOM element.
       *
       * @method setNode
       * @param {Element} elm Element to set as the contents of the selection.
       * @return {Element} Returns the element that got passed in.
       * @example
       * // Inserts a DOM node at current selection/caret location
       * tinymce.activeEditor.selection.setNode(tinymce.activeEditor.dom.create('img', {src: 'some.gif', title: 'some title'}));
       */
      setNode: function (elm) {
        var self = this;

        self.setContent(self.dom.getOuterHTML(elm));

        return elm;
      },

      /**
       * Returns the currently selected element or the common ancestor element for both start and end of the selection.
       *
       * @method getNode
       * @return {Element} Currently selected element or common ancestor element.
       * @example
       * // Alerts the currently selected elements node name
       * alert(tinymce.activeEditor.selection.getNode().nodeName);
       */
      getNode: function () {
        var self = this, rng = self.getRng(), elm;
        var startContainer, endContainer, startOffset, endOffset, root = self.dom.getRoot();

        function skipEmptyTextNodes(node, forwards) {
          var orig = node;

          while (node && node.nodeType === 3 && node.length === 0) {
            node = forwards ? node.nextSibling : node.previousSibling;
          }

          return node || orig;
        }

        // Range maybe lost after the editor is made visible again
        if (!rng) {
          return root;
        }

        startContainer = rng.startContainer;
        endContainer = rng.endContainer;
        startOffset = rng.startOffset;
        endOffset = rng.endOffset;

        if (rng.setStart) {
          elm = rng.commonAncestorContainer;

          // Handle selection a image or other control like element such as anchors
          if (!rng.collapsed) {
            if (startContainer == endContainer) {
              if (endOffset - startOffset < 2) {
                if (startContainer.hasChildNodes()) {
                  elm = startContainer.childNodes[startOffset];
                }
              }
            }

            // If the anchor node is a element instead of a text node then return this element
            //if (tinymce.isWebKit && sel.anchorNode && sel.anchorNode.nodeType == 1)
            // return sel.anchorNode.childNodes[sel.anchorOffset];

            // Handle cases where the selection is immediately wrapped around a node and return that node instead of it's parent.
            // This happens when you double click an underlined word in FireFox.
            if (startContainer.nodeType === 3 && endContainer.nodeType === 3) {
              if (startContainer.length === startOffset) {
                startContainer = skipEmptyTextNodes(startContainer.nextSibling, true);
              } else {
                startContainer = startContainer.parentNode;
              }

              if (endOffset === 0) {
                endContainer = skipEmptyTextNodes(endContainer.previousSibling, false);
              } else {
                endContainer = endContainer.parentNode;
              }

              if (startContainer && startContainer === endContainer) {
                return startContainer;
              }
            }
          }

          if (elm && elm.nodeType == 3) {
            return elm.parentNode;
          }

          return elm;
        }

        elm = rng.item ? rng.item(0) : rng.parentElement();

        // IE 7 might return elements outside the iframe
        if (elm.ownerDocument !== self.win.document) {
          elm = root;
        }

        return elm;
      },

      getSelectedBlocks: function (startElm, endElm) {
        var self = this, dom = self.dom, node, root, selectedBlocks = [];

        root = dom.getRoot();
        startElm = dom.getParent(startElm || self.getStart(), dom.isBlock);
        endElm = dom.getParent(endElm || self.getEnd(), dom.isBlock);

        if (startElm && startElm != root) {
          selectedBlocks.push(startElm);
        }

        if (startElm && endElm && startElm != endElm) {
          node = startElm;

          var walker = new TreeWalker(startElm, root);
          while ((node = walker.next()) && node != endElm) {
            if (dom.isBlock(node)) {
              selectedBlocks.push(node);
            }
          }
        }

        if (endElm && startElm != endElm && endElm != root) {
          selectedBlocks.push(endElm);
        }

        return selectedBlocks;
      },

      isForward: function () {
        var dom = this.dom, sel = this.getSel(), anchorRange, focusRange;

        // No support for selection direction then always return true
        if (!sel || !sel.anchorNode || !sel.focusNode) {
          return true;
        }

        anchorRange = dom.createRng();
        anchorRange.setStart(sel.anchorNode, sel.anchorOffset);
        anchorRange.collapse(true);

        focusRange = dom.createRng();
        focusRange.setStart(sel.focusNode, sel.focusOffset);
        focusRange.collapse(true);

        return anchorRange.compareBoundaryPoints(anchorRange.START_TO_START, focusRange) <= 0;
      },

      normalize: function () {
        var self = this, rng = self.getRng();

        if (Env.range && new RangeUtils(self.dom).normalize(rng)) {
          self.setRng(rng, self.isForward());
        }

        return rng;
      },

      /**
       * Executes callback when the current selection starts/stops matching the specified selector. The current
       * state will be passed to the callback as it's first argument.
       *
       * @method selectorChanged
       * @param {String} selector CSS selector to check for.
       * @param {function} callback Callback with state and args when the selector is matches or not.
       */
      selectorChanged: function (selector, callback) {
        var self = this, currentSelectors;

        if (!self.selectorChangedData) {
          self.selectorChangedData = {};
          currentSelectors = {};

          self.editor.on('NodeChange', function (e) {
            var node = e.element, dom = self.dom, parents = dom.getParents(node, null, dom.getRoot()), matchedSelectors = {};

            // Check for new matching selectors
            each(self.selectorChangedData, function (callbacks, selector) {
              each(parents, function (node) {
                if (dom.is(node, selector)) {
                  if (!currentSelectors[selector]) {
                    // Execute callbacks
                    each(callbacks, function (callback) {
                      callback(true, { node: node, selector: selector, parents: parents });
                    });

                    currentSelectors[selector] = callbacks;
                  }

                  matchedSelectors[selector] = callbacks;
                  return false;
                }
              });
            });

            // Check if current selectors still match
            each(currentSelectors, function (callbacks, selector) {
              if (!matchedSelectors[selector]) {
                delete currentSelectors[selector];

                each(callbacks, function (callbaO(D`m?@3VRjK.M iUFlZ 0pH	XE
h fH(lH0Je
fB)1f(R'D`"`"@AM%,4 W@Pf  @(`R++ ^pq!m @(pEP@%$:  n 	J$H% !	G4LL j P   CP` 0)6&[00.u -(L B&`a! !j] MBL  )'(8@+``AmA`(@0 @1p*	0|@6`i01=(hHB`$ViD   "	Eh G!;R3zhuhV'QBEHDS,(a%EoD "4$HmJ$F-
2 BJ 0KUy4H "E D8&0 $$Gw Y"'G xC$ Hd6$'R JeE:"C#)d0'b@:d!!pA 4  !:UB(E1(0P-  qTyY0`P0^00 )1<14%0H:P'><@ `	%5RM"Ho'D&"dv"aT " FF@'`3TQj(IB)wG"$"00o=2 (0&$ }0-H  cd C'2P 	R X*"0!1*@``AA b			Anb6I 
'F ) @4 `G<!B(UAF)3U@w	x F%84z17i2Q2($ ].6	 XO0M%c'C&'28@|HJDXp@	U @8t(b2@2(j$@@H" "
IJl*F- 9{HhdRRDH* 3 (*
F"$'(F
* `2Ii neB
Q$`
 # 
&
1!b` XC  J2)2f0% J@  OB78:
HdBiQ D@spC* b  D dU9dcW!|6@JND Z&P ` 91 &Fz!= qm@WH9c	@   H	 "@L d(bkx  (A1@tLF 2_JX,JSA}xI@@ Iz  J< .1B0"  !S72@**& 5@bQhyI|	DIH<,Y Gi6 S2-fp$"0BGB#4(.8"$e | e"XOIP-*01& <A `!2b[5 !h&A5aiN)gIC5x@"R%c!a% [0=E8	H/0#@y^l	a;,
0X3:9H @**@TYKRQJ!E Z@%PK%\1BP 4&.Nhn@ ZDvEFT@QP% %?PDciH>PX9J^)O r #dd) 	P H!!C@lQO.th1y!* pw 44B@LpAS20  E#2!@8$INFD("B($@.bqJIy@@ H 2QWpD4Gnv4'p4v!SaHHQt@pp (A <}a&66`t@"FH$8 1 jN!q$H5MH 
4H)RU
)0	6C$XXaALo0 !!$4NFZ.B Dl2PH2)@
xEAVE @@B @ -
@HZ.$'$`B@C`~% D @"(&v	(HD @%x(!$(F0PC h 	y$ E I1pX9T:
0GI
D(D8@m|`@}	qJYXD)!D2%(l! ArbM	
J  7@d lg#H,	\@("
@Ti0* 6gtB,*c5 t!$9\2b	4	0"3DDj?@	8S6j Hm`	S %	@6 hE,e@XJ0	0 A tCxtB" e kl @5 0I@Z46"2$ (d<qHA 1LC+iEP#?aFN
L0lB FH eI("Y  L D FR"D Pp*	$
s.Xb 2[! ;7iBE Lpf % H `p, 6 T")0@   od0
pptF# `E\P@@%GFs B v!$'hBJHL A" O (LRv D-[:1c L#m	J!@Bcd@ kb*p""i1@!I0eI@A9 	J\5&@dd rn
A4	8ibDE3 X@;va0"AJ@
hp\Z	& I 
d%!vFF.R (FdFT+""Ax 8hG`\**4"A+#T!A*    k.Le, pP"4 pG  S@	a r! (@H$HDB#i0 `  A`$%B  9(!]qp 	` (MZ%FPKi`8P`^:J *+ f!Bx@!Ep$P0B		O01K,DAdIXqiAF	F@	Ti&0UD
0T\y`D"q% d?@E!$$)K cA0%t i@#B	Er?H[C H2}'P(H1.& hIAZ]PA&, HT`HPpTa%"$^1Z1  AX

dQ  )$D   =K@H*(	@FL0 $ 1G$y Q%Ia AkBXBe) {
          return false;
        }

        /**
         * Returns all the nodes attributes excluding internal ones, styles and classes.
         *
         * @private
         * @param {Node} node Node to get attributes from.
         * @return {Object} Name/value object with attributes and attribute values.
         */
        function getAttribs(node) {
          var attribs = {};

          each(dom.getAttribs(node), function (attr) {
            var name = attr.nodeName.toLowerCase();

            // Don't compare internal attributes or style
            if (name.indexOf('_') !== 0 && name !== 'style' && name.indexOf('data-') !== 0) {
              attribs[name] = dom.getAttrib(node, name);
            }
          });

          return attribs;
        }

        /**
         * Compares two objects checks if it's key + value exists in the other one.
         *
         * @private
         * @param {Object} obj1 First object to compare.
         * @param {Object} obj2 Second object to compare.
         * @return {boolean} True/false if the objects matches or not.
         */
        function compareObjects(obj1, obj2) {
          var value, name;

          for (name in obj1) {
            // Obj1 has item obj2 doesn't have
            if (obj1.hasOwnProperty(name)) {
              value = obj2[name];

              // Obj2 doesn't have obj1 item
              if (typeof value == "undefined") {
                return false;
              }

              // Obj2 item has a different value
              if (obj1[name] != value) {
                return false;
              }

              // Delete similar value
              delete obj2[name];
            }
          }

          // Check if obj 2 has something obj 1 doesn't have
          for (name in obj2) {
            // Obj2 has item obj1 doesn't have
            if (obj2.hasOwnProperty(name)) {
              return false;
            }
          }

          return true;
        }

        // Attribs are not the same
        if (!compareObjects(getAttribs(node1), getAttribs(node2))) {
          return false;
        }

        // Styles are not the same
        if (!compareObjects(dom.parseStyle(dom.getAttrib(node1, 'style')), dom.parseStyle(dom.getAttrib(node2, 'style')))) {
          return false;
        }

        return !BookmarkManager.isBookmarkNode(node1) && !BookmarkManager.isBookmarkNode(node2);
      };
    }

    return ElementUtils;
  }
);

/**
 * Preview.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Internal class for generating previews styles for formats.
 *
 * Example:
 *  Preview.getCssText(editor, 'bold');
 *
 * @private
 * @class tinymce.fmt.Preview
 */
define(
  'tinymce.core.fmt.Preview',
  [
    "tinymce.core.dom.DOMUtils",
    "tinymce.core.util.Tools",
    "tinymce.core.html.Schema"
  ],
  function (DOMUtils, Tools, Schema) {
    var each = Tools.each;
    var dom = DOMUtils.DOM;

    function parsedSelectorToHtml(ancestry, editor) {
      var elm, item, fragment;
      var schema = editor && editor.schema || new Schema({});

      function decorate(elm, item) {
        if (item.classes.length) {
          dom.addClass(elm, item.classes.join(' '));
        }
        dom.setAttribs(elm, item.attrs);
      }

      function createElement(sItem) {
        var elm;

        item = typeof sItem === 'string' ? {
          name: sItem,
          classes: [],
          attrs: {}
        } : sItem;

        elm = dom.create(item.name);
        decorate(elm, item);
        return elm;
      }

      function getRequiredParent(elm, candidate) {
        var name = typeof elm !== 'string' ? elm.nodeName.toLowerCase() : elm;
        var elmRule = schema.getElementRule(name);
        var parentsRequired = elmRule && elmRule.parentsRequired;

        if (parentsRequired && parentsRequired.length) {
          return candidate && Tools.inArray(parentsRequired, candidate) !== -1 ? candidate : parentsRequired[0];
        } else {
          return false;
        }
      }

      function wrapInHtml(elm, ancestry, siblings) {
        var parent, parentCandidate, parentRequired;
        var ancestor = ancestry.length > 0 && ancestry[0];
        var ancestorName = ancestor && ancestor.name;

        parentRequired = getRequiredParent(elm, ancestorName);

        if (parentRequired) {
          if (ancestorName == parentRequired) {
            parentCandidate = ancestry[0];
            ancestry = ancestry.slice(1);
          } else {
            parentCandidate = parentRequired;
          }
        } else if (ancestor) {
          parentCandidate = ancestry[0];
          ancestry = ancestry.slice(1);
        } else if (!siblings) {
          return elm;
        }

        if (parentCandidate) {
          parent = createElement(parentCandidate);
          parent.appendChild(elm);
        }

        if (siblings) {
          if (!parent) {
            // if no more ancestry, wrap in generic div
            parent = dom.create('div');
            parent.appendChild(elm);
          }

          Tools.each(siblings, function (sibling) {
            var siblingElm = createElement(sibling);
            parent.insertBefore(siblingElm, elm);
          });
        }

        return wrapInHtml(parent, ancestry, parentCandidate && parentCandidate.siblings);
      }

      if (ancestry && ancestry.length) {
        item = ancestry[0];
        elm = createElement(item);
        fragment = dom.create('div');
        fragment.appendChild(wrapInHtml(elm, ancestry.slice(1), item.siblings));
        return fragment;
      } else {
        return '';
      }
    }


    function selectorToHtml(selector, editor) {
      return parsedSelectorToHtml(parseSelector(selector), editor);
    }


    function parseSelectorItem(item) {
      var tagName;
      var obj = {
        classes: [],
        attrs: {}
      };

      item = obj.selector = Tools.trim(item);

      if (item !== '*') {
        // matching IDs, CLASSes, ATTRIBUTES and PSEUDOs
        tagName = item.replace(/(?:([#\.]|::?)([\w\-]+)|(\[)([^\]]+)\]?)/g, function ($0, $1, $2, $3, $4) {
          switch ($1) {
            case '#':
              obj.attrs.id = $2;
              break;

            case '.':
              obj.classes.push($2);
              break;

            case ':':
              if (Tools.inArray('checked disabled enabled read-only required'.split(' '), $2) !== -1) {
                obj.attrs[$2] = $2;
              }
              break;
          }

          // atribute matched
          if ($3 == '[') {
            var m = $4.match(/([\w\-]+)(?:\=\"([^\"]+))?/);
            if (m) {
              obj.attrs[m[1]] = m[2];
            }
          }

          return '';
        });
      }

      obj.name = tagName || 'div';
      return obj;
    }


    function parseSelector(selector) {
      if (!selector || typeof selector !== 'string') {
        return [];
      }

      // take into account only first one
      selector = selector.split(/\s*,\s*/)[0];

      // tighten
      selector = selector.replace(/\s*(~\+|~|\+|>)\s*/g, '$1');

      // split either on > or on space, but not the one inside brackets
      return Tools.map(selector.split(/(?:>|\s+(?![^\[\]]+\]))/), function (item) {
        // process each sibling selector separately
        var siblings = Tools.map(item.split(/(?:~\+|~|\+)/), parseSelectorItem);
        var obj = siblings.pop(); // the last one is our real target

        if (siblings.length) {
          obj.siblings = siblings;
        }
        return obj;
      }).reverse();
    }


    function getCssText(editor, format) {
      var name, previewFrag, previewElm, items;
      var previewCss = '', parentFontSize, previewStyles;

      previewStyles = editor.settings.preview_styles;

      // No preview forced
      if (previewStyles === false) {
        return '';
      }

      // Default preview
      if (typeof previewStyles !== 'string') {
        previewStyles = 'font-family font-size font-weight font-style text-decoration ' +
          'text-transform color background-color border border-radius outline text-shadow';
      }

      // Removes any variables since these can't be previewed
      function removeVars(val) {
        return val.replace(/%(\w+)/g, '');
      }

      // Create block/inline element to use for preview
      if (typeof format == "string") {
        format = editor.formatter.get(format);
        if (!format) {
          return;
        }

        format = format[0];
      }

      // Format specific preview override
      // TODO: This should probably be further reduced by the previewStyles option
      if ('preview' in format) {
        previewStyles = format.preview;
        if (previewStyles === false) {
          return '';
        }
      }

      name = format.block || format.inline || 'span';

      items = parseSelector(format.selector);
      if (items.length) {
        if (!items[0].name) { // e.g. something like ul > .someClass was provided
          items[0].name = name;
        }
        name = format.selector;
        previewFrag = parsedSelectorToHtml(items, editor);
      } else {
        previewFrag = parsedSelectorToHtml([name], editor);
      }

      previewElm = dom.select(name, previewFrag)[0] || previewFrag.firstChild;

      // Add format styles to preview element
      each(format.styles, function (value, name) {
        value = removeVars(value);

        if (value) {
          dom.setStyle(previewElm, name, value);
        }
      });

      // Add attributes to preview element
      each(format.attributes, function (value, name) {
        value = removeVars(value);

        if (value) {
          dom.setAttrib(previewElm, name, value);
        }
      });

      // Add classes to preview element
      each(format.classes, function (value) {
        value = removeVars(value);

        if (!dom.hasClass(previewElm, value)) {
          dom.addClass(previewElm, value);
        }
      });

      editor.fire('PreviewFormats');

      // Add the previewElm outside the visual area
      dom.setStyles(previewFrag, { position: 'absolute', left: -0xFFFF });
      editor.getBody().appendChild(previewFrag);

      // Get parent container font size so we can compute px values out of em/% for older IE:s
      parentFontSize = dom.getStyle(editor.getBody(), 'fontSize', true);
      parentFontSize = /px$/.test(parentFontSize) ? parseInt(parentFontSize, 10) : 0;

      each(previewStyles.split(' '), function (name) {
        var value = dom.getStyle(previewElm, name, true);

        // If background is transparent then check if the body has a background color we can use
        if (name == 'background-color' && /transparent|rgba\s*\([^)]+,\s*0\)/.test(value)) {
          value = dom.getStyle(editor.getBody(), name, true);

          // Ignore white since it's the default color, not the nicest fix
          // TODO: Fix this by detecting runtime style
          if (dom.toHex(value).toLowerCase() == '#ffffff') {
            return;
          }
        }

        if (name == 'color') {
          // Ignore black since it's the default color, not the nicest fix
          // TODO: Fix this by detecting runtime style
          if (dom.toHex(value).toLowerCase() == '#000000') {
            return;
          }
        }

        // Old IE won't calculate the font size so we need to do that manually
        if (name == 'font-size') {
          if (/em|%$/.test(value)) {
            if (parentFontSize === 0) {
              return;
            }

            // Convert font size from em/% to px
            value = parseFloat(value, 10) / (/%$/.test(value) ? 100 : 1);
            value = (value * parentFontSize) + 'px';
          }
        }

        if (name == "border" && value) {
          previewCss += 'padding:0 2px;';
        }

        previewCss += name + ':' + value + ';';
      });

      editor.fire('AfterPreviewFormats');

      //previewCss += 'line-height:normal';

      dom.remove(previewFrag);

      return previewCss;
    }

    return {
      getCssText: getCssText,
      parseSelector: parseSelec"$	By$4`l`$1 +P!
	Y 2 1*c	 Er*4ChE%ADQ'%	T%BY,Pz' c"4~
&  P(CQ7P`	@HL6T JBp\B  
H} <+. ,K,D)'

a1zF 0(L$4)@ A`$ 0!A"PI@2dA@d AF
HUN!@6
dR S Z1h0$0Ic< +)bp)a$G%`XPE$m`<G+Nb
(. 8-Ad<1LB!pNP  dQ -'`q% PC$Bc0z,pAFA&)BC  hBhH 4a
8A-9)"""\ (H- 	  " pJ @,% fH] $  P@4$P4#
Hp("!C"@89(RnHE
RPBRsF1Y,cGj 9B9\	 EE$`J0-$@4!6a6(" C@/ '/-RP[*	0`R.vp A4 L0!	D	`
 G $
$2b sbi!B 9~B#GH@'?5C|/)NOL4RA )9CZ(%Dh) 0ha'! Kh`(X$sQ$+#W<V$Dj  uF fU X"RPAetD7E  $Ze@H G !'AIbD.90 "	2\9! #hC"trxe" 0a
@B(  @!u(!%fh	
@q BD"
P 2lRP`/ C@$$

 
{ x ?@ @    ,"$r7H 4<`!p$ $@V Bx*& F;#	!$ (0!$P9HJ)H@@\ Q@1&": *K1  (d
0
`t$J	, 
)Af>E@#	EIdX'7 0< 1zPBX  H

AEPCA!` BlD%Ih@.:)c%h"0$@	 %RTHi= )q 90 &L I&(PJ &PdI@[9(Pt G@H``DUGUP!rM5b 	YA(2i.0r	
B!Gd0rST!hh7P$,Kr d+ d8  & TBRQ@4#HXm3"P $e
B[2i| QApB( 2" Fpv JIP 
*CR? l H%`A@ax4Q&2B$D DMaA B @ A2sP@B ! +,N	@Kj@ Csd (!P,|H*#%)@) ($)S5c
 #* A
$e4@S %)
j!" )$Y4!m# @ Z@$KxPI
fz
JL19G)#&dC:$^P4F
A'%G R60U6 1D#1@J(A`A 
IJK@Xr@"
HA 9a}EQ3	B|h"x(I)p:!#$C( b%  W
ahE`zF63 DQ0 )pH102y hX68Q
@"E@! F5@y) (f,P* @U@$2&@`%hRR!Wv  3%)  @"TH$
,X7p@e	HAB$*%Bx$*a p0;H
BK
 RGKD .ad DxT,X]( `A'H5I0E VPD  $- sc4!#L@AB A #@N(8)2H1 A 1RP @  zH(AlJO)	4 5PlQ!D  $0J&,TeHs	;9W0i	qA\
 1`0 fn@!#0Z@$yBTt9D$TC a(pT $8`FFR 
 uP G' 8W!AXcC+!@, 0.2( b	 H01+mF! ui, " *(xR1$J9 9J : +G GtOr]` ,,d X@q*CR  )"B AB@@m06fl` +"MH0TCUT!   Y!@P  "dHe!u!]G $ 
p;$. DP 9N! Pu X"3)*t TV U`!Na7
R;Dh"7 ,#`F(! <@L-cREaX`T R1$bPH/    (l-!
8LT fXBl2`z,  (OIH[`8a3	^  ; Bh4C*%E@10fP6@A	@ZHJ ':HPP"j&!) s$! (FpD&p & Dh! <   d	 1
% 5 4B1oj*
B
@6b P@r}B
 BC5  "PdDB$DP Q	P# f	Se."0jd@(Z@
`7J
:XAD
dB ` p 0
K j;
$4p25 W9&$R% !2H@BPTJ)(hiEp$`"  	HhEE@dI
qQ *^$(5$S
X)aO &	Tr4bs PPJmr({`E0m&`
Wd Pq3Hm@ `@6 ^ @!q(NV6DD#')BA LD\H
<&:73U([_b PPL,xF@Aq  "RX0<@z9d!	c.Q #bAGXJ L  P$N<K@h , e(
6Bu@}H <3@
/R}

      function isInlineBlock(node) {
        return node && /^(IMG)$/.test(node.nodeName);
      }

      function getParents(node, selector) {
        return dom.getParents(node, selector, dom.getRoot());
      }

      function isCaretNode(node) {
        return node.nodeType === 1 && node.id === '_mce_caret';
      }

      function defaultFormats() {
        register({
          valigntop: [
            { selector: 'td,th', styles: { 'verticalAlign': 'top' } }
          ],

          valignmiddle: [
            { selector: 'td,th', styles: { 'verticalAlign': 'middle' } }
          ],

          valignbottom: [
            { selector: 'td,th', styles: { 'verticalAlign': 'bottom' } }
          ],

          alignleft: [
            {
              selector: 'figure.image',
              collapsed: false,
              classes: 'align-left',
              ceFalseOverride: true,
              preview: 'font-family font-size'
            },
            {
              selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',
              styles: {
                textAlign: 'left'
              },
              inherit: false,
              preview: false,
              defaultBlock: 'div'
            },
            { selector: 'img,table', collapsed: false, styles: { 'float': 'left' }, preview: 'font-family font-size' }
          ],

          aligncenter: [
            {
              selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',
              styles: {
                textAlign: 'center'
              },
              inherit: false,
              preview: false,
              defaultBlock: 'div'
            },
            {
              selector: 'figure.image',
              collapsed: false,
              classes: 'align-center',
              ceFalseOverride: true,
              preview: 'font-family font-size'
            },
            {
              selector: 'img',
              collapsed: false,
              styles: {
                display: 'block',
                marginLeft: 'auto',
                marginRight: 'auto'
              },
              preview: false
            },
            {
              selector: 'table',
              collapsed: false,
              styles: {
                marginLeft: 'auto',
                marginRight: 'auto'
              },
              preview: 'font-family font-size'
            }
          ],

          alignright: [
            {
              selector: 'figure.image',
              collapsed: false,
              classes: 'align-right',
              ceFalseOverride: true,
              preview: 'font-family font-size'
            },
            {
              selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',
              styles: {
                textAlign: 'right'
              },
              inherit: false,
              preview: 'font-family font-size',
              defaultBlock: 'div'
            },
            {
              selector: 'img,table',
              collapsed: false,
              styles: {
                'float': 'right'
              },
              preview: 'font-family font-size'
            }
          ],

          alignjustify: [
            {
              selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',
              styles: {
                textAlign: 'justify'
              },
              inherit: false,
              defaultBlock: 'div',
              preview: 'font-family font-size'
            }
          ],

          bold: [
            { inline: 'strong', remove: 'all' },
            { inline: 'span', styles: { fontWeight: 'bold' } },
            { inline: 'b', remove: 'all' }
          ],

          italic: [
            { inline: 'em', remove: 'all' },
            { inline: 'span', styles: { fontStyle: 'italic' } },
            { inline: 'i', remove: 'all' }
          ],

          underline: [
            { inline: 'span', styles: { textDecoration: 'underline' }, exact: true },
            { inline: 'u', remove: 'all' }
          ],

          strikethrough: [
            { inline: 'span', styles: { textDecoration: 'line-through' }, exact: true },
            { inline: 'strike', remove: 'all' }
          ],

          forecolor: { inline: 'span', styles: { color: '%value' }, links: true, remove_similar: true, clear_child_styles: true },
          hilitecolor: { inline: 'span', styles: { backgroundColor: '%value' }, links: true, remove_similar: true, clear_child_styles: true },
          fontname: { inline: 'span', styles: { fontFamily: '%value' }, clear_child_styles: true },
          fontsize: { inline: 'span', styles: { fontSize: '%value' }, clear_child_styles: true },
          fontsize_class: { inline: 'span', attributes: { 'class': '%value' } },
          blockquote: { block: 'blockquote', wrapper: 1, remove: 'all' },
          subscript: { inline: 'sub' },
          superscript: { inline: 'sup' },
          code: { inline: 'code' },

          link: {
            inline: 'a', selector: 'a', remove: 'all', split: true, deep: true,
            onmatch: function () {
              return true;
            },

            onformat: function (elm, fmt, vars) {
              each(vars, function (value, key) {
                dom.setAttrib(elm, key, value);
              });
            }
          },

          removeformat: [
            {
              selector: 'b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins',
              remove: 'all',
              split: true,
              expand: false,
              block_expand: true,
              deep: true
            },
            { selector: 'span', attributes: ['style', 'class'], remove: 'empty', split: true, expand: false, deep: true },
            { selector: '*', attributes: ['style', 'class'], split: false, expand: false, deep: true }
          ]
        });

        // Register default block formats
        each('p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp'.split(/\s/), function (name) {
          register(name, { block: name, remove: 'all' });
        });

        // Register user defined formats
        register(ed.settings.formats);
      }

      var clearChildStyles = function (format, node) {
        if (format.clear_child_styles) {
          each(dom.select('*', node), function (node) {
            each(format.styles, function (value, name) {
              dom.setStyle(node, name, '');
            });
          });
        }
      };

      function addKeyboardShortcuts() {
        // Add some inline shortcuts
        ed.addShortcut('meta+b', 'bold_desc', 'Bold');
        ed.addShortcut('meta+i', 'italic_desc', 'Italic');
        ed.addShortcut('meta+u', 'underline_desc', 'Underline');

        // BlockFormat shortcuts keys
        for (var i = 1; i <= 6; i++) {
          ed.addShortcut('access+' + i, '', ['FormatBlock', false, 'h' + i]);
        }

        ed.addShortcut('access+7', '', ['FormatBlock', false, 'p']);
        ed.addShortcut('access+8', '', ['FormatBlock', false, 'div']);
        ed.addShortcut('access+9', '', ['FormatBlock', false, 'address']);
      }

      // Public functions

      /**
       * Returns the format by name or all formats if no name is specified.
       *
       * @method get
       * @param {String} name Optional name to retrieve by.
       * @return {Array/Object} Array/Object with all registered formats or a specific format.
       */
      function get(name) {
        return name ? formats[name] : formats;
      }

      /**
       * Registers a specific format by name.
       *
       * @method register
       * @param {Object/String} name Name of the format for example "bold".
       * @param {Object/Array} format Optional format object or array of format variants
       * can only be omitted if the first arg is an object.
       */
      function register(name, format) {
        if (name) {
          if (typeof name !== 'string') {
            each(name, function (format, name) {
              register(name, format);
            });
          } else {
            // Force format into array and add it to internal collection
            format = format.length ? format : [format];

            each(format, function (format) {
              // Set deep to false by default on selector formats this to avoid removing
              // alignment on images inside paragraphs when alignment is changed on paragraphs
              if (format.deep === undef) {
                format.deep = !format.selector;
              }

              // Default to true
              if (format.split === undef) {
                format.split = !format.selector || format.inline;
              }

              // Default to true
              if (format.remove === undef && format.selector && !format.inline) {
                format.remove = 'none';
              }

              // Mark format as a mixed format inline + block level
              if (format.selector && format.inline) {
                format.mixed = true;
                format.block_expand = true;
              }

              // Split classes if needed
              if (typeof format.classes === 'string') {
                format.classes = format.classes.split(/\s+/);
              }
            });

            formats[name] = format;
          }
        }
      }

      /**
       * Unregister a specific format by name.
       *
       * @method unregister
       * @param {String} name Name of the format for example "bold".
       */
      function unregister(name) {
        if (name && formats[name]) {
          delete formats[name];
        }

        return formats;
      }

      function matchesUnInheritedFormatSelector(node, name) {
        var formatList = get(name);

        if (formatList) {
          for (var i = 0; i < formatList.length; i++) {
            if (formatList[i].inherit === false && dom.is(node, formatList[i].selector)) {
              return true;
            }
          }
        }

        return false;
      }

      function getTextDecoration(node) {
        var decoration;

        ed.dom.getParent(node, function (n) {
          decoration = ed.dom.getStyle(n, 'text-decoration');
          return decoration && decoration !== 'none';
        });

        return decoration;
      }

      function processUnderlineAndColor(node) {
        var textDecoration;
        if (node.nodeType === 1 && node.parentNode && node.parentNode.nodeType === 1) {
          textDecoration = getTextDecoration(node.parentNode);
          if (ed.dom.getStyle(node, 'color') && textDecoration) {
            ed.dom.setStyle(node, 'text-decoration', textDecoration);
          } else if (ed.dom.getStyle(node, 'text-decoration') === textDecoration) {
            ed.dom.setStyle(node, 'text-decoration', null);
          }
        }
      }

      /**
       * Applies the specified format to the current selection or specified node.
       *
       * @method apply
       * @param {String} name Name of format to apply.
       * @param {Object} vars Optional list of variables to replace within format before applying it.
       * @param {Node} node Optional node to apply the format to defaults to current selection.
       */
      function apply(name, vars, node) {
        var formatList = get(name), format = formatList[0], bookmark, rng, isCollapsed = !node && selection.isCollapsed();

        function setElementFormat(elm, fmt) {
          fmt = fmt || format;

          if (elm) {
            if (fmt.onformat) {
              fmt.onformat(elm, fmt, vars, node);
            }

            each(fmt.styles, function (value, name) {
              dom.setStyle(elm, name, replaceVars(value, vars));
            });

            // Needed for the WebKit span spam bug
            // TODO: Remove this once WebKit/Blink fixes this
            if (fmt.styles) {
              var styleVal = dom.getAttrib(elm, 'style');

              if (styleVal) {
                elm.setAttribute('data-mce-style', styleVal);
              }
            }

            each(fmt.attributes, function (value, name) {
              dom.setAttrib(elm, name, replaceVars(value, vars));
            });

            each(fmt.classes, function (value) {
Z p0 A1HAB@ Fb  " g&
r0i)E@jTF0@JH`!% )bl`5"MrA7+n~Hye/.2esffe 2-t?bQ}!vs]aRG2Ccz_oNO}^q7z_uF9}ok{{gw'$|5Gl}W?QIWDEK~t/E].{lyPL>^XBB
g( ,F
bXd' R`@hB8
D	N#</Lg r60	PFBB C 0\F4ZAH  $DHHU\'jwE?:r<Io+e.{B.gn*SQ_z%m{fQ~Uszg#RV2k64#QH=BzR$@ACCP-H$VAP( 81L $C<@
` 2 \1M	$,`H# %	 "P'6@f"8 AFk0`dFAB@R#SiBTr0Y@ZXB0I"  	D!	#]"?9dH 2CFB	P@@`
Hh!$jU}/s9.uNVi];?)Fq5pz{O9;&,w1chs>Zj{3;HyuIf1@!PE@p:
&ZRc
xq@1HQHBQL
]
pLhj&R)KA<!@ B@CrDC  CC  Px[Cn[R}4>L}.6wA;s=BWXM\W{;:ZzyG
Zdt~d;Yi.wwsdh0kjDO;3i [0,LGW7}g~h//p@smPbUfo_WaM)_!)npo-pg'65Ig1)NU    -Q` "$ A,T	AV5p@0	 TT#$"FRL6%0YADHnctF}.gi~r-v0n4koYMsgr7
Y~ob JBA!#J4P
\NT@	`* !XP
  -` 	pR(J@c$ 	 <SD8 @U	#	
 .(@@B\61@ R V` 'K$4D L"a ( I
(K -1EaK($!%B8!`J \' A)SP	B!2e! lP@R0B@w?e|
w<__}w^g2;w}S{TZ["zw;9-S*v{m`7>=?\WWy&'as`V.(`S 8"C`R"JBC@ a,D$1Q=M *`jn+T '0 b!Sp 7H%D 
 |A{1M
z1OM^|~<)x vqbWf?><yqAaOjY!V+|]L[8[ Eg,>Uu5{~L27yCrG=Vs#WSw~<_6W*GIMYk|lqtCOm_}N Cq(; *& JLX=m'o{=6h|&FA!8  ! !`Q0'&+BJ@D	1@RcR%Q'!PIPE/vx]MNu,9_b?e=NAA-7vr]zpO_Y7O}M?+]KS/M12o|K?f}{n+Ou	!*qRHsH!Q(V Eh @T=$a4 9r 8CH1  X	-G !][ P)N(B D`e
4 $5 q
&P/(\X!"+ ^O pH X Gw (@CT#"AN@B(ARQ @J/Q &  R1zzPl=_;yq~o}0qv8v=e:_{7}[fWcW9wkF^3vz!0s	 !@I6" X(X@M' ( *H@pY/# r - !3 @
E0p@lJDH_a^vJ?WMDimig%kW%o`S}O<m=tqw[v/n>?hEWm+v7Y679]}gG-1sgV$?h^5?6#u|xo?/vl+_N%]"OG~yLDd9b (*E rAPH0 R  6C 0DbMd+ClDHT0@A v 3d&E*:(\!J3h_+Oq\+$+M#-s$UXzq]On`7%N
/g7+vuNmR  9SP ^+ 	MPcI"N*BhV5 *@!B1JL@,dpXt $t(GpE
b D.
e j|5 E` )V Rd1V@(	0@A!@ DH `$ Dp
]Gk`	 Q	D/D xe"z.6 . (]pCftl3GnsrXk|M< 3lU/h&:~>:i_sJe5qcG:S5kt wrapping it with a DIV this is for forced_root_blocks: false
              // It's kind of a hack but people should be using the default block type P since all desktop editors work that way
              if (!forcedRootBlock && formatList[0].defaultBlock && !dom.getParent(curSelNode, dom.isBlock)) {
                apply(formatList[0].defaultBlock);
              }

              // Apply formatting to selection
              ed.selection.setRng(adjustSelectionToVisibleSelection());
              bookmark = selection.getBookmark();
              applyRngStyle(expandRng(selection.getRng(TRUE), formatList), bookmark);

              if (format.styles) {
                // Colored nodes should be underlined so that the color of the underline matches the text color.
                if (format.styles.color || format.styles.textDecoration) {
                  walk(curSelNode, processUnderlineAndColor, 'childNodes');
                  processUnderlineAndColor(curSelNode);
                }

                // nodes with font-size should have their own background color as well to fit the line-height (see TINY-882)
                if (format.styles.backgroundColor) {
                  processChildElements(curSelNode,
                    hasStyle('fontSize'),
                    applyStyle('backgroundColor', replaceVars(format.styles.backgroundColor, vars))
                  );
                }
              }

              selection.moveToBookmark(bookmark);
              moveStart(selection.getRng(TRUE));
              ed.nodeChanged();
            } else {
              performCaretAction('apply', name, vars);
            }
          }

          Hooks.postProcess(name, ed);
        }
      }

      /**
       * Removes the specified format from the current selection or specified node.
       *
       * @method remove
       * @param {String} name Name of format to remove.
       * @param {Object} vars Optional list of variables to replace within format before removing it.
       * @param {Node/Range} node Optional node or DOM range to remove the format from defaults to current selection.
       */
      function remove(name, vars, node, similar) {
        var formatList = get(name), format = formatList[0], bookmark, rng, contentEditable = true;

        // Merges the styles for each node
        function process(node) {
          var children, i, l, lastContentEditable, hasContentEditableState;

          // Node has a contentEditable value
          if (node.nodeType === 1 && getContentEditable(node)) {
            lastContentEditable = contentEditable;
            contentEditable = getContentEditable(node) === "true";
            hasContentEditableState = true; // We don't want to wrap the container only it's children
          }

          // Grab the children first since the nodelist might be changed
          children = grep(node.childNodes);

          // Process current node
          if (contentEditable && !hasContentEditableState) {
            for (i = 0, l = formatList.length; i < l; i++) {
              if (removeFormat(formatList[i], vars, node, node)) {
                break;
              }
            }
          }

          // Process the children
          if (format.deep) {
            if (children.length) {
              for (i = 0, l = children.length; i < l; i++) {
                process(children[i]);
              }

              if (hasContentEditableState) {
                contentEditable = lastContentEditable; // Restore last contentEditable state from stack
              }
            }
          }
        }

        function findFormatRoot(container) {
          var formatRoot;

          // Find format root
          each(getParents(container.parentNode).reverse(), function (parent) {
            var format;

            // Find format root element
            if (!formatRoot && parent.id != '_start' && parent.id != '_end') {
              // Is the node matching the format we are looking for
              format = matchNode(parent, name, vars, similar);
              if (format && format.split !== false) {
                formatRoot = parent;
              }
            }
          });

          return formatRoot;
        }

        function wrapAndSplit(formatRoot, container, target, split) {
          var parent, clone, lastClone, firstClone, i, formatRootParent;

          // Format root found then clone formats and split it
          if (formatRoot) {
            formatRootParent = formatRoot.parentNode;

            for (parent = container.parentNode; parent && parent != formatRootParent; parent = parent.parentNode) {
              clone = dom.clone(parent, FALSE);

              for (i = 0; i < formatList.length; i++) {
                if (removeFormat(formatList[i], vars, clone, clone)) {
                  clone = 0;
                  break;
                }
              }

              // Build wrapper node
              if (clone) {
                if (lastClone) {
                  clone.appendChild(lastClone);
                }

                if (!firstClone) {
                  firstClone = clone;
                }

                lastClone = clone;
              }
            }

            // Never split block elements if the format is mixed
            if (split && (!format.mixed || !isBlock(formatRoot))) {
              container = dom.split(formatRoot, container);
            }

            // Wrap container in cloned formats
            if (lastClone) {
              target.parentNode.insertBefore(lastClone, target);
              firstClone.appendChild(target);
            }
          }

          return container;
        }

        function splitToFormatRoot(container) {
          return wrapAndSplit(findFormatRoot(container), container, container, true);
        }

        function unwrap(start) {
          var node = dom.get(start ? '_start' : '_end'),
            out = node[start ? 'firstChild' : 'lastChild'];

          // If the end is placed within the start the result will be removed
          // So this checks if the out node is a bookmark node if it is it
          // checks for another more suitable node
          if (isBookmarkNode(out)) {
            out = out[start ? 'firstChild' : 'lastChild'];
          }

          // Since dom.remove removes empty text nodes then we need to try to find a better node
          if (out.nodeType == 3 && out.data.length === 0) {
            out = start ? node.previousSibling || node.nextSibling : node.nextSibling || node.previousSibling;
          }

          dom.remove(node, true);

          return out;
        }

        function removeRngStyle(rng) {
          var startContainer, endContainer;
          var commonAncestorContainer = rng.commonAncestorContainer;

          rng = expandRng(rng, formatList, TRUE);

          if (format.split) {
            startContainer = getContainer(rng, TRUE);
            endContainer = getContainer(rng);

            if (startContainer != endContainer) {
              // WebKit will render the table incorrectly if we wrap a TH or TD in a SPAN
              // so let's see if we can use the first child instead
              // This will happen if you triple click a table cell and use remove formatting
              if (/^(TR|TH|TD)$/.test(startContainer.nodeName) && startContainer.firstChild) {
                if (startContainer.nodeName == "TR") {
                  startContainer = startContainer.firstChild.firstChild || startContainer;
                } else {
                  startContainer = startContainer.firstChild || startContainer;
                }
              }

              // Try to adjust endContainer as well if cells on the same row were selected - bug #6410
              if (commonAncestorContainer &&
                /^T(HEAD|BODY|FOOT|R)$/.test(commonAncestorContainer.nodeName) &&
                isTableCell(endContainer) && endContainer.firstChild) {
                endContainer = endContainer.firstChild || endContainer;
              }

              if (dom.isChildOf(startContainer, endContainer) && !isBlock(endContainer) &&
                !isTableCell(startContainer) && !isTableCell(endContainer)) {
                startContainer = wrap(startContainer, 'span', { id: '_start', 'data-mce-type': 'bookmark' });
                splitToFormatRoot(startContainer);
                startContainer = unwrap(TRUE);
                return;
              }

              // Wrap start/end nodes in span element since these might be cloned/moved
              startContainer = wrap(startContainer, 'span', { id: '_start', 'data-mce-type': 'bookmark' });
              endContainer = wrap(endContainer, 'span', { id: '_end', 'data-mce-type': 'bookmark' });

              // Split start/end
              splitToFormatRoot(startContainer);
              splitToFormatRoot(endContainer);

              // Unwrap start/end to get real elements again
              startContainer = unwrap(TRUE);
              endContainer = unwrap();
            } else {
              startContainer = endContainer = splitToFormatRoot(startContainer);
            }

            // Update range positions since they might have changed after the split operations
            rng.startContainer = startContainer.parentNode ? startContainer.parentNode : startContainer;
            rng.startOffset = nodeIndex(startContainer);
            rng.endContainer = endContainer.parentNode ? endContainer.parentNode : endContainer;
            rng.endOffset = nodeIndex(endContainer) + 1;
          }

          // Remove items between start/end
          rangeUtils.walk(rng, function (nodes) {
            each(nodes, function (node) {
              process(node);

              // Remove parent span if it only contains text-decoration: underline, yet a parent node is also underlined.
              if (node.nodeType === 1 && ed.dom.getStyle(node, 'text-decoration') === 'underline' &&
                node.parentNode && getTextDecoration(node.parentNode) === 'underline') {
                removeFormat({
                  'deep': false,
                  'exact': true,
                  'inline': 'span',
                  'styles': {
                    'textDecoration': 'underline'
                  }
                }, null, node);
              }
            });
          });
        }

        // Handle node
        if (node) {
          if (node.nodeType) {
            rng = dom.createRng();
            rng.setStartBefore(node);
            rng.setEndAfter(node);
            removeRngStyle(rng);
          } else {
            removeRngStyle(node);
          }

          return;
        }

        if (getContentEditable(selection.getNode()) === "false") {
          node = selection.getNode();
          for (var i = 0, l = formatList.length; i < l; i++) {
            if (formatList[i].ceFalseOverride) {
              if (removeFormat(formatList[i], vars, node, node)) {
                break;
              }
            }
          }

          return;
        }

        if (!selection.isCollapsed() || !format.inline || dom.select('td[data-mce-selected],th[data-mce-selected]').length) {
          bookmark = selection.getBookmark();
          removeRngStyle(selection.getRng(TRUE));
          selection.moveToBookmark(bookmark);

          // Check if start element still has formatting then we are at: "<b>text|</b>text"
          // and need to move the start into the next text node
          if (format.inline && match(name, vars, selection.getStart())) {
            moveStart(selection.getRng(true));
          }

          ed.nodeChanged();
        } else {
          performCaretAction('remove', name, vars, similar);
        }
      }

      /**
       * Toggles the specified format on/off.
       *
       * @method toggle
       * @param {String} name Name of format to apply/remove.
       * @param {Object} vars Optional list of variables to replace within format before applying/removing it.
       * @param {Node} node Optional node to apply the format to or remove from. Defaults to current selection.
       */
      function toggle(name, vars, node) {
        var fmt = get(name);

        if (match(name, vars, node) && (!('toggle' in fmt[0]) || fmt[0) F  +4HA"bp>AB	 @DDO0|F.4pB)H0 B#(5AACDBK	rlL (YT"c 	@"12Rx($R8BPQ0tRS.`
	FL$N*="<>. )0>N.Q
7p,g \ E @?%P (PD@">n|"0HIVBA(sP@b0wt f
00tVvTH2HD"t DAb(
@	@TV   <($T !Tr$JAi$ hI+ Dm() 7[ dPJ9BDQu
H)d @ HHyY r C%`x,	F%h10dA	QL~!`(58q#2 #jM7v#I8D:c2:tJ!D'1T) e#J8! ,E i QTFD6!|U( `t#I P, }LDHB =!p%1-	X1 H "4S@"D `6D*ho"K `@a'Cv` Q  *T 46 
(	`BL	8KeD
,p$",V'	WIVSVi "D
|r T$1k*  LPl	aPHQ@Q @BI )fBC!@0O@I2`L"/ H)p("H,p5`S! B*o3^@BkDS,H1*B (1UDA^Li& $D@ KcUA	-)QjbB #C,`0` QF@;	IQ6p", `IDA0  F@A A$Uf"*Y
!,0@4hRRa2l$AzT.6,cLh@yL0S5x$^T8*"@QBQIppI\nQtW!1jE"!I(B(L912!8Z#*lB5#	 A1b
J/@0"8ai&kh<B=B` 2x
`F)8"< $a4FIP.` THU6,dHExC6Jy		S5p( TYCi5E  D@*U`B
	 	 bO: Z"h(9("H  UO DlhP"m"B ` hWGmJ e	 1 2F"(S
!R:VAtCa [ CYLcSfHirY PDA3f<2G+)D!E&^p@$2 ?\DA BID.l .cE	Bl#*.  '	Dh,!T-F jG  r ` IB @8(@EGPX12A$!BA0 wG5%3F0I UH+TA SHA2YBpbDU09
 b	8)K@PVXGy3 c@	BH0d|Z@k/ "?@,PL02 Wp AC*s+ b'*`pg qQR0liKz* 01D@XIcJ UQdPhpAB% 8	qaV+Wb  42PbiOpC$	c P!"JQA  S`# 0B
 F DW1P LGL(@ D2((H<!BA
aXt#5,> PA=A%AD$oA{l r#(HBV7K( :Ej'F#_vzT hDl!VS![[ 8`-ktPjM6`fJ{wUnx9*`U	C"@t>@2D'*m2(,! VRQ: l&2u(:	t49BH4! 9	 	(  V# 1Z#P``AZPN ,f&"j"8 a
P B	<J
  $ 9T TU<BC"  B!)P|Wj@j[7f1Xc0QO't"b9$te (:4N":6FB$8#&*pl l-d\+),fMBdA@ia%(
(dvc&`	 0PA q>BN)1

	bTfp.@?B
,W	20 XPR	+%P	d 2Q`@(P	\h@"@CX4fT e	BD@PH 	n`8	edJ 
j (P@DE9\2B@G+ *3U
3taXi
P8
W)5&(?1G #Ia!1i)4P*&sN#V@02% ` ChIg 
iH"W/bc8BPV2ACa  \B" ECePmi<J H D] @TaP0   &u3"
vA@BJ9@B@,*R	uJAb2/h9I9a080_r`ndpT` Bg\.m Pd,T&|&E@EZ:4VQ0pMIJ8e)Dz	E@^F$(XjRyHImElKr{s@N@7dq'.Q/"!Y xrbX (  b< qxl	   $BC)U[ p@}\HcHt`PD2  ?`! B 0fq= ( J@	f@e@qF
Ba@40FBhfE8Q@gGIO{  hG_21)0aBDGRxDq "`h(N eNI2@@D0CGAL>G4q6.m1J0Q I  ,c,EJ DH ',V (P D0BPQ vQ0M1PDRQ E/(_D b!p, "  *R3Xa"
  +@i2FRy  	  D
T`P@(a)XJ@&,) 0.BVD$1d :J*b	H0(fp9s! )?#0;hgTR bL2!8G;B0Y[`AB3(T(=1& UADp0%?FIRe! w?je if it's different
        startNode = selection.getStart();
        if (startNode != node) {
          if (matchParents(startNode)) {
            return TRUE;
          }
        }

        return FALSE;
      }

      /**
       * Matches the current selection against the array of formats and returns a new array with matching formats.
       *
       * @method matchAll
       * @param {Array} names Name of format to match.
       * @param {Object} vars Optional list of variables to replace before checking it.
       * @return {Array} Array with matched formats.
       */
      function matchAll(names, vars) {
        var startElement, matchedFormatNames = [], checkedMap = {};

        // Check start of selection for formats
        startElement = selection.getStart();
        dom.getParent(startElement, function (node) {
          var i, name;

          for (i = 0; i < names.length; i++) {
            name = names[i];

            if (!checkedMap[name] && matchNode(node, name, vars)) {
              checkedMap[name] = true;
              matchedFormatNames.push(name);
            }
          }
        }, dom.getRoot());

        return matchedFormatNames;
      }

      /**
       * Returns true/false if the specified format can be applied to the current selection or not. It
       * will currently only check the state for selector formats, it returns true on all other format types.
       *
       * @method canApply
       * @param {String} name Name of format to check.
       * @return {boolean} true/false if the specified format can be applied to the current selection/node.
       */
      function canApply(name) {
        var formatList = get(name), startNode, parents, i, x, selector;

        if (formatList) {
          startNode = selection.getStart();
          parents = getParents(startNode);

          for (x = formatList.length - 1; x >= 0; x--) {
            selector = formatList[x].selector;

            // Format is not selector based then always return TRUE
            // Is it has a defaultBlock then it's likely it can be applied for example align on a non block element line
            if (!selector || formatList[x].defaultBlock) {
              return TRUE;
            }

            for (i = parents.length - 1; i >= 0; i--) {
              if (dom.is(parents[i], selector)) {
                return TRUE;
              }
            }
          }
        }

        return FALSE;
      }

      /**
       * Executes the specified callback when the current selection matches the formats or not.
       *
       * @method formatChanged
       * @param {String} formats Comma separated list of formats to check for.
       * @param {function} callback Callback with state and args when the format is changed/toggled on/off.
       * @param {Boolean} similar True/false state if the match should handle similar or exact formats.
       */
      function formatChanged(formats, callback, similar) {
        var currentFormats;

        // Setup format node change logic
        if (!formatChangeData) {
          formatChangeData = {};
          currentFormats = {};

          ed.on('NodeChange', function (e) {
            var parents = getParents(e.element), matchedFormats = {};

            // Ignore bogus nodes like the <a> tag created by moveStart()
            parents = Tools.grep(parents, function (node) {
              return node.nodeType == 1 && !node.getAttribute('data-mce-bogus');
            });

            // Check for new formats
            each(formatChangeData, function (callbacks, format) {
              each(parents, function (node) {
                if (matchNode(node, format, {}, callbacks.similar)) {
                  if (!currentFormats[format]) {
                    // Execute callbacks
                    each(callbacks, function (callback) {
                      callback(true, { node: node, format: format, parents: parents });
                    });

                    currentFormats[format] = callbacks;
                  }

                  matchedFormats[format] = callbacks;
           B	(VN`ZP A (U'l$@ 9`
p1H0_h v4X Ne Rj,,9 CYQBC0d@1?2sMnrvg^w2??k3|=^nWWnirLHE.=~Y+)u>	D spL7qv/ym:}W?]\hi}"c_;s~Ui1o7oUu_gy/
!b  H!@  +p`HKq84CDF
B`	J,YS-bR! F\@GBDhAptGh @ BBU	%l"IZ,=s{	z}5W(Yj7OeVoo_gE4,;9S%I{Sywq?_y{_swuw^?@ %MH0*Q80<	SB@WC @  "t$ B@" @H0p G- 08h 0  ! 3'
T\0*m$ a  J 	g+   @4 SZ+1d1fH P "7a A#&   F5 i  D  ,Rp  `k  I)*_hW<~be;>G^]m*s<:caxK6,zWVkkSW-u8.~Wg[=+ZeUW&AHF) `@ ( 	@2"e!	pX$ > h@7DH "B`0 h*	 %l@dd azY  qHk_ifW` <YSJ~0~8z9mqS9(Od.~Cm]\8*{v_!zz';qg\7_o7i7g77qTk+FVU<_%?*<~TKSUO]>A<v=NJToK"(F5/A(
,X H@AEP T X @" F $F8  ` ZRr@H8R,H0Fg h4u>nuS~xw?vwsr5o}ONlK2g_Zp]n3r= _Sqm%@# Aq)B  hH;:D ,h"GH[%uFp  L5# *$H!F1	@(B	a" +xCG)FP RA4 &A Dq9`U(k'H!4# 
]	hmp+04 a*DEf`H")IsH(FP!H6y x &  Ed^Ajo=(3}oB}vot}_vqWOk}ot-#-Zy~|HRPN:;jYxS' D$#	6	$ G"$	RkAb($1 2!h  
@O0Hw'yB!3"I-AJ5H1P N4 3~%.}kYAs#k%]I_$$_7s>m_M;8oO'?MsMO{/|7e7smlEtS6U1R<_zsovUgk[]?/}='N^$Nq,o~1fwoUSwUxltAL dj:$SV )nA  \*0)9b " )
"$(ra1$ADBj9Lh+5) D, z@*|Orvm1qZIrm=?7hON;l7wsO1hMbw}_e}KObn~iC @H&(5H@ hR8 (H#lD-AA2T
 CSf
 Ci0( "_4  )@ A,@2	3X[a"cA2 D`2P 
` $!/E L!gtR rTHL *"QIlqE` "XAr"jRbpZ% is>>8>l;=Us|_hW|&g}ysIGgSeKN_jn\?[[}W5WxVS{=gnTYg'( 
\eHH dU-JPUS}f @* hri (`$"nD b = `P @ D&ZBUA|xlpq2_o.}9w~eg?9i]~oelV^u~<W5w9.i
u]{O5z_vF>3J:it'OV3'x~xX,gQuIk}'q#\^S~%?~Ko6oUdevh-B -	XFt@
RR0`QB!dP `b6  Xp PB@Im @Z !JOB2@&D54$,A"U#DKqqE~eiv}wk{~wUt	uvGj|??CU&NqZ~z*}zUw[f$ @1@&H('@*!	D2D# 0HB5L  h
QBDf!`D"@+) "$_tB9 @ D!DJ0*$BP4AW(@H $8'J^J8RF*&02, `#  68HoD ZBRd,C0 *@  ,AMZ
u+  =|/._;wK87^$(<Ys+ NYJ!-[68m'mX(w=PVx!urn Fun.curry(function (name, node) {
          return !!(node && getStyle(node, name));
        }, name);
      }

      function applyStyle(name, value) {
        return Fun.curry(function (name, value, node) {
          dom.setStyle(node, name, value);
        }, name, value);
      }

      /**
       * Returns the style by name on the specified node. This method modifies the style
       * contents to make it more easy to match. This will resolve a few browser issues.
       *
       * @private
       * @param {Node} node to get style from.
       * @param {String} name Style name to get.
       * @return {String} Style item value.
       */
      function getStyle(node, name) {
        return normalizeStyleValue(dom.getStyle(node, name), name);
      }

      /**
       * Normalize style value by name. This method modifies the style contents
       * to make it more easy to match. This will resolve a few browser issues.
       *
       * @private
       * @param {String} value Value to get style from.
       * @param {String} name Style name to get.
       * @return {String} Style item value.
       */
      function normalizeStyleValue(value, name) {
        // Force the format to hex
        if (name == 'color' || name == 'backgroundColor') {
          value = dom.toHex(value);
        }

        // Opera will return bold as 700
        if (name == 'fontWeight' && value == 700) {
          value = 'bold';
        }

        // Normalize fontFamily so "'Font name', Font" becomes: "Font name,Font"
        if (name == 'fontFamily') {
          value = value.replace(/[\'\"]/g, '').replace(/,\s+/g, ',');
        }

        return '' + value;
      }

      /**
       * Replaces variables in the value. The variable format is %var.
       *
       * @private
       * @param {String} value Value to replace variables in.
       * @param {Object} vars Name/value array with variables to replace.
       * @return {String} New value with replaced variables.
       */
      function replaceVars(value, vars) {
        if (typeof value != "string") {
          value = value(vars);
        } else if (vars) {
          value = value.replace(/%(\w+)/g, function (str, name) {
            return vars[name] || str;
          });
        }

        return value;
      }

      function isWhiteSpaceNode(node) {
        return node && node.nodeType === 3 && /^([\t \r\n]+|)$/.test(node.nodeValue);
      }

      function wrap(node, name, attrs) {
        var wrapper = dom.create(name, attrs);

        node.parentNode.insertBefore(wrapper, node);
        wrapper.appendChild(node);

        return wrapper;
      }

      /**
       * Expands the specified range like object to depending on format.
       *
       * For example on block formats it will move the start/end position
       * to the beginning of the current block.
       *
       * @private
       * @param {Object} rng Range like object.
       * @param {Array} format Array with formats to expand by.
       * @param {Boolean} remove
       * @return {Object} Expanded range like object.
       */
      function expandRng(rng, format, remove) {
        var lastIdx, leaf, endPoint,
          startContainer = rng.startContainer,
          startOffset = rng.startOffset,
          endContainer = rng.endContainer,
          endOffset = rng.endOffset;

        // This function walks up the tree if there is no siblings before/after the node
        function findParentContainer(start) {
          var container, parent, sibling, siblingName, root;

          container = parent = start ? startContainer : endContainer;
          siblingName = start ? 'previousSibling' : 'nextSibling';
          root = dom.getRoot();

          function isBogusBr(node) {
            return node.nodeName == "BR" && node.getAttribute('data-mce-bogus') && !node.nextSibling;
          }

          // If it's a text node and the offset is inside the text
          if (container.nodeType == 3 && !isWhiteSpaceNode(container)) {
            if (start ? startOffset > 0 : endOffset < container.nodeValue.length) {
      |o,|oZ}]ftNurqj/7sKl}oE|=K!_-mZTwQE^iRBqHP4	R	vK .b	IEf,J  C(y@6
`* !"21A"	"P	F!LAAA  JmR(D 06( Ae2c()80Q8Z HJ$(AMX"J0EA"(`B0 }9p/@9 5' ``
nK.W|{;?s?yQ{r~=?zroe~}fC[F>s7[I~q_	q, @Id@fLH@	P"A@	pxd4@a-I: "$zZH  nIld	$"g[l UIb(2s2D@I~wO__{u|s=m ?_~we{]>y\/cvk?#o{,~rZM.\7s	W`-nSw}+Cf}zG}?m=mW/~_Bt_Lm_tksb2Q^ ,A$10@) Z4H."R.8^ "@8 -  !S p2ABb& Jh 
( fDbt2   K~rK/?ys??_^m~}-?vt?og~w!^(}x
6TO^G:FQ,@'Z`p d+b 
v41L$X  r7 
d0A<H>	E Z	XI 2BdS (0{5F
%a(E@FJEGRBA3!&FBl $'0PE,8pp,FOhPTQ0 ] &C!$Nh@@r+%^	3$&6JbPJk`	&"-E(d@R3YVI]w=eei_?7q_t
l~wt6w/y7iztv;s/9{'WAvWaz5Z}Ra#g2d!&5M$"5t@H2D3mx0EBBZhHh]":D6BPd-"d
F`LA +Uo>z_S<gI57e_~?Yw2~O.=]ilE?z}J_??WKhm&=HZy2_z>z]gjtKz\K^lmkE{){fs{Tbp`L`#5<	@ay 0-	 @B"
y, 0DiM"Ba<.@BS`0(	_TN$ I%0P , b}Yg/Su=k=*>v=yyZx-o_WO~.w0yo7i9Xfl34$-@Qu MD)	""FpHE2 # 3sU @:42%h"`  
HRHHQFT&L IPO&5OhE}@yQQlYK@I-B$a8aD  2'\D!IL T@)BBGzRO@(D Z\|rSr}J)7;<!q!X<o_?O6hc	}gC}?wF_"`K4$r$44 /B`@DZ&t$  B
eB;P PB02IU q=1" Hp` @ A	E?(tkVy;/?p_;]?no/g_p=WT4~em}/_\V>-w~<g?KvrsjoNuq\aJyknn.6R?wN>lXm~o]mU[_{-{?' 'tEb3TE 9RdTAX10GH@n 1C`E	\ MTADV)fMH%d@s# hQ
CVh$lyKw?W_xa 7[g.vZg?ujuRnu~)foOnu%r/|jng|_}wEV?gzw@BP ()N}!Pq A.
=QjF4Y8V`DzF"B0Q4
)lC $2c\8p{4F+ "a) 453UG4mV`	APi  XB? 8JbK@AfIJ.2 EBc
GdHQi tTSJDc HNA1P(P,4iqz>#,nwnK~=mW)_y^}owag;^u\vB$(0D(!,L@&\)G* b PB	QJ)052'W@!r?JAj)S'[w`MpJ N	a1	"  %ls:K\-%{oz^n~+Rx?e~ =c~k;KbS?L[9wn<\;~yoGb=
fyz)W?FR_3-G.U{w<*g!X7,?7 <  2R1x $m @D By0`A,T!D Kq  Q#Hv IT6zE`Z&K@@$`%deS2~;{qJ_dr=3wXN%[M~nC}}{9{VEtg:|?Wf<a|Q{ ^\E*'Z[hQ TH *$LVa: \pS E$&t $V:l
@TM\#D RcFT|N@ts 2Ap$@BJ_9@|AX(0$TI'%@$$B@PE@PDX4ie$!eQ0=[ g j PiJF!LFOEB $";}>Udz^o}ww{^z@ks;_39}_Jg_n?mV75<I"R #P3A   .	 A%@7'&WGntzC ]PA"@p!_ ^hoDP	0 !a5/a,!:
Y2)c2&t7^ {vSc/Y7s0v2wp]7uGv+nr\-Y,_s}?6^z{'O~Ow[{jkv?{;g~/W_|_m^ZUv_!G DDe`GAt@3 SBA,hB?DUd0DA#@{ "8B ST7m		*BPg@PA q5`79cnuZl>__;P|Z?28~6{|^|'9wyem7G3}}$cD= B$QJsR@ 6"@-ZM9 q}%Z8&H T=aKb4`G	 2/)~ &6mAJHFC# 7R&%E$h-&`b:'A9LRY8%R$p0q$)	$\  3
/TxD2 1#6.Nh
%U$lK3; H[ywS)[Os?eowk?t]>mE/1BZ\g/[}7~:m>3U;v 	i@:BP.Je*AKAa
: '!p:1H}k`	qPU &t
 Z"	O	P`C	K [oNt_(MX-_/6IOY{\{woLxQS"wol'77vwM__|kwyO49q~/->kmc;{./^zc|6/vW#s{}zh}~z{_Q5V&rCkdrXSP P
B A9eZ{j	eB&)8`'r' 7q bdU	 IBX)A{E 0R]^Wzk_<_b_?@~wkgF-U+zg]3_?>;l;w}(!Bh|J0PF0*(
@Zf@CS02|L`" 7VH&eK&n3'xB)!R'#K`JA7xchO|]zU HF$ YLET;RMVNl[HQl`{@#`0Ld X )0+d8s@@L 2" k BpLyf|'^>>~wv;M=Uy>W~n}j3?k~OUfh!$+JbD@A0bG	S,(GCe@q+$.Fo 6lW#$Qd oH-"RP0  HWTN_qummg*>kR}<;}bS,^q/w?K/ksPgrC{7dq-y~^d?|oOk?{mhK8lSrK3|Wp*o{=j+8]@6}o??5LN`%"O Z  ZR@4qDB8 E_@ 	Sz q%F28dB7u)[2uTIxEU[i:B?Pwhm!a24qw\_oFtw}^^s]Wr}gw{y]}%N`f3={~$o~yO_q}#2hKZdBiRb2& d7w1X	F#B\B xRoF	f Dx+3S&&,7 cb NXq}LPE'B:a BQBJT[@SDCEH
K BNsA"A"HfA4G F0| "" P&@  6n#a9Rdr 0g{g+jeo-k~k/cc}?TW_~7hobNekokUoyD={u{5+,e F&-D' n Uy < LXXRAg	` O"DG @(p^Nq1+(4SQITSHZAnM`,O"HDJBk09	/pzW=vN[yJ7<|]?y_]cnvvo	Z_y/~}{[W/kZ.Woo;~r9=7__w02|]vMnO|i//_?^w?w7F	0iDD@,Rp@E@ lcx?U @H^A`=2X,)K(kA! A&xD	1^Qy PP$Abr!I`8L<ord boundary
            endPoint = findWordEndPoint(endContainer, endOffset);
            if (endPoint) {
              endContainer = endPoint.container;
              endOffset = endPoint.offset;
            }
          }

          // Avoid applying formatting to a trailing space.
          leaf = findLeaf(endContainer, endOffset);
          if (leaf.node) {
            while (leaf.node && leaf.offset === 0 && leaf.node.previousSibling) {
              leaf = findLeaf(leaf.node.previousSibling);
            }

            if (leaf.node && leaf.offset > 0 && leaf.node.nodeType === 3 &&
              leaf.node.nodeValue.charAt(leaf.offset - 1) === ' ') {

              if (leaf.offset > 1) {
                endContainer = leaf.node;
                endContainer.splitText(leaf.offset - 1);
              }
            }
          }
        }

        // Move start/end point up the tree if the leaves are sharp and if we are in different containers
        // Example * becomes !: !<p><b><i>*text</i><i>text*</i></b></p>!
        // This will reduce the number of wrapper elements that needs to be created
        // Move start point up the tree
        if (format[0].inline || format[0].block_expand) {
          if (!format[0].inline || (startContainer.nodeType != 3 || startOffset === 0)) {
            startContainer = findParentContainer(true);
          }

          if (!format[0].inline || (endContainer.nodeType != 3 || endOffset === endContainer.nodeValue.length)) {
            endContainer = findParentContainer();
          }
        }

        // Expand start/end container to matching selector
        if (format[0].selector && format[0].expand !== FALSE && !format[0].inline) {
          // Find new startContainer/endContainer if there is better one
          startContainer = findSelectorEndPoint(startContainer, 'previousSibling');
          endContainer = findSelectorEndPoint(endContainer, 'nextSibling');
        }

        // Expand start/end container to matching block element or text node
        if (format[0].block || format[0].selector) {
          // Find new startContainer/endContainer if there is better one
          startContainer = findBlockEndPoint(startContainer, 'previousSibling');
          endContainer = findBlockEndPoint(endContainer, 'nextSibling');

          // Non block element then try to expand up the leaf
          if (format[0].block) {
            if (!isBlock(startContainer)) {
              startContainer = findParentContainer(true);
            }

            if (!isBlock(endContainer)) {
              endContainer = findParentContainer();
            }
          }
        }

        // Setup index for startContainer
        if (startContainer.nodeType == 1) {
          startOffset = nodeIndex(startContainer);
          startContainer = startContainer.parentNode;
        }

        // Setup index for endContainer
        if (endContainer.nodeType == 1) {
          endOffset = nodeIndex(endContainer) + 1;
          endContainer = endContainer.parentNode;
        }

        // Return new range like object
        return {
          startContainer: startContainer,
          startOffset: startOffset,
          endContainer: endContainer,
          endOffset: endOffset
        };
      }

      function isColorFormatAndAnchor(node, format) {
        return format.links && node.tagName == 'A';
      }

      /**
       * Removes the specified format for the specified node. It will also remove the node if it doesn't have
       * any attributes if the format specifies it to do so.
       *
       * @private
       * @param {Object} format Format object with items to remove from node.
       * @param {Object} vars Name/value object with variables to apply to format.
       * @param {Node} node Node to remove the format styles on.
       * @param {Node} compareNode Optional compare node, if specified the styles will be compared to that node.
       * @return {Boolean} True/false if the node was removed or not.
       */
      function removeFormat(format, vars, node, compareNode) {
        var i, attrs, stylesModified;

        // Check if node matches format
        if (!matchName(node, format) && !isColorFormatAndAnchor(node, format)) {
          return FALSE;
        }

        // Should we compare with format attribs and styles
        if (format.remove != 'all') {
          // Remove styles
          each(format.styles, function (value, name) {
            value = normalizeStyleValue(replaceVars(value, vars), name);

            // Indexed array
            if (typeof name === 'number') {
              name = value;
              compareNode = 0;
            }

            if (format.remove_similar || (!compareNode || isEq(getStyle(compareNode, name), value))) {
              dom.setStyle(node, name, '');
            }

            stylesModified = 1;
          });

          // Remove style attribute if it's empty
          if (stylesModified && dom.getAttrib(node, 'style') === '') {
            node.removeAttribute('style');
            node.removeAttribute('data-mce-style');
          }

          // Remove attributes
          each(format.attributes, function (value, name) {
            var valueOut;

            value = replaceVars(value, vars);

            // Indexed array
            if (typeof name === 'number') {
              name = value;
              compareNode = 0;
            }

            if (!compareNode || isEq(dom.getAttrib(compareNode, name), value)) {
              // Keep internal classes
              if (name == 'class') {
                value = dom.getAttrib(node, name);
                if (value) {
                  // Build new class value where everything is removed except the internal prefixed classes
                  valueOut = '';
                  each(value.split(/\s+/), function (cls) {
                    if (/mce\-\w+/.test(cls)) {
                      valueOut += (valueOut ? ' ' : '') + cls;
                    }
                  });

                  // We got some internal classes left
                  if (valueOut) {
                    dom.setAttrib(node, name, valueOut);
                    return;
                  }
                }
              }

              // IE6 has a bug where the attribute doesn't get removed correctly
              if (name == "class") {
                node.removeAttribute('className');
              }

              // Remove mce prefixed attributes
              if (MCE_ATTR_RE.test(name)) {
                node.removeAttribute('data-mce-' + name);
              }

              node.removeAttribute(name);
            }
          });

          // Remove classes
          each(format.classes, function (value) {
            value = replaceVars(value, vars);

            if (!compareNode || dom.hasClass(compareNode, value)) {
              dom.removeClass(node, value);
            }
          });

          // Check for non internal attributes
          attrs = dom.getAttribs(node);
          for (i = 0; i < attrs.length; i++) {
            var attrName = attrs[i].nodeName;
            if (attrName.indexOf('_') !== 0 && attrName.indexOf('data-') !== 0) {
              return FALSE;
            }
          }
        }

        // Remove the inline child if it's empty for example <b> or <span>
        if (format.remove != 'none') {
          removeNode(node, format);
          return TRUE;
        }
      }

      /**
       * Removes the node and wrap it's children in paragraphs before doing so or
       * appends BR elements to the beginning/end of the block element if forcedRootBlocks is disabled.
       *
       * If the div in the node below gets removed:
       *  text<div>text</div>text
       *
       * Output becomes:
       *  text<div><br />text<br /></div>text
       *
       * So when the div is removed the result is:
       *  text<br />text<br />text
       *
       * @private
       * @param {Node} node Node to remove + apply BR/P elements to.
       * @param {Object} format Format rule.
       * @return {Node} Input node.
       */
      function removeNode(node, format) {
        var parentNode = node.parentNode, ro8@ 	@( o@`,b:VRI o0%!Yl	sXN,,Q.< 84+ZeH%DJ)	@n(h)'1@2DRL
aD+L)!@d) S@@R h4Q1@R(x@Hp
C8@DI(I"&"!"P@ IX16@P
"@!@h$HuD..&l
Qr  	.YCbWB"F5@ 0F%<d GLCB	z04
CF
	(5UZ
(*jDr  P#$),F b d1C@q@IR}Q4A`G2c#`@ 	@.@Ib4B `  SBPH*@cqC"i E$( /5
   E@C_B
r}\$)
dP -?hmE@H19H<p !LYbadT%K:8RR!l2	Ne^ +b G$<+Jf5[$`R CV^
\YvUGA1	H
*8DFx# $jz12 k@DRpE[h	 pu]
S1!12`P  bH#$-S&;0 x84%@bT@D?xIu#\ Bb \\%! pdlH,B8*QDStAZ & J*IAh(P*AN@ca`# %t$%[ GX(HH% e 2
F)\\GB&qgVlhF	;a`"Nc.f@0ia8 R daDE+$h9EDD(
jJ
Lm@kH BcA  @.RXT	x $P Cne "X"($@@@!L	BR$@8RA
L:
.  1XH" H: 7TT$Xg!  3LD@,I!'cKL|q aZ)XBK CpH$!!0H(	 hLj|M% LJ5 HxM" G  D0VRac!i @
 %1+(c1`2h@8NP!#BAM3}$*LCDPI\ 0 @cUDE{hO A&TTJAcRIB@uI-b#     	=x O,e & @  $GYFH $(GPc j d
!MQ
wkm!"P 0Fp]fnHCR +UB$"N	-@
ZUlA0HA}Ww9I3L( 4MVQ$p%)x8a#lF`!0EL .X (.AFB(8@T"Q)
P!.I1Vdm])s5,a!
Ggg@Aa%  ,-RR)J;( 'LD-0	v3p&&S+$ 6"i`Dc&j9 0"jDA68J9G   *	 %D	y 6' P  B>5MV0))n6 XV.h#"LL  V HC` d AHF4J>g EMadC"d60, lBr,c&`0B$a]xY@ E3rQ& ZaG$F@
I 8F:; Fd' 
a@q%|#@`Q0DJWTJ((0
A"PlH4jn%H%`$D0BJ6
0mTF	 Kl':(Ln X@ -TRNp! 03 B(< pPL|8@%)@<x(6X:3 ,YCi(DHga Q q!C!%tJR@vz
%mb 6RMi8 EtRE`e8;HLE! XE S"
 G P&01@ @4j( ((QAKHmFZ	phQB\ !3DH
 m# B&  qi#) `&"Q# "E=%)ARn`DfDE$D/@a@@6d@@}rlj,g		dS,G4<b0dT0 0cnIH6`$d"P@^ 8h.
MB +V@$%jAH|$CBIUBaXoA! HA&hGA=H0Q|! 4C@L$B h"B-(pG(@qOD4(?A 1* EFEDA%{Ad k0vHh$T& 0   T 1"@%bhc,e8UKc	DC&0'7R )txDNHH<pH&<,RebT!x()p A"%^"D  H
	6$
) RCI ND*I0aA 6PhlTDu[@O@(L 8@	
#9PgI%FE@Q( )1CHIz#R2  E
Itj C  b    2Q]Nt$+C$$`2pRPtE@*5`%2J25)$S@\Y`z+1$&$	0 b  	 B4'GQ107a58TtbGH\lL)!+vg0 _P"$jc4@Mj'@ms0pJTCTe* b09DK l% %
!bD(OgbP(C$DN 3@@*\ 	l iQ,p:  @%a[ 	 0L!Je0rK &/ T R2 X@4ThdFLbC[ `L CIiF	)8h$LAb kH4"@a>"c d nW	B0>o@VA
'"t#\+A%p$s R&BJ!C\3EEV*dF!\mtX* @SjV 
T  #1Z0U (	a8duI"J=)BAtX L h/"   -@	UPR[CY".)m1$@@D k# 	`@! bmt2M{]u~Zo{6
qvW igy/s6wxuS}cRZ}tO^P@d*Q0B
B#!  1;&h @@  
K$& 2#GdpN	t|PB b"V$9
B"0K@-07<*%	I k%BI@B,bR7)"F>(:@$
]b
A@ DBVR@"LCI8
`\0c#z.oGunMcwm{OmJuFuJ~7j|/?]z|gYWXSuMw^i `:&y'c"20"MDf:V,@8 @$!PBD`"Au  "PY.34@P` lTje3E`
N6wj7tw;gzp1[=\%M4_y>mW_4gW_9/Z"'~w*z/t}4}Wg=>)
el}_^z7in\7dg{{xz_Uc\	m[i'[5$PqA  $ABE@.%	CETe
&%W 
,}#(@ qpQlT#VN1?TRZPo+4i 8/9'	OtfK}+___^}JAz{ekw_Gn:m?v16F+~}}?,{z	 <Bl:  
8`k @hxW@	a	44bH
  !|T`5ti	(HrD
pMoy%$B9
TFET,3YBHph2P1T2uQtQ&`"		)s(H~0`61 49!@qH`H0qI@ V((t @Z c
g}+wjuY{Q<o3w7qt?f/_k/mVw?w^~^m=?&ow{=Nx/tqABHFJRJ
" ]`$c{s!T\$h{D$PH)xA`d4 #VAIBH@!%)J(:Cm4H(hYdug|l_}zWK\OZMoGovs<;jo[3m/?a|znq}w{7{z?'TIOWj}1's{i_7g;x5<:cqiLe+P(~r3>.}aIDIaEd!02@ 	 f"eaB{;@xH 1fL`D@aEP!B-Z" ebJHAC CYa(HBO ! h@pFa*ISt8tn\vTmn_}{s Fmg}~__qT??/{6kilWvi7*yg_.{J, &3 B0AbU`a
 Z;hgaA
wd@2J 8&4&`( \AvC	$!<aE6Vp0@T:8yaIBD8&!`! $)	<ADH,"I	t 8A` ($Fa *O  $ Ai.Z :1`<PRnb|OepC?m6}_+$<;OLR"Yw{s|~9B_~{b+=OP*5TK|HzQ $`

 Dd"D00X!  P 	2Cn0	R&8+aE$0&
%Wjlm_gmCE7_yy7{mfzdwNo_~mY.5q}seZ5V_?+j7=g7y^_/}nG~mvEJM;	:iM^5eUw}<'_vW	_WMOqo-sC[|vV; _
`ljQi`Df B0]p Ih'O )D D`P`,  eP!
D l\ (Q@%%$db@N 	8}w?bwp7;gw*g/w?l|SVz-*|*}exwD]ogNzo_-[@5	0 CHC0D@8"R	`GpCBf" "2nD#$	)	$n "etj`ra@ $$JHMfr)8( 2Fba{'A%*IB&B`TtqvA0 iH#
hd  H@"N`4B(l!3d.G@BI2"  9Fd]~-_:l;/F
~tI`'S~ws'mxw{Zqi)g?|U~AVAH*T,DepL:(> b@H #l	fP@"HD hCAU	P
O@UCPP+B@y A  ia$6AP FT;|fQ_;4VO-m;j6v:W7b~o-iRn|)ner3[	o>Z#hyq{ii.|}M_k%|d]-?ON1>Y-CM[^^v:rvx{1wm_[/S}S?MT8$B'`)B;_ 2gZ <dP
 @fABHc, p*n5zF$*Ko(yBP"fd2fF[j&Ac S0         }

            selection.setRng(rng);
          }
        }

        // Applies formatting to the caret position
        function applyCaretFormat() {
          var rng, caretContainer, textNode, offset, bookmark, container, text;

          rng = selection.getRng(true);
          offset = rng.startOffset;
          container = rng.startContainer;
          text = container.nodeValue;

          caretContainer = getParentCaretContainer(selection.getStart());
          if (caretContainer) {
            textNode = findFirstTextNode(caretContainer);
          }

          // Expand to word if caret is in the middle of a text node and the char before/after is a alpha numeric character
          var wordcharRegex = /[^\s\u00a0\u00ad\u200b\ufeff]/;
          if (text && offset > 0 && offset < text.length &&
            wordcharRegex.test(text.charAt(offset)) && wordcharRegex.test(text.charAt(offset - 1))) {
            // Get bookmark of caret position
            bookmark = selection.getBookmark();

            // Collapse bookmark range (WebKit)
            rng.collapse(true);

            // Expand the range to the closest word and split it at those points
            rng = expandRng(rng, get(name));
            rng = rangeUtils.split(rng);

            // Apply the format to the range
            apply(name, vars, rng);

            // Move selection back to caret position
            selection.moveToBookmark(bookmark);
          } else {
            if (!caretContainer || textNode.nodeValue !== INVISIBLE_CHAR) {
              caretContainer = createCaretContainer(true);
              textNode = caretContainer.firstChild;

              rng.insertNode(caretContainer);
              offset = 1;

              apply(name, vars, caretContainer);
            } else {
              apply(name, vars, caretContainer);
            }

            // Move selection to text node
            selection.setCursorLocation(textNode, offset);
          }
        }

        function removeCaretFormat() {
          var rng = selection.getRng(true), container, offset, bookmark,
            hasContentAfter, node, formatNode, parents = [], i, caretContainer;

          container = rng.startContainer;
          offset = rng.startOffset;
          node = container;

          if (container.nodeType == 3) {
            if (offset != container.nodeValue.length) {
              hasContentAfter = true;
            }

            node = node.parentNode;
          }

          while (node) {
            if (matchNode(node, name, vars, similar)) {
              formatNode = node;
              break;
            }

            if (node.nextSibling) {
              hasContentAfter = true;
            }

            parents.push(node);
            node = node.parentNode;
          }

          // Node doesn't have the specified format
          if (!formatNode) {
            return;
          }

          // Is there contents after the caret then remove the format on the element
          if (hasContentAfter) {
            // Get bookmark of caret position
            bookmark = selection.getBookmark();

            // Collapse bookmark range (WebKit)
            rng.collapse(true);

            // Expand the range to the closest word and split it at those points
            rng = expandRng(rng, get(name), true);
            rng = rangeUtils.split(rng);

            // Remove the format from the range
            remove(name, vars, rng);

            // Move selection back to caret position
            selection.moveToBookmark(bookmark);
          } else {
            caretContainer = createCaretContainer();

            node = caretContainer;
            for (i = parents.length - 1; i >= 0; i--) {
              node.appendChild(dom.clone(parents[i], false));
              node = node.firstChild;
            }

            // Insert invisible character into inner most format element
            node.appendChild(dom.doc.createTextNode(INVISIBLE_CHAR));
            node = node.firstChild;

            var block = dom.getParent(formatNode, isTextBlock);

            if (block && dom.isEmpty(block)) {
              // Replace formatNode with caretContainer when removing format from empty block like <p><b>|</b></p>
              formatNode.parentNode.replaceChild(caretContainer, formatNode);
            } else {
              // Insert caret container after the formatted node
              dom.insertAfter(caretContainer, formatNode);
            }

            // Move selection to text node
            selection.setCursorLocation(node, 1);

            // If the formatNode is empty, we can remove it safely.
            if (dom.isEmpty(formatNode)) {
              dom.remove(formatNode);
            }
          }
        }

        // Checks if the parent caret container node isn't empty if that is the case it
        // will remove the bogus state on all children that isn't empty
        function unmarkBogusCaretParents() {
          var caretContainer;

          caretContainer = getParentCaretContainer(selection.getStart());
          if (caretContainer && !dom.isEmpty(caretContainer)) {
            walk(caretContainer, function (node) {
              if (node.nodeType == 1 && node.id !== caretContainerId && !dom.isEmpty(node)) {
                dom.setAttrib(node, 'data-mce-bogus', null);
              }
            }, 'childNodes');
          }
        }

        // Only bind the caret events once
        if (!ed._hasCaretEvents) {
          // Mark current caret container elements as bogus when getting the contents so we don't end up with empty elements
          markCaretContainersBogus = function () {
            var nodes = [], i;

            if (isCaretContainerEmpty(getParentCaretContainer(selection.getStart()), nodes)) {
              // Mark children
              i = nodes.length;
              while (i--) {
                dom.setAttrib(nodes[i], 'data-mce-bogus', '1');
              }
            }
          };

          disableCaretContainer = function (e) {
            var keyCode = e.keyCode;

            removeCaretContainer();

            // Remove caret container if it's empty
            if (keyCode == 8 && selection.isCollapsed() && selection.getStart().innerHTML == INVISIBLE_CHAR) {
              removeCaretContainer(getParentCaretContainer(selection.getStart()));
            }

            // Remove caret container on keydown and it's left/right arrow keys
            if (keyCode == 37 || keyCode == 39) {
              removeCaretContainer(getParentCaretContainer(selection.getStart()));
            }

            unmarkBogusCaretParents();
          };

          // Remove bogus state if they got filled by contents using editor.selection.setContent
          ed.on('SetContent', function (e) {
            if (e.selection) {
              unmarkBogusCaretParents();
            }
          });
          ed._hasCaretEvents = true;
        }

        // Do apply or remove caret format
        if (type == "apply") {
          applyCaretFormat();
        } else {
          removeCaretFormat();
        }
      }

      /**
       * Moves the start to the first suitable text node.
       */
      function moveStart(rng) {
        var container = rng.startContainer,
          offset = rng.startOffset,
          walker, node, nodes;

        if (rng.startContainer == rng.endContainer) {
          if (isInlineBlock(rng.startContainer.childNodes[rng.startOffset])) {
            return;
          }
        }

        // Convert text node into index if possible
        if (container.nodeType == 3 && offset >= container.nodeValue.length) {
          // Get the parent container location and walk from there
          offset = nodeIndex(container);
          container = container.parentNode;
        }

        // Move startContainer/startOffset in to a suitable node
        if (container.nodeType == 1) {
          nodes = container.childNodes;
          if (offset < nodes.length) {
            container = nodes[offset];
            walker = new TreeWalker(container, dom.getParent(container, dom.isBlock));
          } else {
            container = nodes[nodes.length - 1];
            walker = new TreeWalker(container, dom.getParent(container, dom.isBlock));
            walker.next(true);
          }

          for (node = walker.current(); node; node = walker.next()) {
            if (node.nodeType == 3 && !isWhiteSpaceNode(node)) {
              rng.setStart(node, 0);
              selection.setRng(rng);

              return;
            }
          }
        }
      }
    };
  }
);

/**
 * Diff.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * JS Implementation of the O(ND) Difference Algorithm by Eugene W. Myers.
 *
 * @class tinymce.undo.Diff
 * @private
 */
define(
  'tinymce.core.undo.Diff',
  [
  ],
  function () {
    var KEEP = 0, INSERT = 1, DELETE = 2;

    var diff = function (left, right) {
      var size = left.length + right.length + 2;
      var vDown = new Array(size);
      var vUp = new Array(size);

      var snake = function (start, end, diag) {
        return {
          start: start,
          end: end,
          diag: diag
        };
      };

      var buildScript = function (start1, end1, start2, end2, script) {
        var middle = getMiddleSnake(start1, end1, start2, end2);

        if (middle === null || middle.start === end1 && middle.diag === end1 - end2 ||
          middle.end === start1 && middle.diag === start1 - start2) {
          var i = start1;
          var j = start2;
          while (i < end1 || j < end2) {
            if (i < end1 && j < end2 && left[i] === right[j]) {
              script.push([KEEP, left[i]]);
              ++i;
              ++j;
            } else {
              if (end1 - start1 > end2 - start2) {
                script.push([DELETE, left[i]]);
                ++i;
              } else {
                script.push([INSERT, right[j]]);
                ++j;
              }
            }
          }
        } else {
          buildScript(start1, middle.start, start2, middle.start - middle.diag, script);
          for (var i2 = middle.start; i2 < middle.end; ++i2) {
            script.push([KEEP, left[i2]]);
          }
          buildScript(middle.end, end1, middle.end - middle.diag, end2, script);
        }
      };

      var buildSnake = function (start, diag, end1, end2) {
        var end = start;
        while (end - diag < end2 && end < end1 && left[end] === right[end - diag]) {
          ++end;
        }
        return snake(start, end, diag);
      };

      var getMiddleSnake = function (start1, end1, start2, end2) {
        // Myers Algorithm
        // Initialisations
        var m = end1 - start1;
        var n = end2 - start2;
        if (m === 0 || n === 0) {
          return null;
        }

        var delta = m - n;
        var sum = n + m;
        var offset = (sum % 2 === 0 ? sum : sum + 1) / 2;
        vDown[1 + offset] = start1;
        vUp[1 + offset] = end1 + 1;

        for (var d = 0; d <= offset; ++d) {
          // Down
          for (var k = -d; k <= d; k += 2) {
            // First step

            var i = k + offset;
            if (k === -d || k != d && vDown[i - 1] < vDown[i + 1]) {
              vDown[i] = vDown[i + 1];
            } else {
              vDown[i] = vDown[i - 1] + 1;
            }

            var x = vDown[i];
            var y = x - start1 + start2 - k;

            while (x < end1 && y < end2 && left[x] === right[y]) {
              vDown[i] = ++x;
              ++y;
            }
            // Second step
            if (delta % 2 != 0 && delta - d <= k && k <= delta + d) {
              if (vUp[i - delta] <= vDown[i]) {
                return buildSnake(vUp[i - delta], k + start1 - start2, end1, end2);
              }
            }
          }

          // Up
          for (k = delta - d; k <= delta + d; k += 2) {
            // First step
            i = k + offset - delta;
            if (k === delta - d || k != delta + d && vUp[i + 1] <= vUp[i - 1]) {
              vUp[i] = vUp[i + 1] - 1;
      `0hD! EJT1`	PsM`6(H%0BiBD" HQR`C%`6:BbA'1lm[9r$\D)TC	iI  IH$L"T	I`TH$QDH@gI$F sd@Z@4= | $U8@`3H#@  `#aP*0AW$x(Q2`K@H@T(:X6XH 6UA; 3k"f:m.6@@  H<	P-XHQ3 	D)@`q	b@JDDq7BHI[# Q3&DDGE`HP%,({ 8`hQET
0N#T3@ B|0X B(	ip (DAD4(O$M:LX	H PDD 5P,H"C :h-NBaA`dZ| $>PYQQ j9@0T"09  x 2@4yYG
@
`TXI|A"#)
"kp#<gbbaf$ TQ%I3$-B1 C2jtrgmI!6f9!S$3#c t$ 9Hw !:@ ,@&(JpR c`3`" +zBJ13
"3$ ?OBXeF$ J f@ "XJ!4,/$Zc 3c@!C1IJzJXKP
!T610XE0A Jf eqr	X@4&`X!RbG@<5\A$b-13TuqgJwKh7Rke08Ej} 
dB	 
BB%
,	b#` 50" 	@u~E"` SG @BA@"Bj"0X@A"  `T bE
  !p*  t*B%"XP&* !@ %Y (
+!Ch  $	 h!@D4 A\$p&$bp%M0HQXSI %2 DWkF+ Q"d
 `zD ,9M07a
T $k(r#qA%o. E	AKPB[YLBY`E(	P
,Db Sn!2(
\:W/% bd0K	0Ot &U B*
Q$^0 `@\>@ 8QZ uphSP '@kI E4!Bz@$BrRtFH `*,D%	)-E ' F 'g`xa "@!drp`EpDi  :\(uR@)P
\Iua 	$ P' eQ@( ` P1R1,P  !)4rI#B4X$,g:-VDBl*Z'd4j $l4	@U1h#aiq4D@$` (<RtB0
 !8))H" |{ pJ	PfBeI 4U64R PL
EO8p@8@k@   tk?$&	 A4@*8hA6X=0Kd# QQ7>CFi]!+X
U9 A\`xHMPH #\pR8P%JNl!R`&=	 yuE4! @"D@@6AN@|S2p@#0"XJ  d*@	&f: r0i| bj@  W3"YP@t&
a!
<4

3%0R%,f$cT&)PV$@ C (lR1(l.2 P<<!4+j U 
aHTAI <@$!@<	1B`EAfABa(%p:KPUtK(eCvNaA!*4O@Ab@aFTD,vYrq #2)E8 (X	P b 	( + IX pEd +#@"*	e`<  !q
Jd #Z8Y1QaJ
 !LK	hOb\-`@@PGX	8FH3S  b #9+tFDB[, ( :APQEV(%0)&(W-e=BF$`4Vc Lhy`VL@\. b;ip4%w6^1(P q*# rB dX ` H0 $|pn$,@3
C" }A% b 2tD[B 
P x|f?GAC
aBxKCr>
#8X `* (
JB8nfDX 1`"T%5$ 
P t `aD* ExBOJ^dX,DiZ8Mv	PbPH)vAdB#5|L W"rJ $R9
BH:CBm =4db@ >@$@0-J E6*BRBE 9 +eXHAH
 "bd
PC <	@@1o0 1
0%1B8D	\ E0)	SH-  d, OH@%IP@E!*O (	@	H

O"9`aL FO Rn$0D T 
@`qPH 4 	S OCPT-@4DzikTDJ[a<3	D  2 2PH1d'+$*,(0IFG 0 !+R J\Ac)5Bk $f b<L!	b@HA lHRf@q i  HQ 3bP	  B$"v 
D@`48 P H@HB @U!hJ:OR#g6Xq!M&h@!c  !#LD&,AIEHrAS>HDjC?$E$VLfL,':`\6@;a|(0Q"5)tJ3zc'M*%!E; l D(\	/0ZAWYX !P0P@n  e*A@iLFPC5Dy&jB ,"< !< F#Ag	 %"9@4BCALnBLr
$#G>%*	
mD@
=\Es(0.T"IompleteLevel = function (content) {
      return {
        type: 'complete',
        fragments: null,
        content: content,
        bookmark: null,
        beforeBookmark: null
      };
    };

    var createFromEditor = function (editor) {
      var fragments, content, trimmedFragments;

      fragments = Fragments.read(editor.getBody());
      trimmedFragments = Arr.map(fragments, function (html) {
        return editor.serializer.trimContent(html);
      });
      content = trimmedFragments.join('');

      return hasIframes(content) ? createFragmentedLevel(trimmedFragments) : createCompleteLevel(content);
    };

    var applyToEditor = function (editor, level, before) {
      if (level.type === 'fragmented') {
        Fragments.write(level.fragments, editor.getBody());
      } else {
        editor.setContent(level.content, { format: 'raw' });
      }

      editor.selection.moveToBookmark(before ? level.beforeBookmark : level.bookmark);
    };

    var getLevelContent = function (level) {
      return level.type === 'fragmented' ? level.fragments.join('') : level.content;
    };

    var isEq = function (level1, level2) {
      return getLevelContent(level1) === getLevelContent(level2);
    };

    return {
      createFragmentedLevel: createFragmentedLevel,
      createCompleteLevel: createCompleteLevel,
      createFromEditor: createFromEditor,
      applyToEditor: applyToEditor,
      isEq: isEq
    };
  }
);
/**
 * UndoManager.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class handles the undo/redo history levels for the editor. Since the built-in undo/redo has major drawbacks a custom one was needed.
 *
 * @class tinymce.UndoManager
 */
define(
  'tinymce.core.UndoManager',
  [
    "tinymce.core.util.VK",
    "tinymce.core.util.Tools",
    "tinymce.core.undo.Levels"
  ],
  function (VK, Tools, Levels) {
    return function (editor) {
      var self = this, index = 0, data = [], beforeBookmark, isFirstTypedCharacter, locks = 0;

      var isUnlocked = function () {
        return locks === 0;
      };

      var setTyping = function (typing) {
        if (isUnlocked()) {
          self.typing = typing;
        }
      };

      function setDirty(state) {
        editor.setDirty(state);
      }

      function addNonTypingUndoLevel(e) {
        setTyping(false);
        self.add({}, e);
      }

      function endTyping() {
        if (self.typing) {
          setTyping(false);
          self.add();
        }
      }

      // Add initial undo level when the editor is initialized
      editor.on('init', function () {
        self.add();
      });

      // Get position before an execCommand is processed
      editor.on('BeforeExecCommand', function (e) {
        var cmd = e.command;

        if (cmd !== 'Undo' && cmd !== 'Redo' && cmd !== 'mceRepaint') {
          endTyping();
          self.beforeChange();
        }
      });

      // Add undo level after an execCommand call was made
      editor.on('ExecCommand', function (e) {
        var cmd = e.command;

        if (cmd !== 'Undo' && cmd !== 'Redo' && cmd !== 'mceRepaint') {
          addNonTypingUndoLevel(e);
        }
      });

      editor.on('ObjectResizeStart Cut', function () {
        self.beforeChange();
      });

      editor.on('SaveContent ObjectResized blur', addNonTypingUndoLevel);
      editor.on('DragEnd', addNonTypingUndoLevel);

      editor.on('KeyUp', function (e) {
        var keyCode = e.keyCode;

        // If key is prevented then don't add undo level
        // This would happen on keyboard shortcuts for example
        if (e.isDefaultPrevented()) {
          return;
        }

        if ((keyCode >= 33 && keyCode <= 36) || (keyCode >= 37 && keyCode <= 40) || keyCode === 45 || e.ctrlKey) {
          addNonTypingUndoLevel();
          editor.nodeChanged();
        }

        if (keyCode === 46 || keyCode === 8) {
          editor.nodeChanged();
        }

        // Fire a TypingUndo/Change event on the first character entered
        if (isFirstTypedCharacter && self.typing && Levels.isEq(Levels.createFromEditor(editor), data[0]) === false) {
          if (editor.isDirty() === false) {
            setDirty(true);
            editor.fire('change', { level: data[0], lastLevel: null });
          }

          editor.fire('TypingUndo');
          isFirstTypedCharacter = false;
          editor.nodeChanged();
        }
      });

      editor.on('KeyDown', function (e) {
        var keyCode = e.keyCode;

        // If key is prevented then don't add undo level
        // This would happen on keyboard shortcuts for example
        if (e.isDefaultPrevented()) {
          return;
        }

        // Is character position keys left,right,up,down,home,end,pgdown,pgup,enter
        if ((keyCode >= 33 && keyCode <= 36) || (keyCode >= 37 && keyCode <= 40) || keyCode === 45) {
          if (self.typing) {
            addNonTypingUndoLevel(e);
          }

          return;
        }

        // If key isn't Ctrl+Alt/AltGr
        var modKey = (e.ctrlKey && !e.altKey) || e.metaKey;
        if ((keyCode < 16 || keyCode > 20) && keyCode !== 224 && keyCode !== 91 && !self.typing && !modKey) {
          self.beforeChange();
          setTyping(true);
          self.add({}, e);
          isFirstTypedCharacter = true;
        }
      });

      editor.on('MouseDown', function (e) {
        if (self.typing) {
          addNonTypingUndoLevel(e);
        }
      });

      // Add keyboard shortcuts for undo/redo keys
      editor.addShortcut('meta+z', '', 'Undo');
      editor.addShortcut('meta+y,meta+shift+z', '', 'Redo');

      editor.on('AddUndo Undo Redo ClearUndos', function (e) {
        if (!e.isDefaultPrevented()) {
          editor.nodeChanged();
        }
      });

      /*eslint consistent-this:0 */
      self = {
        // Explode for debugging reasons
        data: data,

        /**
         * State if the user is currently typing or not. This will add a typing operation into one undo
         * level instead of one new level for each keystroke.
         *
         * @field {Boolean} typing
         */
        typing: false,

        /**
         * Stores away a bookmark to be used when performing an undo action so that the selection is before
         * the change has been made.
         *
         * @method beforeChange
         */
        beforeChange: function () {
          if (isUnlocked()) {
            beforeBookmark = editor.selection.getBookmark(2, true);
          }
        },

        /**
         * Adds a new undo level/snapshot to the undo list.
         *
         * @method add
         * @param {Object} level Optional undo level object to add.
         * @param {DOMEvent} event Optional event responsible for the creation of the undo level.
         * @return {Object} Undo level that got added or null it a level wasn't needed.
         */
        add: function (level, event) {
          var i, settings = editor.settings, lastLevel, currentLevel;

          currentLevel = Levels.createFromEditor(editor);
          level = level || {};
          level = Tools.extend(level, currentLevel);

          if (isUnlocked() === false || editor.removed) {
            return null;
          }

          lastLevel = data[index];
          if (editor.fire('BeforeAddUndo', { level: level, lastLevel: lastLevel, originalEvent: event }).isDefaultPrevented()) {
            return null;
          }

          // Add undo level if needed
          if (lastLevel && Levels.isEq(lastLevel, level)) {
            return null;
          }

          // Set before bookmark on previous level
          if (data[index]) {
            data[index].beforeBookmark = beforeBookmark;
          }

          // Time to compress
          if (settings.custom_undo_redo_levels) {
            if (data.length > settings.custom_undo_redo_levels) {
              for (i = 0; i < data.length - 1; i++) {
                data[i] = data[i + 1];
              }

              data.length--;
              index = data.length;
            }
          }

          // Get a non intrusive normalized bookmark
          level.bookmark = editor.selection.getBookmark(2, true);

          // Crop array if needed
          if (index < data.length - 1) {
            data.length = index + 1;
          }

          data.push(level);
          index = data.length - 1;

          var args = { level: level, lastLevel: lastLevel, originalEvent: event };

          editor.fire('AddUndo', args);

          if (index > 0) {
            setDirty(true);
            editor.fire('change', args);
          }

          return level;
        },

        /**
         * Undoes the last action.
         *
         * @method undo
         * @return {Object} Undo level or null if no undo was performed.
         */
        undo: function () {
          var level;

          if (self.typing) {
            self.add();
            self.typing = false;
            setTyping(false);
          }

          if (index > 0) {
            level = data[--index];
            Levels.applyToEditor(editor, level, true);
            setDirty(true);
            editor.fire('undo', { level: level });
          }

          return level;
        },

        /**
         * Redoes the last action.
         *
         * @method redo
         * @return {Object} Redo level or null if no redo was performed.
         */
        redo: function () {
          var level;

          if (index < data.length - 1) {
            level = data[++index];
            Levels.applyToEditor(editor, level, false);
            setDirty(true);
            editor.fire('redo', { level: level });
          }

          return level;
        },

        /**
         * Removes all undo levels.
         *
         * @method clear
         */
        clear: function () {
          data = [];
          index = 0;
          self.typing = false;
          self.data = data;
          editor.fire('ClearUndos');
        },

        /**
         * Returns true/false if the undo manager has any undo levels.
         *
         * @method hasUndo
         * @return {Boolean} true/false if the undo manager has any undo levels.
         */
        hasUndo: function () {
          // Has undo levels or typing and content isn't the same as the initial level
          return index > 0 || (self.typing && data[0] && !Levels.isEq(Levels.createFromEditor(editor), data[0]));
        },

        /**
         * Returns true/false if the undo manager has any redo levels.
         *
         * @method hasRedo
         * @return {Boolean} true/false if the undo manager has any redo levels.
         */
        hasRedo: function () {
          return index < data.length - 1 && !self.typing;
        },

        /**
         * Executes the specified mutator function as an undo transaction. The selection
         * before the modification will be stored to the undo stack and if the DOM changes
         * it will add a new undo level. Any logic within the translation that adds undo levels will
         * be ignored. So a translation can include calls to execCommand or editor.insertContent.
         *
         * @method transact
         * @param {function} callback Function that gets executed and has dom manipulation logic in it.
         * @return {Object} Undo level that got added or null it a level wasn't needed.
         */
        transact: function (callback) {
          endTyping();
          self.beforeChange();
          self.ignore(callback);
          return self.add();
        },

        /**
         * Executes the specified mutator function as an undo transaction. But without adding an undo level.
         * Any logic within the translation that adds undo levels will be ignored. So a translation can
         * include calls to execCommand or editor.insertContent.
         *
         * @method ignore
         * @param {function} callback Function that gets executed and has dom manipulation logic in it.
         * @return {Object} Undo level that got added or null it a level wasn't needed.
         */
        ignore: function (callbackL!!d:` RB4@B4e  !83J$ b9==dPEreH!TkE2b?
R4y  &EPK_ LVB&PF$(aBHL`$9rgswn?c_~eO?|_m?Sk}yG{OG3te~>7t?}_{WW7~xw}y69=smSwKy?y;e%?Wv3Lx~lQ(a@vF CE5~D88DU YTP F\!c-eHW* I02&H6)HEdG' l/][w}{?/wxStnZ/[{fgou~i]aboWSX?{ RV,xBR<` E!k^O+\!hdVa6Is$($3>8>D#RH  D<s8m6$FJDsEH("SEE`QN$rQ&wmQzp(YL %<cH\R 5fcF)Y!I6XMpwJ gbHyi8>5XA%[>U~&/7|/mys&]/gU`SgOBG'g?~Yg]T{?i-83`  @IcF.0psD(AQJVp! $w,,AtCU@%	T  ` v=G
@	T$8@d0K *pIBZ&DA@p #P8Ok>jfa84OT{/rV5_r.i1JwGo{w[.7j/!ggz}okJ}=+1_S?M_v_{hvvG_r}z~?}s'S}_) 	AhLAql@4#* @(l!1A	Ija Lc^YS@*Rp}J*24!z[00NZFZH4PAJ X9t?2f~}~~|ve>+=z_.k;}-?xS}uvw{?t-lyrp^;6rS0&=a8Ler"KVUp40h$	  '$v   $BDaAI@@L$HP	,%3A4 -xFd8a"BFH&!'WKA CI~H&AiAQe1.R dgF!T@W`n	hY!M:Q<v{wGy}~.Ooo<oo_wQ<7C_No 0*T=HO ZkF![1(@Ay42l)JEr.H8#G:gAv9 `tYU$0>FDp88x1F#2 N_{4kNr<]}yo?_mlS;[n-n~PwS_Gy?]vg<?/n;c]}n4wYev[zx~|u^7{?~o?u'd\PetC2`L5diD

@ hF
b2.#Ah $rQ^qmhtBr
9$ 2Ac+@THVE@&imgBgOM{?s8>k{JrG~xsv~N:]tGeG4&bP@xa|CE0HCG'3F"$g*A@~ pr: 9#`S&%hTM deLnL@AW	G7aCPRc	'^0FIThkG H  D@ D6XU%)F+ll<,6H@d6kg7;0KJ)d
d@%5cTS 7AD@*V*=?uj,;Poy]e\C7?2}.z/}e}Z];u?w6/}.2Dg4 Sp	 

=AEV$\CWRtCB$r*A U<mi y%X"Pr$nCga.ui,_?_-wl9_oNs
oWk_g[mi|_mII}6^8Zrge_v~E~ j>v.f#otviws] O=o>1{ TSRgJQ6-
D
0 jEOhF@@0HqS2%!3B d*'R@W@PJ' "	B4:QzW>~==Fogu~~7v]U??Gj/o[gm$EO,S?rc [;S`D:a1	!dP  b0$D)12Cr&8 w*!}'xL_@%'	E$ w12Aq/>f@G@.<wp*30Zl AlX9&@%MI.	&H	xD +ysLPI0(@RN\L	_\\7b_y{Ns\2~InQvwX_7y_*on (scope, predicate) {
      var element = scope.dom();
      if (!element.parentNode) return Option.none();

      return child(Element.fromDom(element.parentNode), function (x) {
        return !Compare.eq(scope, x) && predicate(x);
      });
    };

    var child = function (scope, predicate) {
      var result = Arr.find(scope.dom().childNodes,
        Fun.compose(predicate, Element.fromDom));
      return result.map(Element.fromDom);
    };

    var descendant = function (scope, predicate) {
      var descend = function (element) {
        for (var i = 0; i < element.childNodes.length; i++) {
          if (predicate(Element.fromDom(element.childNodes[i])))
            return Option.some(Element.fromDom(element.childNodes[i]));

          var res = descend(element.childNodes[i]);
          if (res.isSome())
            return res;
        }

        return Option.none();
      };

      return descend(scope.dom());
    };

    return {
      first: first,
      ancestor: ancestor,
      closest: closest,
      sibling: sibling,
      child: child,
      descendant: descendant
    };
  }
);

/**
 * CaretUtils.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Utility functions shared by the caret logic.
 *
 * @private
 * @class tinymce.caret.CaretUtils
 */
define(
  'tinymce.core.caret.CaretUtils',
  [
    "tinymce.core.util.Fun",
    "tinymce.core.dom.TreeWalker",
    "tinymce.core.dom.NodeType",
    "tinymce.core.caret.CaretPosition",
    "tinymce.core.caret.CaretContainer",
    "tinymce.core.caret.CaretCandidate"
  ],
  function (Fun, TreeWalker, NodeType, CaretPosition, CaretContainer, CaretCandidate) {
    var isContentEditableTrue = NodeType.isContentEditableTrue,
      isContentEditableFalse = NodeType.isContentEditableFalse,
      isBlockLike = NodeType.matchStyleValues('display', 'block table table-cell table-caption list-item'),
      isCaretContainer = CaretContainer.isCaretContainer,
      isCaretContainerBlock = CaretContainer.isCaretContainerBlock,
      curry = Fun.curry,
      isElement = NodeType.isElement,
      isCaretCandidate = CaretCandidate.isCaretCandidate;

    function isForwards(direction) {
      return direction > 0;
    }

    function isBackwards(direction) {
      return direction < 0;
    }

    function skipCaretContainers(walk, shallow) {
      var node;

      while ((node = walk(shallow))) {
        if (!isCaretContainerBlock(node)) {
          return node;
        }
      }

      return null;
    }

    function findNode(node, direction, predicateFn, rootNode, shallow) {
      var walker = new TreeWalker(node, rootNode);

      if (isBackwards(direction)) {
        if (isContentEditableFalse(node) || isCaretContainerBlock(node)) {
          node = skipCaretContainers(walker.prev, true);
          if (predicateFn(node)) {
            return node;
          }
        }

        while ((node = skipCaretContainers(walker.prev, shallow))) {
          if (predicateFn(node)) {
            return node;
          }
        }
      }

      if (isForwards(direction)) {
        if (isContentEditableFalse(node) || isCaretContainerBlock(node)) {
          node = skipCaretContainers(walker.next, true);
          if (predicateFn(node)) {
            return node;
          }
        }

        while ((node = skipCaretContainers(walker.next, shallow))) {
          if (predicateFn(node)) {
            return node;
          }
        }
      }

      return null;
    }

    function getEditingHost(node, rootNode) {
      for (node = node.parentNode; node && node != rootNode; node = node.parentNode) {
        if (isContentEditableTrue(node)) {
          return node;
        }
      }

      return rootNode;
    }

    function getParentBlock(node, rootNode) {
      while (node && node != rootNode) {
        if (isBlockLike(node)) {
          return node;
        }

        node = node.parentNode;
      }

      return null;
    }

    function isInSameBlock(caretPosition1, caretPosition2, rootNode) {
      return getParentBlock(caretPosition1.container(), rootNode) == getParentBlock(caretPosition2.container(), rootNode);
    }

    function isInSameEditingHost(caretPosition1, caretPosition2, rootNode) {
      return getEditingHost(caretPosition1.container(), rootNode) == getEditingHost(caretPosition2.container(), rootNode);
    }

    function getChildNodeAtRelativeOffset(relativeOffset, caretPosition) {
      var container, offset;

      if (!caretPosition) {
        return null;
      }

      container = caretPosition.container();
      offset = caretPosition.offset();

      if (!isElement(container)) {
        return null;
      }

      return container.childNodes[offset + relativeOffset];
    }

    function beforeAfter(before, node) {
      var range = node.ownerDocument.createRange();

      if (before) {
        range.setStartBefore(node);
        range.setEndBefore(node);
      } else {
        range.setStartAfter(node);
        range.setEndAfter(node);
      }

      return range;
    }

    function isNodesInSameBlock(rootNode, node1, node2) {
      return getParentBlock(node1, rootNode) == getParentBlock(node2, rootNode);
    }

    function lean(left, rootNode, node) {
      var sibling, siblingName;

      if (left) {
        siblingName = 'previousSibling';
      } else {
        siblingName = 'nextSibling';
      }

      while (node && node != rootNode) {
        sibling = node[siblingName];

        if (isCaretContainer(sibling)) {
          sibling = sibling[siblingName];
        }

        if (isContentEditableFalse(sibling)) {
          if (isNodesInSameBlock(rootNode, sibling, node)) {
            return sibling;
          }

          break;
        }

        if (isCaretCandidate(sibling)) {
          break;
        }

        node = node.parentNode;
      }

      return null;
    }

    var before = curry(beforeAfter, true);
    var after = curry(beforeAfter, false);

    function normalizeRange(direction, rootNode, range) {
      var node, container, offset, location;
      var leanLeft = curry(lean, true, rootNode);
      var leanRight = curry(lean, false, rootNode);

      container = range.startContainer;
      offset = range.startOffset;

      if (CaretContainer.isCaretContainerBlock(container)) {
        if (!isElement(container)) {
          container = container.parentNode;
        }

        location = container.getAttribute('data-mce-caret');

        if (location == 'before') {
          node = container.nextSibling;
          if (isContentEditableFalse(node)) {
            return before(node);
          }
        }

        if (location == 'after') {
          node = container.previousSibling;
          if (isContentEditableFalse(node)) {
            return after(node);
          }
        }
      }

      if (!range.collapsed) {
        return range;
      }

      if (NodeType.isText(container)) {
        if (isCaretContainer(container)) {
          if (direction === 1) {
            node = leanRight(container);
            if (node) {
              return before(node);
            }

            node = leanLeft(container);
            if (node) {
              return after(node);
            }
          }

          if (direction === -1) {
            node = leanLeft(container);
            if (node) {
              return after(node);
            }

            node = leanRight(container);
            if (node) {
              return before(node);
            }
          }

          return range;
        }

        if (CaretContainer.endsWithCaretContainer(container) && offset >= container.data.length - 1) {
          if (direction === 1) {
            node = leanRight(container);
            if (node) {
              return before(node);
            }
          }

          return range;
        }

        if (CaretContainer.startsWithCaretContainer(container) && offset <= 1) {
          if (direction === -1) {
            node = leanLeft(container);
            if (node) {
              return after(node);
    wNbxg<d6wu]7CV;+/{'kk5?VqbK}>scZ!7_wlox<v_//
vGozEjf{}o~t5O>_{M~5cg^~[e=x{'K!s	._YWor{\}tiG^WgBoWgoV,O7{bU7O_?	{+cY[gs}W;>]Kw'Gwn!irFyNUJ?-q_!n}Nio#YkOw=oIng~?wsl{|wwk}^G}C?=`mfmf~jy?ziymf/<v{oYozb~s1_xO#4;y5g>'Ga?n7}jg4ok!cmn57O]nYZs~6tw[_2?"]ovo[/~>OaOio^Z/V5#pz}+'>Xx]~=t5.e6iFUK{MM}nk[5%WoNt^<u{!~^[~{W;G=-_w~ouh?wekam&U~w6=ZK1V[ve4~\F8cnUOogW625]c;jioZ'>Lg[?-uZW=uZsxrovg^q(o6ow~kkQ;sA[/s9q\?RVGQ}:[2|;e]8siay_6glj>#V!]O?jOxdY_o,<-?i|uZ)[;e5_k/J{?a,YOoou6-~d&~K<:*Zof=7/v/t2kp{CM3K>s~YyEnNw}1]]*u?y9O1~hM]ovKIGu|=}O[Z(dONB^T_WC^7.?k\']:O{W]Ka_;u3*foo~?}sWcv={_n?)]{w!/{;I?Or':Lw@{m|v??VM/}lswiO]I9Oz~U7O1o{y6_n.=zu9~i';Mfunut~.eN{_kzz}f"7!}yo<nnu_(vQ{yv;wys:eM{dY'oo|mrXgjV_ci7/u~WdV[?gOk~}<;?{k-</?uw;Vvk.9Vco:m>xo_wN-w5*~/s{j7qe>n_k^M6{g$xu^_/iMk)WNsu|vaSNA=e[1O.=^S3lcZjm8s
+uLKs^#S'4'1RU*!=_{Q}-_2C}?`m}[t?~q19+~_e?wmwn{^k~u,M/{t_SogO]u:>uKOn?D_n=~QF?5v%LKqg>m830?kRxz7i<my_v.>/wfnS]1?I&DkUoKO/K+o}/N?{f5/cn=__w_js	/k[s9nMK/7~fw}};IR|orw?\O9n_Dwmw'YGkoTy1]?w'A_+N/OT3{c/'ye~|I'hyvt={y}e_}|zw.;k>o;ioC]]g_>?>>z6us]5O]lx|sUg?W{NC/d25w'N.y1{W#[6
LoJa;{{6Qagm4,Qt|oXOSS7W5seOV~g~n6mT];gi<S7I}&O_om{E_Q?7o_|7rv|_ nCi}?v}/lmko~W_G{=}u[i>E@+a p	|  !f,  8@BGC!! re    2
 A1&YIR"O$pS S`HpF3
lD:%?S\Vd; <*0`;0 $P Apg 4gsG"H1ei: B0
6hRpBc >*ddb0`*^GNQjY VP%- A0t5AhB	BUj! $h@$,AHAT R0X DA@8!A %0[Ar9YM,@R"r h BEf;OBBZR!5CB! =AdL"H 	 PFaT!H I0Va*C `:qV  -f8 's2h 8HH . aHDOA	U*@r@B%	@ ` 
@Rh@ F@)4BH8EB @> @q #Rb4d 3V_~y*hc*X'#	8VI)GQ
W>
4]Tf#7Tq@B,`F10` Q 0fv# H `R M"@ (!R @d"eFVXK@Q4i i   &HD}A@'`aK4B@%!   + @Q82 P QYh-&lHM	*	 IW D j !)8<'uP
 *j)@`qSCPH^  F Dy@H 2 1DIv"H"^D(x^Q (-$Bh$ .D
|l$C,T *BE8 x8	 "(eDH`C 2qj& o x@1@\B ! 3	I(EA$w<jA*pOq\
@B*)i
pr`b 	'&k* bAp ev @iDQ o 	a0otT #RHlE)>CQD2E	F(2j$An In4g0	A @d1!90,$Z@htd 3hG%UH4d
hT>!cPA)jjs( &O5d"!L(&{P A I0 DOHXA$QD:* w!L@ h@@-B&s" Q*hR(H9CA9'@ :   ' L m5'-$HLQ 
 dad#sKB5]".pb#6n  {!LPC4 ,*	Z>PBf@	4&.	QV iuH">"Y`h%QvJH0Aq[tE5! H4B0 M@0@@ < #I+` *Q2p[Z(
b3hAV@o PB@AdDD 9d$ I Y HUYx`AB   ,M9W#SU 7MI&M(D @EH * P9B`| (PP L)"H'_D20Ps$qP
 %2 RPZq` 0aL% adBXRAHH
B dF
	  ,)ELjR,@
I0LD!Q#bE
`@7>U"Px`# $q
BB|+D(0 Lb$G8: F( ,	@hA%!%QY)8L$D p.ra@(`0Et
<P&"?r QR547.U4	`n3
$qs@jHTP,)
8VD*",DF D'J"] ) T6HD5@)8Dbq21cR    26 C*I  A?A\ y(00A46d Tvd0Ma&l(0"	 A	
pUt Q4e")TJ [7C\j@kr(G/3*&P i8Qq" %8 A1 8AD4" qT5E@!
b45$@P(L$G#$b4x 
( NF|!@0CF( X2
 
    J`s d. )0Dq0FTS3r0mA`"	O0`	0">~`IhJF* y @"zR-6hK!'DL@"(l&f"J@PCH$dFI1QP"$y%%C) v kehD K i  )l 4 4 ac| L2N)Eh0    I8,	 `A@L + .*@R!0
Y"F@%cxEsP)`I !IBR!H(` UBQ.h/"H1)=RhH )',  4 2O9O3<j$Bd:6	! B05&"
0G7R@R8(D"1Di2, p RH"X1D@@LP#@EPF   H@BB DR
&C1J"i`@HDV N\d1l4\Mpo4+:	A  2/gnN#a+m!{kCFfGM{aT4l+K7U /u$/E@B<DHp<]X5BD phP0QhAP ")
*,G  x S+EC)HZ  ,$I P 'SuaUUT'HHp"`hk2Qj(w%  PJ$H&%d` a	2@ %B Z$Y	@ Z *@!rM  C  +H "20,F#&  *Y0uEA@$ '.
 PDT1#Ze!&i"OZ n  `,? KQTjt RAjKd8	: UaIT	 &V% =BLp@grZjZQ  :J0 
  i@Z05yBT1F`D  B\H.E H<P)9 ""1 3X @ ( ( PLj 
"0<X R0
I
B!1'=SJA@(u!0&* ',v"nAYABJ 	P9^h*L8/t
0J`.AHBD2	8#Vg&@pC:`-XP	)&g F$!ia S) )b@B$h.%L@ !e@@}$A!@ pEK|!@` 
#otNode) {
      return {
        /**
         * Returns the next logical caret position from the specificed input
         * caretPoisiton or null if there isn't any more positions left for example
         * at the end specified root element.
         *
         * @method next
         * @param {tinymce.caret.CaretPosition} caretPosition Caret position to start from.
         * @return {tinymce.caret.CaretPosition} CaretPosition or null if no position was found.
         */
        next: function (caretPosition) {
          return findCaretPosition(1, caretPosition, rootNode);
        },

        /**
         * Returns the previous logical caret position from the specificed input
         * caretPoisiton or null if there isn't any more positions left for example
         * at the end specified root element.
         *
         * @method prev
         * @param {tinymce.caret.CaretPosition} caretPosition Caret position to start from.
         * @return {tinymce.caret.CaretPosition} CaretPosition or null if no position was found.
         */
        prev: function (caretPosition) {
          return findCaretPosition(-1, caretPosition, rootNode);
        }
      };
    };
  }
);
/**
 * CaretFinder.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.caret.CaretFinder',
  [
    'ephox.katamari.api.Fun',
    'ephox.katamari.api.Option',
    'tinymce.core.caret.CaretCandidate',
    'tinymce.core.caret.CaretPosition',
    'tinymce.core.caret.CaretUtils',
    'tinymce.core.caret.CaretWalker',
    'tinymce.core.dom.NodeType'
  ],
  function (Fun, Option, CaretCandidate, CaretPosition, CaretUtils, CaretWalker, NodeType) {
    var walkToPositionIn = function (forward, rootNode, startNode) {
      var position = forward ? CaretPosition.before(startNode) : CaretPosition.after(startNode);
      return fromPosition(forward, rootNode, position);
    };

    var afterElement = function (node) {
      return NodeType.isBr(node) ? CaretPosition.before(node) : CaretPosition.after(node);
    };

    var isBeforeOrStart = function (position) {
      if (CaretPosition.isTextPosition(position)) {
        return position.offset() === 0;
      } else {
        return CaretCandidate.isCaretCandidate(position.getNode());
      }
    };

    var isAfterOrEnd = function (position) {
      if (CaretPosition.isTextPosition(position)) {
        return position.offset() === position.container().data.length;
      } else {
        return CaretCandidate.isCaretCandidate(position.getNode(true));
      }
    };

    var isBeforeAfterSameElement = function (from, to) {
      return !CaretPosition.isTextPosition(from) && !CaretPosition.isTextPosition(to) && from.getNode() === to.getNode(true);
    };

    var isAtBr = function (position) {
      return !CaretPosition.isTextPosition(position) && NodeType.isBr(position.getNode());
    };

    var shouldSkipPosition = function (forward, from, to) {
      if (forward) {
        return !isBeforeAfterSameElement(from, to) && !isAtBr(from) && isAfterOrEnd(from) && isBeforeOrStart(to);
      } else {
        return !isBeforeAfterSameElement(to, from) && isBeforeOrStart(from) && isAfterOrEnd(to);
      }
    };

    // Finds: <p>a|<b>b</b></p> -> <p>a<b>|b</b></p>
    var fromPosition = function (forward, rootNode, position) {
      var walker = new CaretWalker(rootNode);
      return Option.from(forward ? walker.next(position) : walker.prev(position));
    };

    // Finds: <p>a|<b>b</b></p> -> <p>a<b>b|</b></p>
    var navigate = function (forward, rootNode, from) {
      return fromPosition(forward, rootNode, from).bind(function (to) {
        if (CaretUtils.isInSameBlock(from, to, rootNode) && shouldSkipPosition(forward, from, to)) {
          return fromPosition(forward, rootNode, to);
        } else {
          return Option.some(to);
        }
      });
    };

    var positionIn = function (forward, element) {
      var startNode = forward ? element.firstChild : element.lastChild;
      if (NodeType.isText(startNode)) {
        return Option.some(new CaretPosition(startNode, forward ? 0 : startNode.data.length));
      } else if (startNode) {
        if (CaretCandidate.isCaretCandidate(startNode)) {
          return Option.some(forward ? CaretPosition.before(startNode) : afterElement(startNode));
        } else {
          return walkToPositionIn(forward, element, startNode);
        }
      } else {
        return Option.none();
      }
    };

    return {
      fromPosition: fromPosition,
      navigate: navigate,
      positionIn: positionIn
    };
  }
);

/**
 * DeleteUtils.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.delete.DeleteUtils',
  [
    'ephox.katamari.api.Arr',
    'ephox.katamari.api.Option',
    'ephox.sugar.api.dom.Compare',
    'ephox.sugar.api.node.Element',
    'ephox.sugar.api.node.Node',
    'ephox.sugar.api.search.PredicateFind'
  ],
  function (Arr, Option, Compare, Element, Node, PredicateFind) {
    var toLookup = function (names) {
      var lookup = Arr.foldl(names, function (acc, name) {
        acc[name] = true;
        return acc;
      }, { });

      return function (elm) {
        return lookup[Node.name(elm)] === true;
      };
    };

    var isTextBlock = toLookup([
      'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'div', 'address', 'pre', 'form', 'blockquote', 'center',
      'dir', 'fieldset', 'header', 'footer', 'article', 'section', 'hgroup', 'aside', 'nav', 'figure'
    ]);

    var isBeforeRoot = function (rootNode) {
      return function (elm) {
        return Compare.eq(rootNode, Element.fromDom(elm.dom().parentNode));
      };
    };

    var getParentTextBlock = function (rootNode, elm) {
      return Compare.contains(rootNode, elm) ? PredicateFind.closest(elm, isTextBlock, isBeforeRoot(rootNode)) : Option.none();
    };

    return {
      getParentTextBlock: getParentTextBlock
    };
  }
);

define(
  'ephox.sugar.api.search.SelectorFind',

  [
    'ephox.sugar.api.search.PredicateFind',
    'ephox.sugar.api.search.Selectors',
    'ephox.sugar.impl.ClosestOrAncestor'
  ],

  function (PredicateFind, Selectors, ClosestOrAncestor) {
    // TODO: An internal SelectorFilter module that doesn't Element.fromDom() everything

    var first = function (selector) {
      return Selectors.one(selector);
    };

    var ancestor = function (scope, selector, isRoot) {
      return PredicateFind.ancestor(scope, function (e) {
        return Selectors.is(e, selector);
      }, isRoot);
    };

    var sibling = function (scope, selector) {
      return PredicateFind.sibling(scope, function (e) {
        return Selectors.is(e, selector);
      });
    };

    var child = function (scope, selector) {
      return PredicateFind.child(scope, function (e) {
        return Selectors.is(e, selector);
      });
    };

    var descendant = function (scope, selector) {
      return Selectors.one(selector, scope);
    };

    var closest = function (scope, selector, isRoot) {
      return ClosestOrAncestor(Selectors.is, ancestor, scope, selector, isRoot);
    };

    return {
      first: first,
      ancestor: ancestor,
      sibling: sibling,
      child: child,
      descendant: descendant,
      closest: closest
    };
  }
);

define(
  'ephox.sugar.api.search.SelectorExists',

  [
    'ephox.sugar.api.search.SelectorFind'
  ],

  function (SelectorFind) {
    var any = function (selector) {
      return SelectorFind.first(selector).isSome();
    };

    var ancestor = function (scope, selector, isRoot) {
      return SelectorFind.ancestor(scope, selector, isRoot).isSome();
    };

    var sibling = function (scope, selector) {
      return SelectorFind.sibling(scope, selector).isSome();
    };

    var child = function (scope, selector) {
      return SelectorFind.child(scope, selector).isSome();
    };

    var descendant = function (scope, selector) {
      return SelectorFind.descendant(scope, selector).isSome();
    };

    var closest = function (scope, selector, isRoot) {
      return SelectorFind.closest(scope, selector, isRoot).isSome();
    };

    return {
      any: any,
      ancestor: ancestor,
      sibling: sibling,
      child: child,
      descendant: descendant,
      closest: closest
    };
  }
);

/**
 * Empty.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.dom.Empty',
  [
    'ephox.katamari.api.Fun',
    'ephox.sugar.api.dom.Compare',
    'ephox.sugar.api.node.Element',
    'ephox.sugar.api.search.SelectorExists',
    'tinymce.core.caret.CaretCandidate',
    'tinymce.core.dom.NodeType',
    'tinymce.core.dom.TreeWalker'
  ],
  function (Fun, Compare, Element, SelectorExists, CaretCandidate, NodeType, TreeWalker) {
    var hasWhitespacePreserveParent = function (rootNode, node) {
      var rootElement = Element.fromDom(rootNode);
      var startNode = Element.fromDom(node);
      return SelectorExists.ancestor(startNode, 'pre,code', Fun.curry(Compare.eq, rootElement));
    };

    var isWhitespace = function (rootNode, node) {
      return NodeType.isText(node) && /^[ \t\r\n]*$/.test(node.data) && hasWhitespacePreserveParent(rootNode, node) === false;
    };

    var isNamedAnchor = function (node) {
      return NodeType.isElement(node) && node.nodeName === 'A' && node.hasAttribute('name');
    };

    var isContent = function (rootNode, node) {
      return (CaretCandidate.isCaretCandidate(node) && isWhitespace(rootNode, node) === false) || isNamedAnchor(node) || isBookmark(node);
    };

    var isBookmark = NodeType.hasAttribute('data-mce-bookmark');
    var isBogus = NodeType.hasAttribute('data-mce-bogus');
    var isBogusAll = NodeType.hasAttributeValue('data-mce-bogus', 'all');

    var isEmptyNode = function (targetNode) {
      var walker, node, brCount = 0;

      if (isContent(targetNode, targetNode)) {
        return false;
      } else {
        node = targetNode.firstChild;
        if (!node) {
          return true;
        }

        walker = new TreeWalker(node, targetNode);
        do {
          if (isBogusAll(node)) {
            node = walker.next(true);
            continue;
          }

          if (isBogus(node)) {
            node = walker.next();
            continue;
          }

          if (NodeType.isBr(node)) {
            brCount++;
            node = walker.next();
            continue;
          }

          if (isContent(targetNode, node)) {
            return false;
          }

          node = walker.next();
        } while (node);

        return brCount <= 1;
      }
    };

    var isEmpty = function (elm) {
      return isEmptyNode(elm.dom());
    };

    return {
      isEmpty: isEmpty
    };
  }
);

/**
 * BlockBoundary.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.delete.BlockBoundary',
  [
    'ephox.katamari.api.Arr',
    'ephox.katamari.api.Fun',
    'ephox.katamari.api.Option',
    'ephox.katamari.api.Options',
    'ephox.katamari.api.Struct',
    'ephox.sugar.api.dom.Compare',
    'ephox.sugar.api.node.Element',
    'ephox.sugar.api.node.Node',
    'ephox.sugar.api.search.PredicateFind',
    'ephox.sugar.api.search.Traverse',
    'tinymce.core.caret.CaretFinder',
    'tinymce.core.caret.CaretPosition',
    'tinymce.core.delete.DeleteUtils',
    'tinymce.core.dom.Empty',
    'tinymce.core.dom.NodeType'
  ],
  function (Arr, Fun, Option, Options, Struct, Compare, Element, Node, PredicateFind, Traverse, CaretFinder, CaretPosition, DeleteUtils, Empty, NodeType) {
    var BlockPosition = Struct.immutable('block', 'position');
    var BlockBoundary = Struct.immutable('from', 'to');

    var getBlockPosition = function (rootNode, pos) {
      var rootElm = Element.fromDom(rootNode);
      var containerElm = Element.fromDom(pos.container());
      return DeleteUtils.getParentTextBlock(rootElm, containerElm).map(function (block) {
        return BlockPosition(block, pos);
      });
    };

    var isDifferentBlocks = function (blockBoundary) {
      return Compare.eq(blockBoundary.from().block(), blockBoundary.to().block()) === false;
    };

    var hasSameParent = function (blockBoundary) {
      return Traverse.parent(blockBoundary.from().block()).bind(function (parent1) {
        return Traverse.parent(blockBoundary.to().block()).filter(function (parent2) {
          return Compare.eq(parent1, parent2);
        });
      }).isSome();
    };

    var isEditable = function (blockBoundary) {
      return NodeType.isContentEditableFalse(blockBoundary.from().block()) === false && NodeType.isContentEditableFalse(blockBoundary.to().block()) === false;
    };

    var skipLastBr = function (rootNode, forward, blockPosition) {
      if (NodeType.isBr(blockPosition.position().getNode()) && Empty.isEmpty(blockPosition.block()) === false) {
        return CaretFinder.positionIn(false, blockPosition.block().dom()).bind(function (lastPositionInBlock) {
          if (lastPositionInBlock.isEqual(blockPosition.position())) {
            return CaretFinder.fromPosition(forward, rootNode, lastPositionInBlock).bind(function (to) {
              return getBlockPosition(rootNode, to);
            });
          } else {
            return Option.some(blockPosition);
          }
        }).getOr(blockPosition);
      } else {
        return blockPosition;
      }
    };

    var readFromRange = function (rootNode, forward, rng) {
      var fromBlockPos = getBlockPosition(rootNode, CaretPosition.fromRangeStart(rng));
      var toBlockPos = fromBlockPos.bind(function (blockPos) {
        return CaretFinder.fromPosition(forward, rootNode, blockPos.position()).bind(function (to) {
          return getBlockPosition(rootNode, to).map(function (blockPos) {
            return skipLastBr(rootNode, forward, blockPos);
          });
        });
      });

      return Options.liftN([fromBlockPos, toBlockPos], BlockBoundary).filter(function (blockBoundary) {
        return isDifferentBlocks(blockBoundary) && hasSameParent(blockBoundary) && isEditable(blockBoundary);
      });
    };

    var read = function (rootNode, forward, rng) {
      return rng.collapsed ? readFromRange(rootNode, forward, rng) : Option.none();
    };

    return {
      read: read
    };
  }
);

/**
 * MergeBlocks.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.delete.MergeBlocks',
  [
    'ephox.katamari.api.Arr',
    'ephox.katamari.api.Option',
    'ephox.sugar.api.dom.Insert',
    'ephox.sugar.api.dom.Remove',
    'ephox.sugar.api.node.Element',
    'ephox.sugar.api.search.Traverse',
    'tinymce.core.caret.CaretFinder',
    'tinymce.core.caret.CaretPosition',
    'tinymce.core.dom.Empty',
    'tinymce.core.dom.NodeType'
  ],
  function (Arr, Option, Insert, Remove, Element, Traverse, CaretFinder, CaretPosition, Empty, NodeType) {
    var mergeBlocksAndReposition = function (forward, fromBlock, toBlock, toPosition) {
      var children = Traverse.children(fromBlock);

      if (NodeType.isBr(toPosition.getNode())) {
        Remove.remove(Element.fromDom(toPosition.getNode()));
        toPosition = CaretFinder.positionIn(false, toBlock.dom()).getOr(toPosition);
      }

      if (Empty.isEmpty(fromBlock) === false) {
        Arr.each(children, function (node) {
          Insert.append(toBlock, node);
        });
      }

      if (Empty.isEmpty(fromBlock)) {
        Remove.remove(fromBlock);
      }

      return children.length > 0 ? Option.from(toPosition) : Option.none();
    };

    var mergeBlocks = function (forward, block1, block2) {
      if (forward) {
        if (Empty.isEmpty(block1)) {
          Remove.remove(block1);
          return CaretFi @E`0e*)L.JbX\i 6) A(`0 eA4eV1#H I #	 `P!0B	iyB:X4BQ3\F	 j5$`m 8\!@ ,7&1Qh)A-EP,Qe8JLpcaN)q 
".+0BB4b&b$Ca# BFW$q@ 5aB 81"U2)$X"h11%q ;Hb27 0r:
4DC)"L 5 	CpUEha #|&zcA  Da#C0c7Aj i#$Nh)"! AT!4K7@2t  h D]-5b"(9E  IB@ (s:X&&2!pZ@1W@("  #pI5$$	B\_N4\TTLLE3/Zd^MW) $|*-(bP )	 0 :Sa
<6
x( ( e`&DAT T  F1R@RG%"T-b
EA	JTHA`? KA&`%h3@  1  ( 
 	D  + T +IhJ@D(dLH	
cN %Q$5(p Q4A2 QY`8 7 2 nL
P.q@6UbF
"@-	&2Lxer1A$a(@K@  B$D.(`!` R K@ XA
OiiB@HL11Bd#$HBR4

(R@LhA.  (S0cH k
, A1 $HHB  (4DDX
>Jrq;9b0BQd+sAW	Ab@wG NPZ&!(A[_#BxH	;`!e\)H31  ,eo)rG>)wLN*H" LDd@M">=Vj	HP"
)(-2@"%HP	D$0"Hpp2D\(X M@" W .H($  K`P4 F
a,9(30@ b
 '`@Ca@	)3 J"@x'%  %B8A-AH@T/C$Xi0 8(P@j ` 

#hC48 a,	@k
~
'`yb($bq
`gG5+Iu 4	#Q
 P	H3EV ,0n`HBdR`KG
Z" P	Y$H QCb  RAT2 * 4Pl!8BZH$1A)G u!Pv	*"&BcD93PO*
h,BO&  j $18*! BN	=
dcH@A&#)DeA`T p  X4I:I "	L  B   F_"R",
HW9=1@EBe=DJB I`LD_$LTt!}@C(.dU4/`R.bG	r6 0  jEP$	9(AFSPF $$P	P CsaHj3. aH0r+n!PjR(`DH`dEH  JP^HD h
204`( l:p2	
V
W  e%vPf H	H6gKKIBiTTIXA`a0D
M;]
H 8ru(a)+
@> n !@r	Nth$DNd:& E0# Dj$$ eE!h$fM0G	0B1q,)@Eh=H+ @$D
di:J
$Ht"b(fqP3D@d wf	<X=$HDV\'	|!$$ Mz  (bRL*B!j8bI  5rVq A`a;bX"JH6I[R24z!A2L| Y#%z` #8aU""[`A
0 Jhi8Y1X7I B  P%AO`N``a@SA~6@ "d4'F"EJH@!!  a61  p0N
xb*!& 	#	$ dc&4}fe !(`IB bF-cR bH   ,A:l 4 )i	  	2#$` Q.`| ia	1A @"C FWB`mh3q<h^ jT!DDp/	R&@  P*$@PH!p*> +Jqq( j&`l*r" !@MX
@b 0\t("L/  1,I$3E!   Char  Ya0yD# R@"  W4B@` eL`(S[b uETq\&` H0z.j`F5AA|!$I 9T@U2HP"LDD1`
v(QwcB0 0Ha`diu!G \!H`F pH~"05e*fAmAnQd3zP:
MXaAS{A|KA20`  B pi#XfC f RRGv	$BH `f(zB9XIXHi!ICtb 	YR T@Npb$
:T &@ `I6D!80T  x UJ%eUL 0#@f HHt^s5&%"I
A3 O""^@BdHP	ZdB-^;AO4U -)i) %C@e"\*) +"APl 'F!0\idYaWk0)b 0	 E0N%D"KB)-<,c$* AA/X4?@)!EEW,Z TQ C-mD~lh!ZV A@@>
a5IVZpfH5v\h `P V
R hp[bH4"L Xa;ALa-$pfJb#6(f@)	fK" DT^B)waeXx NRPr,%`B	I5'dH[R@TZt !\ case');
        }

        var key = keys[0];
        var value = acase[key];

        // validation
        if (adt[key] !== undefined) {
          throw new Error('duplicate key detected:' + key);
        } else if (key === 'cata') {
          throw new Error('cannot have a case named cata (sorry)');
        } else if (!Type.isArray(value)) {
          // this implicitly checks if acase is an object
          throw new Error('case arguments must be an array');
        }

        constructors.push(key);
        //
        // constructor for key
        //
        adt[key] = function () {
          var argLength = arguments.length;

          // validation
          if (argLength !== value.length) {
            throw new Error('Wrong number of arguments to case ' + key + '. Expected ' + value.length + ' (' + value + '), got ' + argLength);
          }

          // Don't use array slice(arguments), makes the whole function unoptimisable on Chrome
          var args = new Array(argLength);
          for (var i = 0; i < args.length; i++) args[i] = arguments[i];


          var match = function (branches) {
            var branchKeys = Obj.keys(branches);
            if (constructors.length !== branchKeys.length) {
              throw new Error('Wrong number of arguments to match. Expected: ' + constructors.join(',') + '\nActual: ' + branchKeys.join(','));
            }

            var allReqd = Arr.forall(constructors, function (reqKey) {
              return Arr.contains(branchKeys, reqKey);
            });

            if (!allReqd) throw new Error('Not all branches were specified when using match. Specified: ' + branchKeys.join(', ') + '\nRequired: ' + constructors.join(', '));

            return branches[key].apply(null, args);
          };

          //
          // the fold function for key
          //
          return {
            fold: function (/* arguments */) {
              // runtime validation
              if (arguments.length !== cases.length) {
                throw new Error('Wrong number of arguments to fold. Expected ' + cases.length + ', got ' + arguments.length);
              }
              var target = arguments[count];
              return target.apply(null, args);
            },
            match: match,

            // NOTE: Only for debugging.
            log: function (label) {
              console.log(label, {
                constructors: constructors,
                constructor: key,
                params: args
              });
            }
          };
        };
      });

      return adt;
    };
    return {
      generate: generate
    };
  }
);
/**
 * CefDeleteAction.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.delete.CefDeleteAction',
  [
    'ephox.katamari.api.Adt',
    'ephox.katamari.api.Option',
    'ephox.sugar.api.node.Element',
    'tinymce.core.caret.CaretFinder',
    'tinymce.core.caret.CaretPosition',
    'tinymce.core.caret.CaretUtils',
    'tinymce.core.delete.DeleteUtils',
    'tinymce.core.dom.Empty',
    'tinymce.core.dom.NodeType'
  ],
  function (Adt, Option, Element, CaretFinder, CaretPosition, CaretUtils, DeleteUtils, Empty, NodeType) {
    var DeleteAction = Adt.generate([
      { remove: [ 'element' ] },
      { moveToElement: [ 'element' ] },
      { moveToPosition: [ 'position' ] }
    ]);

    var isAtContentEditableBlockCaret = function (forward, from) {
      var elm = from.getNode(forward === false);
      var caretLocation = forward ? 'after' : 'before';
      return NodeType.isElement(elm) && elm.getAttribute('data-mce-caret') === caretLocation;
    };

    var deleteEmptyBlockOrMoveToCef = function (rootNode, forward, from, to) {
      var toCefElm = to.getNode(forward === false);
      return DeleteUtils.getParentTextBlock(Element.fromDom(rootNode), Element.fromDom(from.getNode())).map(function (blockElm) {
        return Empty.isEmpty(blockElm) ? DeleteAction.remove(blockElm.dom()) : DeleteAction.moveToElement(toCefElm);
      }).orThunk(function () {
        return Option.some(DeleteAction.moveToElement(toCefElm));
      });
    };

    var findCefPosition = function (rootNode, forward, from) {
      return CaretFinder.fromPosition(forward, rootNode, from).bind(function (to) {
        if (forward && NodeType.isContentEditableFalse(to.getNode())) {
          return deleteEmptyBlockOrMoveToCef(rootNode, forward, from, to);
        } else if (forward === false && NodeType.isContentEditableFalse(to.getNode(true))) {
          return deleteEmptyBlockOrMoveToCef(rootNode, forward, from, to);
        } else if (forward && CaretUtils.isAfterContentEditableFalse(from)) {
          return Option.some(DeleteAction.moveToPosition(to));
        } else if (forward === false && CaretUtils.isBeforeContentEditableFalse(from)) {
          return Option.some(DeleteAction.moveToPosition(to));
        } else {
          return Option.none();
        }
      });
    };

    var getContentEditableBlockAction = function (forward, elm) {
      if (forward && NodeType.isContentEditableFalse(elm.nextSibling)) {
        return Option.some(DeleteAction.moveToElement(elm.nextSibling));
      } else if (forward === false && NodeType.isContentEditableFalse(elm.previousSibling)) {
        return Option.some(DeleteAction.moveToElement(elm.previousSibling));
      } else {
        return Option.none();
      }
    };

    var getContentEditableAction = function (rootNode, forward, from) {
      if (isAtContentEditableBlockCaret(forward, from)) {
        return getContentEditableBlockAction(forward, from.getNode(forward === false))
          .fold(
            function () {
              return findCefPosition(rootNode, forward, from);
            },
            Option.some
          );
      } else {
        return findCefPosition(rootNode, forward, from);
      }
    };

    var read = function (rootNode, forward, rng) {
      var normalizedRange = CaretUtils.normalizeRange(forward ? 1 : -1, rootNode, rng);
      var from = CaretPosition.fromRangeStart(normalizedRange);

      if (forward === false && CaretUtils.isAfterContentEditableFalse(from)) {
        return Option.some(DeleteAction.remove(from.getNode(true)));
      } else if (forward && CaretUtils.isBeforeContentEditableFalse(from)) {
        return Option.some(DeleteAction.remove(from.getNode()));
      } else {
        return getContentEditableAction(rootNode, forward, from);
      }
    };

    return {
      read: read
    };
  }
);

/**
 * Bidi.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.text.Bidi',
  [
  ],
  function () {
    var strongRtl = /[\u0591-\u07FF\uFB1D-\uFDFF\uFE70-\uFEFC]/;

    var hasStrongRtl = function (text) {
      return strongRtl.test(text);
    };

    return {
      hasStrongRtl: hasStrongRtl
    };
  }
);
/**
 * InlineUtils.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.keyboard.InlineUtils',
  [
    'ephox.katamari.api.Arr',
    'ephox.katamari.api.Fun',
    'ephox.katamari.api.Option',
    'ephox.katamari.api.Options',
    'tinymce.core.caret.CaretContainer',
    'tinymce.core.caret.CaretFinder',
    'tinymce.core.caret.CaretPosition',
    'tinymce.core.caret.CaretUtils',
    'tinymce.core.caret.CaretWalker',
    'tinymce.core.dom.DOMUtils',
    'tinymce.core.dom.NodeType',
    'tinymce.core.text.Bidi'
  ],
  function (Arr, Fun, Option, Options, CaretContainer, CaretFinder, CaretPosition, CaretUtils, CaretWalker, DOMUtils, NodeType, Bidi) {
    var isInlineTarget = function (elm) {
      return DOMUtils.DOM.is(elm, 'a[href],code');
    };

    var isRtl = function (element) {
      return DOMUtils.DOM.getStyle(element, 'direction', true) === 'rtl' || Bidi.hasStrongRtl(elem"p		66$` `L0@	k`(.W5 GP<-8Aaq#Crc@\K6	iU*=mFD1 d<%1B0HE #   'H2C4RL <`yrZD 	@:42STD`
@D0! e5AEJR
V*pW`@I F@ (8(S$r AmHq h
@O#$AbR( J mR@+ P8O	!I e[( $0L
HDC0 Y"ASB'*A0| !3`HH !>,1 yP P` gnU&g	D(X~fInba	&,  !
eU(M'``BBj<4uA"he$
Kr sR @3A!E	&@B8BA$l
i@*D*J Pg @ `B"/BCSCT(lM2D  	J> Qu3"ZU<,&o}z0*!@4'L@Evy#X+fO$k k	T0(-
g#B/,] Q A%  %)+F	 j%`WI`K +--6a@Ek"|F cSp )$Sd \ 1P1Z	!+`_
@! CJCvH y
Z-L`apB  	
),DH1 VT bO@
F DP0P10Hp=JH(fbjD`(HA0H380I p)(&*a.F
@v	Q8s H)  IU6 1:8,UHi_\-tVE0t;!! u0k1:7gCfp 02B 4+wFf ,1fh*p")( :z%Jh( PY(G#@,BF	,
5AqXhiI?@	2cd ?\,t .h  0@
H0
J 0zh$  j""YP)!JC!"! $0tX1 %&4`Bh""R`+t1 @ Q0UG`q&@@+&(K	CZ*d(P!rR [)T@g@1~ @ dr	F^2B Y (T0&O(E,bAO@ICH/ego[DX&@A>ZZ0"K cAB@%\ )  @'t Fha@C8P0HBCx;1'.+`(@ PA,0 `H)`Eo#I=b0AKa	UBA(JA(3!T!l;	PN6MB9|2	q,tG B%)"9!L11B.@
HI20lL2NB$J{ a(*[
9JWn@DLR^Yo(E&`/(a@R)(D JqrlqT q0t8MF|JaJH<T8Tj H&zxj`  e-Y !%-XV  Jr4p7GNd\K0z6gKn*P> Y1!j"0O)M  Ej`r%"	T ,		@$"1DD[  *80A%P,PQ2<1A  5fcB3AAJH4((I$Z.B* 	J4I8E`	@i0R@h ?mLoEl/"p S{CI P$j W ZC` j@`BEl_'	H% (*T8  ("$P4A8p<m1"`tT0] 	P4ZP
P   D $A(`h'NI8"(/"(BBF
y Ucm
o
(fSVhC)R
)>$!C$A[ 5	 #w\$IbL).$(e	i)JJB&aH! "Hf3KFd+"CuU+tR<f	# l` D	  "pXbSQD$%DJ b@Q<7
%c
BOR8
E@$"H 1,3I(("1Q  Wh  u7442&h:`L#d=!
 !7g0!  PPa$"%g0U@M2SI!Rq]G0!dKVUS4$%H 
aXT`&
@N@Q	)E3 NL	-@,h @D,Yhb"DKOP# $@ `(y"Ph> a9C8@83D@6DP<(h@&#pe"C.4Z! 6	E Y CC qJ D%aEy` 5r+"&[ \n@)C!!0(( "+UbuEr&)	5Vp!#4frN8D 
!S& J 
0t	"8((r5  (BXi0$PAg.R0 D hYV"<5PL \D!L0`HCLV4\A&`    a54Q(C 
8'Aq$l" Da@C, [`@~i!BC0c 5 !$hH Br 	0 qfEeoMPP ,L~+  8PjQb	8apPQ/
LPM2NP1b@D"N4RpJQ]Sp*ptMLJ!( ics@4*
H0    @ & #%L`($S%#(	.	 TP%
D@@Y,$!*9KBUFD1@baEKD3Q@H\,:hFp\H.4$vmz+ :'` N2PruJaD#
Y !DAs B')!(	D (6`m$		  t#f4BGhiXT$x"EEAY HcZH.AHzi4i.-@a6.BD@Dp22pb \ nh n"  @F0P T!XR (Lz0hw=B)DD@h Q )UwOms2+tY6Wu)Y`?g}}Al}uW3FV946E3u]w6b|vq.VL5_V/?csUY"Idt#!p @   8r` S`2`,zd@dB4w e	4(*<>k  "=!9v! L$"Piq9"II% D\+0Np"$(`2+u  J"   , &	ZP@bF kHDf@ZP@STqJ(@ju>)
	  cziSn0t/?_JJ~{_f?xW	y{zq'Kf/oW1^/Up.{'cl< /"\g	Ix mHHdd`xB*"@Z` FdL@j
PI`P	Vf$	X.P
a  ?/o?'Ev}_.FB~~Rpe7yQ>/kz}l%u|zo |j?FO5yUC'68&>woMm5v__a/v?]oo|nO7yi{n9{on>s$vmiO?yXXW3X)p>km;x;,d- $ e@B*D
0 `Bq005_6"LA2#PX 
U ` X@F X ,X"M `p2@ PH9ohe{n}DZb]o{Gozk6gyyZTn7\_3#}~>4w/=cge/1E   e	0Y vd!0a:8?P!OB <A!JLUu 	R P!(V($%&i< HH  `&6J@% 	@0P1@HtB'BRnB8y$NADJC @a 0Bg*l(   \.r2  ((2* 0#  B PA[WG>OZlw46>c?(Fs%_^&y0X_!V:Cns;+#@l,$!t82 !")M@D$@4"%|2i P	@($I/NBD$RF	TAlvJyrC;{zwjoXld+{y[<z+nyr%
&Etfx9b_V^{3/\wu]i[~lp\Xmv7j*<W.~*wT>'e}w}woif`]>=~l<k_D@@Cp
 (,b`Do$dv PH)J1I$tE0LPP@`$,,TT lp0	 <c,.F!`	1D5	
^I95|wXFfs3[Tc?O8?^[Tz{z~7p4:]{nrnsW^iP  I0 2D)	NB@5 FaEC BTSkTBf&pHDd	I! &$      x) d]V@Pr	11SHT   a	 
 gI0Fx6`+XS 1 $00 
` M	A*UE@d#:C"	H4c@D5eTmvs1\p6#wmo6TWZoe>pj?GS=k~~?w5b]6Q5_z>o~}'B VC d., Hep!Y(`EPlHF0Zgae&crxsd  0*@gBuN dSTH` p#!5)jXkR{Yxokw[a7twm~ty>Lb[xzv!:.cU~w]fuvg_s]k}mul5ZEOV7_pxV_[]Mwkln$` SQHPx 0)0 I`(TPc ( (YXH. @p&-@U!=4   #=,tiS(
 `&Z9~	G1mv8K6~/~~wJy!Z/F%_]?l_m-#np{^	;'IN@ L C!@8%T RP F:8XPP	4-RDaX@C h44 fXQ F
,5``	$A LTBH`	0$
1JDTV>	(XAdD E	4"R$r 2)GBpyU$ H	0IB  pRNCowKZ2?oLwn_tcFS_o/u9-m?nW7@ovTd5{{f<c 
%@0 D"@p	GK8
$FiD 30 DED "` $	0C 4 H>AJ.*@d  P`%_r_~Vww:=nQxW9?-_?'W`_}yYz^tFjvgx>sdzZv)}]??uwjb~h#'rZk?OEoW<]+||sw%U~}7:[nPV~{s0lhb()  0MDp` '7F"0*@J&hUr <b8`B<!RB    `sJ1 h3D29K }P afterDeletePosOpt) {
      return Options.liftN([Traverse.prevSibling(elm), Traverse.nextSibling(elm), afterDeletePosOpt], function (prev, next, afterDeletePos) {
        var offset, prevNode = prev.dom(), nextNode = next.dom();

        if (NodeType.isText(prevNode) && NodeType.isText(nextNode)) {
          offset = prevNode.data.length;
          prevNode.appendData(nextNode.data);
          Remove.remove(next);
          Remove.remove(elm);
          if (afterDeletePos.container() === nextNode) {
            return new CaretPosition(prevNode, offset);
          } else {
            return afterDeletePos;
          }
        } else {
          Remove.remove(elm);
          return afterDeletePos;
        }
      }).orThunk(function () {
        Remove.remove(elm);
        return afterDeletePosOpt;
      });
    };

    var deleteElement = function (editor, forward, elm) {
      var afterDeletePos = findCaretPosOutsideElmAfterDelete(forward, editor.getBody(), elm.dom());
      var parentBlock = PredicateFind.ancestor(elm, Fun.curry(isBlock, editor), eqRawNode(editor.getBody()));
      var normalizedAfterDeletePos = deleteNormalized(elm, afterDeletePos);

      parentBlock.bind(paddEmptyBlock).fold(
        function () {
          setSelection(editor, forward, normalizedAfterDeletePos);
        },
        function (paddPos) {
          setSelection(editor, forward, Option.some(paddPos));
        }
      );
    };

    return {
      deleteElement: deleteElement
    };
  }
);
/**
 * CefDelete.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.delete.CefDelete',
  [
    'ephox.sugar.api.node.Element',
    'tinymce.core.caret.CaretPosition',
    'tinymce.core.caret.CaretUtils',
    'tinymce.core.delete.BlockBoundary',
    'tinymce.core.delete.CefDeleteAction',
    'tinymce.core.delete.DeleteElement',
    'tinymce.core.delete.MergeBlocks',
    'tinymce.core.dom.NodeType'
  ],
  function (Element, CaretPosition, CaretUtils, BlockBoundary, CefDeleteAction, DeleteElement, MergeBlocks, NodeType) {
    var deleteElement = function (editor, forward) {
      return function (element) {
        DeleteElement.deleteElement(editor, forward, Element.fromDom(element));
        return true;
      };
    };

    var moveToElement = function (editor, forward) {
      return function (element) {
        var pos = forward ? CaretPosition.before(element) : CaretPosition.after(element);
        editor.selection.setRng(pos.toRange());
        return true;
      };
    };

    var moveToPosition = function (editor) {
      return function (pos) {
        editor.selection.setRng(pos.toRange());
        return true;
      };
    };

    var backspaceDeleteCaret = function (editor, forward) {
      var result = CefDeleteAction.read(editor.getBody(), forward, editor.selection.getRng()).map(function (deleteAction) {
        return deleteAction.fold(
          deleteElement(editor, forward),
          moveToElement(editor, forward),
          moveToPosition(editor)
        );
      });

      return result.getOr(false);
    };

    var backspaceDeleteRange = function (editor, forward) {
      var selectedElement = editor.selection.getNode();
      if (NodeType.isContentEditableFalse(selectedElement)) {
        DeleteElement.deleteElement(editor, forward, Element.fromDom(editor.selection.getNode()));
        return true;
      } else {
        return false;
      }
    };

    var getContentEditableRoot = function (root, node) {
      while (node && node !== root) {
        if (NodeType.isContentEditableTrue(node) || NodeType.isContentEditableFalse(node)) {
          return node;
        }

        node = node.parentNode;
      }

      return null;
    };

    var paddEmptyElement = function (editor) {
      var br, ceRoot = getContentEditableRoot(editor.getBody(), editor.selection.getNode());

      if (NodeType.isContentEditableTrue(ceRoot) && editor.dom.isBlock(ceRoot) && editor.dom.isEmpty(ceRoot)) {
        br = editor.dom.create('br', { "data-mce-bogus": "1" });
        editor.dom.setHTML(ceRoot, '');
        ceRoot.appendChild(br);
        editor.selection.setRng(CaretPosition.before(br).toRange());
      }

      return true;
    };

    var backspaceDelete = function (editor, forward) {
      if (editor.selection.isCollapsed()) {
        return backspaceDeleteCaret(editor, forward);
      } else {
        return backspaceDeleteRange(editor, forward);
      }
    };

    return {
      backspaceDelete: backspaceDelete,
      paddEmptyElement: paddEmptyElement
    };
  }
);

/**
 * CaretContainerInline.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.caret.CaretContainerInline',
  [
    'ephox.katamari.api.Fun',
    'tinymce.core.dom.NodeType',
    'tinymce.core.text.Zwsp'
  ],
  function (Fun, NodeType, Zwsp) {
    var isText = NodeType.isText;

    var startsWithCaretContainer = function (node) {
      return isText(node) && node.data[0] === Zwsp.ZWSP;
    };

    var endsWithCaretContainer = function (node) {
      return isText(node) && node.data[node.data.length - 1] === Zwsp.ZWSP;
    };

    var createZwsp = function (node) {
      return node.ownerDocument.createTextNode(Zwsp.ZWSP);
    };

    var insertBefore = function (node) {
      if (isText(node.previousSibling)) {
        if (endsWithCaretContainer(node.previousSibling)) {
          return node.previousSibling;
        } else {
          node.previousSibling.appendData(Zwsp.ZWSP);
          return node.previousSibling;
        }
      } else if (isText(node)) {
        if (startsWithCaretContainer(node)) {
          return node;
        } else {
          node.insertData(0, Zwsp.ZWSP);
          return node;
        }
      } else {
        var newNode = createZwsp(node);
        node.parentNode.insertBefore(newNode, node);
        return newNode;
      }
    };

    var insertAfter = function (node) {
      if (isText(node.nextSibling)) {
        if (startsWithCaretContainer(node.nextSibling)) {
          return node.nextSibling;
        } else {
          node.nextSibling.insertData(0, Zwsp.ZWSP);
          return node.nextSibling;
        }
      } else if (isText(node)) {
        if (endsWithCaretContainer(node)) {
          return node;
        } else {
          node.appendData(Zwsp.ZWSP);
          return node;
        }
      } else {
        var newNode = createZwsp(node);
        if (node.nextSibling) {
          node.parentNode.insertBefore(newNode, node.nextSibling);
        } else {
          node.parentNode.appendChild(newNode);
        }
        return newNode;
      }
    };

    var insertInline = function (before, node) {
      return before ? insertBefore(node) : insertAfter(node);
    };

    return {
      insertInline: insertInline,
      insertInlineBefore: Fun.curry(insertInline, true),
      insertInlineAfter: Fun.curry(insertInline, false)
    };
  }
);
/**
 * CaretContainerRemove.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.caret.CaretContainerRemove',
  [
    'ephox.katamari.api.Arr',
    'tinymce.core.caret.CaretContainer',
    'tinymce.core.caret.CaretPosition',
    'tinymce.core.dom.NodeType',
    'tinymce.core.text.Zwsp',
    'tinymce.core.util.Tools'
  ],
  function (Arr, CaretContainer, CaretPosition, NodeType, Zwsp, Tools) {
    var isElement = NodeType.isElement;
    var isText = NodeType.isText;

    var removeNode = function (node) {
      var parentNode = node.parentNode;
      if (parentNode) {
        parentNode.removeChild(node);
      }
    };

    var getNodeValue = function (node) {
      try {
        return node.nodeValue;
      } catch (ex) {
        // IE sometimes produces "Invalid argument" on nodes
        return "";
      }
    };

    var setNodeValue = function (node, text) {
      if (text.length === 0) {
        removeNode(node);
      } else {
        node.nodeValue = text;
      }
    };

    var trimCount = function (text) {
      var trimmedText = Zwsp.trim(text);
      return { count: text.length - trimmedText.length, text: trimmedText };
    };

    var removeUnchanged = function (caretContainer, pos) {
      remove(caretContainer);
      return pos;
    };

    var removeTextAndReposition = function (caretContainer, pos) {
      var before = trimCount(caretContainer.data.substr(0, pos.offset()));
      var after = trimCount(caretContainer.data.substr(pos.offset()));
      var text = before.text + after.text;

      if (text.length > 0) {
        setNodeValue(caretContainer, text);
        return new CaretPosition(caretContainer, pos.offset() - before.count);
      } else {
        return pos;
      }
    };

    var removeElementAndReposition = function (caretContainer, pos) {
      var parentNode = pos.container();
      var newPosition = Arr.indexOf(parentNode.childNodes, caretContainer).map(function (index) {
        return index < pos.offset() ? new CaretPosition(parentNode, pos.offset() - 1) : pos;
      }).getOr(pos);
      remove(caretContainer);
      return newPosition;
    };

    var removeTextCaretContainer = function (caretContainer, pos) {
      return pos.container() === caretContainer ? removeTextAndReposition(caretContainer, pos) : removeUnchanged(caretContainer, pos);
    };

    var removeElementCaretContainer = function (caretContainer, pos) {
      return pos.container() === caretContainer.parentNode ? removeElementAndReposition(caretContainer, pos) : removeUnchanged(caretContainer, pos);
    };

    var removeAndReposition = function (container, pos) {
      return CaretPosition.isTextPosition(pos) ? removeTextCaretContainer(container, pos) : removeElementCaretContainer(container, pos);
    };

    var remove = function (caretContainerNode) {
      if (isElement(caretContainerNode) && CaretContainer.isCaretContainer(caretContainerNode)) {
        if (CaretContainer.hasContent(caretContainerNode)) {
          caretContainerNode.removeAttribute('data-mce-caret');
        } else {
          removeNode(caretContainerNode);
        }
      }

      if (isText(caretContainerNode)) {
        var text = Zwsp.trim(getNodeValue(caretContainerNode));
        setNodeValue(caretContainerNode, text);
      }
    };

    return {
      removeAndReposition: removeAndReposition,
      remove: remove
    };
  }
);
/**
 * BoundaryCaret.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.keyboard.BoundaryCaret',
  [
    'ephox.katamari.api.Option',
    'tinymce.core.caret.CaretContainer',
    'tinymce.core.caret.CaretContainerInline',
    'tinymce.core.caret.CaretContainerRemove',
    'tinymce.core.caret.CaretPosition',
    'tinymce.core.dom.NodeType',
    'tinymce.core.keyboard.InlineUtils'
  ],
  function (Option, CaretContainer, CaretContainerInline, CaretContainerRemove, CaretPosition, NodeType, InlineUtils) {
    var insertInlinePos = function (pos, before) {
      if (NodeType.isText(pos.container())) {
        return CaretContainerInline.insertInline(before, pos.container());
      } else {
        return CaretContainerInline.insertInline(before, pos.getNode());
      }
    };

    var isPosCaretContainer = function (pos, caret) {
      var caretNode = caret.get();
      return caretNode && pos.container() === caretNode && CaretContainer.isCaretContainerInline(caretNode);
    };

    var renderCaret = function (caret, location) {
      return location.fold(
        function (element) { // Before
          CaretContainerRemove.remove(caret.get());
          var text = CaretContainerInline.insertInlineBefore(element);
          caret.set(text);
          return Option.some(new CaretPosition(text, text.length - 1));
        },
        function (element'-lve{u_!F?W92oRm~}__5Ymv4eo`V3~y]M^TkdduVX~C/=z~n5ov[?7LvD/+wi9Wyfcun>u<<6GGi]p_}VN=^dEm%cenx~Tb_>6[qZo6#E`7vn47[w[zvxso'-;}n;7~7O.s>nVe7zwO]n;Jp~7oV]|-tuWgwqk|<td=S-}~%Uw{VV~tev[~gw5|z=Jg8MQ*/_?|W=O{1k^<6>yoiv_O~-t7m)}{5mrgZ]y5LMukn?Ol;FMgF}w\?o./[=y>s}c+rv]}Yw{W'|Y/7Hfu-^xwg'<2f?W?_oNC6.O;d5o~nu[Ogs?0u/PI[=R\7bw{G_#[TOk;?31rQ]:7rtv~{r?7{vm_=]Og*4cSoV|wGw?6lw={EHC^o_W}!
/gg;Skny4M}?o|[}~PW:w^~g\;^gU}n^g~}z{g o_M<lmBAa?f6O:KW7ww1!O{%]%SiswjisG+7FF$vOkHR_s}t`
Ihw}Z{oh_QoO~M{MyX6^:3o|^{of*?}wEmP>{<OGq""9wt_}//oO7{^&Zoz]9Yb}/>]2x?oKF/2:OU^fO^;gkzw=P7z^|}O*'W{_m`-7nQl8d.>=x?{].m-o__7|5Y?\m!{Y}<eWyS?'<^zMW[*'u>o>w>_oo~?-7p3w_jxe5n/(R4>/t|]}{g(su~3A~_{'={7r_Uw?okoE_r*om^mWr>(;w_bymnNjO+Ykul[X~savn{K_Glf_A_4`Y7[!nn/w~SWWWw[kJo_jMw?lfo#tLp_b*V~OSf>_|7>~sjGNmOWp>Uo.Vo{9g?slo~~D5q=|z;z__Gw/s>;-wos}_w{}Wl_^OL?w-~Zwv-7]Kz=]_o_V-U}[9%?~xmrfP^;x /]/}~7W_[7qVW;VyqnXS^$WlBo	??];;|:]6DkI_ww}_uUt~]vjrOjO==_wg{hsw)M1mzM<xeS3|Fs{rWz=e_+szOZn9;wu3|RYzw^lEiu5i2{znpHMd5g/<|?Gpm5gm-4Ehw*$w}jzVi{{~Wk{qO!Ws[vn6F}#_m)ks|h0W5kku_u4.k7v9;_z^}xq~_wzma?aMqv_|o:f	B;~#Wql#?_OWO2t~++>[Wx]gZzKygyi/"OGW?7jdv}g9[?C7Kd|>v;|>|xE/bo~{?m?ySN=1}1U}r6;{s_.O7vQkGZ_o~YK~ry~vw\;|9sm9WG|t?_}%Y;uXg} _za=?P|O._{EK~j{cukO|SYWlnn~}lw
}5VQ~KC5<t=|?[#2u  var nextPos = InlineUtils.findCaretPosition(inline, true, nPos);
        return nextPos.isNone() ? Option.some(Location.end(inline)) : Option.none();
      });
    };

    var after = function (rootNode, pos) {
      var nPos = InlineUtils.normalizeBackwards(pos);
      var scope = rescope(rootNode, nPos.container());
      return InlineUtils.findRootInline(scope, nPos).fold(
        function () {
          return InlineUtils.findCaretPosition(scope, false, nPos)
            .bind(Fun.curry(InlineUtils.findRootInline, scope))
            .map(function (inline) {
              return Location.after(inline);
            });
        },
        Option.none
      );
    };

    var isValidLocation = function (location) {
      return InlineUtils.isRtl(getElement(location)) === false;
    };

    var readLocation = function (rootNode, pos) {
      var location = LazyEvaluator.evaluateUntil([
        before,
        start,
        end,
        after
      ], [rootNode, pos]);

      return location.filter(isValidLocation);
    };

    var getElement = function (location) {
      return location.fold(
        Fun.identity, // Before
        Fun.identity, // Start
        Fun.identity, // End
        Fun.identity  // After
      );
    };

    var getName = function (location) {
      return location.fold(
        Fun.constant('before'), // Before
        Fun.constant('start'),  // Start
        Fun.constant('end'),    // End
        Fun.constant('after')   // After
      );
    };

    var outside = function (location) {
      return location.fold(
        Location.before, // Before
        Location.before, // Start
        Location.after,  // End
        Location.after   // After
      );
    };

    var inside = function (location) {
      return location.fold(
        Location.start, // Before
        Location.start, // Start
        Location.end,   // End
        Location.end    // After
      );
    };

    var isEq = function (location1, location2) {
      return getName(location1) === getName(location2) && getElement(location1) === getElement(location2);
    };

    var betweenInlines = function (forward, rootNode, from, to, location) {
      return Options.liftN([
        InlineUtils.findRootInline(rootNode, from),
        InlineUtils.findRootInline(rootNode, to)
      ], function (fromInline, toInline) {
        if (fromInline !== toInline && InlineUtils.hasSameParentBlock(rootNode, fromInline, toInline)) {
          // Force after since some browsers normalize and lean left into the closest inline
          return Location.after(forward ? fromInline : toInline);
        } else {
          return location;
        }
      }).getOr(location);
    };

    var skipNoMovement = function (fromLocation, toLocation) {
      return fromLocation.fold(
        Fun.constant(true),
        function (fromLocation) {
          return !isEq(fromLocation, toLocation);
        }
      );
    };

    var findLocationTraverse = function (forward, rootNode, fromLocation, pos) {
      var from = InlineUtils.normalizePosition(forward, pos);
      var to = InlineUtils.findCaretPosition(rootNode, forward, from).map(Fun.curry(InlineUtils.normalizePosition, forward));

      var location = to.fold(
        function () {
          return fromLocation.map(outside);
        },
        function (to) {
          return readLocation(rootNode, to)
            .map(Fun.curry(betweenInlines, forward, rootNode, from, to))
            .filter(Fun.curry(skipNoMovement, fromLocation));
        }
      );

      return location.filter(isValidLocation);
    };

    var findLocationSimple = function (forward, location) {
      if (forward) {
        return location.fold(
          Fun.compose(Option.some, Location.start), // Before -> Start
          Option.none,
          Fun.compose(Option.some, Location.after), // End -> After
          Option.none
        );
      } else {
        return location.fold(
          Option.none,
          Fun.compose(Option.some, Location.before), // Before <- Start
          Option.none,
          Fun.compose(Option.some, Location.end) // End <- After
        );
      }
    };

    var findLocation = function (forward, rootNode, pos) {
      var from = InlineUtils.normalizePosition(forward, pos);
      var fromLocation = readLocation(rootNode, from);

      return readLocation(rootNode, from).bind(Fun.curry(findLocationSimple, forward)).orThunk(function () {
        return findLocationTraverse(forward, rootNode, fromLocation, pos);
      });
    };

    return {
      readLocation: readLocation,
      prevLocation: Fun.curry(findLocation, false),
      nextLocation: Fun.curry(findLocation, true),
      getElement: getElement,
      outside: outside,
      inside: inside
    };
  }
);
define(
  'ephox.katamari.api.Cell',

  [
  ],

  function () {
    var Cell = function (initial) {
      var value = initial;

      var get = function () {
        return value;
      };

      var set = function (v) {
        value = v;
      };

      var clone = function () {
        return Cell(get());
      };

      return {
        get: get,
        set: set,
        clone: clone
      };
    };

    return Cell;
  }
);

/**
 * BoundarySelection.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.keyboard.BoundarySelection',
  [
    'ephox.katamari.api.Arr',
    'ephox.katamari.api.Cell',
    'ephox.katamari.api.Fun',
    'tinymce.core.caret.CaretContainerRemove',
    'tinymce.core.caret.CaretPosition',
    'tinymce.core.keyboard.BoundaryCaret',
    'tinymce.core.keyboard.BoundaryLocation',
    'tinymce.core.keyboard.InlineUtils'
  ],
  function (Arr, Cell, Fun, CaretContainerRemove, CaretPosition, BoundaryCaret, BoundaryLocation, InlineUtils) {
    var setCaretPosition = function (editor, pos) {
      var rng = editor.dom.createRng();
      rng.setStart(pos.container(), pos.offset());
      rng.setEnd(pos.container(), pos.offset());
      editor.selection.setRng(rng);
    };

    var isFeatureEnabled = function (editor) {
      return editor.settings.inline_boundaries !== false;
    };

    var setSelected = function (state, elm) {
      if (state) {
        elm.setAttribute('data-mce-selected', '1');
      } else {
        elm.removeAttribute('data-mce-selected', '1');
      }
    };

    var renderCaretLocation = function (editor, caret, location) {
      return BoundaryCaret.renderCaret(caret, location).map(function (pos) {
        setCaretPosition(editor, pos);
        return location;
      });
    };

    var findLocation = function (editor, caret, forward) {
      var rootNode = editor.getBody();
      var from = CaretPosition.fromRangeStart(editor.selection.getRng());
      var location = forward ? BoundaryLocation.nextLocation(rootNode, from) : BoundaryLocation.prevLocation(rootNode, from);
      return location.bind(function (location) {
        return renderCaretLocation(editor, caret, location);
      });
    };

    var toggleInlines = function (dom, elms) {
      var selectedInlines = dom.select('a[href][data-mce-selected],code[data-mce-selected]');
      var targetInlines = Arr.filter(elms, InlineUtils.isInlineTarget);
      Arr.each(Arr.difference(selectedInlines, targetInlines), Fun.curry(setSelected, false));
      Arr.each(Arr.difference(targetInlines, selectedInlines), Fun.curry(setSelected, true));
    };

    var safeRemoveCaretContainer = function (editor, caret) {
      if (editor.selection.isCollapsed() && editor.composing !== true && caret.get()) {
        var pos = CaretPosition.fromRangeStart(editor.selection.getRng());
        if (CaretPosition.isTextPosition(pos) && InlineUtils.isAtZwsp(pos) === false) {
          setCaretPosition(editor, CaretContainerRemove.removeAndReposition(caret.get(), pos));
          caret.set(null);
        }
      }
    };

    var renderInsideInlineCaret = function (editor, caret, elms) {
      if (editor.selection.isCollapsed()) {
        var inlines = Arr.filter(elms, InlineUtils.isInlineTarget);
        Arr.each(inlines, function (inline) {
          var pos = CaretPosition.fromRangeStart(editor.selection.getRng());
          BoundaryLocation.readLocation(editor.getBody(), pos).bind(function (location) {
            return renderCaretLocation(editor, caret, location);
          });
        });
      }
    };

    var move = function (editor, caret, forward) {
      return function () {
        return isFeatureEnabled(editor) ? findLocation(editor, caret, forward).isSome() : false;
      };
    };

    var setupSelectedState = function (editor) {
      var caret = new Cell(null);

      editor.on('NodeChange', function (e) {
        if (isFeatureEnabled(editor)) {
          toggleInlines(editor.dom, e.parents);
          safeRemoveCaretContainer(editor, caret);
          renderInsideInlineCaret(editor, caret, e.parents);
        }
      });

      return caret;
    };

    return {
      move: move,
      setupSelectedState: setupSelectedState,
      setCaretPosition: setCaretPosition
    };
  }
);
/**
 * InlineBoundaryDelete.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.delete.InlineBoundaryDelete',
  [
    'ephox.katamari.api.Fun',
    'ephox.katamari.api.Option',
    'ephox.katamari.api.Options',
    'ephox.sugar.api.node.Element',
    'tinymce.core.caret.CaretContainer',
    'tinymce.core.caret.CaretFinder',
    'tinymce.core.caret.CaretPosition',
    'tinymce.core.caret.CaretUtils',
    'tinymce.core.delete.DeleteElement',
    'tinymce.core.keyboard.BoundaryCaret',
    'tinymce.core.keyboard.BoundaryLocation',
    'tinymce.core.keyboard.BoundarySelection',
    'tinymce.core.keyboard.InlineUtils'
  ],
  function (
    Fun, Option, Options, Element, CaretContainer, CaretFinder, CaretPosition, CaretUtils, DeleteElement, BoundaryCaret, BoundaryLocation, BoundarySelection,
    InlineUtils
  ) {
    var isFeatureEnabled = function (editor) {
      return editor.settings.inline_boundaries !== false;
    };

    var rangeFromPositions = function (from, to) {
      var range = document.createRange();

      range.setStart(from.container(), from.offset());
      range.setEnd(to.container(), to.offset());

      return range;
    };

    // Checks for delete at <code>|a</code> when there is only one item left except the zwsp caret container nodes
    var hasOnlyTwoOrLessPositionsLeft = function (elm) {
      return Options.liftN([
        InlineUtils.findCaretPositionIn(elm, true),
        InlineUtils.findCaretPositionIn(elm, false)
      ], function (firstPos, lastPos) {
        var normalizedFirstPos = InlineUtils.normalizePosition(true, firstPos);
        var normalizedLastPos = InlineUtils.normalizePosition(false, lastPos);

        return InlineUtils.findCaretPosition(elm, true, normalizedFirstPos).map(function (pos) {
          return pos.isEqual(normalizedLastPos);
        }).getOr(true);
      }).getOr(true);
    };

    var setCaretLocation = function (editor, caret) {
      return function (location) {
        return BoundaryCaret.renderCaret(caret, location).map(function (pos) {
          BoundarySelection.setCaretPosition(editor, pos);
          return true;
        }).getOr(false);
      };
    };

    var deleteFromTo = function (editor, caret, from, to) {
      var rootNode = editor.getBody();

      editor.undoManager.ignore(function () {
        editor.selection.setRng(rangeFromPositions(from, to));
        editor.execCommand('Delete');

        BoundaryLocation.readLocation(rootNode, CaretPosition.fromRangeStart(editor.selection.getRng()))
          .map(BoundaryLocation.inside)
          .map(setCaretLocation(editor, caret));
      });

      editor.nodeChanged();
    };

    var rescope = function (rootNode, node) {
      var parentBlock = CaretUtils.getParentBlock(node, rootNode);
      return parentBlock ? parentBlock : rootNode;
    };

    var backspaceDeleteCollapsed = function (editor, caret, forward, from) {
      var rootNode = rescope(editoI`\OerX>kW{??1iUv7/Ouxv^>MYf]_6DtdT<ns|o~,O!BhSB/G$1 !DC9DBC~ B% D$ SU:D^&eD$ pz!d)l81:NL*FA
"A$ " * rL*$>$  @  kpE-
ixQnd`D<,AtrVa!8DB*; 0BA X,&W~>wvY<z\r_[>}c\7+SjyO2s5qsxso_muWUN8/^ K)C %u,$1@X NvA&I$ZJ vj`b+C%(
$
h@NPQ:&@" P}"!@"rTGHc#-oOr_Gn+.Uvtn~r?w?9]x8x&Zy=?$|sR77k^O/yI?\c-5_i}u}o4??Z/]x~Cw#m[n~jvOO\1& J '$I#0x.  9p(H8<AAV #0$,<D1
( !
B! C @M@ 3XOT2DLl8
R}|_2v?bk}p
vX'Gg?\qU_W}?_zn?!?k{qG7:ovZ{.e,4q h(Q0ga)#( DfJXpB Q,@!`!B@D2s6^H&@TH `46J4iB@  *gFQO<r hhl(O	 @a@BE (@? @@`)P0 ? I`D <6A6@Xb"H
:PN2;Y
	RH/~_ty*?\}kD{~;Wm.4MO^)=c{?M=7^YXu4zUmq  D@AK !c8BHh0De@S@ bi  4!{%	mVLp!)P Z- )!8B(*#@%!,d@L a"5_mZ9;L}Pyy4Q77[s_9Ub:k_~?{]{S"Nn_]z3uJSM2]aOsOt'2yvWc;rc8_EbQVIZo&?URggu=R; rp&" ~*N 	@ !rA@@(8S%( 2!R @ !*J$ @a.'aP l@R@TC@e<R\:M)}30YCE#3nb.=?8|}vLo]n==H'3|^w; ?_wzcdx$	@	 alDP	I	4&rS3L@ 8$-` Q1(@ 0 J h0E@AH. `"qf	(x &G!i cXZCQ1@C	@  B4@V!rE@xT#(b PMx@0V O 0 h @)Qh 4HXI:l!G8\_k;?0*kzwO}:`U>:~Ooz|{[g`=Y>o}BVd 0] $ H mP( P 2"])!P ( &h  @A"eR,(R!@s3@ TGil4YB-RuOO9InB/6okCCDew;pwQ{EFVkoO`{dwAm}~;zrK]S/RE7}oC+?f_c[aNwoqd?oeRx.}1vw;z{w'q3jB0<A
Cv`LH)iT E@F1(B"A'"PP@%o C @pv-tZ%4"p?tDre^ 
 Z~*os.?^]6=sMM;orvw/^E?{C>wI^5{l.u[S7^o-2s0)T1 p(IP
B F
U@\ebH]1alN&I  	2#2|$0@:X Sbz;&rBmHQmMP <"C 
(D)d6AQ$.`
 P<@@	!H@B0@H y"1PV@ H t HKAwe5u~vv}Osa7z%~w~O_g4#X?s/3WwYj$k5Pq(Q36l=0xWd8N.e%lg	KRYbN @j@"D,'L@{ 	)PGbGAG; (1 R9'* 6 ,B5bvET0
$
iX$@<"6.nNw{Kmlik~~&S_/&%;g[(7on_3	>/9zc\(4]Bg~ *KWLY?^W{}M"]7_M~cV'u^]v9)
QZ)'m-MVZ?5=~_zSOQ/^5S0&!x  CUE1 (PGxH eE0yQDR	Da/X  0
a ,r XKpa 8.W@
  B`		@,$ a% a1:%"+ bpQ  `4&D0 0&D!@%0-@P`8(H*T&Gzr"#eZ@ @
 ADJERO)tDS
h@0_yCT@Ir7/>o;sC7fe{S=jw]0)?-T"'*}$<n;~U{rF[E4wu_C_c}=&bs&I/nSum_|D>nak[?71_t}O~5/EODU?y5
K=}C R`b>9\p<*hnCf D_Zo:
BT C("vJ`l("- \&	 #(Y.tn1d
$ PRXB$'U)i2R8T^~uy27{}UvK4
yo?:<rZs?JWmTV4+5jzW"a2?(FF C pDV0 C!h 2LS^  CHY(7IHh P^NA&QL+k@4<ZDx*G)LF%xc L$G-2:J&  Sd@hBFA $r@& G!ga @0(B
jqDS 	b  T>@KL8|MwsUYr-=u<}g}f:3KZr}iV7woW_s>:osq\ro[mUQ,Q# >k"S1)	)&uB  pD-LABAAHp DZ6a	$Kt0l~9PeIi=&`%&( 0`!Luo}y*WwDc6Z~:RcT~2L~)vW?|`>|+w,7=^bjv{}kL]WW|mRgq\WV??J7-WS^x|kh3owAkW|V6jGmoUp#B;F@$ 
2lk16h] ?P $@
 R$@"@@h )r  " & B@62ZX0  DE0A 
rM0~W|KwWs\p<7}t/?@"GiftWo'jm;ZV%Cg9jw&!_ B)P		H	A&E *	0$KBH@ 
B4@iK``AAIa	dX _B)4 @qB T #&N
`D @DEAB*AC Y)aej1 r
T:$NC0(B	!)9 6B(HA!p
V
	Jld) ,#0@J~z]gu7IOr~7+pG#BWb?_|x_jP,/?1'1??fgs}NYKpx^UV]+%`.9PLRWgR6- " @ X`VgaH	$ 81	q3E<$@ !h& 6l"$D@@0UK1 5xV@ `  Zg5qjE	~gZ~O1}$m]rG^}^	~u{v/r}>H6s{,m}9'_Y}G)m5f:MGwzi/'_iyH7n$_?uuz{_l Q>B !@J Ue4 \G@`P @
(OKM@ (Bq2A	K40@@<DD0C2s_/fMtm}OwuZ\'.aNBViAOo/&g%b;V6kn[p2IjrW:kCD55BS(Td {#@l!@`6B@R QC $1x@ !-U (Yf  @p
 I Hh pp
!2,#B6@K1 D\G2jRYVB # E`,V 04%
H|0L$<J p   3P&"ABmBEB (sf @00 	 Jn  U +@bib~{9WWgmsL=cjwij;M8t;scV\zMVSvFr_F-V)=V_y{K)~9B
p# JY2C B`CpAV@`$EDJ-F%	5N)45% 5X@Yv0Ct`0X xh `n tVpfxog~	VtK_ZOfov$Dfkv''K$%A~|omgl[cwiThW0:]+jWmKs93mwr[wyt.-[YRW,u_.+27>}}vG:@R& . ,P HGa C
R  J I*P(MB	n*.0E0*-T0FPL c1x# )"f;ox`2{1>L5>v/F6?Or9f}s*st<G5}X_p~O*cgspP
$@@\N    D q 
@K`,%$		#t$a:(XI0RE`"#$ x0CbRB"t 	
&fapSBY"`Dz @ X"j[P < " 	NPnv$s SmRZ$ T!2DR0IQ" C4 D+" 2
i!1
AdZm-X2}.m"{v~)O4c_Yyv?Gpok?J{mW}g.0HYO	lR@.,`J-K
_F!jNPb=Pu2F%q  \D*aL`2op%n	 V!! oD$G,	)dV$< A8qbu
At
pD@Db 5P$40)V%"PI"HY (@Hh I1B PfP"DA
Dn1<!*;D	H uA%DVK	 !XP i,a#1
  ! )W@ h"(*ER)GA"Jaq&PAA|eNHAB9|eM Jh.CD% (%P" 	$P0b @\ `;0#E!D@IP~ kABd #E&/&pC%&	j`kHV$(jSU
A?A`' 4[  $"xI  M 1Q^d % `	PI@$@
,N  fDh UJ9C9!dA6@	
nBJ @0D _xf* AR rT8%aB, Fz \jdX!PaM=: l`@"O$AR%)I sz Ej	P@	@WF=@*	&pNb`k0 <C)u:5J=Q@e0Yb&.n|jCp+dDT
)_6+r7 D
POE"(ADi= 	Lp0&^CP`0&
 I@wP`r L@@0  TP&pIAe5K+$[ 	)CG$0 ~ns	5   1D`!T@[#X^	p<$Z>'k19$P$_	a5e4	&a|
$vHRchl
27a	I`$,%@r& ZR ,	 X D5Td0Q
@0XX@tb2jE  tB@HHXAI I>A9HU#d&lI`! 4K%ElD0FB^`EjBh b%%!qA@)jI7 ((Q0&p` )"s%ATR2"b wP
I9dsEZY1d&|mD ^$
@uOy@GHI >ItHC2Ghxb<)\e#*1J W @lU reI8 b$DD@& IB$(HR "Hz8I*bp(  V (AdQ c0
 $   pVBpBEQ! 1svp8@a,lDPJG#vDQzB55T0BPM@x%@@"{L
\CXC"Hu$%NFD
SIxu  0qq"`L@  
X
d$k KxN8 Q h@ 5|5R (i #!b^@$ +A )^V
D,xA eDn MB$0  H
 T"CR aP	8 GT  GLQ
JH"tL<"&8'
p8*
"D l5I1up3!*Z`	h b& @P&2L0S# R	Bdql`!
EHDN"B Q!31$`#`LHdIE YP)! #Ir   8#	(FP-Bo "sUP4fP 	!VIkXGb~DG`)H0!I(Hq-,`!!@ H"B`CAN F@3 1"pa2@*0K4F X"qt5Q0S4&j?a`X' 	>m=?/5- xghE*":PtX9DfN$D@2a\,M@<F+J<F	04 ( &F"48SY  ^YafECrQ0EQOL`H jF #CH3E)  	AD ) 026 wQ%*4!P)BI'"b!/7
0$TC$Vp? c4" )<5 zrA,cJA$
PC:*@BQPpH@iG0-:"P-t[j0,> q="HTd"F0V @*`FT<:l9
3&AhP@
q:}"CDh @   (VC0B0 PZ"P h!QP#	B6"0`HpDx @
 @! 'P	f;@u 8:TkJ-7Sb*p 
"$`0Q p/4RH$\wArA$xh e4`zIw*5(#16	D PCA(&cD%)mq"IH I*Kf`A "6O(u@XP.%H!C@$"F# ""`$bN$ \ R F`$l " X 0H`0  ]	 9@PDu! 3A1" $=Q(S (D  D%,@.H B= pQpP>0N@ D"20b08\0t`l-G"e
`PJVEl 6!)0K
z=Sg<D)N:oKD$~{%E4@D@``
I	%dC$!"0 hU(L &D
 `AZ
M1YS@[z52 9#`mp	 C,Pv 8Z cMA:3(WY@by.fX gBX%U@QI2",aGZ'N>
0md-4!cE`AC(nC", [\fU (E@AEAJBghWc	G 1 f	B 
0'xb`Az4
Qv L\4dM3CIDH $kp  Ev	sNP`CN`pg QABpP (Br@$a@D RPp8	Y&1(iPC(a@o;	7	'Db&A*Py"@Rmce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Handles inserts of contents into the editor instance.
 *
 * @class tinymce.InsertContent
 * @private
 */
define(
  'tinymce.core.InsertContent',
  [
    'tinymce.core.caret.CaretPosition',
    'tinymce.core.caret.CaretWalker',
    'tinymce.core.dom.ElementUtils',
    'tinymce.core.dom.NodeType',
    'tinymce.core.dom.RangeNormalizer',
    'tinymce.core.Env',
    'tinymce.core.html.Serializer',
    'tinymce.core.InsertList',
    'tinymce.core.util.Tools'
  ],
  function (CaretPosition, CaretWalker, ElementUtils, NodeType, RangeNormalizer, Env, Serializer, InsertList, Tools) {
    var isTableCell = NodeType.matchNodeNames('td th');

    var validInsertion = function (editor, value, parentNode) {
      // Should never insert content into bogus elements, since these can
      // be resize handles or similar
      if (parentNode.getAttribute('data-mce-bogus') === 'all') {
        parentNode.parentNode.insertBefore(editor.dom.createFragment(value), parentNode);
      } else {
        // Check if parent is empty or only has one BR element then set the innerHTML of that parent
        var node = parentNode.firstChild;
        var node2 = parentNode.lastChild;
        if (!node || (node === node2 && node.nodeName === 'BR')) {///
          editor.dom.setHTML(parentNode, value);
        } else {
          editor.selection.setContent(value);
        }
      }
    };

    var insertHtmlAtCaret = function (editor, value, details) {
      var parser, serializer, parentNode, rootNode, fragment, args;
      var marker, rng, node, node2, bookmarkHtml, merge;
      var textInlineElements = editor.schema.getTextInlineElements();
      var selection = editor.selection, dom = editor.dom;

      function trimOrPaddLeftRight(html) {
        var rng, container, offset;

        rng = selection.getRng(true);
        container = rng.startContainer;
        offset = rng.startOffset;

        function hasSiblingText(siblingName) {
          return container[siblingName] && container[siblingName].nodeType == 3;
        }

        if (container.nodeType == 3) {
          if (offset > 0) {
            html = html.replace(/^&nbsp;/, ' ');
          } else if (!hasSiblingText('previousSibling')) {
            html = html.replace(/^ /, '&nbsp;');
          }

          if (offset < container.length) {
            html = html.replace(/&nbsp;(<br>|)$/, ' ');
          } else if (!hasSiblingText('nextSibling')) {
            html = html.replace(/(&nbsp;| )(<br>|)$/, '&nbsp;');
          }
        }

        return html;
      }

      // Removes &nbsp; from a [b] c -> a &nbsp;c -> a c
      function trimNbspAfterDeleteAndPaddValue() {
        var rng, container, offset;

        rng = selection.getRng(true);
        container = rng.startContainer;
        offset = rng.startOffset;

        if (container.nodeType == 3 && rng.collapsed) {
          if (container.data[offset] === '\u00a0') {
            container.deleteData(offset, 1);

            if (!/[\u00a0| ]$/.test(value)) {
              value += ' ';
            }
          } else if (container.data[offset - 1] === '\u00a0') {
            container.deleteData(offset - 1, 1);

            if (!/[\u00a0| ]$/.test(value)) {
              value = ' ' + value;
            }
          }
        }
      }

      function reduceInlineTextElements() {
        if (merge) {
          var root = editor.getBody(), elementUtils = new ElementUtils(dom);

          Tools.each(dom.select('*[data-mce-fragment]'), function (node) {
            for (var testNode = node.parentNode; testNode && testNode != root; testNode = testNode.parentNode) {
              if (textInlineElements[node.nodeName.toLowerCase()] && elementUtils.compare(testNode, node)) {
                dom.remove(node, true);
              }
            }
          });
        }
      }

      function markFragmentElements(fragment) {
        var node = fragment;

        while ((node = node.walk())) {
          if (node.type === 1) {
            node.attr('data-mce-fragment', '1');
          }
        }
      }

      function umarkFragmentElements(elm) {
        Tools.each(elm.getElementsByTagName('*'), function (elm) {
          elm.removeAttribute('data-mce-fragment');
        });
      }

      function isPartOfFragment(node) {
        return !!node.getAttribute('data-mce-fragment');
      }

      function canHaveChildren(node) {
        return node && !editor.schema.getShortEndedElements()[node.nodeName];
      }

      function moveSelectionToMarker(marker) {
        var parentEditableFalseElm, parentBlock, nextRng;

        function getContentEditableFalseParent(node) {
          var root = editor.getBody();

          for (; node && node !== root; node = node.parentNode) {
            if (editor.dom.getContentEditable(node) === 'false') {
              return node;
            }
          }

          return null;
        }

        if (!marker) {
          return;
        }

        selection.scrollIntoView(marker);

        // If marker is in cE=false then move selection to that element instead
        parentEditableFalseElm = getContentEditableFalseParent(marker);
        if (parentEditableFalseElm) {
          dom.remove(marker);
          selection.select(parentEditableFalseElm);
          return;
        }

        // Move selection before marker and remove it
        rng = dom.createRng();

        // If previous sibling is a text node set the selection to the end of that node
        node = marker.previousSibling;
        if (node && node.nodeType == 3) {
          rng.setStart(node, node.nodeValue.length);

          // TODO: Why can't we normalize on IE
          if (!Env.ie) {
            node2 = marker.nextSibling;
            if (node2 && node2.nodeType == 3) {
              node.appendData(node2.data);
              node2.parentNode.removeChild(node2);
            }
          }
        } else {
          // If the previous sibling isn't a text node or doesn't exist set the selection before the marker node
          rng.setStartBefore(marker);
          rng.setEndBefore(marker);
        }

        function findNextCaretRng(rng) {
          var caretPos = CaretPosition.fromRangeStart(rng);
          var caretWalker = new CaretWalker(editor.getBody());

          caretPos = caretWalker.next(caretPos);
          if (caretPos) {
            return caretPos.toRange();
          }
        }

        // Remove the marker node and set the new range
        parentBlock = dom.getParent(marker, dom.isBlock);
        dom.remove(marker);

        if (parentBlock && dom.isEmpty(parentBlock)) {
          editor.$(parentBlock).empty();

          rng.setStart(parentBlock, 0);
          rng.setEnd(parentBlock, 0);

          if (!isTableCell(parentBlock) && !isPartOfFragment(parentBlock) && (nextRng = findNextCaretRng(rng))) {
            rng = nextRng;
            dom.remove(parentBlock);
          } else {
            dom.add(parentBlock, dom.create('br', { 'data-mce-bogus': '1' }));
          }
        }

        selection.setRng(rng);
      }

      // Check for whitespace before/after value
      if (/^ | $/.test(value)) {
        value = trimOrPaddLeftRight(value);
      }

      // Setup parser and serializer
      parser = editor.parser;
      merge = details.merge;

      serializer = new Serializer({
        validate: editor.settings.validate
      }, editor.schema);
      bookmarkHtml = '<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;&#x200B;</span>';

      // Run beforeSetContent handlers on the HTML to be inserted
      args = { content: value, format: 'html', selection: true };
      editor.fire('BeforeSetContent', args);
      value = args.content;

      // Add caret at end of contents if it's missing
      if (value.indexOf('{$caret}') == -1) {
        value += '{$caret}';
      }

      // Replace the caret marker with a span bookmark element
      value = value.replace(/\{\$caret\}/, bookmarkHtml);

      // If selection is at <body>|<p></p> then move it into <body><p>|</p>
      rng = selection.getRng();
      var caretElement = rng.startContainer || (rng.parentElement ? rng.parentElement() : null);
      var body = editor.getBody();
      if (caretElement === body && selection.isCollapsed()) {
        if (dom.isBlock(body.firstChild) && canHaveChildren(body.firstChild) && dom.isEmpty(body.firstChild)) {
          rng = dom.createRng();
          rng.setStart(body.firstChild, 0);
          rng.setEnd(body.firstChild, 0);
          selection.setRng(rng);
        }
      }

      // Insert node maker where we will insert the new HTML and get it's parent
      if (!selection.isCollapsed()) {
        // Fix for #2595 seems that delete removes one extra character on
        // WebKit for some odd reason if you double click select a word
        editor.selection.setRng(RangeNormalizer.normalize(editor.selection.getRng()));
        editor.getDoc().execCommand('Delete', false, null);
        trimNbspAfterDeleteAndPaddValue();
      }

      parentNode = selection.getNode();

      // Parse the fragment within the context of the parent node
      var parserArgs = { context: parentNode.nodeName.toLowerCase(), data: details.data };
      fragment = parser.parse(value, parserArgs);

      // Custom handling of lists
      if (details.paste === true && InsertList.isListFragment(fragment) && InsertList.isParentBlockLi(dom, parentNode)) {
        rng = InsertList.insertAtCaret(serializer, dom, editor.selection.getRng(true), fragment);
        editor.selection.setRng(rng);
        editor.fire('SetContent', args);
        return;
      }

      markFragmentElements(fragment);

      // Move the caret to a more suitable location
      node = fragment.lastChild;
      if (node.attr('id') == 'mce_marker') {
        marker = node;

        for (node = node.prev; node; node = node.walk(true)) {
          if (node.type == 3 || !dom.isBlock(node.name)) {
            if (editor.schema.isValidChild(node.parent.name, 'span')) {
              node.parent.insert(marker, node, node.name === 'br');
            }
            break;
          }
        }
      }

      editor._selectionOverrides.showBlockCaretContainer(parentNode);

      // If parser says valid we can insert the contents into that parent
      if (!parserArgs.invalid) {
        value = serializer.serialize(fragment);
        validInsertion(editor, value, parentNode);
      } else {
        // If the fragment was invalid within that context then we need
        // to parse and process the parent it's inserted into

        // Insert bookmark node and get the parent
        selection.setContent(bookmarkHtml);
        parentNode = selection.getNode();
        rootNode = editor.getBody();

        // Opera will return the document node when selection is in root
        if (parentNode.nodeType == 9) {
          parentNode = node = rootNode;
        } else {
          node = parentNode;
        }

        // Find the ancestor just before the root element
        while (node !== rootNode) {
          parentNode = node;
          node = node.parentNode;
        }

        // Get the outer/inner HTML depending on if we are in the root and parser and serialize that
        value = parentNode == rootNode ? rootNode.innerHTML : dom.getOuterHTML(parentNode);
        value = serializer.serialize(
          parser.parse(
            // Need to replace by using a function since $ in the contents would otherwise be a problem
            value.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i, function () {
              return serializer.serialize(fragment);
            })
          )
        );

        // Set the inner/outer HTML depending on if we are in the root or not
        if (parentNode == rootNode) {
          dom.setHTML(rootNode, value);
        } else {
          dom.setOuterHTML(parentNode, value);
        }
      }

      reduceInlineTextElements();
      moveSelectionToMarker(dom.get('mce_marker'));
      umarkFragmentElements(editor.getBody());
      editor.fire('SetContent', args);
      editor.addVisual();
    };

    var processValue = function (value) {
      var details;

      if (typeof value !== 'string') {
        details = Tools.extend({
          paste: value.paste,
          data: {
            paste: value.paste
          }
        }, value);

        return {
          content: value.content,
          details: details
        };
      }

      return {
        content: value,
        details: {}
      };
    };

    var insertAtCaret = function (editor, value) {
      var result = processValue(value);
      insertHtmlAtCaret(editor, result.content, result.details);
    };

    return {
      insertAtCaret: insertAtCaret
    };
  }
);
/**
 * EditorCommands.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class enables you to add custom editor commands and it contains
 * overrides for native browser commands to address various bugs and issues.
 *
 * @class tinymce.EditorCommands
 */
define(
  'tinymce.core.EditorCommands',
  [
    'tinymce.core.delete.DeleteCommands',
    'tinymce.core.dom.NodeType',
    'tinymce.core.dom.RangeUtils',
    'tinymce.core.dom.TreeWalker',
    'tinymce.core.Env',
    'tinymce.core.InsertContent',
    'tinymce.core.util.Tools'
  ],
  function (DeleteCommands, NodeType, RangeUtils, TreeWalker, Env, InsertContent, Tools) {
    // Added for compression purposes
    var each = Tools.each, extend = Tools.extend;
    var map = Tools.map, inArray = Tools.inArray, explode = Tools.explode;
    var isOldIE = Env.ie && Env.ie < 11;
    var TRUE = true, FALSE = false;

    return function (editor) {
      var dom, selection, formatter,
        commands = { state: {}, exec: {}, value: {} },
        settings = editor.settings,
        bookmark;

      editor.on('PreInit', function () {
        dom = editor.dom;
        selection = editor.selection;
        settings = editor.settings;
        formatter = editor.formatter;
      });

      /**
       * Executes the specified command.
       *
       * @method execCommand
       * @param {String} command Command to execute.
       * @param {Boolean} ui Optional user interface state.
       * @param {Object} value Optional value for command.
       * @param {Object} args Optional extra arguments to the execCommand.
       * @return {Boolean} true/false if the command was found or not.
       */
      function execCommand(command, ui, value, args) {
        var func, customCommand, state = 0;

        if (editor.removed) {
          return;
        }

        if (!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command) && (!args || !args.skip_focus)) {
          editor.focus();
        }

        args = editor.fire('BeforeExecCommand', { command: command, ui: ui, value: value });
        if (args.isDefaultPrevented()) {
          return false;
        }

        customCommand = command.toLowerCase();
        if ((func = commands.exec[customCommand])) {
          func(customCommand, ui, value);
          editor.fire('ExecCommand', { command: command, ui: ui, value: value });
          return true;
        }

        // Plugin commands
        each(editor.plugins, function (p) {
          if (p.execCommand && p.execCommand(command, ui, value)) {
            editor.fire('ExecCommand', { command: command, ui: ui, value: value });
            state = true;
            return false;
          }
        });

        if (state) {
          return state;
        }

        // Theme commands
        if (editor.theme && editor.theme.execCommand && editor.theme.execCommand(command, ui, value)) {
          editor.fire('ExecCommand', { command: command, ui: ui, value: value });
          return true;
        }

        // Browser commands
        try {
          state = editor.getDoc().execCommand(command, ui, value);
        } catch (ex) {
          // Ignore old IE errors
        }

        if (state) {
          editor.fire('ExecCommand', { command: command, ui: ui, value: value });
          return true;
        }

        return false;
      }

      /**
       * Queries the current state for a coaH`      L_   1LM_ 1A LM`H  xr  H    L:_Lz         LL    Aj`L  F`L 1A%`Hx   H      L^L      ^L         A   L_L       A   L_L    1A   Lt_L      1   LS_H;   H  xL1      LLM ^L1      A   LM^L1        LMJ^  r~L1    L]L1        L|^L     A   L[^L
1    AL]       LM]       A   L ^         Le]HH.L         HH\L       A   H          H[
   [}W~UHAWAVATSAII_{1    IHxh  % 8  1=   =       EXWIMtoh  LLHC@Hx
 HALaLL7HC@Hxh  LA	 xLW1[A\A^A_]UHAWAVSPHL{L*  IGP	     L|U9~H.  IGX	     HCH H   H(H0 1p9tHHHvHANHH@IFIH[A^A_]UH:  FH*  H2  HNH1]UHFHHNH2  H*  1]UH   r@4s1%*  $ds   =      H .  ]UH)  @)  ]UHAWAVATSH   Hp9 H HEAALgw HHiuHrt'H)9 H H;E   H   [A\A^A_]Et,ID$@18@HH D~tmHlu1A@H H$HL1E1Di^HN\8|Hu? 4zW~UHH  x$JuH%Pt	1]UHAWAVAUATSPIHA  sOI  Htt18\p   8rI   Htt18\ptj8rE1bH = D IFH pM~$H=!q8 E11LAA   IFH pH=p8 E11LQ|AAH=  thIFH pM~$AHq8 Hq8 HDEL%N6 LEH=1LMIFH1H=p8 L%QAH[A\A]A^A_]UHAWAVAUATSPI% 8   Hs?DD D:' %   =   uBD&'8  =   u.I   ,   A@ A   A   tI  H Htt1:\ptr8rH= D(IFH pM~$H=o8            
A*   	 N X:+AN6+x;+  aV 	P 
`+6 : >_ AJ".V 4 : >  	`/vN 	@ 
@ 

,4  ;;]:   SA   AH0Da% A  A	AL;v!G      A    H@DfeE9AfD;,vL@DH0fD;,      ;   KDsIHG      A    LIdHD)G   A    LDI{d   v  A&    L@L A  % 8  =    
  "    @     )ALG   A    LbfEtAH    HHuLG   1A    LHa=@    1LO    "    @   L #           L #    @   L       LL '    1L A  A   = @   =      tA  PrA     E  AM  ADHD0  % 8  =   t=     "        L
 #       L       LL       L     A  P   &    L "       L #    @   Li       LLO '    1L;       L'         =?  DHD0wA  tAG 	t	        LL     	    AG t	   A@   Zb   "          A&    L@Lf "       LO #    @   L8       LL '    1L
       L     
    "        L #    @   L       LL AG DHD0tugA@   ZbuZA  %   =   uF"    @   LM #       L6       LL '    1L
 A  =   r3      LL       L    AO t	f	 u1A@   Zb	   LDLD    LDk 5   p   LLO       L; DHD0A ?!  L Az  A    @  L AG    (     A   tA  = @  rA   thA  =   rY#       L       LLj       LV     	  LB (      1E1E1LAG&=  uOA  uEA8_(     B      LW A8_(      B   1L7 H"H$EH L"  <)     L X  ~fD;,L  A   DHL@1D9s E@!  H7 1fD;H!     H D9s ?   HD 1D9s  ?  D   H 
   ~$        H $  H ft-?KL    ~$  H@ rfu$  L   $  Lo ft-?KL    v~$  H@J rfu$  H@, tHH  HJ
   '~AMG      A    H@HLj[G      A    HDLPH[HH  xDuPH@   HHw PHH^ fD;Hu++H@   9  M 9AAN9M9AN   I%  	AG      A    HDLXEfD;,0C&=  I  A    A(     B      L      A9_ ?A   L 1A9_  ?  ,   L H"H$EH LJ     1E1E1LAG&=  t
=  u d   ~<)     Lw $        L` $  L| ft)?KL    ~$  L[ rfu$  LA   $  L, ft)?KL    3~$  L rfu$  L tHH  HJLA*u6A   t,A  =?  wA  sL<;AG&=  t=  '  HH      1A    LIW%  i HiQH5HPL1HL& A<   )A     r,A   A     1        A        HH  HK  Ap     Ix  Ht"At   uAt  $  Lg fL5i4 H4 1LH1LH3Q   L   HH        H         Hw, HH  H   A$p     I$x  Ht$A$t   uA$t  $  L fL54 H4 1LH1LH_P   L   H1Q   uH S      jjnYfjfjjjj^_]wWijv, HH$H5Sv, 1HH     uHHA_$A  A)AAE1IG8   Dsex  L   %     =   fFy  L D)y   ? A_$AA9{H5 H H;E  H8  [A\A]A^A_]% 8  =   S  =   DHD  "        #    @            LL           m A  % 8  =   DHD0t  "    =         L" #    @   L"         L     LL       L     
  "  @   L     Lu       LLL&     D    @   L- #       L       LL '     L       L"    @   L#         L     tS~UHAWAVAUATSPEHMIIH   AAu    H:       At0c   A   HMAuOO      s      g   A HMaO      wM   <O      s   A   HMO   g     HMN   w     HNAtD    k   AHL}MN { HMNAu"     1HH[A\A]A^A_] H[A\A]A^A_]UHAWAVAUATSH8AIH|?   t#AL=I4 1L8J   L HAHaa, 4@   1A    H   HELeLuH]IOH    H]HMHAHEDGAH   B)DzHUD2EE1E1DHU<H(Sh	  %F%6 PZ3CDD0!"AR 28XrE`D  P4aQ9EI$5a Ei"U@ U
AHb A9	0aai RT	!FH&/W3Y'""OVOB	+/J04BFe`WQd4&H!73QqHjEY@.:	@>2OHp*E<TF4Q!@ID$e=+(2 @0@! cj	GcBkEHC Z:bvbzFfk# "B @
 9	)	p0@ C@-ba3z# `% 'b(!T=2f
 c>!"9P  BCAb!	$( (1@(	I+#* Q2E!dh+C$6.vPdTNt"@ rNV0fT)) @dp\p	T_0hJ! ADa.TbU$TCC@V)D"+"PR  @ & K0f3Q!Q
aH H"'!$E!*V`Q	(X lXLP$|$2(L(#435 B)B@! !b(JS	2pO	 H H[-H@qD B2	e[SPF)"fE!FuRdP!
q09@D6 x
Go
  D~h` V
m- %  _^<H8BQif%HLuQJE]`]@BAR @$b@g.>i@.xS6.O00@# x h x
 1@BU`ANIg)b2-%$	AV/b9N PUd,YP  P c$4@I~ 3
sqD3h/(2 ;z5$"=G0s(3Tv>{:A h0YkTEm` L  kaDNbF@  |!5,lN	HLM
x@/# H4$AX 2EF	U"hpC VtM!(\1)tyd,X6MaaIP	 Ed.(0H>N @%-qI! HA`$&XC	@P%o	
b b D@@.FQDjv 	Xhai%0=b2Adq +yb8 Q<dB3@@ <PV,(]X. 2P,TrJ'`92H.#tiE8DBt%g'"%D.aaR`0RZ 1S \ a|(OA@; Ar8d 0#kaE&^@Ah_1B,tY qS[:!)Q
YN@V @D (D 	$c3m$@/P?L( tY HA&N3hh9B+d2PF(2Q6`)Qi,  t$NPp
AiN	 K x]r8Rp0b06B).B.@-gzDcxdMi"	648!:t"0F ay
 $6-`=5 L9	4&"1 $1a,whA "R!A  oPC@uC.[S&"a OI1@	6f1$!@
"	F! If
`"$*$B}6<+b1+&d1xb@4m4(_
eZ  K\1d|7*MM  _ J@DEt(B>hPhd6ggb xeT$07!K&3ppOUyVr*6! @")$ 9	|@C@ @d@H%	 " H!0Z(q 
$ !ih
9	D`e&  :Y@:(	1(V v H
!P  #Ag+CrQSCwG00 )	mXkA?c9RG>X0@$a#i	pU"Pd-.^! [hzd?Cj[I!cDQ&	FF  5B" D )T *Jqg   04A0v A6xK2  l!@FSH'TB@\0Y5) zd
0%:<q7@2Q "`x)1KV@  IP-0$ \*^@ 9@/1b7
5)p(r- `uy5N$ I6 0<C(.PLR"9dSj(C*l/@B00	  FEJC DF#eN!\q  (,n!T<Awp1
!bI	)Ip@hA :*C`aHEV&(f\GB"%5cBqh PB TD	D"S(0B6f1R@JK<0	D"eh@X0V*"^ 5B@$/
)r 1@" ]eQ#gu88EJT-j1&<q'r6>3E"c08?a# D% zA=k0/g  q(
 a<!HJ
l8(t H
p8'blc0vWLUTrL L Mh AS5e-:Q$L)6@"mFP D@4 G"3`X@B h 
|dTQ!Ab@T9D'I_8PpBh. x
0.f;
c F*A\h
j -(2:s&#c1R< { \R0)Fq!pS3)$h]P :XPtB5l I1A0	F2IP BBzI		 J&#@#d000uHu< C@Da+IR(<] 0!`1D0G!0
 ah4'(FhQ^ @KNi .\; 
 BU":8M@P$s %X$#  XEN<$H rp
PZ V"2Oa Hbtx@ 4* ){*AO73
@DfDR8&$c 2a#Y aIFD4A..K%EMt'5Hp"o8~. leName] || 0, 10) + intentValue) + indentUnit;
                  dom.setStyle(element, indentStyleName, value);
                }
              }
            });
          } else {
            execNativeCommand(command);
          }
        },

        mceRepaint: function () {
        },

        InsertHorizontalRule: function () {
          editor.execCommand('mceInsertContent', false, '<hr />');
        },

        mceToggleVisualAid: function () {
          editor.hasVisual = !editor.hasVisual;
          editor.addVisual();
        },

        mceReplaceContent: function (command, ui, value) {
          editor.execCommand('mceInsertContent', false, value.replace(/\{\$selection\}/g, selection.getContent({ format: 'text' })));
        },

        mceInsertLink: function (command, ui, value) {
          var anchor;

          if (typeof value == 'string') {
            value = { href: value };
          }

          anchor = dom.getParent(selection.getNode(), 'a');

          // Spaces are never valid in URLs and it's a very common mistake for people to make so we fix it here.
          value.href = value.href.replace(' ', '%20');

          // Remove existing links if there could be child links or that the href isn't specified
          if (!anchor || !value.href) {
            formatter.remove('link');
          }

          // Apply new link to selection
          if (value.href) {
            formatter.apply('link', value, anchor);
          }
        },

        selectAll: function () {
          var root = dom.getRoot(), rng;

          if (selection.getRng().setStart) {
            var editingHost = dom.getParent(selection.getStart(), NodeType.isContentEditableTrue);
            if (editingHost) {
              rng = dom.createRng();
              rng.selectNodeContents(editingHost);
              selection.setRng(rng);
            }
          } else {
            // IE will render it's own root level block elements and sometimes
            // even put font elements in them when the user starts typing. So we need to
            // move the selection to a more suitable element from this:
            // <body>|<p></p></body> to this: <body><p>|</p></body>
            rng = selection.getRng();
            if (!rng.item) {
              rng.moveToElementText(root);
              rng.select();
            }
          }
        },

        "delete": function () {
          DeleteCommands.deleteCommand(editor);
        },

        "forwardDelete": function () {
          DeleteCommands.forwardDeleteCommand(editor);
        },

        mceNewDocument: function () {
          editor.setContent('');
        },

        InsertLineBreak: function (command, ui, value) {
          // We load the current event in from EnterKey.js when appropriate to heed
          // certain event-specific variations such as ctrl-enter in a list
          var evt = value;
          var brElm, extraBr, marker;
          var rng = selection.getRng(true);
          new RangeUtils(dom).normalize(rng);

          var offset = rng.startOffset;
          var container = rng.startContainer;

          // Resolve node index
          if (container.nodeType == 1 && container.hasChildNodes()) {
            var isAfterLastNodeInContainer = offset > container.childNodes.length - 1;

            container = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;
            if (isAfterLastNodeInContainer && container.nodeType == 3) {
              offset = container.nodeValue.length;
            } else {
              offset = 0;
            }
          }

          var parentBlock = dom.getParent(container, dom.isBlock);
          var parentBlockName = parentBlock ? parentBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5
          var containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;
          var containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : ''; // IE < 9 & HTML5

          // Enter inside block contained within a LI then split or insert before/after LI
          var isControlKey = evt && evt.ctrlKey;
          if (containerBlockName == 'LI' && !isControlKey) {
            parentBlock = containerBlock;
            parentBlockName = containerBlockName;
          }

          // Walks the parent block to the right and look for BR elements
          function hasRightSideContent() {
            var walker = new TreeWalker(container, parentBlock), node;
            var nonEmptyElementsMap = editor.schema.getNonEmptyElements();

            while ((node = walker.next())) {
              if (nonEmptyElementsMap[node.nodeName.toLowerCase()] || node.length > 0) {
                return true;
              }
            }
          }

          if (container && container.nodeType == 3 && offset >= container.nodeValue.length) {
            // Insert extra BR element at the end block elements
            if (!isOldIE && !hasRightSideContent()) {
              brElm = dom.create('br');
              rng.insertNode(brElm);
              rng.setStartAfter(brElm);
              rng.setEndAfter(brElm);
              extraBr = true;
            }
          }

          brElm = dom.create('br');
          rng.insertNode(brElm);

          // Rendering modes below IE8 doesn't display BR elements in PRE unless we have a \n before it
          var documentMode = dom.doc.documentMode;
          if (isOldIE && parentBlockName == 'PRE' && (!documentMode || documentMode < 8)) {
            brElm.parentNode.insertBefore(dom.doc.createTextNode('\r'), brElm);
          }

          // Insert temp marker and scroll to that
          marker = dom.create('span', {}, '&nbsp;');
          brElm.parentNode.insertBefore(marker, brElm);
          selection.scrollIntoView(marker);
          dom.remove(marker);

          if (!extraBr) {
            rng.setStartAfter(brElm);
            rng.setEndAfter(brElm);
          } else {
            rng.setStartBefore(brElm);
            rng.setEndBefore(brElm);
          }

          selection.setRng(rng);
          editor.undoManager.add();

          return TRUE;
        }
      });

      // Add queryCommandState overrides
      addCommands({
        // Override justify commands
        'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull': function (command) {
          var name = 'align' + command.substring(7);
          var nodes = selection.isCollapsed() ? [dom.getParent(selection.getNode(), dom.isBlock)] : selection.getSelectedBlocks();
          var matches = map(nodes, function (node) {
            return !!formatter.matchNode(node, name);
          });
          return inArray(matches, TRUE) !== -1;
        },

        'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function (command) {
          return isFormatMatch(command);
        },

        mceBlockQuote: function () {
          return isFormatMatch('blockquote');
        },

        Outdent: function () {
          var node;

          if (settings.inline_styles) {
            if ((node = dom.getParent(selection.getStart(), dom.isBlock)) && parseInt(node.style.paddingLeft, 10) > 0) {
              return TRUE;
            }

            if ((node = dom.getParent(selection.getEnd(), dom.isBlock)) && parseInt(node.style.paddingLeft, 10) > 0) {
              return TRUE;
            }
          }

          return (
            queryCommandState('InsertUnorderedList') ||
            queryCommandState('InsertOrderedList') ||
            (!settings.inline_styles && !!dom.getParent(selection.getNode(), 'BLOCKQUOTE'))
          );
        },

        'InsertUnorderedList,InsertOrderedList': function (command) {
          var list = dom.getParent(selection.getNode(), 'ul,ol');

          return list &&
            (
              command === 'insertunorderedlist' && list.tagName === 'UL' ||
              command === 'insertorderedlist' && list.tagName === 'OL'
            );
        }
      }, 'state');

      // Add queryCommandValue overrides
      addCommands({
        'FontSize,FontName': function (command) {
          var value = 0, parent;

          if ((parent = dom.getParent(selectio_XrU/SE}ECbwU|=g~;lA`tBz"}joW0&1_UV9-Uu}O}~_t;ySwmn_}+~77}o|?O{Ow;5wo~crwWk_;hwSTv{}{Ft4#[_ckhu^$#g;},N1__-{;W'"k:6O|y=.dXux9gg5(yS{{wrkzNi[tS>v>^>?|1vjhZ&8_w3~mv};w"qy~WN;noy#tuw=CA/l~Tx1{~cmzsqER/(s2/[fNm[^2=	9q_YO\7G~v9y{Bzo}*Wyd??oz{s/z_Om~\f~|gv_y{}<+g?l^6wTkx,_/cUh/}owM~oOsiov~vNkUdl&GUMsoc>Q.S=}]oL-:'E?UYyi_oONwovKgy~?o:_~'?wok};Wt{X\v|_~];ngfm}_Qu?E~nGw2	_>nW{__~`wzy'}ZiswI^6Aw_?_{D_gz.Mg3?ZZ^?OWtM@5hz}vV7y_y?n~c}udj"^TX}[sW}[vU/;4o\k"v3<TfM_fd'Pt{ON~{yG-=2Zig:r;w+vzN=wrzGor=z}t'[s2=u_K_S~ms]SU0S6r}e~.}9	-9{!_}I-I}Le=9[>om[w3c~_w'Rnu6Go
+m=\[.Q9UX?_t^g_mx,{~m?_hYw?7~V-3~ww8#P|oxWy"_?~gg{~Jw3S_7mk{?=}zzI&_4g>/W+nwV7~3i>o1O%oY_unCG}#w~;\7g`/>^MuojeVkOo_i|}G4kJEi}u5l'<wS?uNkoWYayxs*Nok?[}sY}O+}ou?_\_N_k/zbw{q.3U/_mku22TR=/I
)w_~^.MQ}.]J>tO??o]{A}oh{k[z%r+sOk3eX?bZ[8^NWM]xC:6?oW\VCS	3wf}e{t>{ueqg=Y3y\lvwC]7\Cc?'0+[5?{_ty}44jb?>o0wQ}M5vLeu1zwJ_S_;]=O.nb.5j>}k|{>~}
C}fZr9>uoeS~~p]I#6B>^ewuv&_<^S-JliNtGG{nW!{;/g~=bwo:}1>>ok]pJ[~_]w
3wyVoVg-VL_smKoO}7}?pW.mw&-U<n^+?^_ 7_wglw{=:_[ZW|k_?o<k?H|r]:kf_&4y+~fripAu;y?)~|m,[O|>UD[dRm vcog/~ZL_o/z/o_S^:sO?<-s~$=inQ>;uGv-n#n_|{m5/ioO=_Zwb{9c-GN?}o}]<xWYusw_`k,]~?[K;^~s+/s])7v>noekrW_o.]dW&{v]{f3
f%V:>~F=7.{zzWu~:u;vOOug6t?=v$O?pf~ZM%;yM[_aOo]w1&xgz$-WdNpzNN	yl/'Wm^OK>i=a]~kWc+|t+_sUz,G/3}O}/]mswOo=7~}7~mn_1'}o xK^$_7(CMO-wsr^d~0W{9zOUKD[q;w?LG{Q~~#3|UY8?n:7&]~.OWsWo.q[}m}>?>snuci~YX!n;.=?tjO{?}W7jS!sMWiW=ZZ\i6GodLCs,Wq[_5_UuzW{{k|g7^-S{;aw-w|o?w9-#w>q7yuMx9;yx[ou:]n,W`9S8$s[>/wov=[cm<IWi3&J
{>CoAwkcMlCvOk-oCy^z9vl_p{J'}0/)lWv:|t~k&[z:o<7Z/-"Zn7aZw;OWw{,vn4|[ +~f?_/d=!}Z>5;5}cQ;H+Y;)_}-zes/]B^hV|NguC6Vyw:v=Xmr}:DX#_`+nzigO:z(?3oFo3}jlwuwo=7_n?<vovV}so}Wn{6{|xj}|;T4m~Vs3]3811%wv3JsoO48}8H/^~Ww~{HcMOi[_^kwwwz7-8zEencoyw<Eq6a_/TRUows}$!^\RVq[[{\/^wiey]aJmU4[ny:OQ_s|jm[}7S;?y~t}=zug<n|5sc'K73}SougN>]?.]AUFn7^^7~?Fo?scKrV.vv{8;{/.nPFrv>w?v7n>UTVj.wc|Q)Yz\vjmuV{D{}Hr\sg?Fv^^w63~?vzC\o=g{}vR;sP]s~gwmMnO	nN~}~}}O<7/Fro<ciOn{Oot\d*j{Zh&n}~Wd{_~/wDh5uf]zC}P8~k|pfiJl%[}?7OovW^N	Op}}>_vV=*x2DCT?9uX!{Py/HO[7o~x/|=g>6S#k7\'7JOkxWzS5Hy_zJ]r`Ans[5`j/i/'l??)e}w[S9Jm__7v?7modsL{.UWu|?];'/_Sy^w^yw_]_{o;iY?H-GeKVTZ;v;O)+_Wv;3t=tVc/~o^u1[3Z}P|?~|W(7Pv3_bookE_t7Bwh]fUi_4wD_E}b53CMM7Hm][])=?V3:}$Z7Osw?[G<7~*/_NRx-mZ}>|omp{o/7.~SosWfz]VWDN+~yut9_-}6vNzwE1@ni-x7dS|P]w\w}\U:U~>s3b^}{vk_*-S_Wmwfn{Rz}/{;}'cZ]oqg}U?|:q=<_lz>K/ymU={75}>o^?UwSB~o~<A~wo~~Y@wt=;RO-}:'cn6$yz'_Y_/7x~KFkOvg1&ON~wn=w?qy;_:v\Ix$}  if (i >= items.length || base[i] != items[i]) {
              breakPoint = i + 1;
              break;
            }
          }
        }

        if (base.length < items.length) {
          for (i = 0, l = items.length; i < l; i++) {
            if (i >= base.length || base[i] != items[i]) {
              breakPoint = i + 1;
              break;
            }
          }
        }

        if (breakPoint === 1) {
          return path;
        }

        for (i = 0, l = base.length - (breakPoint - 1); i < l; i++) {
          out += "../";
        }

        for (i = breakPoint - 1, l = items.length; i < l; i++) {
          if (i != breakPoint - 1) {
            out += "/" + items[i];
          } else {
            out += items[i];
          }
        }

        return out;
      },

      /**
       * Converts a relative path into a absolute path.
       *
       * @method toAbsPath
       * @param {String} base Base point to convert the path from.
       * @param {String} path Relative path to convert into an absolute path.
       */
      toAbsPath: function (base, path) {
        var i, nb = 0, o = [], tr, outPath;

        // Split paths
        tr = /\/$/.test(path) ? '/' : '';
        base = base.split('/');
        path = path.split('/');

        // Remove empty chunks
        each(base, function (k) {
          if (k) {
            o.push(k);
          }
        });

        base = o;

        // Merge relURLParts chunks
        for (i = path.length - 1, o = []; i >= 0; i--) {
          // Ignore empty or .
          if (path[i].length === 0 || path[i] === ".") {
            continue;
          }

          // Is parent
          if (path[i] === '..') {
            nb++;
            continue;
          }

          // Move up
          if (nb > 0) {
            nb--;
            continue;
          }

          o.push(path[i]);
        }

        i = base.length - nb;

        // If /a/b/c or /
        if (i <= 0) {
          outPath = o.reverse().join('/');
        } else {
          outPath = base.slice(0, i).join('/') + '/' + o.reverse().join('/');
        }

        // Add front / if it's needed
        if (outPath.indexOf('/') !== 0) {
          outPath = '/' + outPath;
        }

        // Add traling / if it's needed
        if (tr && outPath.lastIndexOf('/') !== outPath.length - 1) {
          outPath += tr;
        }

        return outPath;
      },

      /**
       * Returns the full URI of the internal structure.
       *
       * @method getURI
       * @param {Boolean} noProtoHost Optional no host and protocol part. Defaults to false.
       */
      getURI: function (noProtoHost) {
        var s, self = this;

        // Rebuild source
        if (!self.source || noProtoHost) {
          s = '';

          if (!noProtoHost) {
            if (self.protocol) {
              s += self.protocol + '://';
            } else {
              s += '//';
            }

            if (self.userInfo) {
              s += self.userInfo + '@';
            }

            if (self.host) {
              s += self.host;
            }

            if (self.port) {
              s += ':' + self.port;
            }
          }

          if (self.path) {
            s += self.path;
          }

          if (self.query) {
            s += '?' + self.query;
          }

          if (self.anchor) {
            s += '#' + self.anchor;
          }

          self.source = s;
        }

        return self.source;
      }
    };

    URI.parseDataUri = function (uri) {
      var type, matches;

      uri = decodeURIComponent(uri).split(',');

      matches = /data:([^;]+)/.exec(uri[0]);
      if (matches) {
        type = matches[1];
      }

      return {
        type: type,
        data: uri[1]
      };
    };

    URI.getDocumentBaseUrl = function (loc) {
      var baseUrl;

      // Pass applewebdata:// and other non web protocols though
      if (loc.protocol.indexOf('http') !== 0 && loc.protocol !== 'file:') {
        baseUrl = loc.href;
      } else {
        baseUrl = loc.protocol + '//' + loc.host + loc.pathname;
      }

      if (/^[^:]+:\/\/\/?[^\/]+\//.test(baseUrl)) {
        baseUrl = baseUrl.replace(/[\?#].*$/, '').replace(/[\/\\][^\/]+$/, '');

        if (!/[\/\\]$/.test(baseUrl)) {
          baseUrl += '/';
        }
      }

      return baseUrl;
    };

    return URI;
  }
);

/**
 * Class.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This utilitiy class is used for easier inheritance.
 *
 * Features:
 * * Exposed super functions: this._super();
 * * Mixins
 * * Dummy functions
 * * Property functions: var value = object.value(); and object.value(newValue);
 * * Static functions
 * * Defaults settings
 */
define(
  'tinymce.core.util.Class',
  [
    "tinymce.core.util.Tools"
  ],
  function (Tools) {
    var each = Tools.each, extend = Tools.extend;

    var extendClass, initializing;

    function Class() {
    }

    // Provides classical inheritance, based on code made by John Resig
    Class.extend = extendClass = function (prop) {
      var self = this, _super = self.prototype, prototype, name, member;

      // The dummy class constructor
      function Class() {
        var i, mixins, mixin, self = this;

        // All construction is actually done in the init method
        if (!initializing) {
          // Run class constuctor
          if (self.init) {
            self.init.apply(self, arguments);
          }

          // Run mixin constructors
          mixins = self.Mixins;
          if (mixins) {
            i = mixins.length;
            while (i--) {
              mixin = mixins[i];
              if (mixin.init) {
                mixin.init.apply(self, arguments);
              }
            }
          }
        }
      }

      // Dummy function, needs to be extended in order to provide functionality
      function dummy() {
        return this;
      }

      // Creates a overloaded method for the class
      // this enables you to use this._super(); to call the super function
      function createMethod(name, fn) {
        return function () {
          var self = this, tmp = self._super, ret;

          self._super = _super[name];
          ret = fn.apply(self, arguments);
          self._super = tmp;

          return ret;
        };
      }

      // Instantiate a base class (but only create the instance,
      // don't run the init constructor)
      initializing = true;

      /*eslint new-cap:0 */
      prototype = new self();
      initializing = false;

      // Add mixins
      if (prop.Mixins) {
        each(prop.Mixins, function (mixin) {
          for (var name in mixin) {
            if (name !== "init") {
              prop[name] = mixin[name];
            }
          }
        });

        if (_super.Mixins) {
          prop.Mixins = _super.Mixins.concat(prop.Mixins);
        }
      }

      // Generate dummy methods
      if (prop.Methods) {
        each(prop.Methods.split(','), function (name) {
          prop[name] = dummy;
        });
      }

      // Generate property methods
      if (prop.Properties) {
        each(prop.Properties.split(','), function (name) {
          var fieldName = '_' + name;

          prop[name] = function (value) {
            var self = this, undef;

            // Set value
            if (value !== undef) {
              self[fieldName] = value;

              return self;
            }

            // Get value
            return self[fieldName];
          };
        });
      }

      // Static functions
      if (prop.Statics) {
        each(prop.Statics, function (func, name) {
          Class[name] = func;
        });
      }

      // Default settings
      if (prop.Defaults && _super.Defaults) {
        prop.Defaults = extend({}, _super.Defaults, prop.Defaults);
      }

      // Copy the properties over onto the new prototype
      for (name in prop) {
        member = prop[name];

        if (typeof member == "function" && _super[name]) {
          prototype[name] = cremM7>z}zO}&H~~j{5y{{;x5{OvkTP[oEM/Z5{{b"
-t6!Q@0:P2(04QXA8D x!JJ" !w*`r.hBBxt(vI@ PEJV%  ;[mZx5A)0	dTLE Nd2^(Oa/..QWLg0P"5[,A "N)B`^@WW N@cc*X~1/uF)|H(
B^( 
uH	P	R4x#K|Wn}|>3*4_]{[m7=_ym.{{=7}/n\myt{v6.K3?(k/^ eF1C6 DD#8D<@JD4)A! gD
 $i"~D0$ P@=@:0Z ,V	U8pKJb(>=qj^J,U=}	wg~s^_O3?<%rvOS%~t{w{|{W|;Mv6=2[7(X&VOn?}~;SeS%f+:}=#YzOZy(H 9%XR&L@f	!e6EHx&P8(( ;0X>=BrBx,S7	G0pfF +#fvSdpB^U=JY#F D&:_omw^?#}..nv5zr>}x<?}nY)~5(Z~e+:/=E00C63Bu4 EUN53Rc3 $YDB	4b"/')H	Cy@((,T& ]P%Xs`%k !X	b -Kbr GD#T@u$M0cQE aX(E`
p"H!j	@*R !C@PD  X y "`D6&!"j_-hjw7>:n;s?_lwu;wwOlY?LZ<nl~{X~)" 4:EKh-4K "!'HGq Lp7$6*,"L#4!F1qr1"PEXa* D #C@i5D)8%P!DH"d(}`s;{~_WNny5W0I%{u_~z"osj3?l};nmcp/YsY!ivnOX:[zwWo_S_o\^s=v_@'B6U`\	(Q,1
6
Vt-P|qHV"`S
..@kDX$ eJ
F7h)N"V<' &8.6r& *
 -tBj!?nU[fod{vgGgekwG?7]7V;_USECnk5~9o?MW;C@sSGYYDS6a4JJvdQ*D0 
4@@
J0DgX% B#N WP$P^8 \f=	 o$PeP: 4TH8@@ 
DhA=$QezT4(E4H@"8v 5TA\apEc&`V28H( V05SSKP)QX#'U___-{[~I{{WMu6{}_scsWL<o~sNz^}3y?_vTZ'ov%b&
j|IBF`
2|HD6BB #D 4+ Q@! C6'Q"2*uDpX%4K$"pgO>+@AMAE
fzm[_??Y'\wQc;k?~;;uu>}Wt[u??WSwuryn_>V6-O~8ys<c?oGU%};m5O~iGe
L1SD0w @!/hIKeB	h1~DQ`!0d0CXTiun@QB p*DYl sc@B K/VQ@ -o?)i]{|~wse_Aoiox^?|w{6iC4y?gU7A p6rhtdB, c2aq2&%
SgiaBB"F B^A*GNsd@b;*51X`l2A% 
DGD[ "kQDX5GUXB^|$
x@=	 @H"	 EH;`"*"B#D#+B @>"2OktP-`A "+< 7v/.x<us^/0l\w=>u^W{?zAO=?fm_)WC\yiyIaml41HM	)v0D PHagJ`[DNpNk gEfTEDP A:y,o`5	DD-(91PI6yM	! Z)
b({>C[g<l;m<^p=Ut5msV#[[Gk3fy{[UkgKhh;?i_S%<^(;X58nG]Kw-~k}%z0Nlndh
Hx` B\	46`(T05bLDQT& '"q"lWKie4 T'
<
\*-L(IPJ!rXL!\<@T( 	:I	A"<t  kPplI@ `ctxDB*!xD+*VD" 4Htq@|E!Db	&BE!?PzTD&a@|A5TWb"<0*$Nf
{t-! 
 @
X=bD+  Q10(,T(	i"!:4qE*2HbM4J"3Ou!Y;@WLb]:6g@4`/;Yv'TB *xCvpS .	UGrH!25cfCp$$b"O4\&?Z 	 	@+QJ)&h.  4M:!=82,C8bH: , `BXRe "$@j5E8j P0MX <$%[VXTW BfVjAE5
3(A8 (&B# !`1CU(
yvV)I  z5K/vB		L@&63 )lJa*0X%J+AtSv@uH\7B@7D	! @"M!)P P F($ B &"!\@-aX  Jh{E"e%VP0l$3HPB%h`8 @Vg`A7  (FrRV( TI    `J[(D@q(DHr`P <bl?9 fH0  8@K7 WsR1L{hFq4j&/@JqJal3 }GS.&@ 
X=#6X@T`0 SR"MK
 B*X@+MB6@E  (B($@2A h)b  @eXXATP	 QPB /8b@0$`B  pH0rD D2V -p)I-OK+A5!)k E"+Dp* d;I`*D b`MAbj` YBaLn6o k$ [-"HU7v-tH4FZ|AO) Bj@P@d@y&Px` A4Ris0}E0H@PB2rs.PBaDp$K( /lHD N0	 dJ@#~av=Tb "@"%V4"O B@eW  	@IN g 
Ht9bCdA<ph
A/ +AFb0rd`bzF"N
XI"W1k(D &.b ,!P#jv X% DQ(@S  zbD54AID|U@&TvHJ0FNkFJ22)|#D  }(b*f@qIM@ZB p *`2C0 B1 h1200hF$f0"(DA`b`1"k$M!Dw+v@$X#H54KG<` 4G`$E	#EQB`QF:ZR4`I#$@u
 a4P\ ` r 8b&Hae
f	!n.P` *M 4$o !"PZGC
(8L K	PDF *QDQ a 6

*P`xJC3 bSyJ`0Q@$-%9 75r$T]g(2 &B,P("h ],BDC@G" `(5D
"
<Z"2,JSxF CiH)f 2 {p DV JH$ApF53@B(Fj@O"@#p,hCD( E""XD?1A ANP0Jt$bRw5G2$$ `4	T^BLDf%@@B"G%Z 4@$^(](buA,6Q!S1	`a  @ A $:A	Db@2`!D`QE8*9DY`   ]!  Ae <CF(Q# %vpKIP Cc U	@ DC*E !/L
@4,QH`U&$)D"`I#pL%b,n./V4]"o--sK qB<	@WCP;XpA  i \Z (4,B)@(5"Dy$SDHPe
@@EKR !$5.P F)	F8T	 3(W&dhTB R*U@z'!PPBp)[J Q`)3g'KtT(d	 89`^ B 54,@\YW\U HY	<(TTZ9#X
	q(s! !"(p6Nb ,CJB C(7(L*1))@2!132`V6vT)s`@ )C$ J @`B1A9Rnc(M'1'< $UB bE@RD(	E	J@+R(G	d8
T5,f8  >S$@C xHqPmZ0.!h`+(R96Tw1 Cdrf"2*pvD0;!$:/+lG((D*	YMpQCVQD $U /P*X!@`v MbV$ c(	P7R =@[(Q@s@\@.bVX-2C/ CH,)}-  dL`Hq(KRz'-v
%WB" 
C   @ (	 lIH#d)!  b9$@7C,  B" W.\c-(s%v()KTa G	H(	<1eFHn,@%$*d@L @*1q*FJQd$8c`_U3AL0!2:ip FD%8YE   \$c(fA~1 (IbD+8JL	J,	d3z`"IM4	Q"V6A*P AH 	 EW\`cI@ R	`x I ,HME|"CA B^x$@$(,ADr b:t| 29 TK@Bbdt})	HRg"f%4$QC UP@ *&	T+ IqI8c>WJ@@56P-5B@! W@(	A * mt(P$:R) X) c A8QdF0EH	!	 
`)IfF y=86$ `Na@P"0I+ K 
K 8jRD0!7vp- cerZd*e2\@CF*G*d	CyBX<PHcSkf!5US"
IpD$ N;PFBaB1A
gB"
w?] / 8,HEmxBS``"N,VB
 TEn8d6	$ )X%@Lp&Q{IR'	`!((X v<
E5,K*  h%F4{
 F	*,STq`	 "&D0
D` (|%K#@%!@DPP&Q2T	@&X,TDIA \F" (3Z8JB1HSL 6 C"x\f'Lch	u 9 g $##  r@" H/aB	` c4  F\BDqE   06@ @ #p0Yld9A) BIpG`(_PFdB@!  p
~EHM P!d tH$N@AJh{`
[WEGzhYrIH9
Q8
E  08TJHITMEDBbx428-v9jzDI[0	[@V$@ @hV&v&yxJBHj L@dW5 7L@r7C.  #P4 I('nj
 ^KT0bnPB01!)ZE@a$H.Pto : "R( @yI+P@mg!81Ea>,D0,[(Kx"t'd`847&y s	H 6	Te3bhO9  zy\! [J
q
P&xa"zfuBAJ[(!M`8C	~AA:
2	nAO*l4/"90!IH4a<h!A*# BuJ@T
OLr 9ji(YfTDT*$"n L $8Kx@rU
dnBE ZRr8QA<29#1X'Qk(&$
 5/`Zp(PcX;0@hiQ! l \I;dx`qi@fc)X9xC0X("<(5A B`,0FF"gM t0#bRrLT&8@Bd		p_
   BjdeBN(,8 h Td a
a
"\WicE0(!b@D(D9@kUYY	!eC  
@$%""a ) 8zV
 
) l@@IjA,p!0eGHD:  Q@T`BLDh0 $@m "$]Cyfh0@G
8(!(	` (0 ($"  U ("E.I H`=b.t$ hT=Iu(#Z~z#	@lBKPmP1jRV@PfAEb8:D:0Z8*lUAe3`1A`%\!=n X%$0ZA	 LLD<f"+b"S6Z6ZCP%D(r
AXtH!D*`qvC8`  "[8

|Dr" a
`
\WV=Vuv7)(^8t^"* iBN2z! *V1'~	- Dl^YpY
*2 fD@D
*4@!Ehs`:Hk0`jD &ALI0<@'F"z>Y	F1K!PfD1U`R^% t)F@@`=! 
 2dD2  $   L1H@0	[ P$[F
%  ICb@Cp$C,a  [1H @$Q":zJG	i,JM
EDO3tP$ `PwC
@R2Z@!W(fCVl"RgB :C6,^x5'#n @8` <H1k" `<`DPU	 je * .6 P"!Ah*JC"	/Ym\0
sZ,{)#\X$\	J$%PHHAi 	SU @Yi<i
Ck #
pY&$FBx TH5 `I
W(>Zb >X)Ry ,y8f %% Pck	1~GuCA@Q/Q 	r$t8,{ H`j
01OKZp`?Tb'LX !P!: %4$R$Nvs  #<C
0	*Y
 CAC	 CT `"	BD!)B0
4 D!`( !vHH8 fK&T*%< @LA#" T%(1DILSd4"sW@hDX  %E4$1,r2)A
+ qN0qy.JQ Rhb6& CT	1R
5hbC %cS @KAc
0Q4 *PSj`WVd$V%'6SBdl3A|K0.l4 $TA>+R@A4  
BePA+bFPs
	$T-@x8)HPu	H)8"^2     ubd &$ aL**d$P ``4@BP P
r @ ! d)01U"u7VJip'H5)cQgFH%x'U"T	{
DlB0J  (%6pD@AGKL$f WB-rGYi8  'd.`TG`
F|F]?}0S$EyC $iI*Q(b (1 H4!@$G Sq$f 
0R)1T	,@@#$
2Bt, 5	A:@ 9.8
M]&/B$(J j`A0- ,48 0!<b1#r68!0]d%7 	PphH!RFR H7,GC^y1~4 L=LEP C80 mO!$|VY@Kh dBl.5#Rs#3U`0AS	QPXf@8 6C by name
       * instance.off('event');
       *
       * // Unbind all events
       * instance.off();
       */
      off: function (name, callback) {
        return getEventDispatcher(this).off(name, callback);
      },

      /**
       * Bind the event callback and once it fires the callback is removed. Consult the
       * <a href="/docs/advanced/events">event reference</a> for more details on each event.
       *
       * @method once
       * @param {String} name Name of the event to bind.
       * @param {callback} callback Callback to bind only once.
       * @return {Object} Current class instance.
       */
      once: function (name, callback) {
        return getEventDispatcher(this).once(name, callback);
      },

      /**
       * Returns true/false if the object has a event of the specified name.
       *
       * @method hasEventListeners
       * @param {String} name Name of the event to check for.
       * @return {Boolean} true/false if the event exists or not.
       */
      hasEventListeners: function (name) {
        return getEventDispatcher(this).has(name);
      }
    };
  }
);
/**
 * Binding.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class gets dynamically extended to provide a binding between two models. This makes it possible to
 * sync the state of two properties in two models by a layer of abstraction.
 *
 * @private
 * @class tinymce.data.Binding
 */
define(
  'tinymce.core.data.Binding',
  [
  ],
  function () {
    /**
     * Constructs a new bidning.
     *
     * @constructor
     * @method Binding
     * @param {Object} settings Settings to the binding.
     */
    function Binding(settings) {
      this.create = settings.create;
    }

    /**
     * Creates a binding for a property on a model.
     *
     * @method create
     * @param {tinymce.data.ObservableObject} model Model to create binding to.
     * @param {String} name Name of property to bind.
     * @return {tinymce.data.Binding} Binding instance.
     */
    Binding.create = function (model, name) {
      return new Binding({
        create: function (otherModel, otherName) {
          var bindings;

          function fromSelfToOther(e) {
            otherModel.set(otherName, e.value);
          }

          function fromOtherToSelf(e) {
            model.set(name, e.value);
          }

          otherModel.on('change:' + otherName, fromOtherToSelf);
          model.on('change:' + name, fromSelfToOther);

          // Keep track of the bindings
          bindings = otherModel._bindings;

          if (!bindings) {
            bindings = otherModel._bindings = [];

            otherModel.on('destroy', function () {
              var i = bindings.length;

              while (i--) {
                bindings[i]();
              }
            });
          }

          bindings.push(function () {
            model.off('change:' + name, fromSelfToOther);
          });

          return model.get(name);
        }
      });
    };

    return Binding;
  }
);
/**
 * ObservableObject.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class is a object that is observable when properties changes a change event gets emitted.
 *
 * @private
 * @class tinymce.data.ObservableObject
 */
define(
  'tinymce.core.data.ObservableObject',
  [
    'tinymce.core.data.Binding',
    'tinymce.core.util.Class',
    'tinymce.core.util.Observable',
    'tinymce.core.util.Tools'
  ], function (Binding, Class, Observable, Tools) {
    function isNode(node) {
      return node.nodeType > 0;
    }

    // Todo: Maybe this should be shallow compare since it might be huge object references
    function isEqual(a, b) {
      var k, checked;

      // Strict equals
      if (a === b) {
        return true;
      }

      // Compare null
      if (a === null || b === null) {
        return a === b;
      }

      // Compare number, boolean, string, undefined
      if (typeof a !== "object" || typeof b !== "object") {
        return a === b;
      }

      // Compare arrays
      if (Tools.isArray(b)) {
        if (a.length !== b.length) {
          return false;
        }

        k = a.length;
        while (k--) {
          if (!isEqual(a[k], b[k])) {
            return false;
          }
        }
      }

      // Shallow compare nodes
      if (isNode(a) || isNode(b)) {
        return a === b;
      }

      // Compare objects
      checked = {};
      for (k in b) {
        if (!isEqual(a[k], b[k])) {
          return false;
        }

        checked[k] = true;
      }

      for (k in a) {
        if (!checked[k] && !isEqual(a[k], b[k])) {
          return false;
        }
      }

      return true;
    }

    return Class.extend({
      Mixins: [Observable],

      /**
       * Constructs a new observable object instance.
       *
       * @constructor
       * @param {Object} data Initial data for the object.
       */
      init: function (data) {
        var name, value;

        data = data || {};

        for (name in data) {
          value = data[name];

          if (value instanceof Binding) {
            data[name] = value.create(this, name);
          }
        }

        this.data = data;
      },

      /**
       * Sets a property on the value this will call
       * observers if the value is a change from the current value.
       *
       * @method set
       * @param {String/object} name Name of the property to set or a object of items to set.
       * @param {Object} value Value to set for the property.
       * @return {tinymce.data.ObservableObject} Observable object instance.
       */
      set: function (name, value) {
        var key, args, oldValue = this.data[name];

        if (value instanceof Binding) {
          value = value.create(this, name);
        }

        if (typeof name === "object") {
          for (key in name) {
            this.set(key, name[key]);
          }

          return this;
        }

        if (!isEqual(oldValue, value)) {
          this.data[name] = value;

          args = {
            target: this,
            name: name,
            value: value,
            oldValue: oldValue
          };

          this.fire('change:' + name, args);
          this.fire('change', args);
        }

        return this;
      },

      /**
       * Gets a property by name.
       *
       * @method get
       * @param {String} name Name of the property to get.
       * @return {Object} Object value of propery.
       */
      get: function (name) {
        return this.data[name];
      },

      /**
       * Returns true/false if the specified property exists.
       *
       * @method has
       * @param {String} name Name of the property to check for.
       * @return {Boolean} true/false if the item exists.
       */
      has: function (name) {
        return name in this.data;
      },

      /**
       * Returns a dynamic property binding for the specified property name. This makes
       * it possible to sync the state of two properties in two ObservableObject instances.
       *
       * @method bind
       * @param {String} name Name of the property to sync with the property it's inserted to.
       * @return {tinymce.data.Binding} Data binding instance.
       */
      bind: function (name) {
        return Binding.create(this, name);
      },

      /**
       * Destroys the observable object and fires the "destroy"
       * event and clean up any internal resources.
       *
       * @method destroy
       */
      destroy: function () {
        this.fire('destroy');
      }
    });
  }
);
/**
 * Selector.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/*eslint no-nested-ternary:0 */

/**
 * Selector engine, enables you to seleck_wN&l27wys[|oW8t}Of_wu&jgsXgnk_^)%6vh&=M_[B?[w>}f2~OV}}d#O@P]{|{fSYwA>dUB}Vs[<}Jdk^;_r{Zo?ySU7a<%Y|M~gKX91]wM|GL}|K>on?OVeoUk-L}^FZK/:V2WFw=ooC}wUo(^&om3{[?{4j>;Q Z;qc=l7VU:v&//{78A4vpc7TUG+7}Z]ZQUIR}s,_.m=}]qo\da1u?hwuIU/?UxSm9>uo?)g^_N{_?E}wOKOW8A?>g_~oyi~mse/?n%[??q DoaKn|v|<~3i_6g3
M>zy{Qo||4Ndwv{Onr-nZ_[ry0^_~9/-_GwN7&i>/jK}3B_mm;m)_;_v;KM6}^_?}ml[4;j7}-3Zv~'c/=d{,j.Z}vawOz/~.osXc1'4~=
RWz\oTI#vNYU~LZu&Jgwcoj{6~<9o19L-ooa}M==.|_{ozzW_7?QOkM?
!ys	oI|GN-n>>vD!n{^=k~r>x|Hu"%o6W+2]h9tZy>5_|wO}ko&3wN*?_wUfz;o+!ORD;~/?~>wokt1N;Ro;+yX	;Tnmil:3^z|w{`Gk/}hXe+pnE{]EvYAEvv1k_FM0;oq0-z?Fg%k+YnU;~OR~^z]|-8(&_cFLfC|?:;DBw_;_}_di]^~;/_5k^,3_>NM+{&o?
_[suLN/ xT:;Tk6_]uo{{T4t}L?]R*~\~.W_O[_7ZsLZOv]v7ve]=:lOTN;oO9,,gp+}+%u^o]C::_?_wo|3#_T_z{Ww}G~V?q=n3s}*2w}^W2{w5~[I?uuew;3gwv7{1K}"s]3o|fz~]#[YooKm.]<|G5{Qlmu	&={[u]njw^VKVc>:_wzn{_TWz4??wsSdl~O_u^{7{\m\Gwwg>r|Wu?qjr?Ande[Q]_v<j7^;
uNaZ6W{F"n_,\Lso/N}FVH/OmqI8/{7[N#qcMM{qsgU3zI7J~[3mq&?ZrfF/>OgJif[~w&zOkQ'9G,k,?Ls9[Lv|ogs/OL[0c}V~'_ZZju?]'{Nr6r=O(:avbv<i]eeKsm#vn;~%{Uly3|q{wJFc=y k~;36}D=M{K.[?_F{?bmlOyQfvB<?k=y~Z'7gW?Lj~_|V?{nVr_2']	
6|eP^G#rA3{[O?lQ5fzzo@AB2Pz_Wgvw#owsOzq-7BG}c.Ww9HV~Swf{=V(+q=_o57]|cNoo_]_5YcxmeoXiFGWm}?bekuMxR6~9xm'l_G]3ufk]l	gw(?_F/GWlH)A
 S   x O31) a tP@R(B`pD `:	lPAGpT7uO0 LA&, Pz * ( MP}^_'3sYVoQh-.o1y^tk}/k[_/+VZo:_^^_>C/9>v?n}=17n[}[x/bkfw[#z?]zbQRTbKP4dP/'2e] A   *K(!Af	R5#PaPP@H$rG ! S5Lz
@@ eP  
=
y?yz5Wy77t\6Z{I\oj{VS{T_JV	f	*L L	vL4n0# 

$0 	 1P_"!tH" <& H@Q`GB\\P<bXT Ehc"B;WL P<Q'6+@Y*!N9uB%	 /I)~`mm
 -PK.V	D@2@Z5PAU3Omwb_98_C?Og)2mssg7w/b:KO_n9~u2p?77mGw7w#8E
.%@Ual#AzU0a)7@l,* E@4@E T8UMdeL	P  ( %lY 3 p*P$%
f'f|@DRw??:k?_=6?^^hwnf_M}WfP|i;oU84[Y?{G7ZM{duUS?c6RWKN]N#^i}/.^;'MwNLsvlDDHa
&GA 	PgC@ TA1A,r# 

(BB@"TP 1Ip		X$6(* Y2@0A` Hcn @ @@S	TzoL;3u)kZSoZ_u_;y_*[vn+knKu?u}`|W|bFy}H $P` % A4G@!H@!HYSATD 	(`H$@X @"`M`,`ER$%RUb Na%1@
 O PBM@sI AKYARU`*ZTDK:l@$6<@BlB X+`W O"$S@e re"2	A0DbSne~fY~[X|+w3^}i}}wU7{}_r5Wg{e?.eh}~sg;_IXm_{}"QK{RKHB!PG%Eb$Ed tZh!P F<$aa 0$:!H&I'x1Vz_0VND5XHqAM6@!	B VK#A9y{g_Evz_o}jy9wev~Yy[2zG|WusIVyKrtdz?^[~.K?vwmh{qg]k`zsv~O--j~v]w6?m_B?FK@PG0 np$$$  B1 fI>hA/ %TJD@DBy`I$!HB T0x
Lvv6P-H!T&H, R pwhg^|?os^?V:>768~,_[Az~mx{zuwa~w(p[o0Cy&TX`,T0 1<f@5Amhf(PD<u$`YK A(S2P0%* u2K@!P`J \!L^$`\CfB$#(!F(e@ b@ ^[$R<!P@l\bT !12BY!p\0!Lf jt%6 @1iYa` E<rM4`i I	gr1A[p-j,4yWou6.OnOspw_/u'A*]76t*H!iO5R2D` 8$	e'ncK&#v QR fCP<)(Q#@2p AM*r@Z%pS#Y"IcpD!qn{O|_W
m>c_rOc&<.ga_R,^nosn?z~w/_~|[?nt{nSW	Of~
YWgtO;{&yWRBw@T$En)+AAa-A-!9$ LaG`h45Z&ZM@@
E 09 8 iJ"," t@A#AY)=j(2$ @$<)&,o{6}|L]m+G7~{/:z<v{fsfR?<lS7r7^h6_g%	IQBJIg9!M`!dh (@oL&4  ` ov%0gCc(b=)$zPVX2`.D lAJ@Ad(2t` Pu#h%$\ +Kx4)` @@&"LaENn
$.@H3`G PDzR@HxD(3 *thxi;=s':{y:6F}{}&h8Sg|>{nl5ko-6o[?}k_#w;6r^wh<|b selector inside the specified container.
       *
       * @method find
       * @param {tinymce.ui.Control} container Container to look for items in.
       * @return {tinymce.ui.Collection} Collection with matched elements.
       */
      find: function (container) {
        var matches = [], i, l, selectors = this._selectors;

        function collect(items, selector, index) {
          var i, l, fi, fl, item, filters = selector[index];

          for (i = 0, l = items.length; i < l; i++) {
            item = items[i];

            // Run each filter against the item
            for (fi = 0, fl = filters.length; fi < fl; fi++) {
              if (!filters[fi](item, i, l)) {
                fi = fl + 1;
                break;
              }
            }

            // All filters matched the item
            if (fi === fl) {
              // Matched item is on the last expression like: panel toolbar [button]
              if (index == selector.length - 1) {
                matches.push(item);
              } else {
                // Collect next expression type
                if (item.items) {
                  collect(item.items(), selector, index + 1);
                }
              }
            } else if (filters.direct) {
              return;
            }

            // Collect child items
            if (item.items) {
              collect(item.items(), selector, index);
            }
          }
        }

        if (container.items) {
          for (i = 0, l = selectors.length; i < l; i++) {
            collect(container.items(), selectors[i], 0);
          }

          // Unique the matches if needed
          if (l > 1) {
            matches = unique(matches);
          }
        }

        // Fix for circular reference
        if (!Collection) {
          // TODO: Fix me!
          Collection = Selector.Collection;
        }

        return new Collection(matches);
      }
    });

    return Selector;
  }
);

/**
 * Collection.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Control collection, this class contains control instances and it enables you to
 * perform actions on all the contained items. This is very similar to how jQuery works.
 *
 * @example
 * someCollection.show().disabled(true);
 *
 * @class tinymce.ui.Collection
 */
define(
  'tinymce.core.ui.Collection',
  [
    "tinymce.core.util.Tools",
    "tinymce.core.ui.Selector",
    "tinymce.core.util.Class"
  ],
  function (Tools, Selector, Class) {
    "use strict";

    var Collection, proto, push = Array.prototype.push, slice = Array.prototype.slice;

    proto = {
      /**
       * Current number of contained control instances.
       *
       * @field length
       * @type Number
       */
      length: 0,

      /**
       * Constructor for the collection.
       *
       * @constructor
       * @method init
       * @param {Array} items Optional array with items to add.
       */
      init: function (items) {
        if (items) {
          this.add(items);
        }
      },

      /**
       * Adds new items to the control collection.
       *
       * @method add
       * @param {Array} items Array if items to add to collection.
       * @return {tinymce.ui.Collection} Current collection instance.
       */
      add: function (items) {
        var self = this;

        // Force single item into array
        if (!Tools.isArray(items)) {
          if (items instanceof Collection) {
            self.add(items.toArray());
          } else {
            push.call(self, items);
          }
        } else {
          push.apply(self, items);
        }

        return self;
      },

      /**
       * Sets the contents of the collection. This will remove any existing items
       * and replace them with the ones specified in the input array.
       *
       * @method set
       * @param {Array} items Array with items to set into the Collection.
       * @return {tinymce.ui.Collection} Collection instance.
       */
      set: function (items) {
        var self = this, len = self.length, i;

        self.length = 0;
        self.add(items);

        // Remove old entries
        for (i = self.length; i < len; i++) {
          delete self[i];
        }

        return self;
      },

      /**
       * Filters the collection item based on the specified selector expression or selector function.
       *
       * @method filter
       * @param {String} selector Selector expression to filter items by.
       * @return {tinymce.ui.Collection} Collection containing the filtered items.
       */
      filter: function (selector) {
        var self = this, i, l, matches = [], item, match;

        // Compile string into selector expression
        if (typeof selector === "string") {
          selector = new Selector(selector);

          match = function (item) {
            return selector.match(item);
          };
        } else {
          // Use selector as matching function
          match = selector;
        }

        for (i = 0, l = self.length; i < l; i++) {
          item = self[i];

          if (match(item)) {
            matches.push(item);
          }
        }

        return new Collection(matches);
      },

      /**
       * Slices the items within the collection.
       *
       * @method slice
       * @param {Number} index Index to slice at.
       * @param {Number} len Optional length to slice.
       * @return {tinymce.ui.Collection} Current collection.
       */
      slice: function () {
        return new Collection(slice.apply(this, arguments));
      },

      /**
       * Makes the current collection equal to the specified index.
       *
       * @method eq
       * @param {Number} index Index of the item to set the collection to.
       * @return {tinymce.ui.Collection} Current collection.
       */
      eq: function (index) {
        return index === -1 ? this.slice(index) : this.slice(index, +index + 1);
      },

      /**
       * Executes the specified callback on each item in collection.
       *
       * @method each
       * @param {function} callback Callback to execute for each item in collection.
       * @return {tinymce.ui.Collection} Current collection instance.
       */
      each: function (callback) {
        Tools.each(this, callback);

        return this;
      },

      /**
       * Returns an JavaScript array object of the contents inside the collection.
       *
       * @method toArray
       * @return {Array} Array with all items from collection.
       */
      toArray: function () {
        return Tools.toArray(this);
      },

      /**
       * Finds the index of the specified control or return -1 if it isn't in the collection.
       *
       * @method indexOf
       * @param {Control} ctrl Control instance to look for.
       * @return {Number} Index of the specified control or -1.
       */
      indexOf: function (ctrl) {
        var self = this, i = self.length;

        while (i--) {
          if (self[i] === ctrl) {
            break;
          }
        }

        return i;
      },

      /**
       * Returns a new collection of the contents in reverse order.
       *
       * @method reverse
       * @return {tinymce.ui.Collection} Collection instance with reversed items.
       */
      reverse: function () {
        return new Collection(Tools.toArray(this).reverse());
      },

      /**
       * Returns true/false if the class exists or not.
       *
       * @method hasClass
       * @param {String} cls Class to check for.
       * @return {Boolean} true/false state if the class exists or not.
       */
      hasClass: function (cls) {
        return this[0] ? this[0].classes.contains(cls) : false;
      },

      /**
       * Sets/gets the specific property on the items in the collection. The same as executing control.<property>(<value>);
       *
       * @method prop
       * @param {String} name Property name to get/set.
       * @param {Object} value Optional object value to set.
       * @return {tinymce.ui.Collec;].!5r<7}EiGO,r;Vprqz//G
TT2 l#D@VPCvhp2"iZB(	$Z 5  JGG  EF "(*@ !$\L`@[)(` a0f{H@d	
DJ	HVVH 1Q`:hIr"AD (h0@HiA&h@IpP@BK@+	d(sg-nM~wj;6mW=#pS6N_ewskw]=~~ivGwoo_(X'"a   *b
0($.4!JDDDPP	  	T8`T@Xu 6  AxI8!4	!9wR@*YVT5h J&`L&yP 43hR6m1)75}eml}|M{^T~mf;v_7nrv<^oxM;oc}>x\e$>{mVWNl,m{gU;{v?(^}4+}_Ol~nOvvSsM_m1dSuI3;W?az?c4vci0LtID0`	@00  !pAT!HDh20P2rHL!* (5(6` GbO3h@  
@Vs]G&0bkOK1{i>|/mG?7eeU?Jgoqwg,w8{avm r@$C qih0,(!MX	r9ERtH 	PAXI i8	.& dsr1&B4C`# 0:. A!a  ha dY%s0B!! JAD!:]
<&T	$@0 @A`A  @ [4H!A06 8\ 
<VK@B i}{KT
op_={acY=nqw|;9M=[vo%]'S:}L{o_e;H <3	% 5rP QhH6 0Hq L!& 
-TDH0tT(`P$G'V hc8@ Zh)bx.>(b5',^_	7fn8YJ}9?~wm#0Z7Gm=ACtPD[7';i/_=77Z=z__9+hVyn+Z)qO~^5v]>uI-e?'c@q66(Pr,JB@$@ F P CP4 !" J@tZD:EQi;#A$eF IXHE :8S>?1 " g@wkM?Z4}s]U)Kc4yvW=wqz_^6w)w,*k3V{+7v+^~Ug;{PH .&*p 	S-`Z!aX @
baBH0pHDNQ[C$%r@{@p2| I #6Dd
0218# X%4	HRAa,((pA2` IF,XFT2
3)QAe %PMi	<xDX487WQQh?ZLpR{c)7Og}z(?/7_youm>QtLO6@IO30 *  #$  ,  .@!cE ae PE2 "  
bk 2!Ep  4(H(Dt@GCT	 hE&  }_77]7LGcSo70{D>y\;$m??;t?ws~*|?QOG_I'}kEqCZ+zz}7'~Kvg~zM:
oh.wKzs-7_}N2 @d%!Hq$d `	`1t@D*&@l
h 1*  0!JdD$ q_!C 
X`()\E@ 
@y^;r#{?e?}^_=?j[RoM?wBe-v??o;Qm/\w/7[wq}cjs
p& 
+" vI)Dp+@8 <S@`LQbpPT0	\RHB|E| 0$d@ FC&@[	pV0 B(XN4Cq0-Fb E01#8&D.}P/HXX$DRsRq d9!%$e~#11D]N`$t`uPDMp (J~u7uvw?OeuR3_-ozonSm?{o]cYqg7e=},);pQ<]"@0F1+?L+N +6Q XId!@'SR 9Q| 't 6"75HQeS4CB?*Qlh$
A; H 	 hA;  $'=R:FHf7}Jw(ywo
^_AU{g-3{/wwK9\_wE)U{S^ =m*Q~z>?g=4w{Bnc'V]>]7r;d?_3u_O>K)":iZ=%Mf'[mod2MKP,L3VBdXBnA ,`Q#)TDR1D*	/C ##z c Z@Ax5lk)KCp%	v  A    ))xcf  !3
v@0+	d0 "mA<n!P aP 4Gh`(YB<DmQ  %JPT
Hj.JkH`XL2 C6CtL^]{cuvy=zz8#{4/wv_{.g^}~ng{Ssusy}7ecu~/%[p&~ki|K_;[:'?:k[/^gTSNw|g~|o2a]g~F^eUkD0 "8@AiP@D 2@hk	  .@D<a P`d0D@`aP!   I(A!
G+%
 Xc21 B^3w?K;QSGgwgV>m{-[wG'vy5'U{w:_p/#>weVz.}>axL @3LHC0<e2(8$%L"@JABX05  `A% @  dZ(	(1!xeHAL-a$-&B (.|,q
F83q"XbE	%LT !(A&*D 
1(I  E@ E!$_0!R,):h1:)w_Wnyj=GkCO>|o{zIgN?{gt};|KZ1u[04 `-L> "
H*
+!Pd  |  IHPqKhT$%@@
FMG	Il2 1 J.@|o+kEZ?c_o[-+.gxo_Q|~?>NtoCk6mJ-]Wg0Wow_'?*sGv?;<<M~{{_2k{}_,nU7V~6sv61:"aQriF%b1s"d+]&0d	@
@ HD$@@(Pj -L4y*y?:A)b d`(/ |HJXul5m~;_^]L_wGE9M_W3Os>GZn{[s/;W+b~qE%t-`^;e3 c+p@=H|D;!		1  pCt@EsW
@L ,	7	! b``|GM
!0zsD f1$!$,$2`B8"HVA"FRDA
PqId	``<T '
vB
`,@NX#"d2$#Pe FREA !H@R@J-y}njw?I[wy7VPm7*v|17~6{B>?Rm/7/bM=o{?WT,Xb-Cvc$#  ` 1N|@|OAJ]F2S$A0d@;dE0#C@F*%*"Uh
(#G@B\9eg?c!y9/9Z7p~=%Ui}'O _n[wo~xX/%nr>Gw>{\.rsDgQuw'v_u]o(^wZo,{?2y{nzRK;7b{VnNKYo-Lkv=G  ()"AXr@D5*+j"0S [P)BZGtpQbdX]$BFb  dAb4:
$$E	 I9+*X   @qt.kf_{~_Eot<\8?fm}vv.]S{O.?Q^#gWkV#g^-?0_S s 	 0@EBC
Z
D )BR* Qt hVmEwN 
6 B+  @MAe%8A@RB 
 afT P53 ! ), H1I @@ 8 " 
AD*0
"	.rIh
b NJ!!G #%,` 
 D`Z+JD(q&@h03
gC[
@}~pWe>Mu]w~fU?V}%)}]w+8IO~Z0?E?Wj]1ppT0 $ bDM&a Ih@,0B  L
 h
C8hTAXhH'nTD
 aa2@\ 6_}y'}m~[sOuw_|9>K\=f^YOBtMv%~c:z?{CF;U_{7Og?|wA%?q,nzy@ehoi~Wmgm@
R FD+!2~@ 	% E
@`" $BHD$~FX  ABPF;P
AD MCPF AA )B
 1 @57_}-;Cy^-^Z|m=/sTws/m@p`,/L\.6x.66R@! `@@g3 H`8(Sh b! E@PB H)&Hk)(B)v<!DRtJD@$
@P
!)$FTp@1 P YfUb@M@@P,`yE4!Th)x@@ b
)L(XAA $0 Ymp  (PU  ,D  h@HS`VDD qiDg}{eaSK[>|slK5/<_wi[.|r}wuhwva;)ou3{+ren, function (child) {
            if (child.nodeType) {
              elm.appendChild(child);
            }
          });
        }

        return elm;
      },

      createFragment: function (html) {
        return DOMUtils.DOM.createFragment(html);
      },

      getWindowSize: function () {
        return DOMUtils.DOM.getViewPort();
      },

      getSize: function (elm) {
        var width, height;

        if (elm.getBoundingClientRect) {
          var rect = elm.getBoundingClientRect();

          width = Math.max(rect.width || (rect.right - rect.left), elm.offsetWidth);
          height = Math.max(rect.height || (rect.bottom - rect.bottom), elm.offsetHeight);
        } else {
          width = elm.offsetWidth;
          height = elm.offsetHeight;
        }

        return { width: width, height: height };
      },

      getPos: function (elm, root) {
        return DOMUtils.DOM.getPos(elm, root || funcs.getContainer());
      },

      getContainer: function () {
        return Env.container ? Env.container : document.body;
      },

      getViewPort: function (win) {
        return DOMUtils.DOM.getViewPort(win);
      },

      get: function (id) {
        return document.getElementById(id);
      },

      addClass: function (elm, cls) {
        return DOMUtils.DOM.addClass(elm, cls);
      },

      removeClass: function (elm, cls) {
        return DOMUtils.DOM.removeClass(elm, cls);
      },

      hasClass: function (elm, cls) {
        return DOMUtils.DOM.hasClass(elm, cls);
      },

      toggleClass: function (elm, cls, state) {
        return DOMUtils.DOM.toggleClass(elm, cls, state);
      },

      css: function (elm, name, value) {
        return DOMUtils.DOM.setStyle(elm, name, value);
      },

      getRuntimeStyle: function (elm, name) {
        return DOMUtils.DOM.getStyle(elm, name, true);
      },

      on: function (target, name, callback, scope) {
        return DOMUtils.DOM.bind(target, name, callback, scope);
      },

      off: function (target, name, callback) {
        return DOMUtils.DOM.unbind(target, name, callback);
      },

      fire: function (target, name, args) {
        return DOMUtils.DOM.fire(target, name, args);
      },

      innerHtml: function (elm, html) {
        // Workaround for <div> in <p> bug on IE 8 #6178
        DOMUtils.DOM.setHTML(elm, html);
      }
    };

    return funcs;
  }
);
/**
 * BoxUtils.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Utility class for box parsing and measuring.
 *
 * @private
 * @class tinymce.ui.BoxUtils
 */
define(
  'tinymce.core.ui.BoxUtils',
  [
  ],
  function () {
    "use strict";

    return {
      /**
       * Parses the specified box value. A box value contains 1-4 properties in clockwise order.
       *
       * @method parseBox
       * @param {String/Number} value Box value "0 1 2 3" or "0" etc.
       * @return {Object} Object with top/right/bottom/left properties.
       * @private
       */
      parseBox: function (value) {
        var len, radix = 10;

        if (!value) {
          return;
        }

        if (typeof value === "number") {
          value = value || 0;

          return {
            top: value,
            left: value,
            bottom: value,
            right: value
          };
        }

        value = value.split(' ');
        len = value.length;

        if (len === 1) {
          value[1] = value[2] = value[3] = value[0];
        } else if (len === 2) {
          value[2] = value[0];
          value[3] = value[1];
        } else if (len === 3) {
          value[3] = value[1];
        }

        return {
          top: parseInt(value[0], radix) || 0,
          right: parseInt(value[1], radix) || 0,
          bottom: parseInt(value[2], radix) || 0,
          left: parseInt(value[3], radix) || 0
        };
      },

      measureBox: function (elm, prefix) {
        function getStyle(name) {
          var defaultView_z}z?m}]o]^_#J}_VO]Y?7wmL!!d: RB4@B4e  !03X$ r9==dPE#reH!TKE2b?
B4y  "EPK[ lFJ&Pd$8aBHL`$lU(aHvF CE5~H88DT tP F]!c-eHW*R I[02&H&)HUA0dG' l4/~Ji=k'	C{N&:9Lm2wLLoo_;3]w^~v[RV,x"BR<` E k^O+!hdVa&IsB$($3>8>D#R:H X D4s8m6$FJs%H"SELEm|1?)%qzr.%wUo;m<~_Ol.4uO}_-O_?wWgtg'C/ ]{]gso}b{\7m3VZuwM=-cy8s_x=?_?cm8;_{hUN$rQweQzp(YL %,aH\R 5&fCF)Y!I6XMpwJ< u"bHy)8>5XE%5_t;n_u+Q&pYc~usft~U:3o_k8|}qumw)` @IcF.0psD(AQJVp!R $w ,,AtCU@%	T  `vx=G
 	D&(@-d0 *pIBR&DA@p#P8O* 	AhLAqd@4#*  )j!1@	IhaMc^YS@"Rp}J*24"!zY00NZFZH4PAJ Q9tuo^[~u?:/{}w[~{VP/_g4~yN/{CMlrP^;6rS0&7=a8Lerx"KVDTp00h$	  ' v   BDeAI@@L$
HP	<7~diGT[[[?1;_~{n]kGg}7a~]iOOwRoe?\Ip|DWZ9w=n'}L)vOvs_>]_zmg%3A40-xFd8a"BFx&!'WKA CI~H&AiUAQd1.Z doF!T DW`XNhY!M:ys>{I{?}?yV;wCv/}{;;{F'wwxc|aW?nw/u 0*=HO ZkF!R1(@A i4"d)JEdr.H8#G:gAV9 `tq$0>D088X
1F#2 N'd\PeTC2`L5diD
Q
@ aF
b2.#h $rQ^qmhtBr
9$ 3!c+@THVE= o}i?_+oC??-\>}g~>]mO_86w6z]^G1}cm4&BP@x |C
E0HCG'3%$g*A@z pr:H q#`S%hT daLnL@AW	G7a@CPR\{v~{]7|?oZmZv?
o=xkswS}nM5\im?U[vg7G_2Qis?sX_=sLok~ool|{[}yw :{!r-Zw~UzQ}}WirSW/>Aa	D'^0FIT<(kG H  D@ D6XU%^)F+ll<,6H@d6kG7;0KJ)d
d@%5cTS#7ADA(Vw9zmN)?=%m9_c1^_Wa$OOz+7}i___uig2s,7Ym2D'4 Sp	M @

=QGV$4]C_STCF$r"A U< m! }5XT"PR $NC TSgJQ6,
D
0 ?jEOh
FA@0HS2%! 3B $*'R@&W@PJ# 2	4:Uyjr7{7g{~v?oyzO~US
[?vS6_;ZW$EOS?pc [;S`D*:A1	!lP  0$)12Cr&8 w*M!}P'xL_@%'	E$ v!{rg?wv3v&KG5]z\zossn;M%o}sz~/wi~j_c">grs'?'_UosWw>w7y~|1;fwkg|~~Oy?N??oz~2A"q/.vBG@*<wP(30Zl Al X&@%&MI.	&H 	gxH +0ysLPI0(@RMV.]|_sxO[|'mG^:us VsETO7?-9^'Um{|swABP    LPSPA  	{D( Dd&)@j  e p0ST0	`Q@  5L!1A3B 	H1 @DCZ$ DA@P#Wp".` 4B5 H h   R0 I6D  eCxq*dTB'@0b1 B Q (U  @p9b `J f O/V{c=W~(RzjvKu;{5_r=}mcsmw,ZzV+o}/]y$ 6@
y(@A&!6  ,aie`4+(	F~`@N$<*!K%k.CH8	fX x4^NQU{Bwun-Sw}ugyJggy<b>qOd2;KswF~}oe?GWZl;*?-PgT4;W%ys5Nob	{__vBh?AD??=~?y6i9g_V~p{[.}!qJI P 0 `@@"I11
!@ < 
58J  @2@
(	"4rL Th#u:A 2H!fe!HKhNPvuH[d;[ggO{?J)VW5~"HV6w0\u`+o#<LGWc{__k	
pR`*|2H @1IbP iJ!jDQ +tIS2
A8-Q ( ` Ah$deI0  %C8
 $2PA lI2 ` YB
Ep HeFB!BN  !BGs(1,"4.8\PKA@J( B(s"^"$$	0
@%!*BX (`@ R"@OuYsO7-(KxWLqH;{rrk-U~FiRod{h:I#/c=u;e/~*R=~8 %^2x1  TH0  "@"6'DB@9`
B`G@(^ Aq6 )0J&1J@D$
8  I287WUn?>o%qNv5&u{.{~5{/INU]n5lss'NyC_K$wm<t3g3Bk
/4~CivT2r~E>FoS^!uwyG'v|/Mo~WnV}^   0x B (d0( (4*( Mb+ v@B f`AP!4 MdKtPBD{q2PJ
% =1L!B,Aj;Yu)/q}l_sAUlz}|??VzyO5v/}Wvb1U)nno|}#[2'/

HJX`	bM:aj	  J0
'E`@ `+@0uGK A(B \Ei		D@P YP D XA  #2 ` 
]SC|!jcUA(@3Hl @cC6Q!B+
m  )!	AH 9TB6!,@#6DH$/l{~swW=wm|im+[s~toh=yo??~s[We{ZkW_{A!K EE IKAr1i\A7!H - +U  IHv	a!b $C  |! 
 ,2 P8 9JiCn85 #AF3+`iP	+mSIkZO7hCu
Ws_G}=Rf>7?oJ7jw?P<\k&?nk|s;{cvoe{5%K:OWuwnl'Op5?-3ztcyCZ-n`gzAyZn${TzH\	E @`  tc`^(5@V!")b,(FN.** 0\ =.Y$B be@6 p0	 @@Qz(Q6n	$LzoO~9PG?d%xOF:~{k_|3_o?hdMyo{G*m 
   2-`I @`!`@8 )Y@_`PP@-UP   0I
0EcKP(@, P P
I (&$ E .  A @p ` K` R "Xpp d)@ 
,&P@ h1P<! x L%F	Ch z.@	\2a 4 OrMw&~{i{4_ldx=w	7k"|)g?LduXv|n~9~C::
bx `P 9 @&B`S5uE@ f0dT$L X JPD2x`Qb:ER@oXA DW_+9Oago2aNWW3]~/Y/q-esWgZ6fYmC|cuo/y0mY}9gV}F|up{o_z_qU6NWtCkwhm=lk  D@$6 )`$At@*"D!(Ih"b8S\HqP@i# @V  @) `(!I0\s $ @6`P J!(`
AN /^[}5{yrv>v/~:ey7iq>ySz4wZn=oN	#~)#,hbbY  
%  P J0  Bpv  tBD : *&X>Lb 
H	!@ !2VS0b$I@$\ "5A
%D@4 : A@Q   
@1 2 GB A(=Hi@tD CxB S !	J[opd<! < @    P@|i  ;|F{?y2}^~gz/%M;{mYW
w_{(Z]_:=[so=ct'\Ww[6u]<  Ba	D\&MS`Bi1 (C v'Q. d XP` BpE 2 Mpi"L!a 	0 KP$BQEP	I  ,}52?]S4mU}zv{5eu'zQKuCk>t?>;^{}7;O;I{?NMS};AW>>/p#l;7gug\nq-8=}vovE}*Q5-4>/?<=;agg} $RM `x:i*ET8XP	8L`	 @@ 2	Hhcf"c  H !cB E	H0$R
aFDM0	JFiB.^xn^45N6]a^o-?p_.?#Cbx/kgvsu]}rQ;g-~F.qwz%3??>@Y(	%" @ `PP0p '`
r#!@  H	 Cr2% PD0  Ti@% P(P @*H!`tB&1 AA( aCTPKp%@<)p(G	 8
$",F)!d `d "86PINF}Mo{779]:ombo|x4o?m]<o:V?/iS_g/@@  	<$4"	 !  #Q  8
h (P4= B  H#B&0D@TP 4` HC%j" 5H`'& a +bXI0DYP]\	`_6u/g^wnvW5sm_o5[wz5qx_U.}+xu1mq~G{Qik=Yy}>a~{{ns%_[_yz([?qnkw6@|H^d:^;)	<"dD%0 $!#UA8
)q$	  oMH)"hq'
0@T0PP"@T  0( ;R}z?_Gu::v/_e=~l7<Gku/}]vfcJhMU=aZWO tkHBL! @ 1D@u P3dA @"oHH&dr(D<p")  "@J  H! P+,! @(B@au@ij0 `. QA l d D@ *  )$  D FcN,@	O@%(f	Z,PW c=5h` ,FL ow(jGlI|Y}_w^||*+~.ogk&Fs^[oWPYw~7ol!"9! @QJ @bdV-B@c2U!0! IF(YDAlpKe$Ie 	@H $b`( P`   `&uX#  h1
@y~MG5WXnpKn?{g6,6rM8}}?oS.[neZ%B*^]q[0WwL3ziv{yG{9=}{!^~a9{w~>|W.iWs{M]kR  @  2$R ((*5 &Fv,j AA ,G%B/	  ' @Bd  @a@3T$0f0 4I   %$ ZH'66{X!%1MKso+~r]'znOS~|g^G5[Q;ywrK^M@~o}no_W$h @5 2$Q PJ:C$ \HP Z@&P"KpfX@Q"(#&D`&"AZ @TU &aHH !
p  ")`A UL`6		jp  %IB   U! "! "h`P@ |0`Vt A .Ba1*2*XDK|t x) F @$$J	L	 P@pH B `@ P H=s{ \/{U>ercP?j6}y~Yly{W3v[V^~t%oU=w?%;^v#)$EEH	  x!	@  :h @P4 $Deb
! !dT b` 
=   p  $T  P E 4>8IsHQ7}hw{+qw3Uo+,)L/WLu>s
:+8OncM={.fn|}wFM~?#?K&{
~y,9J7w	-L	]472nWrz{goV/'so~W6ET@ $` HRJpZ 5x !^ :("	9(		 U@ <0P2@bB`  Ia(@`AhU\!$  		A84btartMinWidth, startMinHeight, initialSize;

        // Measure the current element
        borderBox = self.borderBox = self.borderBox || BoxUtils.measureBox(elm, 'border');
        self.paddingBox = self.paddingBox || BoxUtils.measureBox(elm, 'padding');
        self.marginBox = self.marginBox || BoxUtils.measureBox(elm, 'margin');
        initialSize = DomUtils.getSize(elm);

        // Setup minWidth/minHeight and width/height
        startMinWidth = settings.minWidth;
        startMinHeight = settings.minHeight;
        minWidth = startMinWidth || initialSize.width;
        minHeight = startMinHeight || initialSize.height;
        width = settings.width;
        height = settings.height;
        autoResize = settings.autoResize;
        autoResize = typeof autoResize != "undefined" ? autoResize : !width && !height;

        width = width || minWidth;
        height = height || minHeight;

        var deltaW = borderBox.left + borderBox.right;
        var deltaH = borderBox.top + borderBox.bottom;

        var maxW = settings.maxWidth || 0xFFFF;
        var maxH = settings.maxHeight || 0xFFFF;

        // Setup initial layout rect
        self._layoutRect = layoutRect = {
          x: settings.x || 0,
          y: settings.y || 0,
          w: width,
          h: height,
          deltaW: deltaW,
          deltaH: deltaH,
          contentW: width - deltaW,
          contentH: height - deltaH,
          innerW: width - deltaW,
          innerH: height - deltaH,
          startMinWidth: startMinWidth || 0,
          startMinHeight: startMinHeight || 0,
          minW: Math.min(minWidth, maxW),
          minH: Math.min(minHeight, maxH),
          maxW: maxW,
          maxH: maxH,
          autoResize: autoResize,
          scrollW: 0
        };

        self._lastLayoutRect = {};

        return layoutRect;
      },

      /**
       * Getter/setter for the current layout rect.
       *
       * @method layoutRect
       * @param {Object} [newRect] Optional new layout rect.
       * @return {tinymce.ui.Control/Object} Current control or rect object.
       */
      layoutRect: function (newRect) {
        var self = this, curRect = self._layoutRect, lastLayoutRect, size, deltaWidth, deltaHeight, undef, repaintControls;

        // Initialize default layout rect
        if (!curRect) {
          curRect = self.initLayoutRect();
        }

        // Set new rect values
        if (newRect) {
          // Calc deltas between inner and outer sizes
          deltaWidth = curRect.deltaW;
          deltaHeight = curRect.deltaH;

          // Set x position
          if (newRect.x !== undef) {
            curRect.x = newRect.x;
          }

          // Set y position
          if (newRect.y !== undef) {
            curRect.y = newRect.y;
          }

          // Set minW
          if (newRect.minW !== undef) {
            curRect.minW = newRect.minW;
          }

          // Set minH
          if (newRect.minH !== undef) {
            curRect.minH = newRect.minH;
          }

          // Set new width and calculate inner width
          size = newRect.w;
          if (size !== undef) {
            size = size < curRect.minW ? curRect.minW : size;
            size = size > curRect.maxW ? curRect.maxW : size;
            curRect.w = size;
            curRect.innerW = size - deltaWidth;
          }

          // Set new height and calculate inner height
          size = newRect.h;
          if (size !== undef) {
            size = size < curRect.minH ? curRect.minH : size;
            size = size > curRect.maxH ? curRect.maxH : size;
            curRect.h = size;
            curRect.innerH = size - deltaHeight;
          }

          // Set new inner width and calculate width
          size = newRect.innerW;
          if (size !== undef) {
            size = size < curRect.minW - deltaWidth ? curRect.minW - deltaWidth : size;
            size = size > curRect.maxW - deltaWidth ? curRect.maxW - deltaWidth : size;
            curRect.innerW = size;
            curRect.w = size + deltaWidth;
          }

          // Set new height and calculate inner height
          size = newRect.innerH;
          if (size !== undef) {
            size = size < curRect.minH - deltaHeight ? curRect.minH - deltaHeight : size;
            size = size > curRect.maxH - deltaHeight ? curRect.maxH - deltaHeight : size;
            curRect.innerH = size;
            curRect.h = size + deltaHeight;
          }

          // Set new contentW
          if (newRect.contentW !== undef) {
            curRect.contentW = newRect.contentW;
          }

          // Set new contentH
          if (newRect.contentH !== undef) {
            curRect.contentH = newRect.contentH;
          }

          // Compare last layout rect with the current one to see if we need to repaint or not
          lastLayoutRect = self._lastLayoutRect;
          if (lastLayoutRect.x !== curRect.x || lastLayoutRect.y !== curRect.y ||
            lastLayoutRect.w !== curRect.w || lastLayoutRect.h !== curRect.h) {
            repaintControls = Control.repaintControls;

            if (repaintControls) {
              if (repaintControls.map && !repaintControls.map[self._id]) {
                repaintControls.push(self);
                repaintControls.map[self._id] = true;
              }
            }

            lastLayoutRect.x = curRect.x;
            lastLayoutRect.y = curRect.y;
            lastLayoutRect.w = curRect.w;
            lastLayoutRect.h = curRect.h;
          }

          return self;
        }

        return curRect;
      },

      /**
       * Repaints the control after a layout operation.
       *
       * @method repaint
       */
      repaint: function () {
        var self = this, style, bodyStyle, bodyElm, rect, borderBox;
        var borderW, borderH, lastRepaintRect, round, value;

        // Use Math.round on all values on IE < 9
        round = !document.createRange ? Math.round : function (value) {
          return value;
        };

        style = self.getEl().style;
        rect = self._layoutRect;
        lastRepaintRect = self._lastRepaintRect || {};

        borderBox = self.borderBox;
        borderW = borderBox.left + borderBox.right;
        borderH = borderBox.top + borderBox.bottom;

        if (rect.x !== lastRepaintRect.x) {
          style.left = round(rect.x) + 'px';
          lastRepaintRect.x = rect.x;
        }

        if (rect.y !== lastRepaintRect.y) {
          style.top = round(rect.y) + 'px';
          lastRepaintRect.y = rect.y;
        }

        if (rect.w !== lastRepaintRect.w) {
          value = round(rect.w - borderW);
          style.width = (value >= 0 ? value : 0) + 'px';
          lastRepaintRect.w = rect.w;
        }

        if (rect.h !== lastRepaintRect.h) {
          value = round(rect.h - borderH);
          style.height = (value >= 0 ? value : 0) + 'px';
          lastRepaintRect.h = rect.h;
        }

        // Update body if needed
        if (self._hasBody && rect.innerW !== lastRepaintRect.innerW) {
          value = round(rect.innerW);

          bodyElm = self.getEl('body');
          if (bodyElm) {
            bodyStyle = bodyElm.style;
            bodyStyle.width = (value >= 0 ? value : 0) + 'px';
          }

          lastRepaintRect.innerW = rect.innerW;
        }

        if (self._hasBody && rect.innerH !== lastRepaintRect.innerH) {
          value = round(rect.innerH);

          bodyElm = bodyElm || self.getEl('body');
          if (bodyElm) {
            bodyStyle = bodyStyle || bodyElm.style;
            bodyStyle.height = (value >= 0 ? value : 0) + 'px';
          }

          lastRepaintRect.innerH = rect.innerH;
        }

        self._lastRepaintRect = lastRepaintRect;
        self.fire('repaint', {}, false);
      },

      /**
       * Updates the controls layout rect by re-measuing it.
       */
      updateLayoutRect: function () {
        var self = this;

        self.parent()._lastRect = null;

        DomUtils.css(self.getEl(), { width: '', height: '' });

        self._layoutRect = self._lastRepaintRect = self._lastLayoutRect = null;
        self.initLayoutRect();
      },

      /**
       * BindLwgpb3Ee<wEq;<:tWqoY7g`{s7>wj|okwW~{j1fw DN*aL)5H$F , 02!:GJJ (
s@[F"P415H  HOA5dD2 #\0H((cTLSTN wP0 "r`a0Bf!$   Xt`8@fP@!iQ r2* 4pB	
Sp8 3 >t h +P2 +HpB>u#"oro\5WW?#x/3voozwP\%Ouf~|4]NX1}Gk[WL0bQ2	p  <!zB! vJ	 $
4@h	 	
#3D#B *w<*` BuB^  @F[~ +_WKpl3/NwO];_5_x~{s[ /(\.)'OPzs{|Swc~%MdiBu^oW3W,2?!?{O7zGWnf@}4v1m-~b8{{75Yov\e0X4QU40 `= $ R$@4@B, 0h!gp		  q+HL@% (	G%c#(BZXl$M@D% v]Ew4_elK^UWwu3x{vJ=el~sa~|d_f]Bu~q{}K{`x; PjtHpaAP  : DWH ) FTI	a 4G*"('nIr2z V $E7k	0h@Af -		
D	J  +qV5  ` b kF<A
$i#L4  
C@*@XpB D`KF	0"P(M`!Cm8Q,+%,(
E_=`u/g<,RW'f{OmfT:[K&%/+#<seowl=`~C;x9h4i/+ 8
L	 L:PRX&@DHMH+ 1(ApZ%a"c	@3hL# Ad % 8P$ &  E `RC pk(  cg025qoxosW3>u>o4Cv]i\6#cz8d;\[>3~iOu{"7b)m8t[^'?16w'.u;gwe\go6};Z;wIskVwneNI 32@  24* V^`6
dQ d( MqDHC4LE~P PR X$ R$BP C#0 B  bTJR {.B.mg`~b)'aU&;~<6le~a5<+={s6sRNYl R>eG=m	
)%Yr3`QxIp0Pa! !C@5E8 2 5 QI4'1ptq)VHA&P2$ S	$@ gC	  F`!4[!0^.|! %	 PA<CPai	@	@P2,!dH2bF o	d)8"{sB^sgF~vs{|%oY{ooyQppD[O9nk{1s+WdnB `(@u@30DD0@*A" p!@PEGCA0#P@;f#)9,Q0#  $a &&Hf@@^0;`LvtY;~s/xvIk+/v~^o=87\OX-E>VAy{pJ_}WW(eC?9wg=Xo>wiK|#wnNGOf+`t~]_t?Ng[h|=5KxQ!#@GqU
I&E
@ AV D&!c )8TH11 a
\ 
ADf  +0, A UC$.$i
{ #dh ^TF:8L{_+7nFCx;uoo-o[o|nVuvW5WBg}0RA0	&LB=	) xW`lL`Q8Dg+I5 9D@bD 5E,#a(!GiI (bALSU "8 C 0 T*B8%   J VQ!\L00`-t`J	gf E	@ 
 N*@R0q_ @!cb0mRu:j@@E WMk}7]Zm|[Loa'um^9w,y+guo.h_v[$&s1s<;_Vm} 60SpP*p$  t`Pt 2ADD,H FdbCaI(i\%
 HB( 0M@xh!A @zZ H:vSw[p]%pv#v{Fnix_6.6t{k/Gn%=61 zxzWWusWfS7vWLO5gM[+x}v^|g9bo`Xbg^jMgQk[pp}g+(kCP@0h Lq  :tlEn ,"AU"`$"(DJ`.DY8 $'&$}](E# E0A.B!  H`|	!vDi"H.% !T !2h"	5&*Y JD x S*	J LOF(B(f+ i `1H#	VPj`MR+18R8@f,@6&5h0 F{" RB2s\ dhN1 WYiU +`fLw!D}\.   8UvCC
AB$%^ P,87I<>L -_3#B f 	DjFAt$@B!r@ 
QL@pElK gL
nS%.D@01BR f 	H"qXG9\"]HC
E^T @rQS'I#hd`4J-0 E
"}<)<J+!*^oX1DxBX@U&
 P$pv%&!}0 .h P"@JA\KFPC4V%2fkCUVPH "L1L P!$	LnJ@@r`@!R$]L( s`'1BQ
H	%N	e@iC #	@- j` fHcPLFB
PBR
=p[H G &	rX$E " ``"9 P@ V$`)",@
H@:].7Q$P*DC-dK`DG(<4 z22By``G\*%A "  dB`U B(0GtBZ98"? 0 bIY" ph(u@<}A9S(!&A!DT
~$f a :
8A*s!2Q!@@"dFaaAa,CtD%C8 6 30J%pRU(OHBb02\)r|h; $c{D	 h'hIe0p(ME\ !a "$Iql!vAD/E9VC*@4GKb@_DFY! B
"? 0	&@HCL 8BI -`D-
G3&dp  q?)$Ha5Bb<1!A$:4r2!#dP"Q9kiE \fy]Q0H
# QB&&9@s n 4@l(F@I)"(bH4]BPL
x4L3 rM &843(x @NIB \^v\h@	H FatD   pP bpPlLe	
*yXxA7@5$2O p	G* @hBx AA0JdpKc#	Yp$%@L:HhFH1@, "0(`$A 1C (sT HFmB,\98  c8X K  n \L8! e p!@n$ 	 D  H+!z%ma#@ @QJH
Y*Z" 8L ,B 6HQma .H
F5f )J7KB0MBGQ K +,F<XL%VE$RKsp4lT!9aSpB"d*B4X
(B]D2
2fX*e A0W44X1IEK\"  g-Z#RL dER@+F"^ 2  E@4 ) WER )GDD%0cBFA('>DT5U kgiPUp!A1 <gF opc<&JbxxB[PPE5BV?<:cpNh@Ri(CPiD@tTA**C  -O	&#U` BRDJIe JE.$ 1) Lpba Sh3kE @ G.xb P N2yCQx  ,tp	r_ `P$Dx LjDHc=
b`APILHF 4D*"& 	x  vC!!N'RJ 8yYRBG.#
RHp 
 !Sq a @
!(!(	  \ ]\ 	pA@@H T.H@ 1|G41dP@3' 	@8UMaB0BEQA4d8V
pP &
d"#) x(n@T DI )X@(CC0M
E@1pa)%T$iSJ4B5ug   m6D"DFD2 @1!BqJ
	P_CE:J!i%(}$ NM/P`EC(
PehDJB .@8e@&!@Aw  CL@iE N$8H	$24Sz  J&h8(`T`"$@ @8RIB"	b YDyXFH	Jkd
r)!1Zd~(a@A 7vz "8" P2GD!&H 9S+4-2&BC@Lm  b@OR&CfhHH3&g@B
c%pb|!p$M T aBH0d !Ou2y'@	)ZFX E#-( orDTH.,i@S %z ,%'P-J{ ""  @ r "EU-4Xad

@ZFXd @V*= z5S.mX00 : @ 1AHk$DH<Z3ei0Q+ bhkB(QZ* 'wPA@@!4_*q88`U"5HQ<2BFsHTj.1&R*@]UX AA9-A$a( `hA 6
 CR (j\1V  &(KMIQCdZUpEBX!HJ Ft'P 	&8a2LcP
` HA@ P @A=0#8" l( RfA0x0H$	T! AS  h YBk"H\+@ 3  F4U T=H^ V]&<:@N<"60F': 0D EF6( CFPd#J	F8< SH k4ction (match) {
          return '&#' + match.charCodeAt(0) + ';';
        });
      },

      /**
       * Returns the translated string.
       *
       * @method translate
       * @param {String} text Text to translate.
       * @return {String} Translated string or the same as the input.
       */
      translate: function (text) {
        return Control.translate ? Control.translate(text) : text;
      },

      /**
       * Adds items before the current control.
       *
       * @method before
       * @param {Array/tinymce.ui.Collection} items Array of items to prepend before this control.
       * @return {tinymce.ui.Control} Current control instance.
       */
      before: function (items) {
        var self = this, parent = self.parent();

        if (parent) {
          parent.insert(items, parent.items().indexOf(self), true);
        }

        return self;
      },

      /**
       * Adds items after the current control.
       *
       * @method after
       * @param {Array/tinymce.ui.Collection} items Array of items to append after this control.
       * @return {tinymce.ui.Control} Current control instance.
       */
      after: function (items) {
        var self = this, parent = self.parent();

        if (parent) {
          parent.insert(items, parent.items().indexOf(self));
        }

        return self;
      },

      /**
       * Removes the current control from DOM and from UI collections.
       *
       * @method remove
       * @return {tinymce.ui.Control} Current control instance.
       */
      remove: function () {
        var self = this, elm = self.getEl(), parent = self.parent(), newItems, i;

        if (self.items) {
          var controls = self.items().toArray();
          i = controls.length;
          while (i--) {
            controls[i].remove();
          }
        }

        if (parent && parent.items) {
          newItems = [];

          parent.items().each(function (item) {
            if (item !== self) {
              newItems.push(item);
            }
          });

          parent.items().set(newItems);
          parent._lastRect = null;
        }

        if (self._eventsRoot && self._eventsRoot == self) {
          $(elm).off();
        }

        var lookup = self.getRoot().controlIdLookup;
        if (lookup) {
          delete lookup[self._id];
        }

        if (elm && elm.parentNode) {
          elm.parentNode.removeChild(elm);
        }

        self.state.set('rendered', false);
        self.state.destroy();

        self.fire('remove');

        return self;
      },

      /**
       * Renders the control before the specified element.
       *
       * @method renderBefore
       * @param {Element} elm Element to render before.
       * @return {tinymce.ui.Control} Current control instance.
       */
      renderBefore: function (elm) {
        $(elm).before(this.renderHtml());
        this.postRender();
        return this;
      },

      /**
       * Renders the control to the specified element.
       *
       * @method renderBefore
       * @param {Element} elm Element to render to.
       * @return {tinymce.ui.Control} Current control instance.
       */
      renderTo: function (elm) {
        $(elm || this.getContainerElm()).append(this.renderHtml());
        this.postRender();
        return this;
      },

      preRender: function () {
      },

      render: function () {
      },

      renderHtml: function () {
        return '<div id="' + this._id + '" class="' + this.classes + '"></div>';
      },

      /**
       * Post render method. Called after the control has been rendered to the target.
       *
       * @method postRender
       * @return {tinymce.ui.Control} Current control instance.
       */
      postRender: function () {
        var self = this, settings = self.settings, elm, box, parent, name, parentEventsRoot;

        self.$el = $(self.getEl());
        self.state.set('rendered', true);

        // Bind on<event> settings
        for (name in settings) {
          if (name.indexOf("on") === 0) {
            self.on(name.substr(2), settings[name]);
          }
        }

        if (self._eventsRoot) {
          for (parent = self.parent(); !parentEventsRoot && parent; parent = parent.parent()) {
            parentEventsRoot = parent._eventsRoot;
          }

          if (parentEventsRoot) {
            for (name in parentEventsRoot._nativeEvents) {
              self._nativeEvents[name] = true;
            }
          }
        }

        bindPendingEvents(self);

        if (settings.style) {
          elm = self.getEl();
          if (elm) {
            elm.setAttribute('style', settings.style);
            elm.style.cssText = settings.style;
          }
        }

        if (self.settings.border) {
          box = self.borderBox;
          self.$el.css({
            'border-top-width': box.top,
            'border-right-width': box.right,
            'border-bottom-width': box.bottom,
            'border-left-width': box.left
          });
        }

        // Add instance to lookup
        var root = self.getRoot();
        if (!root.controlIdLookup) {
          root.controlIdLookup = {};
        }

        root.controlIdLookup[self._id] = self;

        for (var key in self._aria) {
          self.aria(key, self._aria[key]);
        }

        if (self.state.get('visible') === false) {
          self.getEl().style.display = 'none';
        }

        self.bindStates();

        self.state.on('change:visible', function (e) {
          var state = e.value, parentCtrl;

          if (self.state.get('rendered')) {
            self.getEl().style.display = state === false ? 'none' : '';

            // Need to force a reflow here on IE 8
            self.getEl().getBoundingClientRect();
          }

          // Parent container needs to reflow
          parentCtrl = self.parent();
          if (parentCtrl) {
            parentCtrl._lastRect = null;
          }

          self.fire(state ? 'show' : 'hide');

          ReflowQueue.add(self);
        });

        self.fire('postrender', {}, false);
      },

      bindStates: function () {
      },

      /**
       * Scrolls the current control into view.
       *
       * @method scrollIntoView
       * @param {String} align Alignment in view top|center|bottom.
       * @return {tinymce.ui.Control} Current control instance.
       */
      scrollIntoView: function (align) {
        function getOffset(elm, rootElm) {
          var x, y, parent = elm;

          x = y = 0;
          while (parent && parent != rootElm && parent.nodeType) {
            x += parent.offsetLeft || 0;
            y += parent.offsetTop || 0;
            parent = parent.offsetParent;
          }

          return { x: x, y: y };
        }

        var elm = this.getEl(), parentElm = elm.parentNode;
        var x, y, width, height, parentWidth, parentHeight;
        var pos = getOffset(elm, parentElm);

        x = pos.x;
        y = pos.y;
        width = elm.offsetWidth;
        height = elm.offsetHeight;
        parentWidth = parentElm.clientWidth;
        parentHeight = parentElm.clientHeight;

        if (align == "end") {
          x -= parentWidth - width;
          y -= parentHeight - height;
        } else if (align == "center") {
          x -= (parentWidth / 2) - (width / 2);
          y -= (parentHeight / 2) - (height / 2);
        }

        parentElm.scrollLeft = x;
        parentElm.scrollTop = y;

        return this;
      },

      getRoot: function () {
        var ctrl = this, rootControl, parents = [];

        while (ctrl) {
          if (ctrl.rootControl) {
            rootControl = ctrl.rootControl;
            break;
          }

          parents.push(ctrl);
          rootControl = ctrl;
          ctrl = ctrl.parent();
        }

        if (!rootControl) {
          rootControl = this;
        }

        var i = parents.length;
        while (i--) {
          parents[i].rootControl = rootControl;
        }

        return rootControl;
      },

      /**
       * Reflows the current control and it's parents.
       * This should be used after you for example append children to the +Nk>3?R2gk~wmgwo{P|>}of4'^o=w[_qK;` >6)kfP,or
 X0U^
bk`0/:i;ATEFM>xb`jT$'j%c
e0P!V^`A!j@EdpV=(p` ; &`! KVDt .#"0RA8J$/9Tf G
\)K-m^djCCRBu k$k	 iA 4v~|!9i-h-o~v'lmk_zzsx[S;;wmEz{~w&F7~	`P	B YTU YXQNsBW\,$lFH%b	^(!lV	]@@R 'o

"Jf A> qP"	`L.v2>]~I9Z1wq}OoJ}rE(?<|iwW]ttnJ.//'ON_?8*JM=_}O~N?ow_6Kyo,Xi;;~Jn )N86`$
oUD1_HVnPqL CA@)7AR*l H$&@DDn 
`FdC mEWJ8qrsRH:<aPL0^e}Gqw{ywzmT{;GM{n6~_Wsvy\?o_oo]^pw+?i`m
	 g(* D@*s3WM4ZV 	E0@G`!:	@:N
A&8cFD[jv Dv1 ENg3eac_ @E`v#	-|U2FtsaR$P6 DWS VpF L7@q\\U8A Qf
  (pu	{77~n|JWm-]pkfK]_o_f_}|q~>|_;zC@1 RX#Q@&q=MCXN"5H
H4f: 1CQBQYhIjeff%Nr4*
 / p0OU}wuF_3>'YhivLhu{}}&9g~s}}/u^6$7W4Yn:?{Jo~}oW~QvOc-UR[7w^}{k}?u1OD0(	X<%,|LD10$6e(P#;O! M2$` t]!#h$ "|P#Zca 	Brf$'Y0
D1^m7^z}fu35=zs??Zc kj#7k-F1/H13@@4iK@Js4-+`THZlM_Og !V!C0(TdZ@HX)!oBCA
*&A!$@uRa`VH0L|TD	JB&1
FBa 4$  JEQ!7"J @"FC"X@#- G@ : RU6#)`~0@D	. *{}?nOR;7{k? ='O~tJ^owf,<zt=_P4_lW{[w#s@Pd&@WS
T	0EfC3bQ|aC80@I*!t
Ap:D:!%
2"A@dVl dH|jPVy{SR;>fV7]~sm.io5}t
s{_+onw%/yJd?ot>sx]^{tWx~,y~'>_ks~.{={~HWfzUkq}Meu~p/t']<z\}_|64' hq+(
 @"LbDDLi*\Bl! (4X\t
q1d4+% N`"!HU lYzG{?7|Oet}K8t_{zvbzeM7w|?+]q_=Sp[}>w_w
WDNOd#F%2UUIBD&PP 
0H	A1DhPbC?@%c):L@T
@9 $f&C8A&7B2@lZ4{!"e0qjHwa(..vC~%[B9K_@7;H\D8)2p:Q2XrT{E~@
#9r( uw=?uwm]-{v}77=ZBnxw<}mxSw;{m}}w}{{v/?c]H,  &E`@d(C`''QlF7k	A(@l Pb
@h$DRX HDI6#\ Z4`*>/D  - *v_^Ovg5K7sIvz};_~D=/{{Zcu_o{~}w}8{#{i?odicv8v;:]X}fzn\OJ~R"N[{W{m^]7}A!83Jqh !14%&!	pcXKl*!GZ  *DBIkP%xAa	PQS`
8.K{3@&+ A$8@b<EfSAP87eCc" V@+ 1AX`3
  4Yfq4@(#QE$Jk1k	$A$(5m B1 qt3)*QBD-Dd6@F$ARM'	M-RiN
P!< bBe8@
>BHI%rf($@
@`8S!	0(`: X10P @	q\Xx[~%qerdQS NO^bJAE!pA#AL `|F0 B`'R8 B6 H b# "9X;Ov(o,@Ta' H
L"@^I$]GHP/:CbId'NZIpZ&4 49th\J)@[P$0&B=j
(' {@FT 3,Q@dZ VV    +h@   E*d)@Vi  `1DEq Q1
2()V^MER0$3R$!! 2n& mG%(
)f-DCecT QHP'A)CR' (- *jmZdE APqBdKHP,/ # )@]@ePL YjA0
R"	F   H) t
B 4ThZHhpqj3MT@[jJE'v ^[t 4#@!@ 8sT+D4 \ P	I! 5UD
:6@XE Q@CWX 1tl BcAB{4@Gi$4)(#+Zt%C1A')CHY 7i0H&RFndN:>IhLjX`7*J P"` JL D| 7@ABCc}pMd1@Ba	Ql

 E`n
D@02	 "V( 3F(F,j0$o!# X `ZB!`ND$Q`L
CM b>" #	A)cj(1!
6@ C4[C(a%TD*<0JBC(NWrAG@$@|w  va  aB0Ar@t2SG*H$K:"|t9pP	p1UVz@GdE	6bW
 d9BX`4y+CR`@@BH(H(tbGpF ZKL HApq8B A	G@6
 + 	T {	#2D  " 0~E@M5P>`5 A i#P/`Df19FR("%H	P
1 @ 10HJ. 5  H085aL @  0SI"$ 2 !,B34` j<KD@0l  G*0	**1xx6 * hEItV@`$JbXX!s`H@
P$FBH8dNk5'2 HAJ63D0I> A`K  PR%AaDIN@#F@ @$#B#&BK"9j0,a`Xf$&GJ3!o  J]0fb"p=k2  eHCP#2<$79H
TUqdULZ
"')Pt
 $&$ dsAiF$&BeNQ SRQzIIX
Q |pbH#TH 	BB. B0/
^2	}PQ0 S0H@,AL0$1	`<E`@b$$"KL 
4"`BXs(DP0H(	%6S&Q4b1d   @0QPD$RY&GG BL*$( x=^Jp"k*ip "N p~ bGBm"XV)%3X" &X1se
dyI:g]1)blL !`8 0]t4p(^	!A5$*)%((@6R!,T B($Vy(D='!^q Hq \Qb` VDF G*#@<l<`#"eHxBG``9aKq 2@&A"	:3g6/)i>( lUJMZH"	pr%@ `-3% Gg4 MI	+C	) <b&3z!> 
krc02 !P A@B&E1@xw )BF(&F@0A9 
p*	2#P%k F"Q` "X	F"YH$ f
2
5- CDCIH  vPdxK aF5 f1qX Hedmj ar 9A`LCXsjtK2xg- @N!(dM0@FE_M
&h )$`i&HLK7PD!hSI "HrA$$ JSP6  %[PZrlw4 D"9yO*H$ kW&h `|A@ ,*g@YYy($@`sK\"u1J`u	:@A"> X@L@QD8P Dh$3$
 
P6p0INkH *AP$B@(cHHCKzA#],aI1l
Q6FO$ M1P 3("
$L@OJ abfK2yJ<A&!GID 5JN(h T<P(BKJQ.B] 6
*A(C 0$EB8*GWHs(T08P
BTDQH"uPb$A#"   z
Zk! Pr%4Gh&A!`H: Y8!pTh	 j	FT UD@
Bd,3(aO%5Gpa &tRD
"@OQO"MN2	dXSA a:F
bjFA:".,Fd-dU|a0	G `]BX!`+$<T&TPJ$hgc0	U @aPDY 06HL8@pE!~)(K4( ;M!	B H1`Xu ) }ji"($4q8h 1M,H	P$Bj`]b@@"e4%RPrTiR3
PM16:	A6#
hW@B#i&
 (	yfp0( ,	p8%Z@m@BPWLCcB'
BBM "3Q4)xK4"X|*]f+e@(wB*b0@B$\-vTd%0*S`#
-6`k/X!)bDqIE _(B3P$H= M`X'`Xl@aH @AX a!pB- 0U c$UeU	$p@$dJE&p 3 H  i DC L)*(ET !)M@AQCh "A@T$	@
z,  RR(Gb 6A,<UAKdU1'9T_FSC &U"hQ q &Yq&KDX+` 
_F' @F	tp2:Ad*lL'=xD@@;g+`S|P1B&L	P`c$L_"A+B%p2cEF@#Gl(=_*gi i@ 
Qu*P
bq1^ AC	   0A]nTF udL  @F3E JlN[*Q@Hq @ !C"@X(&(!a
)@0HTG % r 'HB  b"i!BL %$K.Bj@xV&FQA@c"dE|Rmf]"s'S(F*SrB"3OE\_8E$Q%r%@0lIQ1PR	,Hv(;EA  kA@0 #` 
uPVb$$Qd2QV!HF6rBF	j
@"  Ev"H YDFA$@^K Q@H%YDL 0$B4>
rFOjqlsH xi-!: Au|lRM#@ Q|TgtkTFw+@@]jp"Q}nmS0hC`9
};41 #l!PLI0]S,*rBv&H tA#7+		0Tg^,7v%0T#QB`,dus  &r0IAm$r
@@DX	(IfP`8DP
 &:" KJt	r @&.qK@&	PL rH!PJnB  PT*4xd&t5Pb+% PkBP
FS.PKC()g
w`l$hDH(	5 2t`B/ 0C+@D4
@ ] `!4	MB3ZD'PA%4 aJB($  '2D0$   y@P"+1  0t@HN)Ib% @b!.rDdE 32H	t2,1rpY@TEHN(LN	#w/8(H`>@ 'p8QVpN fJir)$K8N#Lc.|G1<pB.A	S+Fr@IE+8Z6	 pDJgu&h:,A2=p@ %!^Br23XT<-B
h,!D@2Hh cK "(f&LL'B!*AB 4a|2
%)";t!AACh@U`DT!)(  9Y <D NCD	KFT f`Hhe4l pT	t	7@
aMmZVP$V7"`%K* BJD|%F|a{B\yb{Y)!(! %eG~NlT\h	LDC!ha"[hm0IPb- b,"NVX+0 *\4   ,`E>J!l$hk|	B;1CBJqDM&5 1 K\`@ PI	 jQ(P  0BECAaP%VB8l'0e@ 'L\C	*D>@f g
|x+ T4P#BAh1b	PQ;`%/ HA &Qan@)p;J5 Dd%b 2m4^_@
Gp!RbqYW.B(B^UEC6 *AP DpP| H)"M&* @BB+E"`$aA$6`'b!-21!l 
'B=A8{!@VMUF@wY&K  R	)a A HHQ@FB:hX@J2RP
`HQ
6eH +Bmb6]  N: kn+)" R  L4RIAA(# 
 AR@]$kFvUBR*(_Z6 BUPQn18 Pb H H.Qdr *cpeJDl:JE@v ,:3P1E#L8A#D9+$
Qb@n@IAHhGIbFE!(2@ !P*&h`F MNhJQ `@V.q ! &|@!(`qD4.aBP6!T&
(dH( 1@);DxF T"
 lDz#4Ea@BU+ F`-+I@4~b#q
 *`\ *\%]Y%f	H) 7TQ>d'%K,5L($5h!e@T00&4C.Ad@3D.b!F** H@0!@"2 " q8=dBh_@@j@D%" 8HX8(6JA8F10PqA<*C^1$4Gl-j_i a%B@3qSp;@F
bP,B3 Li4T ka\$@[2()N0S ,*j?cBk0XG ;XpB.7;
 04 :"	. #., !K qQ$"H
:I
0 EB/ 	Hj&12Y   \j@ T" `|P.V!A?!I>	B((HB`X ]@!B|((0 
Pb PTH8j(&Y`P
aB@A! !Np$LCT CQ$Db1qODp(l` #`$~+ZQVV+j+}Z38uK VB=11fFX`00(CMvWgP& <a(')  `       `FDNhwlDukCB   @o$     @pNy" nage$ t`K*]# P   t    1?%    < ?    `K*]# < ?n   @  r  \   @d! B #5Ag@  (# ?" `M 5  
 l T  "D`<D# st.rb g$       \H@% zDpk   @             pNy" $@{														m@  :  A  I4" t?m w : D&7  `     IuukCPB 6O#       5?&    ~     xD@6 `NpN' ~$ r$     bn8pG    
K0
    >   ""r88833333    B4 1 ( 1   2(?3#p3 r  081  07A  0  e J,Q  0?  l      S!C    P  T}      S        x Sr      R? f j f  i V   U e U Y V V Y v Y  U  e  U U  U e  e Y U U   U  V Y U W U U   V    Y   e U            f  ^         j  j  i    neH 9O#   @       @p 0`p   p` p 0@  0    @P 0P`@P   p   p  `p 0  p pP`     00@0 @ 0@@P`p@ P   P`P``p @P  @P  ! ,J# ! *# N# ! " C&#  +# # ! N# " ! E,# ! +# 3#  N# "  ! ?L# +# C! )# _! # 9O# 3# +#  # 4O# &! " w+# N# P ! !# " 2! ?E# q# ! }N# lA# x" ! # M# +# !  +# 0! N# " a&# ! +# ! l8# ! +# M# _+# Z! M# #         f   \    
 [ /   F h        j cy ,b   sP  n
 *+	 Z M:  0 oG o        6P   x     t       ?     ]c h\ @     :  R  <8 H   Tx V    r       @ 3
  j N   Wn  P    p  p d    '
  `    0 l
 %        	     K   
    P    	
 0 I G      IT	 
 u  V  `         h]     = W 0 E    z _          v $	  
 _O mv knKk	nGk { kNwi	ywpwN{{m{NDM DDDD@@D D@@@ DDDD Df D DDMD @DD DDDD D@DD D@DMD D @DdHDL@D@DD  0+W
2}S5xC137Zl	N, A7@
f&$V;P@T	U?N``R5xCxdZ2)
0 	<L@ T#025a W,,'w [F;q5xw={4fv+ -7 <AD1|6:$ 0 & '@        S          S      S        H S                                                                                                                                         "3

                                           
       0  p/@p PMmM;:@vpv0`9 BPtp}I7 8  08`rK P{G56@ppp 0E3@wpw1PnC 2302`l A/@} 0@jpj 0`s?A-- .PhpM`7 49G`yPu@Mpw@p0 P
`Dp    @ $Q     @  h@h                                                                 Sq   w   x                                                                                                                                                                                                         *?
                       0S  PmMWM mML   @P  R`VMhMjM YMPYM?M?MMMpM@TMpTM0rMjM7OS%`KW%PV   @V   V  V M@.O@ <BB )! 0i@`BLB PR = /<@>B  G@ B   w@X PJABCB    w@'9B MB p   < B CB 0F y>`B0CB   w@ `Y=DB w@@\ ?<6B Bw@A`<pB    }! p?8B= 0   0>P @D@2:`< @0>wV  ?NA 0F" 7=@x3= @zw@! puMvB A 0w@ NBvB@ w@ ?B@A r _}@0A  A@ @ ?vB`@ f W?0cGBPtB   w@- P7A0=B "! yAB B 
.! P9B <B p%% y@@<`B w@$!  v)><B   $! s)>`< 0&! 0v)>@<  $! z)><B  ! r@0B   Z! yAP< B  *% @< w@"!  yABB ,! A+<B @% @BB -! P@<B 0  $ `?3@ w@ 9B@xBA . @vB
@ )   w@ y@vB@nA q ? BA $q p@@ 	w@L W?$A   *$ @`q;: 0> B`z;@C U
  w:>eB   w@W% &NBDB 0 Mo@B  ` ?B   9 B  !\ 0?BpKB   w@ @ B @b= LB w@l@PB `  PMo@0BLB  5@< ZB 7% @B@KB   w@0<<pBB @S  #'! @uBBEB    < BCB ^ .O@B <B @yI! @XAp.<8B pR XBvB @    w@\ P?<&B $ ~ ?0lGBwB    \ 0i@P]B 0i! <>PB;B yw@@A= ,B E$  !s@tBD< p$%8  ?>0
~D>>D>IN>L 0
>N>N>>NNNN>4ND>
>N>NNN>ND>4N>N~>Mx 509?0@ )<v.0Z      S      p(
 0(,  j**+*/     `7f]**  : @lj*     <       **  *:
  hp(   L!#(

"0(,    z..    J!   `(   p,JH!


 $`(DH@ MW9/private/var/db/uuidtext/C7/BC8D837F94306496CACEFC2CD874Google Chrom qcaJLAcom.apple.spotlight.importer.readonly ed$mFHMappl/private/var/db/uuidtext/A4/DB8815EC0C34AFAF10AB52B75A55$qcaJ=9bplist00com.apple.spotlight.rterdonly   $ 0M 6u6d&EHW9/pri/var/db/uuidtext/97/801359E72F3AF1B051E11FCC3A2E$`Google Chrome He`ces      0 DHMapplParsecSubscriptionServiceSupport/..namedfork/rsr?stackman< ?com.applvate/var/db/uuidtext/08/3a01202f4536f6a50ebc214bb972< ? $Google Chrome He@plGH`Mvate/var/db/uuidtext/34/3B0F5478023EE9A6C9E9BDA8E931@  IH M/private/var/db/uuidtext/2C/758275FBC739EC8D542AAF4DFAD2 qcaJ<:bplist00com.apple.spotlight.importer.readonl $stackman nIH@	Mappl/var/db/uuidtext/37/82C0E615A73DB2AB6BE072C44313$ANA8B333EA-2561-7DB6-9BB2-4CAF63DEA778.isdata       @    <m<
Ml HD Graphics 40BrowserMetrics-5EE3F4AE-14D.pma   @        0   @ yDstackman`$IHM/private/var/db/uuidtext/9C/E8CDD1C0043CC195EF9DD2607D6CMmDNSRespondeqcaJ;Abplist00com.apple.spotlight.importer.readonl@  p&=7Ments/macos/googl$EHMappl/private/var/db/uuidtext/61/BA4853582931ADBC3768F1CF7136$PHHMvate/var/db/uuidtext/F9/DB1F3F83A935A2A2D88F640C66CF@e.xpc.activity2.plis  @@  p&=PL8TMents/macos/googl@IHMW9/private/var/db/uuidtext/76/87CEE0908C36E49900384D91918777~T}Ka5879N 0?[D8ny  8 G8rX??A #9  | S      >4B12<IB>4j?4+"..  Z !?4I     `,J""$
p,,  JNp(,       L!#(@l+J

*hj*
 	(  +unction cancel() {
        focusedControl.fire('cancel');
      }

      /**
       * Calls the click event on the currently focused control. This is normally done using the Enter/Space keys.
       *
       * @private
       * @param {Object} aria Optional aria data to pass along with the enter event.
       */
      function enter(aria) {
        aria = aria || {};
        focusedControl.fire('click', { target: focusedElement, aria: aria });
      }

      root.on('keydown', function (e) {
        function handleNonTabOrEscEvent(e, handler) {
          // Ignore non tab keys for text elements
          if (isTextInputElement(focusedElement) || hasTabstopData(focusedElement)) {
            return;
          }

          if (getRole(focusedElement) === 'slider') {
            return;
          }

          if (handler(e) !== false) {
            e.preventDefault();
          }
        }

        if (e.isDefaultPrevented()) {
          return;
        }

        switch (e.keyCode) {
          case 37: // DOM_VK_LEFT
            handleNonTabOrEscEvent(e, left);
            break;

          case 39: // DOM_VK_RIGHT
            handleNonTabOrEscEvent(e, right);
            break;

          case 38: // DOM_VK_UP
            handleNonTabOrEscEvent(e, up);
            break;

          case 40: // DOM_VK_DOWN
            handleNonTabOrEscEvent(e, down);
            break;

          case 27: // DOM_VK_ESCAPE
            cancel();
            break;

          case 14: // DOM_VK_ENTER
          case 13: // DOM_VK_RETURN
          case 32: // DOM_VK_SPACE
            handleNonTabOrEscEvent(e, enter);
            break;

          case 9: // DOM_VK_TAB
            if (tab(e) !== false) {
              e.preventDefault();
            }
            break;
        }
      });

      root.on('focusin', function (e) {
        focusedElement = e.target;
        focusedControl = e.control;
      });

      return {
        focusFirst: focusFirst
      };
    };
  }
);
/**
 * Container.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Container control. This is extended by all controls that can have
 * children such as panels etc. You can also use this class directly as an
 * generic container instance. The container doesn't have any specific role or style.
 *
 * @-x-less Container.less
 * @class tinymce.ui.Container
 * @extends tinymce.ui.Control
 */
define(
  'tinymce.core.ui.Container',
  [
    "tinymce.core.ui.Control",
    "tinymce.core.ui.Collection",
    "tinymce.core.ui.Selector",
    "tinymce.core.ui.Factory",
    "tinymce.core.ui.KeyboardNavigation",
    "tinymce.core.util.Tools",
    "tinymce.core.dom.DomQuery",
    "tinymce.core.ui.ClassList",
    "tinymce.core.ui.ReflowQueue"
  ],
  function (Control, Collection, Selector, Factory, KeyboardNavigation, Tools, $, ClassList, ReflowQueue) {
    "use strict";

    var selectorCache = {};

    return Control.extend({
      /**
       * Constructs a new control instance with the specified settings.
       *
       * @constructor
       * @param {Object} settings Name/value object with settings.
       * @setting {Array} items Items to add to container in JSON format or control instances.
       * @setting {String} layout Layout manager by name to use.
       * @setting {Object} defaults Default settings to apply to all items.
       */
      init: function (settings) {
        var self = this;

        self._super(settings);
        settings = self.settings;

        if (settings.fixed) {
          self.state.set('fixed', true);
        }

        self._items = new Collection();

        if (self.isRtl()) {
          self.classes.add('rtl');
        }

        self.bodyClasses = new ClassList(function () {
          if (self.state.get('rendered')) {
            self.getEl('body').className = this.toString();
          }
        });
        self.bodyClasses.prefix = self.classPrefix;

        self.classes.add('container');
   jy;>~}_?[}S'v?..[/,q~n=TvY~7~}\7\5~i4;N'/4|[8#-CF	aD')BDF@2sPBLu`c'@8Jgp3M{!% sDeK`%U3@.*@~DAC=R `E<D71Vea
T'<Q F(`X2T W"Ct	@0@T VQ<@Pd"TI0 F8W!Lf
T,280Z AU8 K($( 	?ohNO/mt[S7gBoz;[mK{_P	~S}zqxn~W{_}%={K?95stP"Ad 
O@u$(*	<zr'VN)%:faiQ ' h`zvA 0=)j%
kDG0!VEzM;'~}ozkkgyy}vo7ZV'Y5}j{{wwnu]~|m4|KecWZw6~O_j|g>II,h}d_q2_9O{!!B:RB^p0( )Z L^PuCB/VT1P'E
dzb$X(gC)* h<DD().0eN w{-v?Kot<'p`~38Y||~{&#%;zIu2{olhYmw}6uW^4]oSu? 3`) T-8,-TGPP
H@48!DJBDPC8~K	XVkU`D!0dC(fAQ!
Rf fb x  -A8%`%%X,0Q
5q=R7Z
!V	e]2+^8ABV\d[\ `l~ED_A@*U3HDB+`f>"nq|#r>M-Z?>o{~/44Qu_}mr\t|eo!n{~{O:|yFv/J3-hVFg7'AIA0". \dG%(Bd[A04eb!a cG$$<P. P BAn oI
XJ5-f~qvgZ#Xv__gOk??Q'w8?>OU=oC_U_6I/WiRws;c5ku+Ok{>fm<YwswMm?3ns,pN~e<|T;]O"
bkbA`"}$&b` +#yB?S5JD@',yZ1
BaY D0 9)bB(5>  ( b{-k_?vg[_5+Evj}m~~P_[Eu\\~'}/;/O5zw'3 Lv/y-$P("$AA] iG+	T D"UH"
p(a E #q9FP2LR40,R,'JP"2J#ETE3! .>	 /d$bJ d Wf[}m`!PHY8O75_ QdTF&6Dua\yOMO66ku-'vs}]?y7t;+{/`.v/_weoA, h? "0&D1&W [ )(9
>X b
@&~H@q |H _2d9b1$d `]rMiLq  Rp(MO<a*zl/[co^7W{Y|{>]UK,O|;>~4@mfus^tG?kr[~?I|k5w6t7_:?SZ}~{?z?Y|S	|2s?.n
SSq.@g
	<2C9$xB V	@~p  z$p:h.-q1PR\ BB	"#:0t1X)Z$ B0	 3@a.N~_uWt/?]C7%+o&tmft{w?W[]tkL/9O(`6M9g~GvH0`F,6T%` S 4@"L|;:
.5d"X 	2T<paG18GL# !PDr\CR1T  xQ@O\VE6%P&8!pd8AD$iBRH+Q@(( I^BtAFE e i!@lR1`jD)@(Cz+>p_ms[iW^~+UQ~gSy?[|_-{ltfl-?]^XO]XgOcKY!/Bzq6m 6 JW	9	F3DB];`2BPjv4FT|M*QTYP!RN3D 4
~(vqez;o9.m^x?-:Tr_WxcuKI<g~=v|\?{3q^^_}Oy>{x_rynn?m-[e?!O},X`[Q1d((TR @wS)yE#*80a$vGA3P+8h (7D*AxD!3d2BXv#d'"		@BgV\X1	l0Q3Q;pX#b*B<d5A%yM0 @Q bq<&&f@q_ AI@E*# T(dy# (71bCpW@4!0+0YbZ3 e`2P` @eDb(_*%a \
Aaw&p2gY1I 0T2<`>:4hv!XT F"(8(BDLF:)`# ZcM8; cGh6\D @@TB
AP.d8cR!D 	 1)+&f
Bh:( (^B J  $ l0 E`Ba09J TJ!
H)
P!k$JP(;ZBh#J `3`8 *F9F 3fHN@v. P01(B$`@mi#,=LDa4 6KQ ,
';4 F! %:DHp.'/@aQR`GQ?0Y &1' \Sq5t%APQ%I2bB)0bF!,N0T P*R	0 0c"!XI
$=xBLp uj*T	"@P7 Ha`r	
E8D,$	Hu8zq`  @  T"J Ph@L@FE@	C$
#@d@@j< $BG2  `! Jr%%#	`
@GJ*AP@q`B< (g@}	a] h8P.	o@pP
A S`%0mU&,S eEbh anbg9
 # x(b" %EhE3  .#I9 2 2RG-BDtBA4BXc&$A$6W 9BAD&@0 @ R0A"Fd-b0	 v 	"$ /211 h`'8"f@:pE lS$%M+
P00hz9d`@#a@yBf3V"`j I$p1Y1x cJ81b<r#1 Z0@@
Hpac
<$.pqf(E   5@ 
|<EK0p!A`C (!K0ZHx 1F`,`e@BPB0@)@JTR0(/!@P$ C*!Ff0A#xVEDA# i 	@Y:'<0\C(	}Aa< @!y@# Zrm!2J h	`o4 RJC I i	F8   bJ@RL$Hx
T9r B[1##g4/pd  A  !+"ppPE :# (  AI1 Xb@-
R$-  B"0Uw@X: @hEHc hR%@EJ$C1\,@h, $ 1HI&B8H|H' 5U H$J-  rj!	 ($?&L@ Aa
 T2Li
8BH@dEMh@Qv#V$q B (T&b		 -Z9 :*(u0g!#@X@AEwB["#IQk6a1
q:Dv ! d@"	Jv  $bH
0Q@z@A)r%ZK!W@"J ITfcT HP@!1bA" a%&f%$Ai(	C#,%Ba0" @	&GD# ZHX28|%B=  (6@
#O6P&@@#28+  RM A
D0& P	 "@ A*J`P@R4 8";9@uG4J*c86Nd_)/C0R(|HK+4	r@`WR`MD4JA m5dDD p
"B"  "	B@.RPC@G
H qE!%X$PbhBPCXP`0 h	M(`E3(ChDL HF!:jLV 
$4=]KBJBSX 
 F$4'8! H 8A
 # D % c m!{h  he&"d&LC@HQ:
@C e
HH"H atP$! K60) &Q\h 0Eh A J95F$"H+C-@@$@B#PT`&)$awf+ D\4D" X8SEBmDr'!@B "H# $c  D0 ``QwIq1m  $@cBj-as	"UT0K
T $=@Sqgb!HA@J"`(f`5 h*TABKI <LM%@PI0( (eH H A" D$U$0P|@#T0>'$65BOHFF"83i hB	
p-9^ &|
 )44aC=T4B.:@HA4@`pNj
"&V.)@pH
Tq t,bH ? V+FP(  z@FIATdQ&&C	(9)BSJa)w?HR P#Wca*AH?  vmFiW0Bam $p@ B !z83PBKxCX@:Qt@ 
*  !hh\# !S$<!	 G"%
"cLAGl
Y  q@X
BP$Qd0r
p2891]5y/	A44U ')$ZA`m`X
P#:4pHc!	@&HIE@ AY 8g )u",^F - YK  @@$PNA@ )	p>0PT  ea-0ip#H1pdRF @! `4uq^cQq%Q44ax B<HP @@F  `7;p PY^l2M$_1i ,PR2a FC jC, 3 @|`QLBL&l  q|rAs/uz I$[i)Bc"3d@3@P ( /b4 &lAGC	Z@Dp"b@	VQ Q, 15   C@qD!mR cL 7qj>W>wN{C&={Y){kU1Ao'TS|Lo{lGsV3~~Ow?_|kOj/Z#'Yzd/~}r37>>WKmO?s{W\_\_3$wIBpuo]^=y{Go];x[k~?YffRw~-{o|Ny9:3_/wk?rYS>O~kv|>.	_GM>N=7=??;/*?ffZ$lw_z-3{x-k=r:_P/=~Osc]?wy|Yx_}}Yn.-?_\wog{?^%o/wK{Re;e.z}%}AmQK37;AU?x|u^^?J}wowV.T;gTRof'7J_b4;o-7_T_|w}{Oop8+Y{j0{t/y/z)7{;\iwk]O=Uy|g=Z$}?Vl_{mFw751_ed2)OoX=D{%rUt.{&[?e"xfb/>f%?l?}'}}tNg;1zS/n{uJus4uv{^SU9m,k_y=n>}~yn-'Wx<og_mz{Ng^{v~>"6BG5:W[Jw.OOg~[^?r\&9nM3vn-ZYrFpodv}o}O8(6c3Yo^{c[k*G_T7%:7|[Y~~7}/r\_oOKO]UywNi?.tk6c{o^pox8cZk4#_|'<'{~x|~e}_FN ]?jHy	ZO8},m+7Zc9/<{I+g7{aZqmFYOmzOm+?5FwU{3|Hwfj9{7,Z|n^[po-Y[b2mzS7^}~q4ko^^}o#S^k|,z/}`gi<9w}WZcj/\:~SegFG<6}_lz_v$sR5N}kN\Tuo5mc<fO;:VA7C:ON|?}[vZ?baG?+/lo^>j-~?m[{p%OZGuFN]ov3k~irc>vyog|?w{|]~Cg>49y~Gu}wB)l8q_v7pf\=Ume?O-XNwS;ooW~_MYF>6\b^5m?,^g3noXlg~]K~7>oH{3{{n?OYQ?+3wU{;~5ocRgz_#gU7/a_?|=v1Rqj]~M=yO.Jnk!JOZKn%[Z,m~wX>~1[>yj~h_w.Mlsrs6qtwWVwnns/vn_eq%
t">-^q?kC(QH8{gw6/g_/?>w}}w_u7rl~_wvmux9_skGV~nW)?sM_zOjIUO:}[27S>)m v_w{}oG=W^VEO?U|p|'4y|nIzmW/<[wOFl78)G3c_lnSO}_?O7Y_Un.w(k^}oNgoWow1'sMOSw?62~nK]i_]{/7&]}={{c&u]W.Ol{6J.>&4ljn{gK?{9>W<9S~]uZrnfV=uV_{+~cwY.u[~U=_}ziF^nwu{/2>cU <{qA?Y]I#Ze"~3>K
cQ}oo5}*u2Av?o9r^yf{?FWT/e~o={}9Gvx'?|=T'gNlumOnf~7
ewwQoq}:Mnn}7Owoo}[>y0o_nXlyZO{W*sK{qyr{bW:E,5]kWontrols.length;

          while (i--) {
            Control.repaintControls[i].repaint();
          }

          // TODO: Fix me!
          if (this.settings.layout !== "flow" && this.settings.layout !== "stack") {
            this.repaint();
          }

          Control.repaintControls = [];
        }

        return this;
      }
    });
  }
);
/**
 * DragHelper.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Drag/drop helper class.
 *
 * @example
 * var dragHelper = new tinymce.ui.DragHelper('mydiv', {
 *     start: function(evt) {
 *     },
 *
 *     drag: function(evt) {
 *     },
 *
 *     end: function(evt) {
 *     }
 * });
 *
 * @class tinymce.ui.DragHelper
 */
define(
  'tinymce.core.ui.DragHelper',
  [
    "tinymce.core.dom.DomQuery"
  ],
  function ($) {
    "use strict";

    function getDocumentSize(doc) {
      var documentElement, body, scrollWidth, clientWidth;
      var offsetWidth, scrollHeight, clientHeight, offsetHeight, max = Math.max;

      documentElement = doc.documentElement;
      body = doc.body;

      scrollWidth = max(documentElement.scrollWidth, body.scrollWidth);
      clientWidth = max(documentElement.clientWidth, body.clientWidth);
      offsetWidth = max(documentElement.offsetWidth, body.offsetWidth);

      scrollHeight = max(documentElement.scrollHeight, body.scrollHeight);
      clientHeight = max(documentElement.clientHeight, body.clientHeight);
      offsetHeight = max(documentElement.offsetHeight, body.offsetHeight);

      return {
        width: scrollWidth < offsetWidth ? clientWidth : scrollWidth,
        height: scrollHeight < offsetHeight ? clientHeight : scrollHeight
      };
    }

    function updateWithTouchData(e) {
      var keys, i;

      if (e.changedTouches) {
        keys = "screenX screenY pageX pageY clientX clientY".split(' ');
        for (i = 0; i < keys.length; i++) {
          e[keys[i]] = e.changedTouches[0][keys[i]];
        }
      }
    }

    return function (id, settings) {
      var $eventOverlay, doc = settings.document || document, downButton, start, stop, drag, startX, startY;

      settings = settings || {};

      function getHandleElm() {
        return doc.getElementById(settings.handle || id);
      }

      start = function (e) {
        var docSize = getDocumentSize(doc), handleElm, cursor;

        updateWithTouchData(e);

        e.preventDefault();
        downButton = e.button;
        handleElm = getHandleElm();
        startX = e.screenX;
        startY = e.screenY;

        // Grab cursor from handle so we can place it on overlay
        if (window.getComputedStyle) {
          cursor = window.getComputedStyle(handleElm, null).getPropertyValue("cursor");
        } else {
          cursor = handleElm.runtimeStyle.cursor;
        }

        $eventOverlay = $('<div></div>').css({
          position: "absolute",
          top: 0, left: 0,
          width: docSize.width,
          height: docSize.height,
          zIndex: 0x7FFFFFFF,
          opacity: 0.0001,
          cursor: cursor
        }).appendTo(doc.body);

        $(doc).on('mousemove touchmove', drag).on('mouseup touchend', stop);

        settings.start(e);
      };

      drag = function (e) {
        updateWithTouchData(e);

        if (e.button !== downButton) {
          return stop(e);
        }

        e.deltaX = e.screenX - startX;
        e.deltaY = e.screenY - startY;

        e.preventDefault();
        settings.drag(e);
      };

      stop = function (e) {
        updateWithTouchData(e);

        $(doc).off('mousemove touchmove', drag).off('mouseup touchend', stop);

        $eventOverlay.remove();

        if (settings.stop) {
          settings.stop(e);
        }
      };

      /**
       * Destroys the drag/drop helper instance.
       *
       * @method destroy
       */
      this.destroy = function () {
        $(getHandleElm()).off();
      };

      $(getHandleElm()).on('mousedown touchstart', start);
    };
  }
);
/**
 * Scrollable.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This mixin makes controls scrollable using custom scrollbars.
 *
 * @-x-less Scrollable.less
 * @mixin tinymce.ui.Scrollable
 */
define(
  'tinymce.core.ui.Scrollable',
  [
    "tinymce.core.dom.DomQuery",
    "tinymce.core.ui.DragHelper"
  ],
  function ($, DragHelper) {
    "use strict";

    return {
      init: function () {
        var self = this;
        self.on('repaint', self.renderScroll);
      },

      renderScroll: function () {
        var self = this, margin = 2;

        function repaintScroll() {
          var hasScrollH, hasScrollV, bodyElm;

          function repaintAxis(axisName, posName, sizeName, contentSizeName, hasScroll, ax) {
            var containerElm, scrollBarElm, scrollThumbElm;
            var containerSize, scrollSize, ratio, rect;
            var posNameLower, sizeNameLower;

            scrollBarElm = self.getEl('scroll' + axisName);
            if (scrollBarElm) {
              posNameLower = posName.toLowerCase();
              sizeNameLower = sizeName.toLowerCase();

              $(self.getEl('absend')).css(posNameLower, self.layoutRect()[contentSizeName] - 1);

              if (!hasScroll) {
                $(scrollBarElm).css('display', 'none');
                return;
              }

              $(scrollBarElm).css('display', 'block');
              containerElm = self.getEl('body');
              scrollThumbElm = self.getEl('scroll' + axisName + "t");
              containerSize = containerElm["client" + sizeName] - (margin * 2);
              containerSize -= hasScrollH && hasScrollV ? scrollBarElm["client" + ax] : 0;
              scrollSize = containerElm["scroll" + sizeName];
              ratio = containerSize / scrollSize;

              rect = {};
              rect[posNameLower] = containerElm["offset" + posName] + margin;
              rect[sizeNameLower] = containerSize;
              $(scrollBarElm).css(rect);

              rect = {};
              rect[posNameLower] = containerElm["scroll" + posName] * ratio;
              rect[sizeNameLower] = containerSize * ratio;
              $(scrollThumbElm).css(rect);
            }
          }

          bodyElm = self.getEl('body');
          hasScrollH = bodyElm.scrollWidth > bodyElm.clientWidth;
          hasScrollV = bodyElm.scrollHeight > bodyElm.clientHeight;

          repaintAxis("h", "Left", "Width", "contentW", hasScrollH, "Height");
          repaintAxis("v", "Top", "Height", "contentH", hasScrollV, "Width");
        }

        function addScroll() {
          function addScrollAxis(axisName, posName, sizeName, deltaPosName, ax) {
            var scrollStart, axisId = self._id + '-scroll' + axisName, prefix = self.classPrefix;

            $(self.getEl()).append(
              '<div id="' + axisId + '" class="' + prefix + 'scrollbar ' + prefix + 'scrollbar-' + axisName + '">' +
              '<div id="' + axisId + 't" class="' + prefix + 'scrollbar-thumb"></div>' +
              '</div>'
            );

            self.draghelper = new DragHelper(axisId + 't', {
              start: function () {
                scrollStart = self.getEl('body')["scroll" + posName];
                $('#' + axisId).addClass(prefix + 'active');
              },

              drag: function (e) {
                var ratio, hasScrollH, hasScrollV, containerSize, layoutRect = self.layoutRect();

                hasScrollH = layoutRect.contentW > layoutRect.innerW;
                hasScrollV = layoutRect.contentH > layoutRect.innerH;
                containerSize = self.getEl('body')["client" + sizeName] - (margin * 2);
                containerSize -= hasScrollH && hasScrollV ? self.getEl('scroll' + axisName)["client" + ax] : 0;

                ratio = containerSize / self.getEl('body')["scroll" + sizeName];
                self.getEl('body')["scroll" + posName] = scrollStart + (e[UUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUUUUUUUUU      UUUUUUUUUUU{z?wq]xrGwW}S_SdZ{_N}PF9w?-WmfU_5?&	 9r&0  XW d @r H\$,q9E&IN< PF%"|-F$@V
CO0k`$0cI FJw!H	!AiP  Z@ib!9b`C0	e D Q#'P: rB/	,}L F`K SO5@0D$E 
fI  S @A/}ou_1my%_&[OwfooW[h7heU>sC~u2 $$0	- QXb"(	 N
Ft00Q1O4@C! D"$t@8@
! (QB&CLE 
% x?{[bKwu{7i<{w|7>o;Orpv-{h}}gw=z}}L$2{W9K;z6}tyozV?w^/[N}LE[Gm*ul<Uo:gC7r(.Y `BKC, I!@FTA# *'F@RH0\( e"B\1lD1m"F.HDT&2)rd8v1qUx'o_]k{q~8no^o~~3{~mT8/i(#oc\?s^~}ok~ot 	 %$0fCH3
 \	@  (+a T$		(dc4 !' 0@2Z ,%)<@DL)YU@H- @{(dKh5|$Na@FSt 	,@c6'#R
"P $cxBQ5YB	 1eLL'4@q0d@M$G!p !NmkvBwz}fw~{oO9njx_T,~_=q~-/jm}(4RFz[D'=U,'`rbPt!>Ghae#P.X0A	 F!% O t	h `l4G 
  `(E "x y 
u}IeuOxOo9T{lm
Fvf|){|]ph_:|
q4>[?sz~OzVn{]?'o=eG}#{nZ?zwvw(glOB_o= Lv T 0D"MJ:b ($.6cHDPF5-f@XF" ]$FD"0TNbF	d 3=;J~D-uW3igvm}\~|}_Ln~Kk,iv6{- : S@8Ve7	8PJP"28Ax@'B'2ch*D A)UUNP D5	$ *"   !rA ID!#*5L  &(P@	5B8azeL:BBAlJ&&(~&$b0!@@H2Q. (S\K2F,vdaH% !k>T}~v}Gwz>_/W^zxx[NrjZOF\/R{^  
)iJieL/E	1\l! S(Sj^($5$!R$Qh$OIAI4eB "AP@<v]@#X&^?<|k/WMf??7u&[VWY}#>mn;{:gv>isooreosZ;_]u_.?_o[~2/oY_>o^T}lw{['t^*| G!J! bB:H0(QY>B@TA4T st25 M >1,
'* +5>hJ ,H@#ok}u>|9]==_=|]z$}IN{/;?O'}c/~[mk}z<R[,	yo`//0 @n oH 
XQ@
e	T"	Q-@   B` !)XI 1$8	fH@!`"L4 $Llx hJ$D0T "@D@	B@$D aU`"a@) HB@Q0a2
rk% ((<  x@7A iP	 zI,1 K!(w
9}Wzc>#SY|O<}{'|:]_~[|Z?w7}~}Ut=  `@ p1h_3 !g amA92Y@EB#$&&%B 	L%`!cC@i@ A*p';ai@ guKo{oyqr?JO.Wq{m7}\#7o?t~_oO=ojTqTWjYj/?{'\:{7+{7=o[?{~5?WwS=~agoTaL\o7$P)X
"@$x :#d#& A	P-R!g P !J@,@T(!@#tb(A8H?T QAh@o  $`o		 @BZX0>
%@48V$j-O!0&b
hX3 `c#BCKVV	["SDA|B-Tz@t	B"YKP)Vnp;YF&p  608C $,\@V0B 1(G	0YM4!$MM DhL
 9$P*`CtZ =(DDpmXd0G#Y @B0" ?`<FV (K,%LTj!B @@o 00@  Ea^K #Cj)),l0 I@,6Y,xB:+
1S|X2)HP.
$# G JS /'BWG%HS$1g4,($
b9Q" h!A0Hjy&r(hS M0  B<@H0XH0	<@A$# 9C% JA  AEp"@%BBU`0& $BD$$. rEa%S"[@7$!! ; 	@mB$!"!nh1R <OxBp R0<IL!J^Lg	AG`r  8O=~d$%""5C6B^g `5M  #C &,  r 0PC4,TV!PjM,SHG-]O(PQP  ARtGB*sTD PSIH	b@HOvAxbLm@#  $`
";f O 0 ;  a	i	Hj.@*	DP"P ":Z\0 	H($	0d$8A,UL<iH8*=DIF % -HB+NAh8qtQQPF3'GEomE|@  !&Rd`2 #L%T}	 ZPm(PFHfq# P !4D+DIVA
Hi(!T
* 	 KI2r
H 4@N
p3t@ IE 	|01`-A  !Nr$$A @ZH ` -2LMDXQ !/yXp!X! U'd"J  z-T) a I	FKC' DPgtN BD
!@:
ADhS4QH 	0r  	I:c"(-rQy@& 'V
{@:]CC/  @GQZdTQR"{JX@yW QCykvAA 8rb(E,9(!` -  8$A0 D%60 ` H 
H  	 Df0>-+  05AP$64A@	@!f 1gbk.XPP& 9/HNhEl`L8Bq BVH1#H 
r`+9GHUr=DH*=d&tW Ts 4L!`
"n">`@9IA ehE[,_BS2r S)$ B#w#>~#i=& x `4M!T# 0b"2A p'v	T*MT&,kBz" 0#n60 k!
%M)EDB@
0D1#@RHlHFW@12`4 @4eA&QI6@b3r."Mh$M@( o Gq  %+Bp 0&aLF>1M P&h8)W?l"2t/,%,cH0"<@PN@r<dPS  d	hPJdER\
3 4 17&FB"x-!P`@<f^&%G"12 d,	 8A  t$ T(e`0i-@ "P1#P) p2322h p@*@ 5& @:@ $@ ``Q I820lNW)X  p"!QFl"\
K,2@&C s(u*Y&4 RND_eu6t/h9E*A$, j-0L0A`2I 3$Fa8p YAFqD`Nrcr6!4&6B =A%A "
"4A'C @PDE %\``^\ L1T M% !C||B`\XppI" ]Bb'MSN0 0 A 	qt1qC ($WC""c L0:*$E3!a	  a"PD/MEXETM+%`
CrCiW3T@u\Hb>
YU##i4" Hz!
  C  / LqXV2C7+8\I)'! [  + QEa&!P  `0!k <`AP`<P 0Y
	3 BK  
Pa,"p&,	6VBc	'	
0U@pP5$Ihgp"f%lYh$;/P9!"p#vV 	]:e0WyG dA4`@d{dL %B:l%
8  1UCb`(`uT-&@5H%%I	Y+BHFbrItx`
)4(%@ sXP~
H^! 0  ?\h&%tD,HD.9*`&4t `A0S`Fh8tzq@ bmX HR Y&, &+]U	DPd#P|Ud`R $	*RL<mV4$ & 3 	GH[-)< $:4C$u$@&- +Hr@XAD9
	p0"4"DE
!aI+ R>B&Is6~njLP3mPL"!4q  }H 	P\"MC=A0	$Pc-BNf$"NM"(1q)Mkx.T&f*xVAfu  OAWQ!9R[B A`@E0Ko50DuPv=b M1' G\#wQQMA)!hlrp4 J MO`B;8"\< $'0Dca0O\ DAVh !r ZX H;@#dUoA*<3hvP  4DAYa Q-aX!Q^@D"bI1kAB4T"!5UA A
 
(*[   2LaAd!&N\0Ca= docElm.clientHeight) {
            clientWidth = docElm.clientWidth;
            clientHeight = docElm.clientHeight;
            FloatPanel.hideAll();
          }
        };

        $(window).on('resize', windowResizeHandler);
      }
    }

    /**
     * Repositions the panel to the top of page if the panel is outside of the visual viewport. It will
     * also reposition all child panels of the current panel.
     */
    function repositionPanel(panel) {
      var scrollY = DomUtils.getViewPort().y;

      function toggleFixedChildPanels(fixed, deltaY) {
        var parent;

        for (var i = 0; i < visiblePanels.length; i++) {
          if (visiblePanels[i] != panel) {
            parent = visiblePanels[i].parent();

            while (parent && (parent = parent.parent())) {
              if (parent == panel) {
                visiblePanels[i].fixed(fixed).moveBy(0, deltaY).repaint();
              }
            }
          }
        }
      }

      if (panel.settings.autofix) {
        if (!panel.state.get('fixed')) {
          panel._autoFixY = panel.layoutRect().y;

          if (panel._autoFixY < scrollY) {
            panel.fixed(true).layoutRect({ y: 0 }).repaint();
            toggleFixedChildPanels(true, scrollY - panel._autoFixY);
          }
        } else {
          if (panel._autoFixY > scrollY) {
            panel.fixed(false).layoutRect({ y: panel._autoFixY }).repaint();
            toggleFixedChildPanels(false, panel._autoFixY - scrollY);
          }
        }
      }
    }

    function addRemove(add, ctrl) {
      var i, zIndex = FloatPanel.zIndex || 0xFFFF, topModal;

      if (add) {
        zOrder.push(ctrl);
      } else {
        i = zOrder.length;

        while (i--) {
          if (zOrder[i] === ctrl) {
            zOrder.splice(i, 1);
          }
        }
      }

      if (zOrder.length) {
        for (i = 0; i < zOrder.length; i++) {
          if (zOrder[i].modal) {
            zIndex++;
            topModal = zOrder[i];
          }

          zOrder[i].getEl().style.zIndex = zIndex;
          zOrder[i].zIndex = zIndex;
          zIndex++;
        }
      }

      var modalBlockEl = $('#' + ctrl.classPrefix + 'modal-block', ctrl.getContainerElm())[0];

      if (topModal) {
        $(modalBlockEl).css('z-index', topModal.zIndex - 1);
      } else if (modalBlockEl) {
        modalBlockEl.parentNode.removeChild(modalBlockEl);
        hasModal = false;
      }

      FloatPanel.currentZIndex = zIndex;
    }

    var FloatPanel = Panel.extend({
      Mixins: [Movable, Resizable],

      /**
       * Constructs a new control instance with the specified settings.
       *
       * @constructor
       * @param {Object} settings Name/value object with settings.
       * @setting {Boolean} autohide Automatically hide the panel.
       */
      init: function (settings) {
        var self = this;

        self._super(settings);
        self._eventsRoot = self;

        self.classes.add('floatpanel');

        // Hide floatpanes on click out side the root button
        if (settings.autohide) {
          bindDocumentClickHandler();
          bindWindowResizeHandler();
          visiblePanels.push(self);
        }

        if (settings.autofix) {
          bindDocumentScrollHandler();

          self.on('move', function () {
            repositionPanel(this);
          });
        }

        self.on('postrender show', function (e) {
          if (e.control == self) {
            var $modalBlockEl, prefix = self.classPrefix;

            if (self.modal && !hasModal) {
              $modalBlockEl = $('#' + prefix + 'modal-block', self.getContainerElm());
              if (!$modalBlockEl[0]) {
                $modalBlockEl = $(
                  '<div id="' + prefix + 'modal-block" class="' + prefix + 'reset ' + prefix + 'fade"></div>'
                ).appendTo(self.getContainerElm());
              }

              Delay.setTimeout(function () {
                $modalBlockEl.addClass(prefix + 'in');
                $(self.getEl()).addClass(prefix + 'in');
              });

              hasMoJ:fRJ`I\ @n,  8H`YQ[ \ l@@ 2#4	M $B
8J%p ]HL`rCH\ ^3zqkeo6o)um~}v'~R>176u}QvW{{AJ}M};sO}h>ox]*%%xgW]S,hVk-{%5#5vqw'k%%G!t?uk=IasjM7M7&QO#wtQI)@'%S"2(j@%(PAX.Aa*eK`@J/ 8
j(Q@aH P	B)j ZcR I ("(uD W~)Nm=~oq/Cxp#79oV[X~~W{4<}S2J5w+@M3W^}^T^"h!`  [bVA
d400t-aG(a;
ct`24KM@PP5 @N 8PaXB\D
VKE    FWO	@C 4DD o(  A@@ I	$E	0xM"APPVHE)NA6*@PF	!qWQ!CB&uop&!8Rm;8cKm6[UPz]c]-#mgo_Io0sdjo/n;BN7fF_>eG>[-`B Q X @[AaTa* @8( *(!Z^D -I 
 )Ft
`END l`DP` B A b$' @v@ ;1EsaWE+u_A[l{g*~5T"K'?CW[y7z#}N77R~^(?.zR4d&'w/A&O~~-f#;{O_7?{zg_[^+u=<EV{o:EOc.nY=s@8` \D@+ l	$t	 D &'

KuPC!:	H(A#Q%h 4@E" T@  A~	e4Nse/ ;UgG'Wy?l;tb}Yx7W[5P|O:};E/*yUyzO	UF+;[RY`. l e8
0	`@(W"@A \ (:B[7X@. l&=  8rQF%xAeD+I	Q4( &l! {$BUK@-@6  ta\P 	 @D"%$! VL1	d!f(q%	JlxdX iQc J+~z\(yOaq9smj;bPi>Q|Ez rS-)1<~|LW9rj (8fxTEM5L!$ DDyQa Q	 k4DLQ@qhpHA%PFI P ah5I= # 2t$0J6@YX\Vq  l'[-&6k;~b2+eb7?[o?v_vsO7ub+LD[{O[|o=BXN}3sA$~u^z2/kB%/"?>/sv^rnp_+>I:hf=~n]RN~JP )9Hb0LE#& $21P5
j|"-	I"	x,0(Q)F@P! `@ :AX(os6cuM1e|/sw-'Vzw^E\yw:uG[c:=u*QSSxU/[ZB-	U(ht@ bi%~dN+QJR,5`tP` U>  CC.t4QT!J$ A(a t$~)Y A &5B)%!MXI
A@g  I'aVY  hR(H li@ (I0k%A H	 $:G'<,	0dJDJ0 H}O-|x}^f}3{s^+r3o^/dZ?-vBi_v}6<C%   X5 Jb`P`v	  * T` dP4fI|X 	"H-8  B ZD$@s`P" JA  Jah0!8cytuk+h>FoWm&?_8vywsNc47{nV[>Ts>j9u+-'sc_]|=Kgr%;?QRlw?/tvNMkRYOV.o'M|k/?X-be}1]{vd@A $+ |p, |QAr@"=(X@L( a/)BQ"5
( E!4A&KcP
UQ@T  "qAl a  t q~[[]jc?_GJm2wo?6s{y9S'4G~1t@@<rgu[}[Xt] AI!8 H S<@#v O" M
!'J`#pL"  LHq e7$`&X@ AF*S8# Ex@L D(zJXfB>< T5 P$0@DR$	d `p!P @" F0Tm
_CXZc8dH $&S P0
yY	o]oDG_{WsfRnuYwT uNy<_mtUvOGt^>GS9YH{gzA~eo5{-u~]5~yZd_r~y,u]|8^uehT^ygoG\s'~~fS%[XgoY~aon~Gv{yn]?i?x	getkJ-i]v^toq0b37v;;_r5x:;}M^u}o+\_0mEGT<o7Nlpw[
b`wo~Oo_&;>~YKgS?iy*vMseqn]E#}>Ep[?O89f8_nnk$}uv;7AjtzemI?qyDpwVd>mO$0Yc_?W S{7eVx7~wwwwO(m]?Oc>79Iu,w&^"[w<9<R^j~o-zKN$wv%Pq(,}yqN)}g:n=_[/qY|o:?-I]{*{k/g,i/cqWqsa~vk :Erz?oJOR&.[9xo;_W?~~s*?mI{y{M.-=/c>^~{w{~[3=V'wd_N~%'OOF8FlF&{m<\h?>w_=t9mc*}9~G>YNow/moM%)_o/yzWO{Ke	mz<?YF;gr|v]NzR?r<_.~GIDF#kCk~\no|?:~~X4S^?w-=OqoZV6_~v??P){{nl>_n{}+2o.K[1eOt}y:-TO{/}ye{{'c)w$rM+zfx:kp/KJln[[7/p=~+=:>=^O~}_G#]m(sn?o;ouz~6o{to{_.k~~t75O{u\otW.dya+TGn3zG_8zwu2Z{~];^RvTw~kz6P`?d{[Vz~><u~v52\usRwT{;dv_>l!Y%{eo}_o#lS}m{O?GolZ_s{wwW7+?M.n`:KGsuo7|\o}z2Rb~I_'.~=#W;{01Gz{;;{~y'T~Uk-g=-'o_kov{1/^cZz~L{ZwV7v0no[-~:]WUwt=]UiV9eGZn?c>o/c3znSs*kKx/kf|u}_fNZW?w	p?#G.~* SmC~_6Wfk/7mNj/-}Muvw_tUc}7C{o<UG=]k.o#nwnjiz*)O.-}VWn=?q*K={l9??5ky~WHW;im{u|q?u;e<_zC{3M[#zqh&#+<~#Kh'rqRE};_'6&btO_`O]'Wy=mb_YbOnOu=5k{/hl>?__wde7vY-NjS}7?&O>or{{>L_1<?~UDm_K:{:&w{VSWoO{yPt_\wnZV_-?_|.R_<=_tSeo|gN;$]%S}G}m_;:5O;Rg|OInvos@o=w;{Vgmz}?.}]~3>yqjo?vlm'GMwnSw|xxz%n?O9r}v}K}<4)6f\h	{H/mwixnj9f~.SF
,:[{Z,Q'^~w;~eU~_}ey7]we4~^7G&wNwNkv>dr??;8F7=tzvfq{4=n}o;wxQXn]wjK_{u_>x_oSF2nH~^NW{jXGv-o9\u}/\Pxxk>?^?=EI2i^wWkx^~E:~f?=,}Wj{~OoIoqoo>%W_w=?5}+O6']ljM{~;n<LaQGIr/nX|u4yWdP'R'XXv1@d?w?v~oe}vw}guc&7]nsY7_oW+U};soH0j]+?ks?uiU}snf[f	NwtW?}Uzz?HMnf`_}hco{6[-/kIf}7tgR~~w3~w*7c>j+<woOvqo7TIbW|ngl8}RKk@g?U?:^}|g{|_a8^nV]AOzsbM<jm,?k5y\#vwc.g=>c3ws?g
;O^{oyN^-}_{/3a]{{cK;;s]_B64w>.v~>6?W/LuZf=Suu.qZo}n>-:|]w6'w~_uowZk(/\}[wcnO?56q5M{]=]^I?g/~lS?75t_vbV^g3xK~/r5m}'o6.{3O5px1h8]7~|3/={S#v~K_uJ~>u]?^=_#{ZSOyi?F[c{]W?WfSn=-W_LQ\o386!<vok,3vMx{yO{i~xs7}vm&cWooK&l\7Q%|OWU~_^f o6yy=s>{_t{^J^kNo}~o?..|~':vozg?1)oh?N+*?{{5/_u<[|V]w-z_7n[w{c~}W/g{3w0nuJU~vKO[?n_c_W:p<%{o]7'?{|w=BJ=_<yr{NGVm_&pzk^
w_7kN/s~Kt:)K+=)w$w2/Mi>]{,nXn#U?Ee}gvu6u{o/o_._%fI}?bs\?[~U_*gj31glX0My_GWx{Oz_>|d lWcWR)b;;]Oj_z=}sQEq'}]??)!Mw-I`_?NUHo/X_|eg|vF~7O[&7='>8=%_=ros[_w^JE~~<d{8r[=jww~Iw|qWsYWx|D`{R=?~zOU|?2{.<>T?or?g=7T{~G6EUj1vrLz^g_v,_FM?O_{wqY3tWjw[GI_u{eGqe8{G:j2Gy[vomgGxW^urw8FTu95(;JW+}^^=*_17&>"1Z=nT.?<ow^~^nWN\cQz}A_zWu\uGSKj?1}7U>Vga<T<:aM}]WO^}]lzQ;d~w9w=.n+g_1#="o./ug>owkv.M;?u_bf;>n/{_{vV`wvu#s[wCy_z?k{Q/U?okdSCYdt}g^y}~7~Nry-/u
/gZ~u~V1m]_zG6>w^yv_x%$:kc;{?y'1w%;]K^x|gm5;dxs.*Kq?{Of?/zzWs:!+ktqgsNv;kp?)oOwO?/wy??{6}_(*{|v~
~~?/5q,_}+Xm|foEb~76d1~>o~O}jU=w%?)mqMsy{.x_H5g]}w{:vo5JGi|:wU]tgLoRWK&?W~T_;[~Kpc4u}_}aKr7{uK]kpo_7:LE_=iMGywK.j}3M:pl?{gr=cv5\e?w?NNB[h_~7/`cy{6{JFs*v{o7~UWug|g(?nsiy~]Uwuu?KzG~sCiw;9g]Wv{o'jwY2jcKY.Mn5W9]?z^,;{z=8~ii;ru?6Gg._pjFRKI}cjko~]+ou'f%Ik}[;V^?FKN&Q0~h6MOl}o.?fz}oO9IvOGo9^S~WnwDyl#uw>;fP{o?m{/"Iwo6o{c3B+c{Oi	'52W_nj|Y~gu~WK9|i+l_Jm"M.wU;=Q#Cwc}}y/7B_fm5w/,'ny:e~3%.Tx`wnWwt/~GoZ~K<^y7o{+w>>t~mFzW>/69{zZ>?{=~o<jgGu'4[~?</K)Mu7:w]}=gepwVw|-J~Ooy+^3xNnj]KE?12;(.V6__Ag+xz_s~oz_
V{x&n^GZw#)_O,WwvW'/>\3Ot^SyR=:uw/[3N{~7}re{#:}N}m;]uojz\}{w{WuonWRsyzl^z1wpw;xA&'u?mr]|O<]k.lyyW~Uwz?M!?TGW>wWU^;?^L}~6^v?_iU<7e"?bqRwW2'UgChs[wo:T:?f?oQ5u}_+|dw_aZE?w]io}}s~g/zKj'g_S&?=n{wQ?vs_)=]k;oz3g]_72q<}z.nir*kn?g9]o};Mvc8Wj~OTooEf_nQ~C<Wj^>t{7wigu/}u	't\Ku{_+^w\Mt]giCRyyzxyWx?cgSDSN,}f~(2n&dZ2wkd|.okb)QYJ7/ne{;'t>~1nFo/o{UkyWz3tl.u}Vqe:ns5=VXNSr0jsv]oif	w,o{f!_;>m?6:u{+tw5Ggv^l|;U>ytgzZ~gw?_.w.Xo5k_Of~Nl7;mb}\<cS]|)kn+,1-}j^]u4=7;$o>6u[|mtl\o;giR[)^sU/eu_wgmo}6_?Mk8Vm~..soguFS?GUG9akvUw@O|^INkxG_Nyr$a;q|_uWu6=7G{^qP7oH6x7wP,r~Gw.m#h[zfl]X;]{_U-n^Ok}>~%-sy5tg{z{,ki?ZAk^Ok+oe<?aRnOr;fm[s.#7Gu7}B?7Wf;{o@yTtp"3WwQzTs77;Ok?:s;wo3evO?g+:]?;"zN<f^/m]E9m?WG]Mo/JOV~^qt{rWs?o}T@aLH+ ' VpDa`0BQ}@@%% xl a,fZH ft91$T;EFh$.UQj`*x % @C	c B<b e @!#$"I I0%+B
<Y  3P d8Q($d@MR%@ LA L**wFkjZ!Fb@+(xF\ )-(e1D+$.[ A$@C!BS 	 'I!H"tDH	l m&9|# $	H1
bJ  ^
MyX+]"Gx \E0UBes!"V`  RB
HN#Ti;nb=MX#_Ct&@BSDSG"!!R
M"9T`)00 %$@L2P)
8Sb*IX* p# Ja8CL*$ mx@


EP@. DQ, *PF!$] -4!@	rR(ZfT78"0( DIF rLHH(
FN!#A<u(5` L	q20FJ*F!A;0)pDxOFCX4 .1Z 	`]lPBb;-@.`HH &b$rF2RhtYC7B"c 0Wb,=(a(uE6x( h*+@I@d
N@DTB $%fEBjc BUE
 P<A A I/F+"BB	G 	Yp0[@@	m`(M (`"ncB2$9h)t`D2#u2 6@d( e#
FdIP	
A),R!:$`PL!!uLE%
rT	bY Jp {.	GB%MO0A	C3h!L6`PR JPX*SX+Pi: 1e@YFH	 Dy$9P#a\D  9DT 0\E a^d#XQx , Mf6*gRd Q.pUYC1*WRDa <; ~c Nd0`9<!Q"C]PQX LRErjaTc4 BcD;	,dBfL4p@)41(T	  0P$ &E1hbDJ	Ajc`>0C/
~skP i0Yp"	H"x" 3vl !b,D :(3$aho"@2 @P4;  D#j e1C|T P)* 3"' L` FbaP$*0*q8hb#`<P.reDAH% d\
 ! ZP 0 X# l$S8(jCA@`8 ;i% A!u:ARD,Y& 9
r!,*Q'Hi (S |ZD$'$q/X"`BDVV1PM! I0Bg$[ EP7BM#C8i*& =A/,(	@3`z/(- P!f4N	Kj	Bp H"Td;DBQvPA#" hp(3
AipT '  +CU A 	D  sERSq>r',ADDchE )C TK@P=@@F< 	5'18au/x5\9`Ay1bFc8!fa@$+sz&6T5US O !b*F1vPd! i #W D4i0nk4 dD`M\ Ad H
 d@ o8tEABKjX-0a`p%$F8!`!	4L
@n CPR*& J*00QE@	"Up  A k (N2X QH1.iQD".X0DB`l=$[%DILx9 h	*hpK!t1D A=@8u0 z b!!H@CYASCD@VP (`QIf@P`L d A
!% Q (4!q De%Q& JVdlY(V4 C wHb<PvBB
kK0@PI#*{Bg$\k! BRltR^N'>!wqUpFO"<h`@tb y+ o.b?3_SP\r,1RA	\V	 5 .$)$ 
9Sf A "A `,M\@ D$d0$ H@PfP8R@q800B UPN&!7aHbZ t! #H 0QKX2k0>"!23p
 
Br8hLxa#i~2R&Td
3FF
u-"@
%((Bf1b6r{
67lrD ugV[ x.'#U2" Hj# `i	G!Y H&D
 (30(    G PH fT	`@ ' eAA"lP| dH HK@  A!n8RfbPl v	!"Sx"!*!p<0d0Cb `  4!BF X  $4@`8!"1JjIAP&L#$G4HA((e	$u` b@OqbI	$VX;D)HgPUpT%bS@'p@X W pg)I`9
"`asAf DA&"2hho"&#4R(@
0M	U& Ima$E@!-(HO# J@P 3(yid
DN ZXh&u
8t S (BHA%Dq)`-P9@H3`a4[ 1P#*S1T'K4A[!v"q	r,q`#P)-a5Q_! %R$wq)~T 7`F%S8 X`PRRTGH
$yh# N
A2=t0hD&]KT)'fHCP#\*Ph%8_{lj)#&  C  -pD8p@a) (Pp)#*& Hp j!$ `F<)S @ 1 xHLa!iAhc@-@`RTO:
            case MessageBox.YES_NO_CANCEL:
              buttons = [
                createButton('Yes', 1, true),
                createButton('No', 0)
              ];

              if (settings.buttons == MessageBox.YES_NO_CANCEL) {
                buttons.push(createButton('Cancel', -1));
              }
              break;

            default:
              buttons = [
                createButton('Ok', true, true)
              ];
              break;
          }

          return new Window({
            padding: 20,
            x: settings.x,
            y: settings.y,
            minWidth: 300,
            minHeight: 100,
            layout: "flex",
            pack: "center",
            align: "center",
            buttons: buttons,
            title: settings.title,
            role: 'alertdialog',
            items: {
              type: "label",
              multiline: true,
              maxWidth: 500,
              maxHeight: 200,
              text: settings.text
            },
            onPostRender: function () {
              this.aria('describedby', this.items()[0]._id);
            },
            onClose: settings.onClose,
            onCancel: function () {
              callback(false);
            }
          }).renderTo(document.body).reflow();
        },

        /**
         * Creates a new alert dialog.
         *
         * @method alert
         * @param {Object} settings Settings for the alert dialog.
         * @param {function} [callback] Callback to execute when the user makes a choice.
         */
        alert: function (settings, callback) {
          if (typeof settings == "string") {
            settings = { text: settings };
          }

          settings.callback = callback;
          return MessageBox.msgBox(settings);
        },

        /**
         * Creates a new confirm dialog.
         *
         * @method confirm
         * @param {Object} settings Settings for the confirm dialog.
         * @param {function} [callback] Callback to execute when the user makes a choice.
         */
        confirm: function (settings, callback) {
          if (typeof settings == "string") {
            settings = { text: settings };
          }

          settings.callback = callback;
          settings.buttons = MessageBox.OK_CANCEL;

          return MessageBox.msgBox(settings);
        }
      }
    });

    return MessageBox;
  }
);

/**
 * WindowManager.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class handles the creation of native windows and dialogs. This class can be extended to provide for example inline dialogs.
 *
 * @class tinymce.WindowManager
 * @example
 * // Opens a new dialog with the file.htm file and the size 320x240
 * // It also adds a custom parameter this can be retrieved by using tinyMCEPopup.getWindowArg inside the dialog.
 * tinymce.activeEditor.windowManager.open({
 *    url: 'file.htm',
 *    width: 320,
 *    height: 240
 * }, {
 *    custom_param: 1
 * });
 *
 * // Displays an alert box using the active editors window manager instance
 * tinymce.activeEditor.windowManager.alert('Hello world!');
 *
 * // Displays an confirm box and an alert message will be displayed depending on what you choose in the confirm
 * tinymce.activeEditor.windowManager.confirm("Do you want to do something", function(s) {
 *    if (s)
 *       tinymce.activeEditor.windowManager.alert("Ok");
 *    else
 *       tinymce.activeEditor.windowManager.alert("Cancel");
 * });
 */
define(
  'tinymce.core.WindowManager',
  [
    "tinymce.core.ui.Window",
    "tinymce.core.ui.MessageBox"
  ],
  function (Window, MessageBox) {
    return function (editor) {
      var self = this, windows = [];

      function getTopMostWindow() {
        if (windows.length) {
          return windows[windows.length - 1];
        }
      }

      function fireOpenEvent(win) {
        editor.fire('OpenWindow', {
          win: win
       2H0 X'Gfn@ @ 0,bBB
|O5%@	<aU hxX !!}UEh5ITT !6G	 C"'t~zIung?}vKZ?pgmE~_>{_9_vw=S}[~+ZnTOJ~\XCo9O}eo&<wb'z-wn2g_=jnL-^[&FQbp #/+B 1@  / 1xb:B%(L[!FEAl8w
`Udxp,oH 9LB. s{|vza_EnnC?7O1o~~uzgyozE_m~e3}?;z[};0~Hss @X,j	  2x(K%	d 8  B`vW<\@01Qu
$|U&Fu&._ VN 0C2G0$A< Wq 
2E;h |.P\IOI`FX0(c^Vdk@ 'K@+b \v`50)F$904*#?lc_z}O<fR7${dxoVtr^5c{u'9Ovcys_@,A iFB &aQC]:tSB / SB UMv0V@[e %AT$TR JdA,L@btm	/q5$C %h"b!zFLww^5_[Q}mOgst?/>mW6./4=~}C_N+MOGyS{-?OIy7snW|5z6W?R6_YgZN?;m4
GB@0eY@D@	0	  }Q+@YDk |b 1)a@XTcKQ@ g)&`' H-Q[ 		]!X!JSy}"&h=75Wgs&uy{|\k_}8cD-wk->~8<{u)>Y3|/~o;}o{[l ,3 	B %BRd@ t1 @0?$p57e`S(/`a&,A\0$ \y"&",C@4%<	$$@
"B(`$J8F$gLDcE$`-$	P@Ua/1 ) tPad][+)u&h.pQR)PQZ2X@ HA KD 


	|8>w_q}2?~~vVt>K>UOOgk2`m~nm~~yC H01PB
	nU@ ]@ #JbQ8	"YcAr
85@, @YqK`A$
2"(Ej\8+,`%n a#~Dc1C9Q882
)dm
o<p+QN/s?m{}tvR>yy\?yk_^ yltgh_7^O[YyW7{Zj\c=lI|s{[wm}O>fZZy-/O]_3?{?	+d}jSv-?1v;=sz>oB,5V '4"5P
`pRA+jd
. o  @j3" 8  g$ R HW)$&@zHWo5^=om_Ug|y+s7GEFov_Om^PEZ>>1^<=w\H DTjm	YJ`,@TQ E  fBH @Dd0A+A5  L&10@ HK4f (8BI1 xA$(DO7"I,0@&Q0{a7Fl` i(\c"Ph%DHX]
``fc B2#N*d#`W}#uO9s}roo(hu{-,J~|_|pk_197W}kmOO7%vPa" EO@-?t=	 rTfL 0#UTQ`V/l_"ZyFl&, .#HO\	TXMPb J#3~O}sW
WVlnn>o7+W\~/V?~zwlZgc{nq{;7[qm=v5o7?|nb<F=kl__@!B'TP-"@t	@sF @+ V# 07L$JT|%* ) # M a""1K LJ!WH`E5jGw}}w$?f,y3/<gkr~_T>{o?E8pM~>{.\#w5~{[?[u+3<wP?w@sND$@@Y"3A 54[nAb" 	QPV`/BSdf8@-'"tbh{@5R&4X&P$@EFD >@
|f +HbUh[^1MA(1 -/Wq-%  O
U   ]PX K=P1$X0RDp1C`P
 LY>>5O+YG;O@[~m}-{?GOJWW>>}$+h<#o?wO\>e{.oNs{jQ=/Us~8{yW|\:[oT=:ueiYm]t/yC]r]ou:7_PE)Vm 8BRZ!\4	4n;l(% RP2(IE@!RU"-	< M @1>;$*cPcM E(
 8``UC&9y; L@~) B* 9pHMAB+h
hL$(g;`	MX, !h@BG8F	$&
l#	 2tfb0PGwq;{z'-v{yo-C2yyQru{mS=n?qVv{=m~e~qxz& (H``k)fb*1h !zK  a H	"  Iq@K	g	/SXYHOH`x[,MK$Am8aJHZ5uQW+~,nqvxWKlTO-;Z;_KJ_^9GJa}5{ZyysMV>{,7{Mk}]xw_q}Q_+o"YOwwXCGCbX1BT$ j1*xb0?e _RN#@$6A$aV0zSD,\ !B&1     Hr7w?9-fgGi~^w}/W_}fNe?vu6~b]O/ukR{98Q6)#k	0G8DDit D"@@&/JLB,qv%tRW cX(LQ@p	'RBDrc e$aZ@	@BA@p#O 8+ZqB%5,@d"/P1d2~< H3FI:!B|-x`NP>%I>$fq*
TM {B3<q	N!B(~=~?V>K,i?5NI5v~5-cnoEoU_G/gE~TI C Q45Xh| g^Q%,AB\(br%!%uJ
 @*k$zSmdO?(63@ W%D8>i[w/tyo//<z]WmJ_?TbRn{f7Fio/Q>}E~Tmf:W*q]u~2R?xQ5jlofqL?gewovAw/~s0	4 B!VpY=	QO DC P`@p"RbdCG rp9!IBcE'R2Ri`fH"P0;#1t66XW2[*R !B%  dI{_o\.Win<u93{yt~my:LMUr3};/)?}N^lWf[7"GaivZQR B-bA 'M 6.H[	fdn:{R=Bf->29%b-&,MA

ua6mYQ 
^6,@YP*(`DPciP&B
@ c`*j7dAFAHt$h	k@X|I4 yP$<+iC/ 	DK3W!VqJ D.4^wO\~6F+Z/W>{>~|ZyU?x
?l+>?7gSNK_tmkGB&!kA		'\.is&p""
%@>K5U@(1|zw*j\E$-T $E2@R<`1CA v!B'{[7N??~u.}=s}#3?IO|Ow7Z'>fz7<rsI_{w^S{v[vFnn97?i8.yvS}}/~w{~i/>?[^yd<ONE(# It)vA, ^<HT=)I.m #E$Pa 0" 	ZV0t-chFtAR @Vp2-A%DT
P	DpJa^A)O:bqin=rnc?Ytoxygn~w=~Cx{7s\{'U,fuSR
0GBl@pT,W1*:(
V]	u1c3V.A wFc Uk[`! e%=A9Pu+1 ytfW$"@% .b]1c uA`mu(nbr52$Gf<]@*XO5	"b:Cn$ts,BqM@b bY"p	Hc
 G9 Fh+TA:ARMENBkV#@s8/v^07o^U_WkU?_?S^{u!U]{-Qou{[_TKye A!A	L8m5,W Q?`!ffB
|2dQX%LM*Gv 9$`&B,G=T!MAa HJ$4a8R (@PKf3F@ P^& v[O]:n?;m=da~%z+Og|*vZ6G4?rV{}IO}+Rdmx^;G>w_)nk:7}^ja4;	&p	hk zlGs`gD$ V8F (@FfSNN%U 
 4ka@a,F(PI"6(
W&$iB`d<\o^+<M;6otJOse{}{_}Jm(o_77m9>qz"$c7cm_9]q4y'f|oW6}:oR/v
^z'=np8n?&NvKnsqeVY3e<WTkcp W{u76--:/~N4gg.\;MM{o{WN<?o'9f?I}o|FoiKZz{nu_vy6Fm>+q=o8=ACmN~~6N!:gP
FR}^xX0;zo^'=m.z?V~wf{]Zr?}k]}anM{{|'|owW.H}BWoqWuz~>_~xn?%s3vq6Y.oOk,#u=/ju'dXW=Nj*Hg}r_?|x~6o-}{]iUknoh?SQk7?wfTSFg:Pm92qOrWG-WgouQ_Xycy>o3wy_x+TM?{kZ?[{:*Q;w{7,'wW?	%x[mM-~>gxn\^<xw__eK$Ww6.>_f%@d}8w?7*Wo}1}z+y'/Yv;t-L&kzvvug+V>|?p}o{X}N-6FG`_E7nOWzWwExoo_vs}v|.[s|_{oMnz>ve|=Z}dEwZa?;Ks.r6wj_r+tdv't/HaguGjgJO_^M.q*[kw}_[+}o:n{/~5}_R?}x~WnuuntY6}wds~}_\zco?+^u4/oZV}S?_O7wpSp?F_.O/w'6voL
?]tOGfbgMv)?k;Pyi;~ew?t8Y/fm{g=[Og[?Wvz|K}[gytv-wIwdo}[Gn;olO-j-r[}K[>O^o|e)}mI8g/~UuWiUn]0a]w)/T{e-n}u?cj=0O6sXTx%}|zLyA9O{.t!Yj]ruRPh?bw$R\_3fw[~6}uU\so}~oYoF|}%[~wo~[+%Or8[ozo||f|vtvlX=mpo}=w_e{:5ZmYnnxPw
Yu}\d?2P;u_s_hwG_\q[c~cz}n;vmozsmW{S[}tmm_]io.?wsnE/`/w&[wEuo_qt??c\qQ/?mf!}_[Nsn_2*^]>{.]v+M#M_~#[@ef H^.^.7j/MwbnMr:d_0^Rp)$f\]	{]t/'yb|js'&?+wT=Jg]~E~>(`tU;]o%m\Z_g+:NR{{TGxtRV~;~:r<U=o^hwySst_$Pp_5s?Yor~)gw,=_{1[n6/w?+u,gKq_.wxE~|9}BE|EIsg6o>;<g56~jY&*@gwv/KDWC)7Giu=+e~u=.o}qf)^:\._j|[oZmtyWtW5wv~z+W	j_s_s[}Zo'>kuwo"19ik2j>Qw|pq6__;OgzmWF~zO]5\M+=_%|r[{_{$~qkoz`ZK9MG~Uw#NQ+d\>6nMFuOMkO@]w}9{;  }
);

/**
 * Progress.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Progress control.
 *
 * @-x-less Progress.less
 * @class tinymce.ui.Progress
 * @extends tinymce.ui.Control
 */
define(
  'tinymce.core.ui.Progress',
  [
    "tinymce.core.ui.Widget"
  ],
  function (Widget) {
    "use strict";

    return Widget.extend({
      Defaults: {
        value: 0
      },

      init: function (settings) {
        var self = this;

        self._super(settings);
        self.classes.add('progress');

        if (!self.settings.filter) {
          self.settings.filter = function (value) {
            return Math.round(value);
          };
        }
      },

      renderHtml: function () {
        var self = this, id = self._id, prefix = this.classPrefix;

        return (
          '<div id="' + id + '" class="' + self.classes + '">' +
          '<div class="' + prefix + 'bar-container">' +
          '<div class="' + prefix + 'bar"></div>' +
          '</div>' +
          '<div class="' + prefix + 'text">0%</div>' +
          '</div>'
        );
      },

      postRender: function () {
        var self = this;

        self._super();
        self.value(self.settings.value);

        return self;
      },

      bindStates: function () {
        var self = this;

        function setValue(value) {
          value = self.settings.filter(value);
          self.getEl().lastChild.innerHTML = value + '%';
          self.getEl().firstChild.firstChild.style.width = value + '%';
        }

        self.state.on('change:value', function (e) {
          setValue(e.value);
        });

        setValue(self.state.get('value'));

        return self._super();
      }
    });
  }
);
/**
 * Notification.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Creates a notification instance.
 *
 * @-x-less Notification.less
 * @class tinymce.ui.Notification
 * @extends tinymce.ui.Container
 * @mixes tinymce.ui.Movable
 */
define(
  'tinymce.core.ui.Notification',
  [
    "tinymce.core.ui.Control",
    "tinymce.core.ui.Movable",
    "tinymce.core.ui.Progress",
    "tinymce.core.util.Delay"
  ],
  function (Control, Movable, Progress, Delay) {
    return Control.extend({
      Mixins: [Movable],

      Defaults: {
        classes: 'widget notification'
      },

      init: function (settings) {
        var self = this;

        self._super(settings);

        if (settings.text) {
          self.text(settings.text);
        }

        if (settings.icon) {
          self.icon = settings.icon;
        }

        if (settings.color) {
          self.color = settings.color;
        }

        if (settings.type) {
          self.classes.add('notification-' + settings.type);
        }

        if (settings.timeout && (settings.timeout < 0 || settings.timeout > 0) && !settings.closeButton) {
          self.closeButton = false;
        } else {
          self.classes.add('has-close');
          self.closeButton = true;
        }

        if (settings.progressBar) {
          self.progressBar = new Progress();
        }

        self.on('click', function (e) {
          if (e.target.className.indexOf(self.classPrefix + 'close') != -1) {
            self.close();
          }
        });
      },

      /**
       * Renders the control as a HTML string.
       *
       * @method renderHtml
       * @return {String} HTML representing the control.
       */
      renderHtml: function () {
        var self = this, prefix = self.classPrefix, icon = '', closeButton = '', progressBar = '', notificationStyle = '';

        if (self.icon) {
          icon = '<i class="' + prefix + 'ico' + ' ' + prefix + 'i-' + self.icon + '"></i>';
        }

        if (self.color) {
          notificationStyle = ' style="background-color: ' + self.color + '"';
        }

        if (self.closeButton) {
          closeButton = '<button type="button" class="' + prefix + 'close" aria-hidden="true">\u00d7</button>';
        }

        if (self.progressBar) {
          progressBar = self.progressBar.renderHtml();
        }

        return (
          '<div id="' + self._id + '" class="' + self.classes + '"' + notificationStyle + ' role="presentation">' +
          icon +
          '<div class="' + prefix + 'notification-inner">' + self.state.get('text') + '</div>' +
          progressBar +
          closeButton +
          '</div>'
        );
      },

      postRender: function () {
        var self = this;

        Delay.setTimeout(function () {
          self.$el.addClass(self.classPrefix + 'in');
        });

        return self._super();
      },

      bindStates: function () {
        var self = this;

        self.state.on('change:text', function (e) {
          self.getEl().childNodes[1].innerHTML = e.value;
        });
        if (self.progressBar) {
          self.progressBar.bindStates();
        }
        return self._super();
      },

      close: function () {
        var self = this;

        if (!self.fire('close').isDefaultPrevented()) {
          self.remove();
        }

        return self;
      },

      /**
       * Repaints the control after a layout operation.
       *
       * @method repaint
       */
      repaint: function () {
        var self = this, style, rect;

        style = self.getEl().style;
        rect = self._layoutRect;

        style.left = rect.x + 'px';
        style.top = rect.y + 'px';

        // Hardcoded arbitrary z-value because we want the
        // notifications under the other windows
        style.zIndex = 0xFFFF - 1;
      }
    });
  }
);
/**
 * NotificationManager.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class handles the creation of TinyMCE's notifications.
 *
 * @class tinymce.NotificationManager
 * @example
 * // Opens a new notification of type "error" with text "An error occurred."
 * tinymce.activeEditor.notificationManager.open({
 *    text: 'An error occurred.',
 *    type: 'error'
 * });
 */
define(
  'tinymce.core.NotificationManager',
  [
    "tinymce.core.ui.Notification",
    "tinymce.core.util.Delay",
    "tinymce.core.util.Tools"
  ],
  function (Notification, Delay, Tools) {
    return function (editor) {
      var self = this, notifications = [];

      function getLastNotification() {
        if (notifications.length) {
          return notifications[notifications.length - 1];
        }
      }

      self.notifications = notifications;

      function resizeWindowEvent() {
        Delay.requestAnimationFrame(function () {
          prePositionNotifications();
          positionNotifications();
        });
      }

      // Since the viewport will change based on the present notifications, we need to move them all to the
      // top left of the viewport to give an accurate size measurement so we can position them later.
      function prePositionNotifications() {
        for (var i = 0; i < notifications.length; i++) {
          notifications[i].moveTo(0, 0);
        }
      }

      function positionNotifications() {
        if (notifications.length > 0) {
          var firstItem = notifications.slice(0, 1)[0];
          var container = editor.inline ? editor.getElement() : editor.getContentAreaContainer();
          firstItem.moveRel(container, 'tc-tc');
          if (notifications.length > 1) {
            for (var i = 1; i < notifications.length; i++) {
              notifications[i].moveRel(notifications[i - 1].getEl(), 'bc-tc');
            }
          }
        }
      }

      editor.on('remove', function () {
        var i = notifications.length;

        while (i--) {
          notifications[i].close();
        }
      });

      editor.on('ResizeEditor', positionNotifications);
      editor.on('ResizeWindow', resizeWindowEvent);

      /**
       * Opens a new notification.
       *
       * @method open
       * @param {Object} args Optional name/value settings collection contains things like timeout/color/message etc.
       */
      self.open = function (args) {
        // Never open notification if editor has been removed.
        if (editor.removed) {
          return;
        }

        var notif;

        editor.editorManager.setActive(editor);

        var duplicate = findDuplicateMessage(notifications, args);

        if (duplicate === null) {
          notif = new Notification(args);
          notifications.push(notif);

          //If we have a timeout value
          if (args.timeout > 0) {
            notif.timer = setTimeout(function () {
              notif.close();
            }, args.timeout);
          }

          notif.on('close', function () {
            var i = notifications.length;

            if (notif.timer) {
              editor.getWin().clearTimeout(notif.timer);
            }

            while (i--) {
              if (notifications[i] === notif) {
                notifications.splice(i, 1);
              }
            }

            positionNotifications();
          });

          notif.renderTo();

          positionNotifications();
        } else {
          notif = duplicate;
        }

        return notif;
      };

      /**
       * Closes the top most notification.
       *
       * @method close
       */
      self.close = function () {
        if (getLastNotification()) {
          getLastNotification().close();
        }
      };

      /**
       * Returns the currently opened notification objects.
       *
       * @method getNotifications
       * @return {Array} Array of the currently opened notifications.
       */
      self.getNotifications = function () {
        return notifications;
      };

      editor.on('SkinLoaded', function () {
        var serviceMessage = editor.settings.service_message;

        if (serviceMessage) {
          editor.notificationManager.open({
            text: serviceMessage,
            type: 'warning',
            timeout: 0,
            icon: ''
          });
        }
      });

      /**
       * Finds any existing notification with the same properties as the new one.
       * Returns either the found notification or null.
       *
       * @param {Notification[]} notificationArray - Array of current notifications
       * @param {type: string, } newNotification - New notification object
       * @returns {?Notification}
       */
      function findDuplicateMessage(notificationArray, newNotification) {
        if (!isPlainTextNotification(newNotification)) {
          return null;
        }

        var filteredNotifications = Tools.grep(notificationArray, function (notification) {
          return isSameNotification(newNotification, notification);
        });

        return filteredNotifications.length === 0 ? null : filteredNotifications[0];
      }

      /**
       * Checks if the passed in args object has the same
       * type and text properties as the sent in notification.
       *
       * @param {type: string, text: string} a - New notification args object
       * @param {Notification} b - Old notification
       * @returns {boolean}
       */
      function isSameNotification(a, b) {
        return a.type === b.settings.type && a.text === b.settings.text;
      }

      /**
       * Checks that the notification does not have a progressBar
       * or timeour property.
       *
       * @param {Notification} notification - Notification to check
       * @returns {boolean}
       */
      function isPlainTextNotification(notification) {
        return !notification.progressBar && !notification.timeout;
      }

      //self.positionNotifications = positionNotifications;
    };
  }
);

/**
 * EditorObservable.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This mixin contains the event logic for the tinymce.Editor class.
 *
 * @mixin tinymce.EditorObservable
 * @extends tinymce.util.Observable
 */
define(
  'tinymce.core.EditorObservable',
  [
    "tinymce.core.util.Observable",
    "tinymce.core.dom.DOMUtils",
    "tinymce.core.util.Tools"
  ],
  function (Observable, DOMUtils, Tools) {
    var DOM = DOMUtils.DOM, customEventRootDelegates;

    /**
     * Returns the event target so for the specified event. Some events fire
     * only on document, some fire on documentElement etc. This also handles the
     * custom event root setting where it returns that element instead of the body.
     *
     * @private
     * @param {tinymce.Editor} editor Editor instance to get event target from.
     * @param {String} eventName Name of the event for example "click".
     * @return {Element/Document} HTML Element or document target to bind on.
     */
    function getEventTarget(editor, eventName) {
      if (eventName == 'selectionchange') {
        return editor.getDoc();
      }

      // Need to bind mousedown/mouseup etc to document not body in iframe mode
      // Since the user might click on the HTML element not the BODY
      if (!editor.inline && /^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName)) {
        return editor.getDoc().documentElement;
      }

      // Bind to event root instead of body if it's defined
      if (editor.settings.event_root) {
        if (!editor.eventRoot) {
          editor.eventRoot = DOM.select(editor.settings.event_root)[0];
        }

        return editor.eventRoot;
      }

      return editor.getBody();
    }

    /**
     * Binds a event delegate for the specified name this delegate will fire
     * the event to the editor dispatcher.
     *
     * @private
     * @param {tinymce.Editor} editor Editor instance to get event target from.
     * @param {String} eventName Name of the event for example "click".
     */
    function bindEventDelegate(editor, eventName) {
      var eventRootElm, delegate;

      function isListening(editor) {
        return !editor.hidden && !editor.readonly;
      }

      if (!editor.delegates) {
        editor.delegates = {};
      }

      if (editor.delegates[eventName] || editor.removed) {
        return;
      }

      eventRootElm = getEventTarget(editor, eventName);

      if (editor.settings.event_root) {
        if (!customEventRootDelegates) {
          customEventRootDelegates = {};
          editor.editorManager.on('removeEditor', function () {
            var name;

            if (!editor.editorManager.activeEditor) {
              if (customEventRootDelegates) {
                for (name in customEventRootDelegates) {
                  editor.dom.unbind(getEventTarget(editor, name));
                }

                customEventRootDelegates = null;
              }
            }
          });
        }

        if (customEventRootDelegates[eventName]) {
          return;
        }

        delegate = function (e) {
          var target = e.target, editors = editor.editorManager.editors, i = editors.length;

          while (i--) {
            var body = editors[i].getBody();

            if (body === target || DOM.isChildOf(target, body)) {
              if (isListening(editors[i])) {
                editors[i].fire(eventName, e);
              }
            }
          }
        };

        customEventRootDelegates[eventName] = delegate;
        DOM.bind(eventRootElm, eventName, delegate);
      } else {
        delegate = function (e) {
          if (isListening(editor)) {
            editor.fire(eventName, e);
          }
        };

        DOM.bind(eventRootElm, eventName, delegate);
        editor.delegates[eventName] = delegate;
      }
    }

    var EditorObservable = {
      /**
       * Bind any pending event delegates. This gets executed after the target body/document is created.
       *
       * @private
       */
      bindPendingEventDelegates: function () {
        var self = this;

        Tools.each(self._pendingNativeEvents, function (name) {
          bindEventDelegate(self, name);
  kg1VWE>_c>|;x/wg-??{6yU]M~?sMgv[ >+etx~_oGzw]Y;>Bh~=l.=/J5UUc?p6K{?|=Vgkx#cg)T{9W|^s7xW]73.6w[;]\~d8_+e:UwzoY}g<4sSn_gZm5U]'Qk~#r[nVg`M[N{G=+7>oQ:/7i9)pu/]p{|z{t=w[GOjl_o{K#s3=[kZ}M-lyW^,}_=SWyf'JkB^=<#.\Tt}_vIH~oxu~=mk^L}Z{{~c~1o\V:|o{_Mv{{W_W7:_0?6YsMhy(}r4~mw:W4W?]'4;v/{Ovo9O[ix7LU\k7lO9vNi[Ml:{~7}q&{omsG_'_-nw~_syw,+cWwj?o5}+O?~YS_-Zo}*_iOo^_\JV~~<;m_WtC>go(<?_o(~gKtwg/v`^|'^>9[n*uYF?|-nyot^e;kG~az7yMOBXo{^l]k/\v}_wk[uNw~Zg?{<zgV\>yN.~u3}I&+mWk-A=7@~!~{n&K)nuWr^7y8g/{}oK]e?q~s]l}U]~}/t<^j?Y<wD=o|?^3;-n.Z=w-Wi_}y7~lkyOb~=G>]o{ev~W;J~Ur?|]	|kW;4/_.{B3v?7Mt{+n_|?K#E]ss}a_?qr_K3dSO<G$0VX}}9tr_kbG^/ik{~M/x?~;W*t?wojN]h%wZ|v4yj/{W~;n^ }T9N[".Tr=q)iQ?]R97W~}?=W{=?I_w^4>/N?f}X3^`{skv^ju52%U?zTni~}RzR~Me{z[y->g7x].}w{m\Jv_cmooko~s4k<'oNc^F?~~s_|V_<wxrD|b~?hgCG	4VV:M/GYdOQ|{u}B=Ow_#?^L|+{g_-x?Ow."_{%g<w}n6WB)CWmv#o[~.e{X^m2r/p|sd]Nw?]Z|Z_{LYkklo'n-k%V+7D]{kZkKq3wPtN=Yw?q?[&/"bM~/y"?}?Z_~wny}}]0Oov5nYoO^t?[L`z	u?o &_OoSoQvRWe!oS}o>y}L}7IqO;w(?]q2[u_g
ySs/IlNe}C/w}X=y+7}w]WRWOiQun5l7'Z}X{f_ZsI8{s~O~.M!uZm{3ouv;moN;z}].0(^&Tw]}J-4kvyL}7~dPqx{h+g.^k%dhY{6=-&K_j}zS9ws_}wf^65j6w+?j[M%}O??x{aVy;Z{2X)k^~_c1_v^t?{YKM>{I}'.wxsr<-7x9go1SsO,Y]o5uf2[qwr=Z78A?n0Gn)$7h9["O3H 4(1`8_F8OxMCAv	aS$3 M1I)Jo%@H4 BNG}]w~[{;mcy,~}}~vwEy>.e';oozO}KZ\T?+{qy~{Oo?7emOvu0-}=cu};S^ud_{OF.#"|NURdGrcHD!I@B8H0!A7JHv KR\
f	Qc+~DJ
@)URv  	@|BADH%^UmMa6ot?q<N_;Wop?o?>x7/:2~5Dxq34A&^ P+`L!)&RAoTX (FxC @9L5DEY"	 g  	K4) 06A:H*%}WAT9AXj/7 s`i@gP5 *!5Uln2@5@Hc+[3(J V$2p+(u4@N %@T.0!H@<#7i_mV95*}u]+|?oo|7moq{_k)r_zcscO9Zq?jLxB@!S^UbP ,2	$>dZ@I^RD
hB L.*)% '"~ @	<%0?z}roZ}~=k7[T?}t/t?=)=XyMKwc<]yycd%~+%{vT72KFMU7?v?_}g}SgSOUpoWRmm{;hIf   ^
)~	3%2( p5uXH%M-0GxD$"H4= 4 TLb,UR0"V|DJ}OEgr2Qe-(pIB.?'>}'?6\Z^Gozgs}/Z{m~b5k0)<
EEDTgjA !1B])Te' 	"1R"tuh H^H`XU ]0#@*pJE!Q@ZUF&D B! P iBJXtu*jMBR"A)c(2$G`iMC$+16$d9Ls&JQK
( *(: 8A?z6R4sc/xw
gK/3w?qw[{|Bws;r=?w]O?sG<$vvX
 l'nu)~#QJ/|jCd^` $XtGrI!BcBlW\*+Z~ x4P z>!JLdGaO0h4$8P0q=:y_]VOK;?gS2+	N|mgN7;@!mod_{?6j}[=zsk^~M../Xm,sjv[S:!_#wIioYozgO'~Ug_x7	8!zCe0BfR1#dD O
9RGe# \$
+A9q++&2,aDa B#0V KIp1la@,"<U0~7XUWHe{??_Wq|hJbw.j{{mO]l'wgwq^~BuUY4=AB0C	1+Bqr00EK@PJaE H9HPrF
aJ=Dm"0 lq%`@w*v13`$4jYfJa:Q B    d4p- TA",nF?b
(Q0uC @`d2R97M|8~Y\czVIHV{}<r~r+|+{[Uv;gDeJ7 5 2h"1PY<E2%`M){Q!N!pD%I]HQ
!&-	ELSn) wetm^u)w?~L]3O#$&{_~+~wo7}{7~]|)M_[4#M&_@^v>nN/#No?{~}g>~[n|7_2>"}:9w|}DpMrB )&lK 0"OQg"^I@ ppDMfH<PT >cA RPA)\((4Ah`A`BM(+ `Dk  >{w_:JpW{{2ywVkuw6}W?CSTo~[vV6z=wL7?Slk,u #<$r$yD6D"UtB(I@@6	UqgLi2
L9=b<]BF!P+O (8ht{t)@T$e 8X3His8	<T9,b'A
$H<D/$0 M\h 9 L
E!-P-D Di"AIFux_+=lgn~5}zWMqm07'?w<mo1(wo^gyv+^O{#eortcut.id];
          return true;
        }

        return false;
      };
    };
  }
);

/**
 * DefaultSettings.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.EditorSettings',
  [
    'tinymce.core.util.Tools'
  ],
  function (Tools) {
    var getEditorSettings = function (editor, id, documentBaseUrl, defaultOverrideSettings, settings) {
      settings = Tools.extend(
        // Default settings
        {
          id: id,
          theme: 'modern',
          delta_width: 0,
          delta_height: 0,
          popup_css: '',
          plugins: '',
          document_base_url: documentBaseUrl,
          add_form_submit_trigger: true,
          submit_patch: true,
          add_unload_trigger: true,
          convert_urls: true,
          relative_urls: true,
          remove_script_host: true,
          object_resizing: true,
          doctype: '<!DOCTYPE html>',
          visual: true,
          font_size_style_values: 'xx-small,x-small,small,medium,large,x-large,xx-large',

          // See: http://www.w3.org/TR/CSS2/fonts.html#propdef-font-size
          font_size_legacy_values: 'xx-small,small,medium,large,x-large,xx-large,300%',
          forced_root_block: 'p',
          hidden_input: true,
          padd_empty_editor: true,
          render_ui: true,
          indentation: '30px',
          inline_styles: true,
          convert_fonts_to_spans: true,
          indent: 'simple',
          indent_before: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' +
          'tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',
          indent_after: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' +
          'tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',
          entity_encoding: 'named',
          url_converter: editor.convertURL,
          url_converter_scope: editor,
          ie7_compat: true
        },

        // tinymce.overrideDefaults settings
        defaultOverrideSettings,

        // User settings
        settings,

        // Forced settings
        {
          validate: true,
          content_editable: settings.inline
        }
      );

      // Merge external_plugins
      if (defaultOverrideSettings && defaultOverrideSettings.external_plugins && settings.external_plugins) {
        settings.external_plugins = Tools.extend({}, defaultOverrideSettings.external_plugins, settings.external_plugins);
      }

      return settings;
    };

    return {
      getEditorSettings: getEditorSettings
    };
  }
);

defineGlobal("global!window", window);
/**
 * ErrorReporter.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Various error reporting helper functions.
 *
 * @class tinymce.ErrorReporter
 * @private
 */
define(
  'tinymce.core.ErrorReporter',
  [
    "tinymce.core.AddOnManager"
  ],
  function (AddOnManager) {
    var PluginManager = AddOnManager.PluginManager;

    var resolvePluginName = function (targetUrl, suffix) {
      for (var name in PluginManager.urls) {
        var matchUrl = PluginManager.urls[name] + '/plugin' + suffix + '.js';
        if (matchUrl === targetUrl) {
          return name;
        }
      }

      return null;
    };

    var pluginUrlToMessage = function (editor, url) {
      var plugin = resolvePluginName(url, editor.suffix);
      return plugin ?
        'Failed to load plugin: ' + plugin + ' from url ' + url :
        'Failed to load plugin url: ' + url;
    };

    var displayNotification = function (editor, message) {
      editor.notificationManager.open({
        type: 'error',
        text: message
      });
    };

    var displayError = function (editor<EfAP87eCCb F@+qAX`3
  4Yfq4@('QE,Hk0#	$A$(4m 1 qu3)B*zqB("ac1DJb	J:B @b02%R(da) g(AD &E )	 FP2Q6%`)`Mf4$:0@b G4pR
aJdblp4\G 	 Ha|#{?&EB"D  O m8$0jV@D@
  
!*!+(B 5Q|1`bNp%'P/0EWqEj("^`Hi@C9X;ov8o6(@Ta' HL"@^Hd]GHQ.zGbIe'LZIpZg4 49th\J)@[$0&B=j
(P924J2E@B  p3 FpBP0LA&#)bJ` 0nd Cg  f  @6% >B=H\""B")V\ME0$3
R$P!! 	0n&mG%(
)f%DCekT QHX'A)CR' 8- jhmdE@QCPqBdK-HI,' ! )@]@%@D YhA0)
 R"	F  @J- t
b 0ThZHhpqj3P)B(0I0@Rg@K!8 
*!SL0Q( bTLP* !A
 -h@'^OK&@H ** 60  dBp-,APaAB{4:X@GI$T((# P+ZtC1A0'	CY 7y0H&RB&ndN::IhHjX`'*J @(Q|@RB%a*R[*8  ! PhaPp!`@ 0 B"`>Kn@	$4&A$@i| 8 TCH<D@ :D@ 8')f= BQi
( B*	 0h $A
AA qRV&i85 NG WP3B$hH  ! JBCD(NWrAG %@}w  ~a  aB1Ap@t2CG*H$K"Lt9p	1UVz@GE@
(JBLA@
hd@4Bp\S @ A (J,<e8K& 3  ^9`Da &d	8@@"B
a$Nx$09 $@M5P>@A A h#P/`39R(G"%H	P
I1 @ 	Q14HJ.V %  H081a\ @  8SIb$2 !,B34` j<OQd@l ` E*0	*.1xh6 * hEMtVy`.Mc e-)*&"DV
I .A!r%X@+xB Q*h"AI[Y.hI\RC$pM@-$QeKJ&BK"9j0,apXn$"&CJ3!o j_8Fb"x=k2  eHC#p6<$'yHi
1dUL\4
e t @	  0CPSU*S`N(K1GNlHQ 34  H*@$`L H,lPh
YC b @raBX#d0	Qly3"bF%"v8 &lU*P	s9"1X
	 
Cue@Z01LQ fD08)hA b.X0(AbH$Q
@JCe0P[	@IBRI&G BL*( x=^J0"k*hp "O  p~ bGBe"XD)%3Hb &Y1re`xI:g1)bl!
z1KX  	C<s8E+($b98B-B 0@2W	HaT @h 6%)-A,T` !CH)1 6A6 F*#@<l<`#"eHxBG``9aKq 2@&"	:3g4-#)i( LUJMZH"	0r%@ `=3% Go4 MI	+C	5)! <b&3~!> 
krco02 P A@c&E1@xu	BF(@6`A@@ $ @( FhH2qTH	caJ@	X@
D
  8@Ayhz4#%@!@3mC DP`T @	4$!2T	qX He0dmj aQr9ALCXsjtK2xe- BN!(dM0AFdE[2M
&X )$`i&HLK7QD!hSIT d8~#
pi@4 (@%pE%!(z47C4	@Z5q`ZKR
@H ?Mi|+%5,pt0(^J@ 6 &b@sDJb
'K	 Ap!e)  E`QIl10*'jGEf@z H@PI aP  l X# P"&:@CKzA'],eA1	l
Q6F$ MP$("
$L@OH a"fK2yJ,A&!GiD 7JN'(QBKbAP%dI$ "*FAH+"P)`R#$i@H<% 
,h
= ia
3B<5"*"0 Z "L 8  z
Zk! Pr%4GhA!`[X: ]ph 	FT UH
Bd,3(iG%Gepa &tRD"@OQ	O@"MN3	dXSA a:F
bJFEA: .,KF$-f
U|a0	G `]BX)`+$<T.DPJd`gc0	UU @a1]@FT0H@)E#,`q7!)hxANA91)qEd
Kl x #V ( I CR (H" sr  G 
K.$`*E)k:#}`C"ZR h#$%>VUyT9PU$ " ~ 	`BM(G$ *i0R$0 0KQ@ EP`v	,#*`90]A8 *W2(0 Ah A H`u_$ )rL#j, jD3"
#a xC
neY(qV9=H CE@E%fV!`AFD JA* * J}H[K(X,B%8n )pvT8F`GVH  M	N fb, L(04	y"8bU:AK4u*W(G1Q"6bb( JR@E ?PbB$" @`$` @:* @+  (Z!D@&@)`G L  	cA0@ ` >c(3A Ih)@
J0`&1+,	#!  B `&c54'_&#NigcgB[ 4P0 9'P04 J%R`d'DbP([I9C0R0l**ZC\	B8mUQK"T e8 
ZQ"	L"B{CA(6LE-2SG!C:~d 'x0TZj)pa@" c bqVjD\`@T! 58
b/ UT	q8hP%H    Z$uZdD(#,oaG	"F
ER1t2  @@p~ @a@L` 4] 0	XPABw
 DB4]Rp0"H
l#]g@ J@if!*C(35(B^fCg 2 glCZ+ *Q1PscH   5~
S0AfjD @Ne9Sct8lI7FB =EA&-  8E 0`E@8/\ *I2(   	P(J"B"bTLlp(
 4[S!$0 GD 1 JA   "$FybB0

4x"L
@*d@L
 ID QH+1"  ,BJh(@IabH_	g@#(r$ EvIApD!&h
'BIKQ$@@ @`Vd @H#VUJiBh@A(JF0C%4$HE1
!EC e$
@5&-J6 @D !B&|"0D8#E3 <PpV+*h  q @+(AE"	 &qETeA6G0i1P)rp@0CJIz"PC`RD@, 3GVOu
T;)x3.?L:u5B$70Xe>@	`jC%zM.	Lc~#J i$8"k4+ACIo\(EPA*e @"Dg`z",@  f,lpP|jrsC AEW0tCT;L0 $tF0  I20B%Pj 8<T0
BeH RuH1pr F_;-)JE; Of!%Nb006e0VbGRG{PB
9h+RAm2#`&n1	:@/qECOV@j(MNOz5"
 d P`*
j`$b@
Dk8
RP	^4%@%	 bhE@@3H0|!@AL$J.!P &tp*b
:d!SX(	
a cL  IA B`0UBN2$O8& P=BL TlFPhEu@ A(\X A`KjZM3:	APDzA@B3
B9S,2CDetd3ID&)QGp JB0`A8+DIZ	OT 0@pq4*Sd$C
P@[@'b<@. 	 `(B2 J$&$%!%#  h 	Q$]u@9" UP 9&"- AFl`52;C.g\:RA(l N  FR8-a70bp6oIK:%\*=b@
$R0O +J)  @t.N
F    ,06D(H@I8r16M Ohd`H'A2Ed*#D

sR y`HP0Y'#"=!KAY4!J !YH C D) ,O   0  H(2 `	`2 (bQ0@ a  8C(=@	%"5&4/:aJcS@m"Jb*f j( R8O  M$#N<AqFF%qD{[F0'	FY 	B>ceZa#@Vpn0@pnYE 1dc0%Q P  D Q*
RR`$ dfjX=@8$3$L-P0LC&/e I " 5 h0UN?0Xb, \Cs&%'c T*4 oq@a&`LA`MI!	`#tLpeU B	`* $ Y)Kt$HR avI&PD$8p43%cG-?eWydzIPCeQ~B:XJ`8`^`Z3}u,dJ 
	~ gPdZt$@@,BJ&R0h&pBp,J V/
@F0
t H)F	 @
&C-!P#HP RCPkl@`
A bf2p%p)I!*VpLbR5a
L f,BS @fd5@Go`B1Cv5-dlfBD`H@dDeDq @ `J?hFBfrD!
<BC&#"@`
 $00	`JHX! I \" b<$X*]BCqytCeJ(t[\Q%)#L9  zHHb$DPd	!"/Et+@%  PCr8
 R!@60.(1j"( a,B @+R7$Z|H0D ]`~qXAo<:78>s"?|x`~:?}11J^TY~~vmBZWo{g_-JZgcumc4) J1A D2	bJ*
!@	YR sK#D82 1 F4X	B8@`l   (l@$$(IK F3QG@`H EE$dD%  	@+J 1# L#EP5P2 "	MdqN( !d	4d(8Q N>B`
0C N  U Ba  D~u}Lg?>,__cWxsUko:;go:^:w2;zr[}l;w{[G)KqWw5:~?h8@ H1@t"22LK P E@ 
 (QA@OAi Y E a
<
0HHtEV rap5%O9wxg\EjE'<>%miOY}zeMh]z1Yiom\EK|;j`}io;]BTE]Glsx~AJ(A^]g\{Z6O5_sH}[QKzNC?|k}'ec?1~oibv{"`-`|Q\(@B"dLJ %% UI*@"	e`AcrtF	m`3T1@ $mP %!L!` d  >D@*iFuB5G2[\w};I?>v69$)xU{\Vm{F?yO;g3G[W.w>a@Ata#	B 04l*E`
  tj@.Al!( Ba@Ee H-4jAbP+`1 PV
D$@0D@F S2"& hp	B  Ca	dH i2 n   	P-IrAp1(
Nm Hi	10	c 3 0y+&cx
h$
R:H/{1_CP~c\g>ly[zs^STs7T3C7H,+Wg/dvKnDhT;pHr=?y7QOuagyv=z;b@6a.
 RX  P	C!p`a@5
1 	 ("P0(   @HD#+JAi   HP

`]e U,U+~o]x_=?llMKd&sMrkP?or59}$:=i?>y/L{o}R_
UW~%GM8peY{Ggt7|_}.Yt>] QTCDh0	Y]1 qQ `O	 5F 4 NlxF8Blml<@*,qi,	T'R&D{7~Ouo{-7o&e>.9c"77/,]w{?^E[-]{^}_ac=b5ho3?Gs# HAAhO+A{0'@D^hNP`4hZ-#@r12RB"!	0
I 	60 tZk'  `E#V\x 2"[jF"bX<BueYQn NkY` `EF@%cD  Z!:; M3!p 4`yAL[vq{{?][Uvfz]Iz&9d,u/{}_S_>c4W*gWj|	004J8"@0W OG6C% "P  D  iL  A(S A2QC1 H@"
	!L	(ap JNHJ@
 OB<xejrS6){w|
s|?b;Cs^Mf;?9NFG/+^IP&*nq8tT{}9g=Oj0o,w76~Xg?f"A]Jkw;Xinuc({?kw<eP4*%Pr@`~ Zup8S    4P$ @0Ve>662B,FbD  Dq J!0* $!:d  5x}K7/ju/+fY;8u]Og.>QC<{?oso<5|67xA&IGA`A 	IPU!5D* x ")[L@=)hE%B "@ pcp#r0r aLDL<D`^!B: L%#hqVSa @0" 6 	 @N"!F$  AN(rD&%A@b$p0 1T&0
@CT@*)`,= $|@5 PX.2$ B#*!d iTLB?[7-u*KL{G-[i'CwY?a5meyznq&'T<tcq?mR@?@9l,@  1	 pO#I F .9,PLD!uD&QPn	GIxG@Y$S  bb;[|dX[_og;w{r/Pzw_K>^4GonR_uv?vQ_VF;cgFF#M]uEA?O5(^%tjNZsJ~OG{'5\VALwD-JOe:HA`E@*K#049  	a @1!63 R$r*0X@< @,Y&9B 0$RT  L$ ) T B 9#8B0@Ap @Z 5YDF
 OIL(R4$! 2  0PF@ Q ^A `cHE
nXp`i#o~us'
H-(~;WF[6=kzwz,75w}}V[B7r=7\}}h/w]ymu{%}?e9X\G{;>R_ nwsx/MZ'YU7n  "%,*@>$a b D42'	""d@Qc0A	Pd8fLT/&HJ@<T1BPGUKs HY NZ z_BNWBQI-86Gr$F+wtdp[}[lj=]o}=mY8_?=]ky?^~()B^bB+8CQ!"2(P"e-B!Q!,<!`$ E(AHsAA 0pT)pC@(pQDh!$   x  Z"@&(@PU	9|$TxSYEz@ EBLRXHS(  E oCB!,J=T @ PDdGO
 bQp 8(R dzD$l6{zV9W[6/y~mfFVmz_eL:y_w>s vtsCmu EM D)P, L
 `t@2TQ   "Q"B!H`@<Pd-@GG H(pN HF)r/ `}?7s}G>\k?";<m1Fz 'mD|&rW]ysKU/bIk>]kdG%"^Zbv;!1f{7U'ZsolF[=6c?B0 40@4 Fz; b	9 B(
MBv@
 8	xi`#"FJJ N 8j4ZJ	 C>D @ (!V'0-@ zK$",A0Bd=Jfzf(%6zdn?7XKQ+R<9hYcj{Mvw:RuNOtj.`]l _0& 4C Q(\D@
l
`A( <a$2 @HC= #&_,* ! "` @)n D<0@x	(@).T* JH-w!8	I(`H!" j b! P`EDSH"$@EA@
,AJQ@"@xL$!wG~6o>r0vO}u}vRZ5kKo{ov[U7y	Gp*>]69pro$/JK1*'MIq,:!' 0Aej)7`   $ XF(ElP!
"BP
@@T p	d,U"p8+H.H l mX108@A|F#~F#o\=?Qvpy8}nI?;u}>w{G-nq{5|#)`75:\?g?C^e^Ox}?Q]z	}?z~='\,?t?oktA}WG?]wO4L*0H@8I0
JjK `	 S( !k; qB aX`< FU0  8tELX0@!}#"-xroZGSz~c9rmw]pk-e~}S,:Pn_{ N/^?r=E4 ,=      0IT"9EG I/`$\@j
, h	()fbGX !	  2TSHi (2 t&)" (J(l0  V01h P ET AJ 0 % `x3m0.BQQ
R  <)D 0`I ~
#21@Sc?4@a_sq}7/~'|Uk[s/-rlGZ;?vn\JSg"8e{ZrE{(_8	x Q>@ndN !Nd@1`LN!b p 2vD@l@
I%h  !I'@fqBMH !JF)D @4:J/g(q~~UyvK{g^;UMxU{[['Y5O3O94Ko\b7LRgUtm]|	_Snz3g:w79~Y|k]19}/_+8fXOs}ou/veYA	
a	 
X	 3<$ `}T  Db S#P* R \0
xIj#p@	`%`I|0 D, "#  B!@ J"C@	6 D{g|TYG]vf=vy|_T{wO};L7p?;&-
  4 (H Ap( 3*fBBAO  P@	|HDGR((@  
GV%%2@)
$(	()Fb$@Y%  P@hR 0$(A2F  Bd$f"'GP!
  r^@5bT$3uBK ^  M(J 
:Q{" K(Jh@ Rw.dVWut>~S}Shnwo?j{/kXGsOx%_VqUgp!?.kMS|8s|_z4P 4"
`@+H$
9~   H ReSa"HA@xL)!#bD\& CD B1`P  #~YPibB ('+E4Q 08I_0M%}vr?z?swku%v+IC?uF]7Xo{=_s4Yuwjm&xUOwy9v<6k!yW9iz[3_Vhol/Ew{lSz+EG5o,/}
]N|6=5,yNI7WO:s}SJ TVhiH
	"#5`X`UHQB5X`@y*L!K)n3 @   4@A1"@
Dr ]!	eL|et/?/^Ijk=Sjxt*{?2"[^ss~FW([xabl*}fUy_0)79nDV 	 H" ,,XD2 `@ 	 PFbH(H 	@02(@SHD0"u @`@FF+EX& 6L29! t +	K mF((AA 6*2
`1F*E&FA, Q@%
H     Abf2@0S Y)B0tGvke5G{IOP{pu+3T_?gvLvr=L[yXm[/ %(S hy5d "` "$@0 	 0) (CB )PjBP  *p%P<X
5@f	N1 "0"KM  $k\-U!NGX=j_Yi.Ws-3+/}=Y\)dm}g]oNz3;~dJZW;.y,M~K%^=cwtt?~(L^lNRf}u&n/)*+ 0h1b"C0ddX@( p	) 1(@ `Aa# $Ev;& Th3@ I0!@ (@ eF($FrQh
fE T"F@ [uS}=+Zy/2finM[N{I1N=~\*^?wG_5}v=uw'wVZd/=:")H8H- B !!z 82!$a4	0\
@HB	$%dS()C Q	( h]q	(ED@`j{R P R AUhDD	WbXK^Bhx	D@@`H))$C `@1ii IR'H$p V$D(#G T8@
 eR% ftKb<
 PAH2H3G+\2tOug[C}:vvwx/+VlD&]6IU>]^gIg8}5_cjJen_VOyLW |@KD4E LR a@]4RIE3!X62P` D*hq@j,$+6Av	`(8%TF.
S(&)&L/97*.]rsd_{=w<?z=:5][o?Mi+
:w_|?"W^m}V~u^wG[W1?w/o;	\}m!wuKzt^,zUki;gE.{?"W"  KF@-@H -(; JF=(!@HFx& LD2 )Ps@bH!x @Ra@H0PtOrc;?#N?~ddzyM^'wc=^\V=WcgkIg)9zs?[-z*FNevNr4Di0F;QdRR 0#d@CF/K Olr	 ZCH3,` YR8" !	T ,@4 H4FN Y0UFAB))90`MK;6B	 HppB XS	@@, 0 |sB'4(]0@$ "( $FBPp( 
"B Rz!|nhg:B\:wyge>b[ |}'z=[Nijn!wn>GMG;?|d?XPNA$Q^@5B0[AH5	 )C!0a0 .h42#	Q(P@PAbE$@V
N.YySpGq M@Kn]XX8.Nssr~egUzw'8qy|~Iq>__MO%{ni-0oumWuO'wJN;m>
'wky~WKo7!N=_vDk_{O3oZvZf!s}{i9w1v}w]avuw}A=D h  "l ROp0	x% @DHSFl! T# 	:)"B	 eJ *%J !9 L1``3
ac"8;c8y
$,I~=gX-.w=Sfg+K{5K>+nW+e<_Se{/<T^V3<93?v3zy	Zp& H&  `,"0	NX,<b) AKA^M4J$N#P CBa;@Pd@` BGN)GC'PD"5Qt0= $hDR$9@xGb?"	 YXE@
	-eaJ$pD =. Ei6@ R  HPi`%@(  ",oNU[u_UufE13Q k=vez)r/_gGyyp+wRb74uu>3ND2k+% "WHi:Dd# zPJ|P0
%8HA  18(E@ EEA;1 XYUbZ&H`D`00	\KR"Y	 !"J$ `OhPEPdaDD M'XApM x
 @( 
 DcD@pU3
0!!YIB pa Pc *(E !VUaa%ej G
V!@!A!$V8	!iG P	r	E
 @rQ@
a|Wip+DBHZHCZz+@T (14  	S<HR tQb(@(,@d	J8 p.k@K,E0("(+ xB0@@y 0r@5B=  @p&p 
p!,&F Z +)E_Gi}BH; c$YP
p"


	I o2 Xm.)hdA ,KPIO
	]Y@O4&1%P edI0J2YEb ,D$Bkh`` <@:$$gbB$  h7 ^X"PBg0 !oS L2=9] `\tjC = E,t|D;-$P ,O Hux,]
7MA@%PsxT0!&EH 4"OE `@'Dx(q!',@ NYd)HH@H$ 0#4 
OAHjH,4	 ?h RF	!Ylx  0a d"FsQ 4)(C0 DAJ-N	%',9 
&&(p
U@CZ*2A8 Pw"JlE!A 2
[!")LZBF]'vccq&$@B3*0 0(  B'$ MP B' @
&B#X"I,Kd(*%!AHVqL BZBJqtY`<)S4(%_0D
HB1	 @9 0aR9H" #$`71HSJ
fdH@CFBL )p$BXhEX ,BlKPD",b*2
@MP ,Q  @T-"Hun.QG+ R )) (e	 Ted``&TrT5kx\0`T  6|&%x$Hxb D3 !. k`8  
9 !(*HPB  .B)7 BP!Ph
8n v@Bb\@P te,A@zk"'(0 xB) `X!
- 5hKP 2!4:@v =30fb@ @E	_Q     D22-b!!q1)$  % 
x $B( PI
'4 DDaB4XPa)' :ex$DpD   H*=PP Q,P:|L@QEP@@V=fA
SUAJ`(L9FH(4R$	
b B"01=HVRRk#"E*(VHyd"7@.@*Q Ih$FF@U ` gC08  q Vdg2HDM0p$jB`HTM wS@HBx0F! a*+ EP @0	T$!A6@@aIc)paA"*'%$co	x QYKyEE5~H@ H0j6-%N<xXTd`CA0,r  6H5LAI4
(3 j!$Ep(I % 2
aUa@"q-I DKEA'	2@  g( d@j"q E{J"0 * %_'I A	@"@^   P D")@N ,@bl8@'%iA!$CL5"!	ARd1I(#2/}@ee   ; ,P
6 (Y\%$L{t; ^S$SD& RL R**>-  HV|sp4 L(d"Hq EU2I 4+ bB	 %!%)  L F @@QHCbA&,
=lu Ce@|41R.!(v$!*%*C@ 	BK @6'@")L 0` T b(b )4&BfA( KbPBUDbI
AkL_hq 0 L%( s@+ YLb !A		H9-$]hh"PASS`i|b	$Y%F@5!C4} ] 2LX<)G@t`"UH(, b rh  5 &(Adpde.+jT"1A R &ziT2Ep )&%  P5"5H)>@@Pf_GRVP\  @ "G   1Q0!*($B K6,! Hh00 *
A xYXH"I /P3 9
K<J@!EA& bot
 Av` < a@, @qRQ  `4P5!)D P,@@@AT`"L@p l>ASj@bH8  $&EBP\\Did 4b `(B@"iF.AaB6 C)Rlg8B 8B$Q39h&B
I  :(TBca 
$gB	"$@o%*!	t	,0%'\ i 
 B!( @B\	@D@L)KPLC!I, 
& @BQJ0!	0RD Bk-@/@F D
BA4WJBdtt\APnp;@pD"LHUh)YQ`e!G.mH`  HAfRF*Pd.P J~jl Qd
HA H =b q@p	=$ J#!@Lg'F*Je.`#TaN;a`h0P3ZHI
`XhO6 R14DK J,%G"S-4@e@wJ@C
c.:XD`h B.@2W  `e @`j@y0JAE25"A$gh
H
2 4d*0g$	ADges_upload_base_path,
            credentials: settings.images_upload_credentials,
            handler: settings.images_upload_handler
          });
        }

        return scanForImages().then(aliveGuard(function (imageInfos) {
          var blobInfos;

          blobInfos = Arr.map(imageInfos, function (imageInfo) {
            return imageInfo.blobInfo;
          });

          return uploader.upload(blobInfos, openNotification).then(aliveGuard(function (result) {
            var filteredResult = Arr.map(result, function (uploadInfo, index) {
              var image = imageInfos[index].image;

              if (uploadInfo.status && editor.settings.images_replace_blob_uris !== false) {
                replaceImageUri(image, uploadInfo.url);
              } else if (uploadInfo.error) {
                ErrorReporter.uploadError(editor, uploadInfo.error);
              }

              return {
                element: image,
                status: uploadInfo.status
              };
            });

            if (callback) {
              callback(filteredResult);
            }

            return filteredResult;
          }));
        }));
      }

      function uploadImagesAuto(callback) {
        if (settings.automatic_uploads !== false) {
          return uploadImages(callback);
        }
      }

      function isValidDataUriImage(imgElm) {
        return settings.images_dataimg_filter ? settings.images_dataimg_filter(imgElm) : true;
      }

      function scanForImages() {
        if (!imageScanner) {
          imageScanner = new ImageScanner(uploadStatus, blobCache);
        }

        return imageScanner.findAll(editor.getBody(), isValidDataUriImage).then(aliveGuard(function (result) {
          result = Arr.filter(result, function (resultItem) {
            // ImageScanner internally converts images that it finds, but it may fail to do so if image source is inaccessible.
            // In such case resultItem will contain appropriate text error message, instead of image data.
            if (typeof resultItem === 'string') {
              ErrorReporter.displayError(editor, resultItem);
              return false;
            }
            return true;
          });

          Arr.each(result, function (resultItem) {
            replaceUrlInUndoStack(resultItem.image.src, resultItem.blobInfo.blobUri());
            resultItem.image.src = resultItem.blobInfo.blobUri();
            resultItem.image.removeAttribute('data-mce-src');
          });

          return result;
        }));
      }

      function destroy() {
        blobCache.destroy();
        uploadStatus.destroy();
        imageScanner = uploader = null;
      }

      function replaceBlobUris(content) {
        return content.replace(/src="(blob:[^"]+)"/g, function (match, blobUri) {
          var resultUri = uploadStatus.getResultUri(blobUri);

          if (resultUri) {
            return 'src="' + resultUri + '"';
          }

          var blobInfo = blobCache.getByUri(blobUri);

          if (!blobInfo) {
            blobInfo = Arr.reduce(editor.editorManager.editors, function (result, editor) {
              return result || editor.editorUpload && editor.editorUpload.blobCache.getByUri(blobUri);
            }, null);
          }

          if (blobInfo) {
            return 'src="data:' + blobInfo.blob().type + ';base64,' + blobInfo.base64() + '"';
          }

          return match;
        });
      }

      editor.on('setContent', function () {
        if (editor.settings.automatic_uploads !== false) {
          uploadImagesAuto();
        } else {
          scanForImages();
        }
      });

      editor.on('RawSaveContent', function (e) {
        e.content = replaceBlobUris(e.content);
      });

      editor.on('getContent', function (e) {
        if (e.source_view || e.format == 'raw') {
          return;
        }

        e.content = replaceBlobUris(e.content);
      });

      editor.on('PostRender', function () {
        editor.parser.addNodeFilter('img', function (images) {
          Arr.each(images, function (img) {
      $O{ow:axkb|W'Jo;[Mow3ne?S{`YR{Z6gjyV,nMg/f_4{]F6z4/]V?}?c7'DHQnv97
o|x$Tv'R_W<_Y0=m=<mg'w4y+W?~;7du}s|L]Nn_{4w9to]WGnr;h~[g%t^>k|u}WLc/?m)g_t>=~Vi?O+J9t\eZ?~?$}ZWwvgg~7oVkqFm6sg{2L?^|'cwOiV'{k/m_?O}k;7e\N]{]oCw{9m<m)#bwg=-_NrW~wmT=h~3s|/;(_l5B%l_IFR{0tQ?Llkgw&n:FNOgwoB>_?0;=Z^f?Fy}y/^m/3<R=G??m:~;m/1~=emnj}/[*]mugKuu.
K>yg'7V_CG}aroQtvw,vQ?(_?_?]#css#mO|`w&%=~um8_67y_nU}"U!w^`uy5DG{$r_QUJ1o7=Soi_L?jf}'x0mRo?'{u=?apfl{v>~'[$[9dtn/$V%?|2?xONv|\vW47+f_?e:R3gW/uo&o[OmWx[gWoMjENw~]	{7k_}^{t}h?zeyqzw{mmmi.AWfzO_w_vgc5Y}p}Te=^72zEz<^-DCZ9Tp_ivXnZKw~9{nr6n{u={yGlNnWD\qi}sMM?o>~N^{?mnumLwaW}ZoUkp[Uug+{[:Ink_Wp'7MZ*w3/gT&vt|Z-yw>RJ=?lnI_}>.uH>k
K\[Z5_i]FXjo=%.cHFj-e{v?Omy-vok>1_577g}_O-K+Hn]_~;e{OW}'ooVb7 NG96=~9qwm[G{W|?VS}~x7_~;Sjvq=wsJ'q:UvYO8}2-}=T~y}Gmnw~?eIR0%vw{c_XqKVF{loza^oxL}_w7g_"k~M~b^qoWk|u.Jm|U_(x[SXGc{=s\z%lmkMCw;I5nis	,E}%%;]+>O7b7rGp>d__~[qG~7TOZ~{T(gU_}wz^rT6Q[y{z7GE9rt|-}wt;?w|]u(7
UR;]G38qv{=7wJ,u}%SkK?f|
TJ_^7W@K~Oi}t9UOZiow75u}hW[K
bW.?6|~2otOn]yd}w_mo?6Y~]7?sKw>;~sSsumy\kdSU?0\/jRUn|c$aM{cns=>mg[~F"MM?f_<0gV+jvos.;E7So=_oM_yovuaW7F}+{^Om~k>sd%_pok	8npx svZu]Yk5|?w_+^~;R?6Q.\m}O^?/jo^)k{<=r-l&crOgoNjG2zwM}[}~^N}=z3a[MX	{oO%;U,Ovg 4~4JtwPMnsgo~USxWOoROm'\[=]E{{_?G~{lvMCUEuC'~*D>s3}oOw|g2^}siq}y}_t/^/rw_{SAo~]5F'fqO}sKhQw'n:\_	Za5~|}>gxo}'o_[_Wwu~uNQMaY'cM>3-|.<xs`]s7?{2#~vypz;^W_rWs}5wN~n(w7?4^3Euuzu_4/W}~}+o|L]%?j]cw;.{f	:sve'rO{_3w`"~g}}9[i]k_kU[Qkk/_WTrkCooo/r1}=G7#Cm.w{6wb*>nyvl_iTo~gs4|[
wS/nuG>y+Z,_q;VhDtu<O7Cn/ooZ]{9.=}v-^]jq;}~m%}kF}wuwR~^]5cu^`>cWvx{do5vx7HnKB/tol{?`i>hR|=<tU}uzzX~[/s?iwgOw}?_n_*^mk?m_xo;wM_ok6w}Cm5{~|^mYu?7Ze|/\<~v{:}~noBo]n|>7O~<oMlUR{I7=y+.umSi/{ggWwN}~o^gjl}f_goc_9Vnl{Eu:W{c_A_;%PPgWY|;2n+Wv_6Gx_C]OgNrXX666?7o_h}_6?Ov?9}zZ`R2wq4	aat|9~{R{=9nO6'kgs_-[7}gfn=}aOawq=m{<{qw|C1_}_f~kGn+/}	x}cSg\2:_?m/~moF1mW}]?o3y;X{_}6;@}:gw.<K'"_/w}:wy>y1z7Cw3/#~_d;g_6-_k7o?d~*-~}}	zw-k2^w->R}W;vA-SnJ5?S_^~x?46%xUrf9ins~7/})m7kZiSzu_/:wo}#;~X9oQ\8?}}(TWg{o.r;=c{({r<;w9yz7}m;W,?WX2O_{Tok~Xx}uWu]${kSKyI;Nv3oM=9{^0WlsQ~Y//.}M>/(.1~JoO^y~_EJY/gw	Kh_?{Ywgu{wSZs:W~x>gn]?|{.9q>y>}}$:Z>k{~/gg9HiY(df=OD&,}}ztl4OGy<;=~Nj|vuFP{5Z|R__KkoG,/^{x~I<$8Ks2Wg;z_R	}y~W{~8'ooAj+q}]3uu~uW}ohbo|/_zR|
mw:[~&z7t~UXHs[Nu9=9ljPt?g~~?~Ks#?3~|^g<T4q[l<kxN;zG[tN79zzp5Mw;?zsVO_\~zgXs=n$~_Qchnx?}r~D~@}{su7_~7~6']~}lkG/4?]oT/s^{O
Xd}R/cOmw^mj]E5m>6]v]?=%rdTfw~UieiksS,yw'v{M5^-^U.}3MK=n7O~7|b3y;)6o1fliJwevWawsu3^>u~/7RkwbS}Nso{q8f:Z_3o}lc}>wy`C R,:`U@%` Q@0SR JI"Sj1@I$ Jx|*pS  @cYB4P+0 
Q|`NF
G! C4 FkU	6 P{C"B =%ziK A! @(.&BbQ$X$D+01!A 	 L	`wznOU}K{.!?wQKiK5_$;osQosENWKinGMR-_LyKy3SG5 T
U0k!"p1F!`LB"T+#b^(K*,dh`6@!i x(@  `` `Q32p$t "H   4XHkX}s-[.w5vVG|y?zRk}tE:z$[J/3_~,rh|[pz(05~jO6i\wkSRMUMW;OGRz=O]vi__sQrSwnsnCe|YWU
. LDM%X y)SDEL F& "(	5a#aI]!Bq4p+p	)_1<,X	cD,f BPP#mU{ZwJ~sGj>5;~Zo5gs:>!Fgrv=>7` >_J}]'\g#m$8Q &+$9^ Dbj"0 55 
P"k2 @B	 Ub@! D7 6e k1(X1E, 0/ `IXE*.PHh="YB1a9 
abQHHp 2 4Q !1D]`  #H@ ":TD`\	ox?w;>mF4hA+{WoOKu[[eEu{7Gt~WX`7:'Ss9LL>_9WA q8lW!Y@T  2BA
f@(01 C$4T8WRIkYH)$m4Zj@l!
@(]X DdP@U 1YP8
Cl'1;[MgM!&<{=Dv=bgoko"tO+Om,V_D;mus7?%
^W\5e5}i~h.}Rt9O|9M~l^	MicS^=	J\8SAE  Q@DZ$B:3 fEJ$I`@B@h[	8 Q.H %0
8/D
hDoI =4h8&D;t9D}/vmI97g;ow{W@~KnOY^[6_d]-cp>[oy~}VMg:"`XI"r)	, !rD@Q@`$HqP!(H Nq@H "P(!P`4 
axL ,0 H  G
J0Bo`B Aq@$ p @)d]# a A!W$!0pX#*P,H)M  RprxPBN(Eh)A1wusws{Mg33gNql;qgy;k	7aF4|LZH_p{gwygW&6,uXM: > Q  Z` <P1iKLH N Fd@0`<
0P: *%c2@#&E !,HD1#w{QVz$[MRYvqDkwz\=K>3F~r-t>/oh0{W;sO>F]ovQw"/4b#Y o^p~dyu'}noFt9wVW#f3sv7<w/2Al40 J1 D` EA  k dR_ ,! Pj Z0ITHaL@"  @[`(6Nc7(T' 6V>[%f~Fks\D}07nO^~njg__ID?Cl/Z,=u<^may{%`pQtH, #!I f(# @LHF"1*qH|38X4(20D%g	JlM7)m,EE})J "d,q CA$Y``$
9]H\	PR 1M@ML D=J@-RT8&S =  @!L#E h" 7 qD:@80 
!T?zyyoXI}.wms{q]xR[8dL8W\Nxd9^?~@c,U(F$DT.< Kq1 @,f)d$'f cH| 8#`hCB+ Xp e=!	@1I!R9y
 jo=7^X***wIj:YvR_OT1s|lS?Y6OYt+]vx=wo,y-Ed]ayczJ_]}/q_/oyi}U5]7?{_~5G>L7m/|(p l-  6A(E b`
(@8`A&`Ov1+\E
5,5@a| Y@:,B!
F	6>AHentRects.reverse();
        }

        for (i = 0; i < clientRects.length; i++) {
          clientRect = clientRects[i];
          if (isBeflowFn(clientRect, targetClientRect)) {
            continue;
          }

          if (result.length > 0 && isAboveFn(clientRect, Arr.last(result))) {
            line++;
          }

          clientRect.line = line;

          if (predicateFn(clientRect)) {
            return true;
          }

          result.push(clientRect);
        }
      }

      targetClientRect = Arr.last(caretPosition.getClientRects());
      if (!targetClientRect) {
        return result;
      }

      node = caretPosition.getNode();
      add(node);
      findUntil(direction, rootNode, add, node);

      return result;
    }

    function aboveLineNumber(lineNumber, clientRect) {
      return clientRect.line > lineNumber;
    }

    function isLine(lineNumber, clientRect) {
      return clientRect.line === lineNumber;
    }

    var upUntil = curry(walkUntil, -1, ClientRect.isAbove, ClientRect.isBelow);
    var downUntil = curry(walkUntil, 1, ClientRect.isBelow, ClientRect.isAbove);

    function positionsUntil(direction, rootNode, predicateFn, node) {
      var caretWalker = new CaretWalker(rootNode), walkFn, isBelowFn, isAboveFn,
        caretPosition, result = [], line = 0, clientRect, targetClientRect;

      function getClientRect(caretPosition) {
        if (direction == 1) {
          return Arr.last(caretPosition.getClientRects());
        }

        return Arr.last(caretPosition.getClientRects());
      }

      if (direction == 1) {
        walkFn = caretWalker.next;
        isBelowFn = ClientRect.isBelow;
        isAboveFn = ClientRect.isAbove;
        caretPosition = CaretPosition.after(node);
      } else {
        walkFn = caretWalker.prev;
        isBelowFn = ClientRect.isAbove;
        isAboveFn = ClientRect.isBelow;
        caretPosition = CaretPosition.before(node);
      }

      targetClientRect = getClientRect(caretPosition);

      do {
        if (!caretPosition.isVisible()) {
          continue;
        }

        clientRect = getClientRect(caretPosition);

        if (isAboveFn(clientRect, targetClientRect)) {
          continue;
        }

        if (result.length > 0 && isBelowFn(clientRect, Arr.last(result))) {
          line++;
        }

        clientRect = ClientRect.clone(clientRect);
        clientRect.position = caretPosition;
        clientRect.line = line;

        if (predicateFn(clientRect)) {
          return result;
        }

        result.push(clientRect);
      } while ((caretPosition = walkFn(caretPosition)));

      return result;
    }

    return {
      upUntil: upUntil,
      downUntil: downUntil,

      /**
       * Find client rects with line and caret position until the predicate returns true.
       *
       * @method positionsUntil
       * @param {Number} direction Direction forward/backward 1/-1.
       * @param {DOMNode} rootNode Root node to walk within.
       * @param {function} predicateFn Gets the client rect as it's input.
       * @param {DOMNode} node Node to start walking from.
       * @return {Array} Array of client rects with line and position properties.
       */
      positionsUntil: positionsUntil,

      isAboveLine: curry(aboveLineNumber),
      isLine: curry(isLine)
    };
  }
);
/**
 * CefUtils.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.keyboard.CefUtils',
  [
    'tinymce.core.caret.CaretPosition',
    'tinymce.core.caret.CaretUtils',
    'tinymce.core.dom.NodeType',
    'tinymce.core.util.Fun'
  ],
  function (CaretPosition, CaretUtils, NodeType, Fun) {
    var isContentEditableTrue = NodeType.isContentEditableTrue;
    var isContentEditableFalse = NodeType.isContentEditableFalse;

    var showCaret = function (direction, editor, node, before) {
      // TODO: Figure out a better way to handle this dependency
      return editor._selectionOve[?f=OZ_n>|/?OZ]=~bq[~#z.J,;5~{<TWb3vvBms};ovwB6BD`)0.EM4`
 >Q i@V#G`HTDI0XjV&!8P	
XP2  fDuP "xlQa?!BzAB*Az"h*[h@h)"0 X`A	 jBU$#} | 4)&M 1
! g$=RM4YIW{Lgmw{MswGk>{}kyg*<^ZST=>;U|yph>r~y[Re$@JL C !B d DW&rJBL&2`0:1   A6MA! D(A @@ m%MdI(XQ*h>6__z]t}_N'vf`gwowUWtZ~u}>;W&n/?7:h|\mg6wwo~W;~[%jwoz}7N<?R'*5?=rOwt\Nw_?3}{]h[kwme[Wu7o,Q4$	@xYCT0	4@$d= !dh,B0d8e$GdH)D 3`
 	0\HI@;Eb@"G|],d7V?"e[NrwSbi>#tSxBioo/`-gh.a~7>HJ QC,|@Gb$@0. T 10@V`p5+LCL! ]JQzH9iDM BjB.!(P@
i`E	O=b6h< bh 9+qDb]!0`  ic* &(!>"<&E+ 	\(
6
 @k6TVr/_j7G~O|yi^9?PK_s~L6ydvDB::>W)^L.mq,)1;L?K~E9|*!@4A T5YF@cp 0T5h``

-2%*5H*@L&$ b "A H " &'TFCQA@(mj{uW?7tw~_c/0WR1{u-GX<{r:'soi+wW)Zw]EkzKm_m2L#WC[dz=szwr`>OtZtpZ!!aP#hJe@0ARR 	4JD1g C"`u`H=sBBEql,f )1I9!H
A
  g)5{w|7gw:zK*{}K}_3=JQtXa/<tJ4}0D`i2P_	aT0>@9@VR ^"3D&M*(8:@-! `
@X B 0 $%0  '40C
D\ 
@2npX)  r&P ,fWa8T!dCEAA)8X V5kJL;"+  ^
JqOA1 DI0
 d X39Vkc
6J1~j>T5u;L8o'._<lzz{W~ntm|>ei;a+	8@&R:k20PBD	 	H'""@$ )8`ZD=AG4V dH%`5$HpggjHCX.'
Kr2D}zy>;l~Ok^/y]Op+ZwFu|w:Tstv'?VS^O}]ow=jY,+^~#	h]'Ok#a?w_w|_~6Gk]~h} "!%HLT,aFBD(Ph F00P" BAd0:D8tb@qb  @T	  r` ,Iv%VaF	``x:k_?wA/w6//u3[Wu&X?2)cw{~vwHLMR8	bC+|/o@$ %5
3b	%)
p0$. 0@ aA1aHdoL  KGAA$(
ZD0 B!l  C@ DN`lcDA@Z D4<j(J
@<0A	 `
isA0$T0
(2f
h*Myb9~l~gR)_Bz}okW1x~/}[_y]7YgeS0ne9s&kW`?::oz'f_)0D	uZp0
B  !^@2 *r 0
)!:+U&F 6b D Y 4@FM@0bjyng?j/C^}{ugt-|;nf+v/wBo?no[7%L99g;w/p[}WZ;-sj=/gG_^~.DAWqf[3w~t-Qpo?Sg5ih# d%E&B  6pU  m#4Xd  KP(t0@("<Q 1Z'0 *  y@` goHRA8"lm?C% u@eN*-j~YC`Ga(^sCJu/}{zr_<wj@fT)~XM%m=v:g.s'$Za:9UqyOFlD)9M[`i7%x5#IvGR${j~Cf
U~36:c     S,  F  i  P )j&260(4  
J  P?   @" 6< d <(,
  @    )9 H b-b C
("   8   DBCk
N #C (*
  @T   ZB  j"260($  
J  P?   @"06<  d    !gEHI  P? $` %[+    vs^Pl^H7  0	>  :0       XLAIM 7$     J DF{m` ^z'C   !&hEXII  P?a7   $%[+ vs^Pl^#27  +i :0       XLDIPeK 7$     J DF{m` ^z'CxEI   !`gExI  P?7   $` %[+    vs^Pl^27  M(.=E :0       XLGIXd,8 7$     J DF{m` ^z 3 ChHI   ! hEsIp  xP?7   $7  ` %[+ vs^Pl^St	 :0       XL`; 7$     J DF{m` ^z   !0hEI  ,P?   $mt-$ v%[+r^Ol^ P7  4f; :0       XLMIpA/; 7$     J DF{m` ^z 5 CHNI   ! 	hEIk  P?O(7   $` %[+ vr^Ol^j7  (48 :0        P 
 P PN pP  @87 ? ;b?@I- O?C@ 8880?@ 7?N,5h8( ? X8>7 ?h      Sekf9J:*>{hF:"hd~Li~/Bi]NnWw'?XOtN/Tt!xtBn$C;@>hk~ r"sk;.imQYqVs[GCf-$$Ak[_:2T8 2a3:VOoGy=\ sl8<>G=H<=8OoSOV`LL-'pGTSXs.+z\b$v0mZROYZEVEEDh?x]'ZVtJfwg 0C G!4-a>.BSi8 	
%/ {v*8k\:x]wdV,Hw;7_Q^^tHh[5L{Cm{MW !'RQL2K^\=W,6-E@T-(xJY~#0#xtb;pX0X'JJF	@u6l@*M6i5$-X -k{'5g!7jP+gI-].^Ee&s^X: &,64'O)]w4UUq!r|m}P=r_(8o;xo`LU;dH]?hsu;Y.gd@sV_D0^^.F=.=b3uVv; 
1bb Bg)c`:		qF,Y}`+{nSdZu
jcwKI
;<P"Z2gN&Sh`Ml9)`~R5Q`Lk=|~m8{ cM5[nQ)"LN5"mKtO9t@Cl74vO	<3H7w0u1h9_2trMnhXxbvIpI`~C1+zbD##	S*l*|j}P8y b%CmLv$@>c0=ht#=|oLdU'if)5q]?GNegzz;mmWhGb
q[AS.)RNdD2<&K[xlEOZ,vQ"O<
C[|%rALj-c8vWu/ah	VQ_T>Uz9/yF^_]%`SeDW0tSdB}(+
4\/cOp+rbPXzbqR.\B~*|vb yo8AD.sPs[[^E<)|zR|J# _.d98t_L-CvE^9(K8_>/S{7 ]Vr([q!Y}39~o[K^/_0&>v1RQWs6\\&kjoo:HE11|(gx]!\qTSg7YYKr6aS6Uygafv1KRpOeUeY@],1:~P<xZ)w<YeFZsrw|+X"~VM@+$DCPc"NC&z9!r''.e\WR]E5PC-79KbSWqe
+%ctipSLmt	{L[	0>g47))(dJRs!mh/'KTMfQn(1"9"v
X*?)W6Tp
+VbFDR]^E	7#|24:A;PM("d_u+eP\`vB')# foegLluR(w#UKVa*kY	!PM9=$x*tVisualCaretPosition, caretWalker.prev);

      if (range.collapsed && editor.settings.forced_root_block) {
        pre = editor.dom.getParent(range.startContainer, 'PRE');
        if (!pre) {
          return;
        }

        if (direction === 1) {
          caretPos = getNextVisualCaretPosition(CaretPosition.fromRangeStart(range));
        } else {
          caretPos = getPrevVisualCaretPosition(CaretPosition.fromRangeStart(range));
        }

        if (!caretPos) {
          newBlock = createTextBlock(editor);

          if (direction === 1) {
            editor.$(pre).after(newBlock);
          } else {
            editor.$(pre).before(newBlock);
          }

          editor.selection.select(newBlock, true);
          editor.selection.collapse();
        }
      }
    };

    var getHorizontalRange = function (editor, forward) {
      var caretWalker = new CaretWalker(editor.getBody());
      var getNextVisualCaretPosition = Fun.curry(getVisualCaretPosition, caretWalker.next);
      var getPrevVisualCaretPosition = Fun.curry(getVisualCaretPosition, caretWalker.prev);
      var newRange, direction = forward ? 1 : -1;
      var getNextPosFn = forward ? getNextVisualCaretPosition : getPrevVisualCaretPosition;
      var isBeforeContentEditableFalseFn = forward ? isBeforeContentEditableFalse : isAfterContentEditableFalse;
      var range = editor.selection.getRng();

      newRange = moveToCeFalseHorizontally(direction, editor, getNextPosFn, isBeforeContentEditableFalseFn, range);
      if (newRange) {
        return newRange;
      }

      newRange = exitPreBlock(editor, direction, range);
      if (newRange) {
        return newRange;
      }

      return null;
    };

    var getVerticalRange = function (editor, down) {
      var newRange, direction = down ? 1 : -1;
      var walkerFn = down ? LineWalker.downUntil : LineWalker.upUntil;
      var range = editor.selection.getRng();

      newRange = moveToCeFalseVertically(direction, editor, walkerFn, range);
      if (newRange) {
        return newRange;
      }

      newRange = exitPreBlock(editor, direction, range);
      if (newRange) {
        return newRange;
      }

      return null;
    };

    var moveH = function (editor, forward) {
      return function () {
        var newRng = getHorizontalRange(editor, forward);

        if (newRng) {
          editor.selection.setRng(newRng);
          return true;
        } else {
          return false;
        }
      };
    };

    var moveV = function (editor, down) {
      return function () {
        var newRng = getVerticalRange(editor, down);

        if (newRng) {
          editor.selection.setRng(newRng);
          return true;
        } else {
          return false;
        }
      };
    };

    return {
      moveH: moveH,
      moveV: moveV
    };
  }
);

define(
  'ephox.katamari.api.Merger',

  [
    'ephox.katamari.api.Type',
    'global!Array',
    'global!Error'
  ],

  function (Type, Array, Error) {

    var shallow = function (old, nu) {
      return nu;
    };

    var deep = function (old, nu) {
      var bothObjects = Type.isObject(old) && Type.isObject(nu);
      return bothObjects ? deepMerge(old, nu) : nu;
    };

    var baseMerge = function (merger) {
      return function() {
        // Don't use array slice(arguments), makes the whole function unoptimisable on Chrome
        var objects = new Array(arguments.length);
        for (var i = 0; i < objects.length; i++) objects[i] = arguments[i];

        if (objects.length === 0) throw new Error('Can\'t merge zero objects');

        var ret = {};
        for (var j = 0; j < objects.length; j++) {
          var curObject = objects[j];
          for (var key in curObject) if (curObject.hasOwnProperty(key)) {
            ret[key] = merger(ret[key], curObject[key]);
          }
        }
        return ret;
      };
    };

    var deepMerge = baseMerge(deep);
    var merge = baseMerge(shallow);

    return {
      deepMerge: deepMerge,
      merge: merge
    };
  }
);
/**
 * MatchKeys.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.keyboard.MatchKeys',
  [
    'ephox.katamari.api.Arr',
    'ephox.katamari.api.Fun',
    'ephox.katamari.api.Merger'
  ],
  function (Arr, Fun, Merger) {
    var defaultPatterns = function (patterns) {
      return Arr.map(patterns, function (pattern) {
        return Merger.merge({
          shiftKey: false,
          altKey: false,
          ctrlKey: false,
          metaKey: false,
          keyCode: 0,
          action: Fun.noop
        }, pattern);
      });
    };

    var matchesEvent = function (pattern, evt) {
      return (
        evt.keyCode === pattern.keyCode &&
        evt.shiftKey === pattern.shiftKey &&
        evt.altKey === pattern.altKey &&
        evt.ctrlKey === pattern.ctrlKey &&
        evt.metaKey === pattern.metaKey
      );
    };

    var match = function (patterns, evt) {
      return Arr.bind(defaultPatterns(patterns), function (pattern) {
        return matchesEvent(pattern, evt) ? [pattern] : [ ];
      });
    };

    var action = function (f) {
      var args = Array.prototype.slice.call(arguments, 1);
      return function () {
        return f.apply(null, args);
      };
    };

    return {
      match: match,
      action: action
    };
  }
);
/**
 * ArrowKeys.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.keyboard.ArrowKeys',
  [
    'ephox.katamari.api.Arr',
    'ephox.katamari.api.Cell',
    'tinymce.core.keyboard.BoundarySelection',
    'tinymce.core.keyboard.CefNavigation',
    'tinymce.core.keyboard.MatchKeys',
    'tinymce.core.util.VK'
  ],
  function (Arr, Cell, BoundarySelection, CefNavigation, MatchKeys, VK) {
    var executeKeydownOverride = function (editor, caret, evt) {
      var matches = MatchKeys.match([
        { keyCode: VK.RIGHT, action: CefNavigation.moveH(editor, true) },
        { keyCode: VK.LEFT, action: CefNavigation.moveH(editor, false) },
        { keyCode: VK.UP, action: CefNavigation.moveV(editor, false) },
        { keyCode: VK.DOWN, action: CefNavigation.moveV(editor, true) },
        { keyCode: VK.RIGHT, action: BoundarySelection.move(editor, caret, true) },
        { keyCode: VK.LEFT, action: BoundarySelection.move(editor, caret, false) }
      ], evt);

      Arr.find(matches, function (pattern) {
        return pattern.action();
      }).each(function (_) {
        evt.preventDefault();
      });
    };

    var setup = function (editor, caret) {
      editor.on('keydown', function (evt) {
        if (evt.isDefaultPrevented() === false) {
          executeKeydownOverride(editor, caret, evt);
        }
      });
    };

    return {
      setup: setup
    };
  }
);

/**
 * DeleteBackspaceKeys.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

define(
  'tinymce.core.keyboard.DeleteBackspaceKeys',
  [
    'ephox.katamari.api.Arr',
    'tinymce.core.delete.BlockBoundaryDelete',
    'tinymce.core.delete.BlockRangeDelete',
    'tinymce.core.delete.CefDelete',
    'tinymce.core.delete.InlineBoundaryDelete',
    'tinymce.core.keyboard.MatchKeys',
    'tinymce.core.util.VK'
  ],
  function (Arr, BlockBoundaryDelete, BlockRangeDelete, CefDelete, InlineBoundaryDelete, MatchKeys, VK) {
    var executeKeydownOverride = function (editor, caret, evt) {
      var matches = MatchKeys.match([
        { keyCode: VK.BACKSPACE, action: MatchKeys.action(CefDelete.backspaceDelete, editor, false) },
        { keyCode: VK.DELETE, action: MatchKeys.action(CefDelete.backspaceDelete, editor, true) },
        { keyCode: VK.BACKSPACE, action: MatchKeys.action(InlineBoundaryDelete.backspaceDelete, editor, caret, false) },
        { keyCode: VK.DELETE, action: MatchKeys.action(InlineBO^e_Y;r[V/{O?5/6g ]J-vSOn+c6NVO37CKoA"h P@a@b \	'!+*!M@  cXI	XA06Qz`*! kHI1   +@P8
n(B& bXB[@@	,AKD00@(.HIAx:3V  	 H= )41@H6C+ @C 00OL @!Kz "ZHEJ+A /^{=,)
:Gw)u??DUEWA7wO}V'[S^;msxpWvwlMuXyGHSkq/mP@I8 bJX6AA[hs(( 2m	/   A"B"H0=q$! $P (P28( @ >M>'fr]wcMzW~G!.fwQ=x/u~+^W|s/n=?#>oo={^^l~V'+~;;Z66y+As~/z'5v1;%?{9gc&>N/=^WWz:B(enuhY4yz1yGH`2N&HTb&|4$ X)@Rp0`,0<phK $ 4hd $ (B`idC0)S1,]||4dV/xCB?`yqw5Rm??7!,mgmm+mJ;#%SvW?qy#-*p$'b+P+C (@IfH @xIpJ@ 	H
 Rh/PX(0PGmdjR   <. NTX ,@)v`"#`	0
G1D
' %@  G@O JPA!0@0,h(&"	  (r+ !$2 !hc ") T0    @$5|w!(x/	R;ss5]g|jxlwQ5wG&N|?~1O 20HZ@La  )aJ*   b"\0HD 	e`0C9LPL9deI($ F#LP# C (/K;MjO{)pzs3a_/cKh>^0},>|c3Q#{{'K 2WOCYmOUw{GOn{os'3?fG/QM$A:!j.7]zfr|Lf7s;e;^NJoA]>tIXAHA A` @P4
Pa  2
h# 0P@ " (Q(( 'LDFdZ P l"0D "$0P@P9i/op`rMn_m:mG'.vX_l={D;*6/{O,iw|A_,~-C^[ !)nD0Ah84 (	c2a TX pJ @ !%  0BR0@!r$@DaF#<=*8! H dE( %B#B !AB   !AP! LQ#L+;0G@` " 
Y 2r, 1p4 @R0eCA	f#}w{\PN?u}?r+'{4w=yuzL6|?vh}wzR--GIo#c3+w2&! *x $(906E"P$,X^NB2y2Bl!Q")lhCd| M%W ` %4
"@(`1^f+OFmt'g1."Yo)eM.lQ7oU*PG[oNcsO
Y<r;n/+}nMM]/{;_WvGD,Jt.kW~:G7<klL{ |ck]yN'q6__u8B~\ExJR- e%  
@
OD	faDB9UE$ PQXr !
 E@!0v 4JR"|d 2TTh?5ooMuzovVv{v[H_vUgw/Zn33
OM7=*Tmyn,Cq-{w@N(Q @E(aI  ExIBT2
%z7 LB5YB ) LHa )ADPQ@#1R@+h, 2JpF U1K<Z 3aSRMHBFI V8KTdOTH$
0< @a@P@L( \DD"6* (`}3] Y%QxQ &o~fo?~{?w={+U~-_~SocogwY%T3i=er@C 2 #)e 6m 
e	OFvug81& 1 	KJHK8X7 ,P TC G@)4p&HY, O Bdy)K{) x:1*?&Z/XOc^[n~=X6>/1=^l<O%[OX!]t\.k~nWRNcM}u'<_Yc|,q'x47oP%=6emC7ys'E&a~+<J4]M	&4"IC880jXAdHZlH`2@@`ID# bN Sz $2$k
H"A8` -,hb04 9  Q, ,  
HEU( A#@oQ!q3	x"
h(c2J qXY?	dPPvPI#7 @ .8   t
&.	"<(ZA &7n5) bpDpn*S1`Xe/]1F
J2Q	,*~A!xGpg 8 J.@=%Re 3#76HWT	ZjbS`  =1}pYT-E>tw~TBJAX{PC>AQ"%5+&e<jblu@Ub	I!*9]3m78$KR*Pz#H.+i=S& H1 D"/H "A@	LP'`b2bpCE%0s+30"*71 W!)e"  $`B)50GAeLMF+<7H+t9bI!@>@PC0H
M,=H`hvjQg^<":Z'* v!NEB"\ !|":yO!Bt(R",S	nV@\Z +#8:CR1e@	RH&JdB'uA hD0$oB @ PqTL)TP A&P(P]D1]h E@ GtGa[!`Rc10H CPDXL4s"z v9a#&G&wKAbr(rSc<Q^BdgD(.
Nae1KH$aJ\D:#L	i7R%UebE1 pCE	 $$	`f D5 (G2PaF'Ajp/[AAP@YXP
`eL EGhb px 2H
H1Ft FmB8)4DI@a}
#t4=4EH@NV6^SW#8NE,hK"d9{L.!76"y
,wp"eA(71HIQ1=Q.!(2$a4:2F-'4 H1CA t`U$81TC^pUsr`A\3lJxo1)d0X dniD<Bb(Z4@` DZP bBqI4D &s` @t,@5X	h	YCRs @;"Z aL 25oQPz/B'rHrA3[.F
Ew$n`!2JJp,B;>G:;LL0H:~WWH6A4-H(2G0!&"dNP@
$! LqjOhLCJ zp#Db @
2 `<  )	2 HA N5A`a+B "p.$QbB|
D$D!d@RDP A-x&	4d |	$ T%F! %W :u(xHJ%J#H8H0KMn>k*AJ/=#B=!%3
 F( Z6>xt4G/QfLdD$Hzf!,+	_E#D7y	5H7T "X?( *ADsH u'GF$	PZ`SDe& 6 0 04"!, HB@r* HQ Y(GCYUB?	"" 5"%a3!f+.pM4
jM L@%7&9] b9 PbDm!QC2IfDx	60  	N;Bu ILpf^' 9d F8
 gG0		GsM@^AZ6$@ ]@vD-(a`PGJmoD  	Ju\d 0  x8E ``a DDp: c0$8W Mx	PD EH(1B  *DHhBD   vAZ0vYB;"a"^5
h~_1TJCW_F?TC!(7Q"{!` K/s`9cOnC	Hy@"w) hS/@TOc	-MG1@'B83 BI$ i ` cH|@JC B Qr00p	&d"P`3  =dMBd1ak 
, d?Z$	\3Q8`` P %iBPRa(H@E`D41`/L`MQhGRr+ax `@ 1T B8*UF  @8x)pYH#Zf @j@*hGqekr!-3E._3340NP}6 r,*81UPWKp2 2	`PE$&$AjR32$p
C@N 
`|a !P$Hr l\@`  d lbR#%BBP H JpD!	*se!, `	qEEodn6C$09C0>S&1rz)	H4^0C`T+$m7<?5`u"AJ@[r(,b`@=B\p58An`l,/dT61	lu03 
CBHrD8	P-pM0Jq4T%0	_Ac PMPQDp8s&).A,"P9EqCT0=tQ @' 
pQ) 2c(1(AT tj h5L8rT@8,eAE!D)$Rf@ec "H@q L@@ 6B`Q`YE *S2i	LDSP%4X6#$RJ%9 EF["/
Y'D=a@NH!qE"`\ 4PCJ**pAJ@
N&jTD H0tT`4"B HbXc0!F'NHJ!@Eb X Q itB $@F sV3BAEH t
h5B P`C" *0
"Y0Bt'T`RhaDe0  !&N"7P.bcB\2P.S2AC3 		    @LB(	 >i  -@Dj7xxX(b0<0(FcdNb-QrU\MDdnVV5j)	R <E"dtF	2C@aLc/]J{Yl-L(lastNode, 0);
              rng.setEnd(lastNode, 0);
            }
          } else {
            if (root.nodeName == 'BR') {
              if (root.nextSibling && dom.isBlock(root.nextSibling)) {
                // Trick on older IE versions to render the caret before the BR between two lists
                if (!documentMode || documentMode < 9) {
                  tempElm = dom.create('br');
                  root.parentNode.insertBefore(tempElm, root);
                }

                rng.setStartBefore(root);
                rng.setEndBefore(root);
              } else {
                rng.setStartAfter(root);
                rng.setEndAfter(root);
              }
            } else {
              rng.setStart(root, 0);
              rng.setEnd(root, 0);
            }
          }

          selection.setRng(rng);

          // Remove tempElm created for old IE:s
          dom.remove(tempElm);
          selection.scrollIntoView(root);
        }

        function setForcedBlockAttrs(node) {
          var forcedRootBlockName = settings.forced_root_block;

          if (forcedRootBlockName && forcedRootBlockName.toLowerCase() === node.tagName.toLowerCase()) {
            dom.setAttribs(node, settings.forced_root_block_attrs);
          }
        }

        // Creates a new block element by cloning the current one or creating a new one if the name is specified
        // This function will also copy any text formatting from the parent block and add it to the new one
        function createNewBlock(name) {
          var node = container, block, clonedNode, caretNode, textInlineElements = schema.getTextInlineElements();

          if (name || parentBlockName == "TABLE" || parentBlockName == "HR") {
            block = dom.create(name || newBlockName);
            setForcedBlockAttrs(block);
          } else {
            block = parentBlock.cloneNode(false);
          }

          caretNode = block;

          if (settings.keep_styles === false) {
            dom.setAttrib(block, 'style', null); // wipe out any styles that came over with the block
            dom.setAttrib(block, 'class', null);
          } else {
            // Clone any parent styles
            do {
              if (textInlineElements[node.nodeName]) {
                // Never clone a caret containers
                if (node.id == '_mce_caret') {
                  continue;
                }

                clonedNode = node.cloneNode(false);
                dom.setAttrib(clonedNode, 'id', ''); // Remove ID since it needs to be document unique

                if (block.hasChildNodes()) {
                  clonedNode.appendChild(block.firstChild);
                  block.appendChild(clonedNode);
                } else {
                  caretNode = clonedNode;
                  block.appendChild(clonedNode);
                }
              }
            } while ((node = node.parentNode) && node != editableRoot);
          }

          // BR is needed in empty blocks on non IE browsers
          if (!isIE) {
            caretNode.innerHTML = '<br data-mce-bogus="1">';
          }

          return block;
        }

        // Returns true/false if the caret is at the start/end of the parent block element
        function isCaretAtStartOrEndOfBlock(start) {
          var walker, node, name, normalizedOffset;

          normalizedOffset = normalizeZwspOffset(start, container, offset);

          // Caret is in the middle of a text node like "a|b"
          if (container.nodeType == 3 && (start ? normalizedOffset > 0 : normalizedOffset < container.nodeValue.length)) {
            return false;
          }

          // If after the last element in block node edge case for #5091
          if (container.parentNode == parentBlock && isAfterLastNodeInContainer && !start) {
            return true;
          }

          // If the caret if before the first element in parentBlock
          if (start && container.nodeType == 1 && container == parentBlock.firstChild) {
            return true;
          }

          // Caret can be before/after a table orj"E9D*>@^	T<L cdJHP,&u Jq AP4@uP"Z49U#j@Dqe, @p4:%8["!!cA[4#h)lOY)1YAVHD6y'G0p[U9"  [2
&u|BcDD&b)7 "x! +"KPO-`[.IH DUKPalQ Dp_@w8J zPx,{MA*q %o%%+1Sq !a
 _Hv'" HC'Fx<0MBt+&LVqW$hFX^d e	m Bv@- 0 <e4[[X@&m0`y4PBph "T"j  %@0w	94`D$#! `,X(BG, 	 \BB]8!"$awHpi $a@x {H)-)eDw$`eUJH9HD/;HEMABJ Z8rV	:n'"CQ.N&@2b2`$`P(AHHJ&2vp$! @q[5p+$JA$"" }h8%n  r C)
!(i(P0SaKDeLB`a%\Ip6|2
DQ$1@ `YD #	9,hWX3!l`EA 2r Bz0!c 0SCPN-&(IAL r`F {  P,!\p	p2z?p	Kuq]"A$L_p"1C3#-2b@1a
1<I!|	`4.; R+DbB" 1A
gL8%
6u	aYl@[HgKF+v`,HqIAdwT A@,=H q/"8 G,)Zb^06N
S@X;l"( pBK ORORA 8:^_
lE
 @ $`K! BPP d\ .!wc B# F`UpAG%Ho4 dlOWZ(8Y$KtRCp*gM(4T[bE'9u@*bR< %V^w /.KYq@(|a	 H &uG Z)
H86`Y!G@!ah "29@s$
DL`KD1JB 3,!Y=NBCpwSKrD ^!(`}xP h%:?D d'
 l%&A4}3
QP
BI B
#"GC:9a*F UTDAT@@Ea3DW} %H)@"FFGB$1:J&*5C	RFrHxw\*H|0B&Y`5Im(Q:U	BC L	D`,8lD^h\anB
	8\`P&B7U @
:0@ODOA5Dp2$ *h|
rL6wlH +@! -bFpHU@dB2WC
'/A KTV*-h%WZQe
PPK	z
@&]Z6HZsGLH8Dd# B N	Hk, GPK2] V0bX( 6M*'	GF@PiK A	9	 q^

;B92S7#0AA$4  \<5%<'({"A,S,8BtD`QK>0`$@+B)J" dRD +	H,xX@Wm3HTD\@CXRN.2XbL'C`1[N\@D)6j
$5fd\ afPJQf.D_tNAN M\&P8z$I`G"@[vqYb- @`	@@*@(D`gB@" DN`y.1	%A0`6  PR>(X0PQ6s
OJ>#f
N4>J4<nVQF,OD*'% i3Rf<D0HGl&@i*K1BQ0b %9	RR	?
q0@
j-$P71HF8=LZ Q!0  mDP52BP!4xv
&<  <*&/`'ni-)+$> oE r"H+@"hN (%0TH`, 4AHD$(
(t)@ &UBL#4A p]UFD D B(R	(Q"h@$ cx 0D'JK
LrM]M' /D1.4@1	 N$	8!HD%TakIj 6")fRRg $x;$?l,M in \)> 3t@!X&"&*"}FA9`C 
1T 1X&8$D OP *P1"oD 09}44wE(%r"(;`FP7X`eg"*R*FJB\h  m` &EdQ A$iI
	b mSK9

 4'My`a$@Y "pJ2` byQ
@|U6pDd}r' l(D @YO
B
 4@  E5p@W7P Bc  
lAFNGRm) -B	.#(h c 32@D}c0Xc(#VjW`Yn!/-PuP$ \8B$Vd@Og
o"PH|NRKCF@h .B%\C/H G ;CB$a$8W!h Dp% <
q( 3`B-`O>-] 	
8)S21Hw@ya#jT &\%H 6Jd	1#@${TA`Ad4 	HCXQ )B| "HC e(  H`[n@'DsYv dwP?*Un
ode.nodeType == 1) {
                break;
              }

              node = node[first ? 'nextSibling' : 'previousSibling'];
            }

            return node === parentBlock;
          }

          function getContainerBlock() {
            var containerBlockParent = containerBlock.parentNode;

            if (/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)) {
              return containerBlockParent;
            }

            return containerBlock;
          }

          if (containerBlock == editor.getBody()) {
            return;
          }

          // Check if we are in an nested list
          var containerBlockParentName = containerBlock.parentNode.nodeName;
          if (/^(OL|UL|LI)$/.test(containerBlockParentName)) {
            newBlockName = 'LI';
          }

          newBlock = newBlockName ? createNewBlock(newBlockName) : dom.create('BR');

          if (isFirstOrLastLi(true) && isFirstOrLastLi()) {
            if (containerBlockParentName == 'LI') {
              // Nested list is inside a LI
              dom.insertAfter(newBlock, getContainerBlock());
            } else {
              // Is first and last list item then replace the OL/UL with a text block
              dom.replace(newBlock, containerBlock);
            }
          } else if (isFirstOrLastLi(true)) {
            if (containerBlockParentName == 'LI') {
              // List nested in an LI then move the list to a new sibling LI
              dom.insertAfter(newBlock, getContainerBlock());
              newBlock.appendChild(dom.doc.createTextNode(' ')); // Needed for IE so the caret can be placed
              newBlock.appendChild(containerBlock);
            } else {
              // First LI in list then remove LI and add text block before list
              containerBlock.parentNode.insertBefore(newBlock, containerBlock);
            }
          } else if (isFirstOrLastLi()) {
            // Last LI in list then remove LI and add text block after list
            dom.insertAfter(newBlock, getContainerBlock());
            renderBlockOnIE(dom, selection, newBlock);
          } else {
            // Middle LI in list the split the list and insert a text block in the middle
            // Extract after fragment and insert it after the current block
            containerBlock = getContainerBlock();
            tmpRng = rng.cloneRange();
            tmpRng.setStartAfter(parentBlock);
            tmpRng.setEndAfter(containerBlock);
            fragment = tmpRng.extractContents();

            if (newBlockName == 'LI' && fragment.firstChild.nodeName == 'LI') {
              newBlock = fragment.firstChild;
              dom.insertAfter(fragment, containerBlock);
            } else {
              dom.insertAfter(fragment, containerBlock);
              dom.insertAfter(newBlock, containerBlock);
            }
          }

          dom.remove(parentBlock);
          moveToCaretPosition(newBlock);
          undoManager.add();
        }

        // Inserts a BR element if the forced_root_block option is set to false or empty string
        function insertBr() {
          editor.execCommand("InsertLineBreak", false, evt);
        }

        // Trims any linebreaks at the beginning of node user for example when pressing enter in a PRE element
        function trimLeadingLineBreaks(node) {
          do {
            if (node.nodeType === 3) {
              node.nodeValue = node.nodeValue.replace(/^[\r\n]+/, '');
            }

            node = node.firstChild;
          } while (node);
        }

        function getEditableRoot(node) {
          var root = dom.getRoot(), parent, editableRoot;

          // Get all parents until we hit a non editable parent or the root
          parent = node;
          while (parent !== root && dom.getContentEditable(parent) !== "false") {
            if (dom.getContentEditable(parent) === "true") {
              editableRoot = parent;
            }

            parent = parent.parentNode;
          }

          return parent !== root ? editableRoot : root;
        }

        // Adds a BR at t;Cv{O7{yju3wV}w;gWokH%~l?M/7f}~_y{,zp "	l"&F
0J8Xdp
$$2h@L g[ D
8/@_X(   
pH jj Hb@ @ !H@ /2!&P| M"T,
CQ`	 FM
2 9  
t(#9Av440_  .z , eqz]	e)q*z'/}g5wS?:_;<?O;_;;{?eX~k3W.UHlwyW9v@
DX
D 5PG. *IBH$3
HB@'$XK    z4  ^ )@D81MG8 p$ Yn@ HA@$ P4{ /@  PUVJ^x7J#W!7U_doe% X7p+k9vP?=}}wtZ-[97w\so},wS{-[W_Uwy;:LYq[c}n~\)omI:)}w3vn>{Wo_s:|d0`2E@5XLBHM @G`	XDEP (A"Zj%@@5 Eh N
Qd `K`T.@0 Bb4yU|#!MvzD'}ufsW4snW7LgEy]@2?nGyzEx_sgmHrtyoB
=&4Y%`$V R
`,a a8 HG	PL1A<#
HP1PD]=B@Db@|H| $GT	!UB_J	 0B,B$$2S\ 
c#  p<7%.i)$
S
 pJ Fp fH -%
hA@*9'g?;WwT3vy7_ww+Nx<[yE;_w=o8u'Kp}u==o}z3xOmrW?)Za;Rf9(XFHl$E  E	c
#	 Ij
P@JEPC*	, ITV  64
`A# "A- RPd H a@"z~^3IZ]U|8qK2'Gwgb6fuizroCMg>s:~}Vm-#['K[SonW7>o[uW}YSz{v=>/|$?|{?xk}~8 fE>ZB8,K! @K$Ngc@@D Br@H(%s f4`1 fP" @) 0Q'h1HBJHe/ D H mQ;[Gnm2Lo}OoV	$f&{i}%KZz2{|?=~g/v;gdZe)K(@
P&  !D    X!0	 H ,Ib*Y| a 2q#l@( A  iXQ@ * P$@iPPQBNHBL%dX	 &FYX	K00`,r$
0Q   Gd
	@  .  ZtaC(H@YQQI	*D@@$"A;e?e}v"|go?/gyo7.?ny{:;_k^oNOoS[QWss1	"F#0
 E  '"SAD0Tt 	d.0
85*$@AKXb.%! td 0I:l# O&q8Q
L
 (0 rE =E)z_s'p(,mtW/xj_{g~?g6?|_qo|}9=~Y)]+V[.wrc?eEysoewc/|||Q'BsodGMIg\t&TQd	0 BBD%
 ([ E0 c 
A#a @)H*X <@D!@&	HXA dfaXi\Q<^k=mYL/=>OSOg4[3.33^)gW_&\j.7_s.~ZkIk_:@i(P	P!X5	: 	
(' 5uKH#)DLHB,H9>,&!T I!Q0 (udZ7;Y *@Y2C0\H	(B0 4h(:  *(	RU2HP4; & 1npe,D+`T  1*@xF, A9 $`	a(4rc,?u<w?OdB1?#m3W]jO~SH]?glz=Q_oz3wx?(w 	BHnk@NQ`  TEb*Cqa )AS$-a p(1"G9  #$q sB@6A
JRIQ+A ( ZMBl?[}G'on1g#6
_W_^];G{.c#[7}Gx}tw^r_w_MooV}kSu3\U{JW_2KFk-S]o\#waY?ke_F#/_w9^Gl{S7z~>gq
!  @ Pc"( &#
5 I @	TCA5 @<(T		` '`PL )P `!"p@ QD [oyWsSk{dwn~lgipGurku+w<OnKw/v_
l6A
, x	G$&U}C"d,C [cprC&F(YL@;`P@.x
'vi]F3 )( {	D"l!Ce*K\KXhi.MD.XBIVvX
%@'E5@PL rH1(02"DL?D(3Dz 5 3GCKR(6?_k.{:uy;k7C>;|>Mw=nu+>-ep[~_u:)$&6{42Q'*ag3RD1H:TA&'<.,v8MK(U.-7  8+e.U 2 QZ 2J1/B\d;2o/-v?`.qx>?xk+<%k^kL'Zo&bE=pvrG?<YDmlW_H~?b?-6[ow2y:t_3mw<d/V"JE-STT&I(U83*n!l6EhYCN ":b@b4) '` 45`)NCu  0q 3$0r&K- 	 dL_N>=-.G{~igg:.m~n?=>^_n=	__vioaCw.obj	%oFS"9C +y!NXcW P!!@(dA@uD$%*Dc	0 JrJ,0Jy/q8d 3bUR Lm$T%0RBF !@hA`` Q P
X`03G%Fd7GD;$$5H2\%+tZoi6fi?wbu~|]{{}:qgmZu7w]@>Sk=5|~gGugfv\yv	DJPVj016
4AZ08  *&)-%	N$,a19SDd
`5Bb h`*qA4@n.*$ f% Q@KAj wv{{_{/?>4Zi_ff9~mr^Yrk~7r[g3=v[^j{>{o~wSua-v,6v3w>v5.)g/u^~>uww:n/S~fK;#Vl	Fs+IL  U
@U"2 !`%@#9fvbg+(@ Z4)A"P ABON(4 5pQB7T1@Z`Onn;_?JoS~G'{_s_c7gsD&}ksW?QD! %]%Dp @JmF	@A"&	0/Z_B%z@7 bmpp'#vh	pQ"3

p#aSETR6rDlbeQ.aRLdAB4G    N iI1	#27n  ((8* $s` 6xT&! @D* c#(v)"Y"0! 8#`n_}GO?yi77s2fU[WbZZv?z}tNft  K_Wb"@Q2$UeNih(3!0/5/
P8[AZ 4/ bN@D D DEp@9!"PI b	jA$Mq}oQ7:]k}vYu9\9C73?Xq-n{m^bU5zo|mzm~sdgzs'-^o{o/([Q7:_[O~?;=9K35_y~&wWQ m$RY+) Hby0sA$( $tM R< g @)C	HD8Dq-a@
z.@d4 @a3 6Q`4 @DUiX=ngezyy~/`wLti<o~7uVVK?SI=&Ka -qJ! PP !RI`MP 0Y*sxN	)\ Q  A ZD/DxA=^!@c]@DH GrPFla!    
E0A"n  RRQ:D	
 Rrx*$tF#FX3E5B@b,*(	&> $J@ 
(,h	,wKG	+rk>{[M6v8{,7|4~%]v9wC_9fcvl]WEgW>.c@%OLf$b8%( S vTZ"F9TFOF=A$Q*66Z\ UJPt"bc[!@3h"!L 3Z"*(@@m/?1wk(e8N{}o{l'vyTx?gozghwZ7~!P~cz-Go\|}3RYhjw~/aS,M&;=tuKxy':^0H(\c!v%C C  T!r)PN Gze!IBAb9P0H/
h %"4"hU%XrWZ;Z|9aFPeF0`U xX3Kx8pzzl?qg-q^_>g~YYo3UXtw>Gofm8nb>^_{?k|}s8>(xC /@0Q
R ~R#<Y p|jTfG_P\<` f8eE1D H	BQEC*@"1TgpACqYG h4b!%L
 &`@  aPI &LS`"+8B:$ PM`%@ ?A/|S(O$W)
D}O{us~nF/u-tl{__TsY(';a\W\w|G7>jO6!`2+T>,kOPI3;N @."Iz p  Y+DATZ
8D$Q38
0G6h0f5 (M0)mQ !DK ~jzE}ly;;]Odog&~?`oR%yiM4v{:~?[vwk_{O_C;?OX+P_i9Otg=:_~%_3N}W9nC/uEt p!C}x!SM@T,:I?QC8ID"I W:c8V-	0@!  k?_?in_]G<oD}{sT?}Qz{<04tQnWvy0Nuw$8<]p}7YdhOPG(,FFREh8 B)9wH2 k OZx@FlC! z!#BlZX$UFSb ;67
"hQ2&  }@-S+@(c9FI#0  
$Qx8*av(B 

!DE@HA
L Q%pF8
bJv<x/o{EH	Ev~Nw^|}~w?Omm[y{w~5z6yZ}3_[01
f P#uk8[|_j V |^ 2
_m#N	R0lm9$		@L(2
AVGi5`nb#6O!)Tw)QH*@p
z~sk+oz7UWgut`G9?da6^S.;:~{]}wm?rO2?N;F>y?~}|{wwmz|=som,egz 7.]dU MSO"C HEA(`D&[#QCa(,

V(	@$Z1Bh7.\32]#AEEl=&;so*.!/_Q~~x?g;|v{szy||{oy]U{]7_\{}]fgmT]!BFl@A0 {cRR"
V#
RCN#\H@cNRW!7axbPDfL0'Ix%EM8JA!+d4$_i`QKJ8$PRGf`3qX 3l4U"@h cayxB)31@ 3   sl GK7A!) bK@LXVz}<rogO^g/;_g^:H>c=&^~+}?yf|yu([GvWi>7~oQ $>F@W8	
R -(AlP0D!2 TBLCI0 CRPRDC$h "#RnE	'I#
 F+rzn,hA$LA=wntg{9s_X?Y.:Ov;G9}Ev.#{mW}>g^|kYm!GS n~=/]|r}M3~_?/R}_W5xxnW?~n~OY]|_74o}[K^ i"UA0"|8B5X NV EC28jJ
@EAv}<bju' !C07CijhF@@Jnh.(DJ[^/H<q9.?s"aXlo?kUCd_^~[w9OSwgV>AqPBxEVXmGa3QDp@ GTZzb` Hr-3B	6hp6B
 $0a!B"H":0hw@  2B[@bz*Pu(P`{b31($l-!PLA*>&%!-Tg1M	7@gN[n|qX37y?cx;u7nFa(j`B6oft>\7Fosyk>.;R]z/kT%$`\0]!*`NU-b@`)AAXq/F`$OB 0XijS1SD gC#iiuVL=G>z'_u?bw-Wg'[/,LuV)sxF&oOV:Mo:{ffv(j}SKWW?ko}?oo{w]_,g+[z[>_;S"@(23S"Bh2 Hw0I3 
bH; Lr%@A2Q#9+GP%#2l~)` BQDd@h 	ection change events.
 *
 * @class tinymce.NodeChange
 * @private
 */
define(
  'tinymce.core.NodeChange',
  [
    "tinymce.core.dom.RangeUtils",
    "tinymce.core.Env",
    "tinymce.core.util.Delay"
  ],
  function (RangeUtils, Env, Delay) {
    return function (editor) {
      var lastRng, lastPath = [];

      /**
       * Returns true/false if the current element path has been changed or not.
       *
       * @private
       * @return {Boolean} True if the element path is the same false if it's not.
       */
      function isSameElementPath(startElm) {
        var i, currentPath;

        currentPath = editor.$(startElm).parentsUntil(editor.getBody()).add(startElm);
        if (currentPath.length === lastPath.length) {
          for (i = currentPath.length; i >= 0; i--) {
            if (currentPath[i] !== lastPath[i]) {
              break;
            }
          }

          if (i === -1) {
            lastPath = currentPath;
            return true;
          }
        }

        lastPath = currentPath;

        return false;
      }

      // Gecko doesn't support the "selectionchange" event
      if (!('onselectionchange' in editor.getDoc())) {
        editor.on('NodeChange Click MouseUp KeyUp Focus', function (e) {
          var nativeRng, fakeRng;

          // Since DOM Ranges mutate on modification
          // of the DOM we need to clone it's contents
          nativeRng = editor.selection.getRng();
          fakeRng = {
            startContainer: nativeRng.startContainer,
            startOffset: nativeRng.startOffset,
            endContainer: nativeRng.endContainer,
            endOffset: nativeRng.endOffset
          };

          // Always treat nodechange as a selectionchange since applying
          // formatting to the current range wouldn't update the range but it's parent
          if (e.type == 'nodechange' || !RangeUtils.compareRanges(fakeRng, lastRng)) {
            editor.fire('SelectionChange');
          }

          lastRng = fakeRng;
        });
      }

      // IE has a bug where it fires a selectionchange on right click that has a range at the start of the body
      // When the contextmenu event fires the selection is located at the right location
      editor.on('contextmenu', function () {
        editor.fire('SelectionChange');
      });

      // Selection change is delayed ~200ms on IE when you click inside the current range
      editor.on('SelectionChange', function () {
        var startElm = editor.selection.getStart(true);

        // IE 8 will fire a selectionchange event with an incorrect selection
        // when focusing out of table cells. Click inside cell -> toolbar = Invalid SelectionChange event
        if (!Env.range && editor.selection.isCollapsed()) {
          return;
        }

        if (!isSameElementPath(startElm) && editor.dom.isChildOf(startElm, editor.getBody())) {
          editor.nodeChanged({ selectionChange: true });
        }
      });

      // Fire an extra nodeChange on mouseup for compatibility reasons
      editor.on('MouseUp', function (e) {
        if (!e.isDefaultPrevented()) {
          // Delay nodeChanged call for WebKit edge case issue where the range
          // isn't updated until after you click outside a selected image
          if (editor.selection.getNode().nodeName == 'IMG') {
            Delay.setEditorTimeout(editor, function () {
              editor.nodeChanged();
            });
          } else {
            editor.nodeChanged();
          }
        }
      });

      /**
       * Dispatches out a onNodeChange event to all observers. This method should be called when you
       * need to update the UI states or element path etc.
       *
       * @method nodeChanged
       * @param {Object} args Optional args to pass to NodeChange event handlers.
       */
      this.nodeChanged = function (args) {
        var selection = editor.selection, node, parents, root;

        // Fix for bug #1896577 it seems that this can not be fired while the editor is loading
        if (editor.initialized && selection && !editor.settings.di@Hd!Ppe
$#E   J#D8B4R5$>@#.I@&/*#@ K"	a1.0C40BUu
RHP1 &p%.7	4pwo^yMz|WYwu6Jszw~f__OZ{y}kf?o~q{\oO|7wl~}_}{_~|e~%w]}o{>4;yf=[=O^j{}oAofu
br(*@!*X0H yq1,P~7X	!F .C @nl"~/Xt
l HG <d	&EFE(PJD!{|_]_m?c|vOn=91Gw{9w^ws^^6-Mvz7hOy~#N]@+B8t2PDFS8?BF8g.w)"R-p8d a $fF"&` 4]!#qFS0
RXI0I@BbCH *tD
 11WHe~,LZ0'7(a[; R*@$SIh	) $	;$u!('@(%RI>@
ABk = #n
ih( ( .B(xo<z]Oy+~_4z+gog~/6%q~w?tn!6|?,{ni|W(_V{)0M#`&
0p`LJkLh 3pLFFhud
@1Q54]RD<\f@ 2"RA6ptR-*VD. 0R3Fr{oJ^cOgo'<a/~_vB]Onaaz32=>5Z>{7oU];vZ_|uN9}fU/\(k~/hysgfCy7h9& $i.bE!9S$  :TJQH
 f5VV*JbOBE@@c QDE1Whs|nF0P#V4*p7|g_W6|?/v>uwnGuOqo<;5/k5w{e}ov.o4>|Mx@ D	 HIW!MJ& N@`A"L|biX- T	XeY@&Bl&HN_ 4G08`
 @ !TEkPv0e*	P8pO1A$$M9R$T  @&U~Ho"8D4 LL@ KRVL&7HE,"2"PT.F,@(3|L Bip6]>g/<7Lq?;cmyNWv}#Ku}.t_4% * EJA@`>b61@2k:RX$HLL %S d  p$$D=Cb8Ku@tqIR.Y PZ"VZ`F#"2nwf~D<w];>s/&mxe?~3o;;}[~U6l|"?[[~vm*[=f%3/#;Ak)o]\]1}{zSzMm&,||woGPX,Tte	#"4s./	 N* KL) a&k@pQX
M,=x` 6"f5F(Z3-}AfjM.('!=_?ZX_rWg}#?~:]SM{~,;{^~>~N{JT'DsH4BXT20> LH"D:	)ndP'4HGf(^`[ZLayP@ p  O`D
\z2H<aA9PO bT(@RLheDW@ dtERpNB/[Y@tdCB JaL(at]Lt! #$H9 E`).mP"@Q(3{<oiL{yTfq]cQNubVtrwo+s{w/{}nOtOPR-{F.?nY4.!E=3 Qg	AH/ I A$%	F'< bISNGDD ): a(,ckB#Z$DB pD)A,_zVf?~7-_[ _7Wg^t}@^u!u}w;lkv?o.nO/fsz>[/}gm_ __/_SC/q3]~Y~g=c=_yuz9r"*3XHP7 ]e
(F@F;AHCF.0~CSITl@RBl`!#9] ;,*kP&p
 !NabpTFoh5O=;},-;}nNt?{nd=;->n{g?=ok/8zg`~~>y2w'?
AF@0O 9p,d  tFIB0`/B#a	"WQ;
<. 8%6jBdp5$@VqNB]&4hb #*8aM,1%@`YB$P)Fg!s` d YepY`c@6`E5AT@e%KF1?9
@F
3<T QONc]g=cW?r_;4=k?ouz~6~Ow_~gwn^/_yz~o|{( T @ %I\W` ")@".9$%(q1D@j1Q"a  Nikc ,ILD1$eA! @Ts87zjU}"~,,i[WOI?3yx<Gsogw}tz[}^vb>=*[o][nn_;>{+u&{[6=rf]t.Lo}.g_{oNo6D@XO p% dN(dwBLm!N()i`6@tI
1J&&HJVHO2BL, ,r/"   GD0$3jfV;^+??~i{ca/7~sK._=YG=w+_o7'}}_mg~_RlO1EV($4C RQ0JJJ  daP	JP@5  p	QD,cdTn<0ah5Gd xk(:,D2X A@0Z$aS8A
p <#0?$|Pj[0"J P(<#-JSVh X%{ `!`!CA\!Jh)xpid"!pL?v*s?oR[s~;qW}Y/r/guN~nm{3_^^ 6 
 ge	[C"LH5Ke 4nS[
 D&Y&c]0 cCD2z Cp: G$9G'5+p
(1L0 @"$?woyk}FuM9m.ocG|O?_{r=s;n?K\]}>uuswm/m_{_nQ?uw~m;|~!`(Q<&KjOJG(H] K:IQA
,rGB")`>(@  G#fY7xx&l2$a@LfQ23	C(A Pc@E(4R"z.^~9XJ>]w8~b}{_6?w|=?o:[e_}s<~y"e;uwWw^wG<BE P`yx@, n	bGoeEr $
U4p h
  FBSK/dZ#$IM	!t@ 3gc^C `?@(W "bjhV 0gq
Hvf@zB^bMt',$,!Lt^i e@Bsl@h`	Ce$+T`oX#gND>_^&e)Zu7\=t[;z1m^Zo_K_6y}u~5*3GADZ AT-"B GPTfAL
`,BA^bQ,H!BNQ# BE7z`` PmGX + E+L+99}|Y71O=oT~nWmqv\/9?|~u1>vnwhOuX_]mo?]2y>:~Owy7zd^d/"osownw{}n&S}.o;dA# vZ#@)c!T  $\Z4 
a2
H`$	e[(>!8Ql#	~"u"Z K:	V	{LC@MGouo>s7G4ox~4voW}O5~|g>Oy.^]/p*BZOcTM2.\F'`I-*dI	 GUrD$ JgcPQ!$$"A
 PL8x	 
,-kYqp8}+G
   #1BRtg*7<"%bJJ9'b++	Pe(%`<9#d
P90DKG BX%_NQwOoKwNS	oZwq7o8S7zY-V_7+{;;>Z	J`^%0"G 4,J>tP0r|I}5AVv`F pdMX7H[3b;u9('@BmW9
("lS@$NZ_xOoj_'^.I4[[{Y?w#:8O~wP;Ltmm~w|?w{o}-x>%9=5-n[U\+<};5ny?<r\Wzvu_o}?}g
+#u#@
pH@
G!N0@ECtpb&04 I)@;H6:*@!T$0SH e`B0Tl)0 A%kAVQH\&8WF*|]ngk|{Gs|?z&QU%>7qd9>;=	lV_t0P(E@%@XP@ 8O	J h 
pp   	ZR )	gOf UH A)fbI>48 $f"mb8:8b  fB )@((!tL	#	BC"6zo)Hp^"j1Gd@ 8!6K 	`F?{nyJ}wv;un>t}EO}=w}U{O~Gj
W@RCeR*$p
)Um.!$4A3F)2S5o  }@XB1 b(2O$$ #c$,ZE~
BU  HG!AN2$ H'`(JD|0dX TmirhHJ0!XF,CB@lB m2+ePA1K@]6I0#J 4b
 ^K2k@jpHJ,""5$!<40 DpR, JBD6h>7B	B5A`Q(`/	L 1]P e;24"g7=	#2S.A!b&p0ptp=OHEY_r8Hi)C%/$Ai V*x 5F!$*Z?AP7e$T( bSO[	8 Jd!)g	1h#"	5`DQ! X&4@"P%-j(aB5J2p /C)K %XwC0`*6+QAbn8T
 %P:  D0x1DCrHQ$^`@ p	q2ApK(+:
 LsP Q%
"
g`JsH:lJvbJ"ez*%p5%f
|?  $"0p"P@2ajJPGV@J"H))n!
PXQ0
a@J L1#@$3x("E7 Q*D(B<	ijA$-r\	Q@	v@bdC`lrPPD@R 6 .A5DrtNp a	 Zh5$B`J,!A9
Vh!6J(EA+i<\Lu B"Xe5hP`T$sJ
"$c4(p-cD0 D!62G  #   (=8D(pHx| D1AELQ rP	Y6 .B )2c03AYIC%A7b~a L\z-^d:p!Q	H`@+@*DB(&XJ$ELP lHHAr@ph@q $;04   	`)@]@\fV%%T]TDIdSXhd0(C bpM0.c DZ`(&A(r!6$ S&ET	#&	 "
- =n !;>	A F  (D" (e!Z  C:| @P   A` RF"!E$ BLl HTI10d1b`A&4
BA0AQ@PZ) >[f{I43K(N5"
B(  .(` 
XL. !'F nL.a_p NuD VPQ	YCk"!/Rn!0:6`SFCo@1J#[PA6lDQRbGR`9bPlJaym-E#]_Y@!@J|qed6P8{"  L	P5X@ E>.(d&
(dZM$@CJ@1!	aYt f(	w,$GH@

(J hee AVf@[VYK#;tAf!`C"z AK&6->{r 	mjw%c=7l	LQ(60[0P(C @C)dK&$dXJa LI"dB
beb$ 
RRNC!0\&2a0"!*I I2+% 
=%"P)@0$P X
h$+o@@$Z )YULUb  5@90 LFg@P@L8 C46?NP!r) a)B1*;XCtK0cN\
}OeTh=2JC 8)g1)q rZC(Ep
BN"9S!8QY@	p&PE"AH)0%^BW1a$R*bn a"A	 :o9D !I@@Oq34@ 	HQ@ @"DDR @`H@H B	 Jf	3	 d@@9A D`!\2SDt UP	xB0A~6aRdBb+AB"FJ$JZ OX2<&4"6.( WB>E@W22M!(@1ytz9m@47@kAp0A2U1fxLu^ @@0	:OD&NQR.`^$Ld!O @3
  M& ( BETaA8
Qe B>C$hB.
aB @AaP 
\&+Af`)aB*)ELl*E@( $zaB8l0K0|MR`!ZJX  oX`NMV4M,`iREXUb1tQXj Nm(
zpEF Bl,/XH"GA JpDiYQt&H|k3,) A DDB  @ix	

  H $@`P"D @U P C,B% aJX@Nbit2]0( :) h$QAS 1@PU
8$ZKJ!	$HAn@p`-e X"2! QP!(@](%H9A`"@(@"R4rE$GxAT~kP$5v"YTp IE8P1=aP4df $ 1 p`|$J" fQAM0!'"FJ&@"HBBPITs q EOP0Bh.O M% O4,. 
@0bPI!@a D+ x jA  ( + 
Bb	JMA!
BG&pd`[!39 1(Y L!)Q~W,4E$0)K,1 PLTAzOh( `(($hBI@= y`AOb1)*H|p #l`aT +>b2H &@!1
<X#7P  wkA4$ Nt(Jci lDB)p|+, $0o4a 
n6L `vH@*@J"' .Q3`d$ \ 0E JqhF"H  eA	 
BPYM .x"P P0
=bleElement = function (state) {
      return state.element;
    };

    var applyRelPos = function (state, position) {
      return {
        pageX: position.pageX - state.relX,
        pageY: position.pageY + 5
      };
    };

    var start = function (state, editor) {
      return function (e) {
        if (isLeftMouseButtonPressed(e)) {
          var ceElm = Arr.find(editor.dom.getParents(e.target), Fun.or(isContentEditableFalse, isContentEditableTrue));

          if (isDraggable(editor.getBody(), ceElm)) {
            var elmPos = editor.dom.getPos(ceElm);
            var bodyElm = editor.getBody();
            var docElm = editor.getDoc().documentElement;

            state.element = ceElm;
            state.screenX = e.screenX;
            state.screenY = e.screenY;
            state.maxX = (editor.inline ? bodyElm.scrollWidth : docElm.offsetWidth) - 2;
            state.maxY = (editor.inline ? bodyElm.scrollHeight : docElm.offsetHeight) - 2;
            state.relX = e.pageX - elmPos.x;
            state.relY = e.pageY - elmPos.y;
            state.width = ceElm.offsetWidth;
            state.height = ceElm.offsetHeight;
            state.ghost = createGhost(editor, ceElm, state.width, state.height);
          }
        }
      };
    };

    var move = function (state, editor) {
      // Reduces laggy drag behavior on Gecko
      var throttledPlaceCaretAt = Delay.throttle(function (clientX, clientY) {
        editor._selectionOverrides.hideFakeCaret();
        editor.selection.placeCaretAt(clientX, clientY);
      }, 0);

      return function (e) {
        var movement = Math.max(Math.abs(e.screenX - state.screenX), Math.abs(e.screenY - state.screenY));

        if (hasDraggableElement(state) && !state.dragging && movement > 10) {
          var args = editor.fire('dragstart', { target: state.element });
          if (args.isDefaultPrevented()) {
            return;
          }

          state.dragging = true;
          editor.focus();
        }

        if (state.dragging) {
          var targetPos = applyRelPos(state, MousePosition.calc(editor, e));

          appendGhostToBody(state.ghost, editor.getBody());
          moveGhost(state.ghost, targetPos, state.width, state.height, state.maxX, state.maxY);

          throttledPlaceCaretAt(e.clientX, e.clientY);
        }
      };
    };

    // Returns the raw element instead of the fake cE=false element
    var getRawTarget = function (selection) {
      var rng = selection.getSel().getRangeAt(0);
      var startContainer = rng.startContainer;
      return startContainer.nodeType === 3 ? startContainer.parentNode : startContainer;
    };

    var drop = function (state, editor) {
      return function (e) {
        if (state.dragging) {
          if (isValidDropTarget(editor, getRawTarget(editor.selection), state.element)) {
            var targetClone = cloneElement(state.element);

            var args = editor.fire('drop', {
              targetClone: targetClone,
              clientX: e.clientX,
              clientY: e.clientY
            });

            if (!args.isDefaultPrevented()) {
              targetClone = args.targetClone;

              editor.undoManager.transact(function () {
                removeElement(state.element);
                editor.insertContent(editor.dom.getOuterHTML(targetClone));
                editor._selectionOverrides.hideFakeCaret();
              });
            }
          }
        }

        removeDragState(state);
      };
    };

    var stop = function (state, editor) {
      return function () {
        removeDragState(state);
        if (state.dragging) {
          editor.fire('dragend');
        }
      };
    };

    var removeDragState = function (state) {
      state.dragging = false;
      state.element = null;
      removeElement(state.ghost);
    };

    var bindFakeDragEvents = function (editor) {
      var state = {}, pageDom, dragStartHandler, dragHandler, dropHandler, dragEndHandler, rootDocument;

      pageDom = DOMUtils.DOM;
      rootDocument = document;
      dragStartHandler = start(state, edito 	 Px > 	  	 P7 7 7 7 0!`$8b2 2b2 @V6 @! $ w@@c2 @ `/] 
^p->  Z3:0i8: P6{6 P \6>3; 0Y$8 < NpPBpPB `d2 
]>    ]>d2 `w@   y7&$ y7 py7 `y7 @=u 0=u  =u =u =`$8 =   >  \&$   6    ]> XD #]> SOB  	$8 `aR  w@;A 0`$8`g2 zI&$ }6   %8g2  ]> `G> h2 h2 5`$8 h2 h2 P  P]>@h2@h2 ``h2`h2 i
$8h2h2 @&$h2h2 0h2h2 c&$h2h2   i2 i2 <`$8b:  <@i2@i2 uB n,`$8i2i2 @u&$i2i2 @Aui2i2 0Aui2i2  Au j2 j2 ]> j2 j2 pM   @]>@j2@j2 ~&$`j2`j2  H PB @$8= /&]>7 /&P<P< /& k2 k2 p `  `6 k2 k2 @&$@k2@k2 @<p]>`k2`k2 ~k2k2 $]>k2k2 Ak2k2 k2k2  l2 V {6   0 `$8 f&  >l2 W `7&$ P7 7 7 pGw@  	0B `$8  	  O7&$Q?=  r`$8 OD q@C :$8n2  K$8 0K  Y	 @K A&$ I	]> P}^}6  Ao2 } }1; p"]>  }&$.


0.
N:..3>>3>>>>9>999>399>>9802>309>	7>^n ......." ...X.#2,22"". 2") 8888G %` ; "$&(. |7: >" 88888888"@8
*2888$8888G8 n?88  8 ? 8*.2* 9`: 8X SC      v;?33w;?ww33333w;7s33wwwww?33;?swwwwww3w3333wwwwwwwww33;3{{wwwww;3s??? P2 ]> P2 0 o p  ]>  y# Wa P!6P2 @  /`&$ /`aA 8$8 ]>  yw@ y7 0>`$87 @>`$8! p 0   PR2 (7&$ V j0$8pXN 0> w	p]> 0t&$ )$`$8`S2 Pv&$S2 t  # $8 8$8 T2 tb @ub 0ub  ub  W@ @`$8 @S  `7K> " i" `w@   n6P
; LM w@ d;|M w@rF&N 0]>`N 0
, }&$   $8   C6 0C @C PC Cu  Du Cu Cu&$ D&$ D $  0$8 `   ]> X2 `	  `  !6 X2 0V 8`$8 8 s&$ w@ v v  @DG6     Pt t t t  d0>j0= P$8 SPp]6 ]> w@     Au&$  Bu Au`[2 AuM /`$8M /M /@E / \2   > 9  $rB P$`$8 P`w@   `w@   `w@ `&$   8> i@]> e0> D 0$8]2 5u 5u 5u&$  6u @5 p  >> )P]> +`]> &$ C 0,`$8^2  0-g|8 00-0PI= ` _2 R0;  9$8038 B`$8`	V8 )? 0$8~M~M 0M 0$8>n11;;; ;.===;;;. 9 ` 
s:88  	&*B   88?>8 8@8`8 3; ? "$`
*02468:<8 `8888>@&. 8 8@8
8? >8888 "@	(O X SK      vwsgsw;?;{;?o{??ww?ww;?;7ww;?w?;?33{;?w3w;?23377?3{ww33333wwww?;?;7ww @2 g&$ g `, g  ]> `#  $8 " 0 J &$ W]>`A2 z&$ >44#A (_fDHY @NC P1*<`$A#( H 2+( AMdIW 5F0@M*Bc$ZpT08"VeDA@:DBmM7>z]}zO}&H~~j{5y{{;|5{OviTPoEM/Zt{{'K|Wn}|>3*4__?{[7=_mm.{=7}/n\mit{v6.[3?kIX*`cL@$A20i 7@&$X&Ji"xX,- c7@fPhBa<c(p h =2RW  !	 r>=qj^J.U=wG~s^_o35<%v_C!~t{w!%4	@ hgR %Y-L qC*!@ EGTpD"n0)t$@F 
 aTPdI*. IM0L5"CGJ(Phm )w `HDR AP)@aP AC#.MP27 "cXCt 
H	`!2Ep$  a	BB
Jd08QC@6*AI *!1{|{W|;Mv6=2[7(Z.Vnh}~;SeS%f++y=+YzZy* 2R4}0aP,DH F@,a5T n1	T`6J" ("Pt{	m
Vd%$dJ -Dt*	 Ybx.jp';_omw^?'}..nv5zr?}|<?}nY)_~5(^~e+:/Hjw7>;n;/v_lwu;wwO,Y?L[<nl~{X~))EQC\I!23	hB$|!TUj.\['$b-!CaU!K- $0Bez :$7 K $I"K A}`{;{~WNny5s0I}%{u_~z"osb3?lg 2lTq"""	 G<kIpVU.#C%0VE@`	Dx.a	
!hEhPPdB!4jZ6Wp $J"0	YPQ1v`0ZP`1!4 	@`H0"" rP40X2)0s20 * B	 08)!&1 40"*L!D )@&I%h ,};nmcp/YsY!ivnoY:[zWo_S_k\^s=v 2$0|"4$jA): 100"TDle`F`"I !`xPH+<]J 
 !B P  	 AF	 #?nU[nof{vgwwekgG?3\7}WW?_USGCnk?=?WU___-{[^{{WMuR6}_scsWL<o|soNz_}3y?^vTZS'odp!$A  DJ	 BK WEoz	XT B!j.@ >F Q\ &KK-Y^d`H&B  "f\<$TH M(xd%Ffgz_??Y'vQc;k?N~;;uu>}t[]u??WSwQ r
`$B`Oh. IH),5B!)	H@d" 6  #""`bR!p)fE 4	Ch(#H 	`J7: E)zN` 'K @ BPd ;	 os&H (.r%,Jz&@T$FA$T#pNp( BH%rP% :J }ryn)V_>[6-O~8ys<c?G%};m5Mv7iG+ED:e
e'"k	H@   0B )8G!"GdF(3c @XA- pCL:YXGx BX$,+a -Jo)i]7\~wSe_Qooz^?|w{6IC4y?gEv/.x<us?^/0}\w=<&u\W{7zAO??fm_)GC\iyJG$0	!$"DCBP 	&
;# Sd6P&9' bA 
`6 P* (P%LD2ka51
& 0*{>C[g>d;?m<^?s=Utx5}sV#[Gk3fy{J8{ J``@1@cT+F a !T
hB "f0 EAgBDbMzBTf
Q K\' DeH  AQ	 SxyABNzx: ~Iz8%18cvf%20z @R0 LaHY 3 cJ  b 
 Hi!2 	 g'"&u2k[kghh:?_S%<^(;X=358ng]K_wP-~k}e0EXPB!)4
\C	 (X'2p$b"C(dHDBPJo@CA			 R'pFQ gtGD b@=gGO_}gr>s.uwwF`}s~o7}g[!}wgp_y=<W[lL}{OgtH=;o]/oool~n^w}|uq=G>:_l~_VJh (,fn|"r@#h%T*I#  (kB$=@AD  @HICZI0a`CGD #p=$1 ,: v?u?/^}//%*n7'lo>uwmg_,7m?_[y98=Z[}~]7wwtm\'.$)mrq4a1  *a%* b,QH)e@ Y4.[b0B6@" B 1QpFBqAF&A<@ AETK 	g	6D ;%@
8 01$$h' RTEF ,"i-a   xUp"P"06("X@gp4'D  R,P p?T1*x^=6y_cPvb~[a<`oj;,sMZe^2U5}Jr]aq+ $%
  R!rV\u&&91d aP!F   $"`

02IPv.hb0
9
Y`]!(Lf)gPa31U8h
`Rm|GUd$']rOvnHdVzwK|er.x%~]_bv%?n~?~su{}u{n~Nw}:}_f5z>.zZuj}9o'}=z7s12TEP $h`x(3 	/0 1@ , &BaPr` KbPaP!H2  1TR+ cT @P+D}K=w=%hmx|*R{jV=<<qZ|Vvw_y:6_5sz]t~_n~rwk
E(`rI5 3(Q
T
 @1 s RLeR
) Ia"',G E" 	V  J`:C@@S'GP@FU!Y V
7_0&  eD C( EP 1w@ B$V0
m@#CP(Bnp		fLsT A(FT~w6=k->wu'N?6y\=W=ww}z|Y&=VuW>WS Jt#2@a 	&M2 !1:5t8"UR$6pQYaiBe 
=N)@HQ ,P1$E #n6wVn;qU-9]oKwkl=9Oz4j6sO<ix3/z/g6e=e[w|~~q?+gW|o{;O}|~rwv^zi?wg|:w=:)X( RPAl@w* ZPc$:%
>v7 ~EEAg A'k#RcbJ)!%E88	-:D#@!7@Dvxo[8=>=yzn{|I_=Mv[w?d/jwlUcGzZ#Y 7NQmabd	P' V!Uc t 5dK0. qV
$q[h@ $`C!X
HP! @bO06Zb`'* 2s
-8@$ 4  \`:@ .BQSNMT?)
@aA`4De,%02	B#	MP
	IV7|<?5me:{k;YgjzN=w{9._D?EM&&!@ B|07)@6xP#'
t )@JB#P@S PqRnM0@FX\P3 AsS RQ4\1hJl6?_=TLevd??Lkz?[?EOn]}wY,&kr;Y=YMqWwkl\y3V{:{~__/+7[{W-Nv*K;_a@  iH	E1$5 	pMD
d BCmx@H. |	0,4 ]!2
@F
 bH@D$
%oo;\y_Q(}UiQm}n/unj<95v{?y}?{~^o]{W;fF	@K2XE(DK   , 	AJ2XBQ b '4*D	'hE`H@ D9\	A)f^CE YTDuY
a%B;,  L@TE8 hPdUR
$'`KLHa 4 W	p!@0)U eC*2G pf&08in6@A	(XKQy| ?>k}&}@kz4a#]v9Yoo_wuico;;Ok[o\l>{_mentsByTagName('*')[0] : container;
      }

      function isBlock(node) {
        return editor.dom.isBlock(node);
      }

      function setRange(range) {
        //console.log('setRange', range);
        if (range) {
          editor.selection.setRng(range);
        }
      }

      function getRange() {
        return editor.selection.getRng();
      }

      function scrollIntoView(node, alignToTop) {
        editor.selection.scrollIntoView(node, alignToTop);
      }

      function showCaret(direction, node, before) {
        var e;

        e = editor.fire('ShowCaret', {
          target: node,
          direction: direction,
          before: before
        });

        if (e.isDefaultPrevented()) {
          return null;
        }

        scrollIntoView(node, direction === -1);

        return fakeCaret.show(before, node);
      }

      function getNormalizedRangeEndPoint(direction, range) {
        range = CaretUtils.normalizeRange(direction, rootNode, range);

        if (direction == -1) {
          return CaretPosition.fromRangeStart(range);
        }

        return CaretPosition.fromRangeEnd(range);
      }

      function showBlockCaretContainer(blockCaretContainer) {
        if (blockCaretContainer.hasAttribute('data-mce-caret')) {
          CaretContainer.showCaretContainerBlock(blockCaretContainer);
          setRange(getRange()); // Removes control rect on IE
          scrollIntoView(blockCaretContainer[0]);
        }
      }

      function registerEvents() {
        function getContentEditableRoot(node) {
          var root = editor.getBody();

          while (node && node != root) {
            if (isContentEditableTrue(node) || isContentEditableFalse(node)) {
              return node;
            }

            node = node.parentNode;
          }

          return null;
        }

        // Some browsers (Chrome) lets you place the caret after a cE=false
        // Make sure we render the caret container in this case
        editor.on('mouseup', function (e) {
          var range = getRange();

          if (range.collapsed && EditorView.isXYInContentArea(editor, e.clientX, e.clientY)) {
            setRange(CefUtils.renderCaretAtRange(editor, range));
          }
        });

        editor.on('click', function (e) {
          var contentEditableRoot;

          contentEditableRoot = getContentEditableRoot(e.target);
          if (contentEditableRoot) {
            // Prevent clicks on links in a cE=false element
            if (isContentEditableFalse(contentEditableRoot)) {
              e.preventDefault();
              editor.focus();
            }

            // Removes fake selection if a cE=true is clicked within a cE=false like the toc title
            if (isContentEditableTrue(contentEditableRoot)) {
              if (editor.dom.isChildOf(contentEditableRoot, editor.selection.getNode())) {
                removeContentEditableSelection();
              }
            }
          }
        });

        editor.on('blur NewBlock', function () {
          removeContentEditableSelection();
          hideFakeCaret();
        });

        function handleTouchSelect(editor) {
          var moved = false;

          editor.on('touchstart', function () {
            moved = false;
          });

          editor.on('touchmove', function () {
            moved = true;
          });

          editor.on('touchend', function (e) {
            var contentEditableRoot = getContentEditableRoot(e.target);

            if (isContentEditableFalse(contentEditableRoot)) {
              if (!moved) {
                e.preventDefault();
                setContentEditableSelection(CefUtils.selectNode(editor, contentEditableRoot));
              }
            }
          });
        }

        var hasNormalCaretPosition = function (elm) {
          var caretWalker = new CaretWalker(elm);

          if (!elm.firstChild) {
            return false;
          }

          var startPos = CaretPosition.before(elm.firstChild);
          var newPos = caretWalker.next(startPos);

          return newPos && !isBeforeContentEditableFalse(newPos) && !isAfterContentEditableFalse(newPos);
        };

        var isInSameBlock = function (node1, node2) {
          var block1 = editor.dom.getParent(node1, editor.dom.isBlock);
          var block2 = editor.dom.getParent(node2, editor.dom.isBlock);
          return block1 === block2;
        };

        // Checks if the target node is in a block and if that block has a caret position better than the
        // suggested caretNode this is to prevent the caret from being sucked in towards a cE=false block if
        // they are adjacent on the vertical axis
        var hasBetterMouseTarget = function (targetNode, caretNode) {
          var targetBlock = editor.dom.getParent(targetNode, editor.dom.isBlock);
          var caretBlock = editor.dom.getParent(caretNode, editor.dom.isBlock);

          return targetBlock && !isInSameBlock(targetBlock, caretBlock) && hasNormalCaretPosition(targetBlock);
        };

        handleTouchSelect(editor);

        editor.on('mousedown', function (e) {
          var contentEditableRoot;

          if (EditorView.isXYInContentArea(editor, e.clientX, e.clientY) === false) {
            return;
          }

          contentEditableRoot = getContentEditableRoot(e.target);
          if (contentEditableRoot) {
            if (isContentEditableFalse(contentEditableRoot)) {
              e.preventDefault();
              setContentEditableSelection(CefUtils.selectNode(editor, contentEditableRoot));
            } else {
              removeContentEditableSelection();

              // Check that we're not attempting a shift + click select within a contenteditable='true' element
              if (!(isContentEditableTrue(contentEditableRoot) && e.shiftKey) && !RangePoint.isXYWithinRange(e.clientX, e.clientY, editor.selection.getRng())) {
                editor.selection.placeCaretAt(e.clientX, e.clientY);
              }
            }
          } else {
            // Remove needs to be called here since the mousedown might alter the selection without calling selection.setRng
            // and therefore not fire the AfterSetSelectionRange event.
            removeContentEditableSelection();
            hideFakeCaret();

            var caretInfo = LineUtils.closestCaret(rootNode, e.clientX, e.clientY);
            if (caretInfo) {
              if (!hasBetterMouseTarget(e.target, caretInfo.node)) {
                e.preventDefault();
                editor.getBody().focus();
                setRange(showCaret(1, caretInfo.node, caretInfo.before));
              }
            }
          }
        });

        editor.on('keypress', function (e) {
          if (VK.modifierPressed(e)) {
            return;
          }

          switch (e.keyCode) {
            default:
              if (isContentEditableFalse(editor.selection.getNode())) {
                e.preventDefault();
              }
              break;
          }
        });

        editor.on('getSelectionRange', function (e) {
          var rng = e.range;

          if (selectedContentEditableNode) {
            if (!selectedContentEditableNode.parentNode) {
              selectedContentEditableNode = null;
              return;
            }

            rng = rng.cloneRange();
            rng.selectNode(selectedContentEditableNode);
            e.range = rng;
          }
        });

        editor.on('setSelectionRange', function (e) {
          var rng;

          rng = setContentEditableSelection(e.range, e.forward);
          if (rng) {
            e.range = rng;
          }
        });

        editor.on('AfterSetSelectionRange', function (e) {
          var rng = e.range;

          if (!isRangeInCaretContainer(rng)) {
            hideFakeCaret();
          }

          if (!isFakeSelectionElement(rng.startContainer.parentNode)) {
            removeContentEditableSelection();
          }
        });

        editor.on('focus', function () {
          // Make sure we have a proper fake caret on focus
          Delay.setEditorTimeout(editor, function () {
            editor.selection.setRng(CefUtils.renderRangeCaret(editor, editor.selection.getRng()));
          }, 0);
        });

        editor.on('copy', function (e) {
          var clipboardData = e.clipboardData;

          // Make sure we get proper html/text for the fake cE=false selection
          // Doesn't work at all on Edge since it doesn't have proper clipboardData support
          if (!e.isDefaultPrevented() && e.clipboardData && !Env.ie) {
            var realSelectionElement = getRealSelectionElement();
            if (realSelectionElement) {
              e.preventDefault();
              clipboardData.clearData();
              clipboardData.setData('text/html', realSelectionElement.outerHTML);
              clipboardData.setData('text/plain', realSelectionElement.outerText);
            }
          }
        });

        DragDropOverrides.init(editor);
      }

      function addCss() {
        var styles = editor.contentStyles, rootClass = '.mce-content-body';

        styles.push(fakeCaret.getCss());
        styles.push(
          rootClass + ' .mce-offscreen-selection {' +
          'position: absolute;' +
          'left: -9999999999px;' +
          'max-width: 1000000px;' +
          '}' +
          rootClass + ' *[contentEditable=false] {' +
          'cursor: default;' +
          '}' +
          rootClass + ' *[contentEditable=true] {' +
          'cursor: text;' +
          '}'
        );
      }

      function isWithinCaretContainer(node) {
        return (
          CaretContainer.isCaretContainer(node) ||
          CaretContainer.startsWithCaretContainer(node) ||
          CaretContainer.endsWithCaretContainer(node)
        );
      }

      function isRangeInCaretContainer(rng) {
        return isWithinCaretContainer(rng.startContainer) || isWithinCaretContainer(rng.endContainer);
      }

      function setContentEditableSelection(range, forward) {
        var node, $ = editor.$, dom = editor.dom, $realSelectionContainer, sel,
          startContainer, startOffset, endOffset, e, caretPosition, targetClone, origTargetClone;

        if (!range) {
          return null;
        }

        if (range.collapsed) {
          if (!isRangeInCaretContainer(range)) {
            if (forward === false) {
              caretPosition = getNormalizedRangeEndPoint(-1, range);

              if (isContentEditableFalse(caretPosition.getNode(true))) {
                return showCaret(-1, caretPosition.getNode(true), false);
              }

              if (isContentEditableFalse(caretPosition.getNode())) {
                return showCaret(-1, caretPosition.getNode(), !caretPosition.isAtEnd());
              }
            } else {
              caretPosition = getNormalizedRangeEndPoint(1, range);

              if (isContentEditableFalse(caretPosition.getNode())) {
                return showCaret(1, caretPosition.getNode(), !caretPosition.isAtEnd());
              }

              if (isContentEditableFalse(caretPosition.getNode(true))) {
                return showCaret(1, caretPosition.getNode(true), false);
              }
            }
          }

          return null;
        }

        startContainer = range.startContainer;
        startOffset = range.startOffset;
        endOffset = range.endOffset;

        // Normalizes <span cE=false>[</span>] to [<span cE=false></span>]
        if (startContainer.nodeType == 3 && startOffset == 0 && isContentEditableFalse(startContainer.parentNode)) {
          startContainer = startContainer.parentNode;
          startOffset = dom.nodeIndex(startContainer);
          startContainer = startContainer.parentNode;
        }

        if (startContainer.nodeType != 1) {
          return null;
        }

        if (endOffset == startOffset + 1) {
          node = startContainer.childNodes[startOffset];
        }

        if (!isContentEditableFalse(node)) {
          return null;
        }

        targetClone = origTargetClone = node.cloneNode(true);
        e = editor.fire('ObjectSelected', { target: node, targetClone: targetClone });
        if (e.isDefaultPrevented()) {
          return null;
        }

        targetClone = e.targetClone;
        $realSelectionContainer = $('#' + realSelectionId);
        if ($realSelectionContainer.length === 0) {
          $realSelectionContainer = $(
            '<div data-mce-bogus="all" class="mce-offscreen-selection"></div>'
          ).attr('id', realSelectionId);

          $realSelectionContainer.appendTo(editor.getBody());
        }

        range = editor.dom.createRng();

        // WHY is IE making things so hard! Copy on <i contentEditable="false">x</i> produces: <em>x</em>
        // This is a ridiculous hack where we place the selection from a block over the inline element
        // so that just the inline element is copied as is and not converted.
        if (targetClone === origTargetClone && Env.ie) {
          $realSelectionContainer.empty().append('<p style="font-size: 0" data-mce-bogus="all">\u00a0</p>').append(targetClone);
          range.setStartAfter($realSelectionContainer[0].firstChild.firstChild);
          range.setEndAfter(targetClone);
        } else {
          $realSelectionContainer.empty().append('\u00a0').append(targetClone).append('\u00a0');
          range.setStart($realSelectionContainer[0].firstChild, 1);
          range.setEnd($realSelectionContainer[0].lastChild, 0);
        }

        $realSelectionContainer.css({
          top: dom.getPos(node, editor.getBody()).y
        });

        $realSelectionContainer[0].focus();
        sel = editor.selection.getSel();
        sel.removeAllRanges();
        sel.addRange(range);

        editor.$('*[data-mce-selected]').removeAttr('data-mce-selected');
        node.setAttribute('data-mce-selected', 1);
        selectedContentEditableNode = node;
        hideFakeCaret();

        return range;
      }

      function removeContentEditableSelection() {
        if (selectedContentEditableNode) {
          selectedContentEditableNode.removeAttribute('data-mce-selected');
          editor.$('#' + realSelectionId).remove();
          selectedContentEditableNode = null;
        }
      }

      function destroy() {
        fakeCaret.destroy();
        selectedContentEditableNode = null;
      }

      function hideFakeCaret() {
        fakeCaret.hide();
      }

      if (Env.ceFalse) {
        registerEvents();
        addCss();
      }

      return {
        showCaret: showCaret,
        showBlockCaretContainer: showBlockCaretContainer,
        hideFakeCaret: hideFakeCaret,
        destroy: destroy
      };
    }

    return SelectionOverrides;
  }
);

/**
 * NodePath.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Handles paths of nodes within an element.
 *
 * @private
 * @class tinymce.dom.NodePath
 */
define(
  'tinymce.core.dom.NodePath',
  [
    "tinymce.core.dom.DOMUtils"
  ],
  function (DOMUtils) {
    function create(rootNode, targetNode, normalized) {
      var path = [];

      for (; targetNode && targetNode != rootNode; targetNode = targetNode.parentNode) {
        path.push(DOMUtils.nodeIndex(targetNode, normalized));
      }

      return path;
    }

    function resolve(rootNode, path) {
      var i, node, children;

      for (node = rootNode, i = path.length - 1; i >= 0; i--) {
        children = node.childNodes;

        if (path[i] > children.length - 1) {
          return null;
        }

        node = children[path[i]];
      }

      return node;
    }

    return {
      create: create,
      resolve: resolve
    };
  }
);
/**
 * Quirks.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 *
 * @ignore-file
 */

/**
 * This file includes fixes for various browser quirks it's made to make it easy to add/remove browser specific fixes.
 *
 * @private
 * @class tinymce.util.Quirks
 */
define(
  'tinymce.core.util.Quirks',
  [
    "tinymce.core.util.VK",
    "tinymce.core.dom.Ra""px@4p-D>HM0pz I@&*a$/p* 
jip41 
p	  ASC8\ hA2CH+k[;;sT?n/nk]5oge:6;/}m_}/=?|[Ob[:Sn>zvnR^/4_^:_G7uwn'S}K?.sk0oj$
\X 6b[0VB@(n5R PN[
#PQ hH%C$/@ $ra@	!"w oL jxw1t{ks}q*wWO?tC{6wrOsmO;V_WO+8d
Rp&X | 8
] %Ff!`",$*( 4=F-L9b.pG *xaj`AJ$
 E ! |	D o 2 Fhh  @U#8D(RPhX0JS ?$<XR@ba
av|	h@II j  VD0FX*n  54	ta`-1R P@v&%~3[7q^f9unuv>sKC^hV]O_}}|?e7 ~bDeU[(F
POMc-
!Ub.$"KXC &@@F	@5&g! FR CbQ"
DGwN?ZO/o;}o?dzk~}ng_Z}P8`?xW6Og;nAV;~wW_r}v,+YouzkTn&7fWqL;]GWm{#w#t?=	/_}h* J0 T  AA6NPY*`$x"4C*"0@I0"@rj9!^E\V^@b~P@ #)QGAX$ 
H D@ (`Jc_wo_r}Lk/|?mo[_Fw3[&}~oxnOL_5"u^WM*	K20VK"@Q(OaMtC))_"0+` 1kA ) I	 6@2B2cj(TGB[@70f@m(H@z$wY/ (acK.%A	#5GJYQ
j0\%,kA$F
4iD	PA
[X<FL;A \	.a1-u.Kv:6bv~	ww\sf=o,Sg_ule
Lg;~rv'yw6OZ?]0vC2R @Zh%9B<3$ 
FJZ p# &P8"@Dlb dD|AT.'Y2D^`tAX,@%*"!%	PFU kJt}/Yc{_w/wLKj]<^n\>9v-?n}k9zvnep~\wSw<rlk^`3O{w=_g*t;z'?ZXc(}kMW:zuy=?;~~\'"0C_@)TEVTh& Y#B#TB4(RR$T2i@bHH .1 R"$G!0 
 	G=?z{	O_3Yyw'y?ur3==)gZ>{oxOkC|OmM0/V6Wi>(+@DE&%
T h H
@2
+:C  ! TB;5
@4VPATB@3 p! @HV1iN(" P i$FKO6!` [jHR bQ"B=|RX*,#Q`#F
d#Jm
ah_UrMf]^mT;'oxGVIN/]7a?/O/\-}}_i<y,_M7]zLp@CdaA2JZ MS
)
u*5#KA! 3A ' T  H {.
7# )D%A"
M

DPI$7iOo|O?;u[?sWe_[.?V}wNwWyoyO[3_^_g~OU}zw>}}n 3~^E[cuiW	kgO=*CpTrA$%Q\<#b1e," B$<q ]GpH @p&PMXq!|PKGA4aa("2hI(AB-(@,nc:4BaK"H,+"v^6}3m__/;c>o}_r{qoW'}@}v/{c_ogkVsomsz\2 FDt@2%,C  R@$8 
V	E`""`$!H  b2H()M 2ab
 K')jWp:bp'@P21`&p $0B` @<< @o#dB0 Q&bHC`SRHWi)_ : 9p7 T\,4" 0, T!n *Id dw7YMm?f{zcyqvw?gyw;!Ou[E|^z_l_J~?O?y/3upooWm}/oUt:oy9c/[zk9GK\]=_cM?Jplo} `o$(D K-P;?Hfy"D8N	Czt G0IB`JQ!Lh (aAw! Yx()-(1!}J9XL@-. K`Q+xZ D( 4`Q&"R sq- F6W)dl#5De--bh/!  Wa U Q@C1lkC
-0sLe#fV;oko~{K.G=V]tg=z?~wl+~=]_y\Wh[euS=T#LtuM/Kp	C%"
D="az  ceO +CF$9 >j4#t`?NAH&|3hA( 0|d$nv~2?)_dS|hk/JnM{;:^s;~_[w?|^nxQxgmv_'Q+}qWu?y^|g[/>i~Wd_93ww&TrFp'"SB(b6 	21$?
F",mL%$Dh UA@XHW&EQb!CS)A+{={?/W^pcgWmG=f~{r<g]]]	m0 K"&l&VE I2P QhI'hGy#i@dQaubd?h$BlW7BZ,dj#dCapB' 4d Z<AJ|IL| IS f&rdmQZ:`HR'cZAC3|	 j1AUrJbD$5aGv+ #I  ["
)].wOn?n_[Mk~[0>_>4yGt5^mM_2Y^7~w=_P6-hHLAF2A|@`Y2PP jrU-!$6D XKCH,2$#.  .x7Y/v>?!VgIjunsXs_.Zj}O1o'-avG>ws-owG}]=(Mk7*z?l{/}/]mm7V.v{{?~=?3(bH}+DHh)(@?*0s
JHRPIaAuXL 03ih2HhB
A808!<(,pu*yJL +gsg7oO)Wcz='=:}}=;twR(loz9li(/x} H*nPHa$ @1u9oAP#P$t f_$\$Q"pFG1X&c@U`aG!ADX &iN#x 4	S`hAJRL@T)	A.pQ4T4)FVBh`TRppJ )HKW$UlZ9$h	 iE~On/}g>v>6'mwtI>{So-Jr]~*{K~oUf ug Q9  Q shS@X @rQ4P9y
H4YD2p p`ePe$$tt4 BA$'4oVAZnbB	D~xgzOq]oaUxN}izz,"nrrd_|i:nuz{:}.mS_xV)}v^vr{{{p_qik[w|,?7|!cxlvv_w]?;R~X4D_TPLVD=QEd
N\P!n
L*&N$$IBl	 i@S
 @@h5="9dfQ4g$0kX$Gi|s3dobv~3+xQO7}W{ygau];tW_v~ c c@A|* rF4HEYJ)KK$w!3`$,d=]Zs$ ^A&J`5()@@$I R,i]57$%R_dZ"Dt:dfdRl&u7	#$0?#Y1aht>hWX@`&P,"x@ 8	N2st8h!I1RD_?>o}1|xzm+|]>'|kr45]fu:*gUooc7dA@1K#_} ?hN2',i&+25 B)!oHDE pGgD H@`Bz$b; Y8 tlb8`aZO B\D;=xu3?s?{v]+UH]e^z.g6w^SX]]7=^<nzzw`s}/gWL/vo}_owvG9n^iflitW?ko>o+YF_<^!A$ L3p`LA\PFDb`E">]@4!PCB@;OSdBK"Q *(htG!($Gq!7"(A(.At0OF^P8R%F	 & P$/CA "Qs>  A&!BaA bU  E p1PO 0%! p  0(v9@!NQ0"(+2 	JX( DdA90
I084x  	"P DE  /[ 9v0@2ZVB	RN 7I
N.0 	"- D(I(E PA EdS 0if+`A0P 0 >B 20BJ-J ru*`! 0J"7Ks Q\@E!	
B0@'. <=B,
 c !|	 X)b	a:$jb^XHMb] "j<`3\e H#rI+AVjC@ByL d0[HKA i`SNTFH	8@aM$\(q7iW`a @T	[QP[U B %K@DR"Z	, V0*a!t%>(j0AGQ)h+EaBbc"8P(X}T@ LB  9 H
c4C(WU8"D$ tX!'$KTB4D("7ID(HLAB T $000IZH !P0  r&Tm0@  x@`@D0=  c 4H	`PP`H"BUR a.P1 	 -@` F\  AMT% NlT@D$lB  r" @@W9*Y$Kd!RW4%"0L
	A8XlJ"T^B r7z)#` @T@m@t22l S\l@2)A
Nd!NP$ ( C
RL`EB0`2 (* r S%  nJJS%KPr'!f  JC -C6H 0RPb!@ .=+@t!YbF"[D*D 4@Gs $ HM)d 6@O(
N |"Qt/@ !B 0r , 0 :PABa! GPu3vCe@PH\'"%C,XQ*D%B%0XjB1XB5@($ B I1k@CDR .XK $N0 H?$@J,Na@@\A!1d$Yi B@"R02$DV H) A+T8Q6DPT*0A5DU1$C"i`X3#I_pv1@P! xp1(JEA@$M*)!IU A D`oX'@d"\%'WjAIB@ A@@a Lf'XhCB	0S W$ K` U60@AQ>h20XJB0PD$-` KD $B\J9 @JD8EA	4)aFDx-bDVIQ()H5RP!N@ @hM\H:*HSyD@N`&F	 	:e AE@C BhUvC)` 4H0(@
 $h(  PL(HB B
&1qSdP`r`H $D$	$1ztj
5D8'"!4n(@aZ$h`l D)h"$C#   \  2O$5  0[d`r<	4OP(Y!FH!94	"SdOD` C `@D8  @%H$@  @)34Q  DD C 	 H 4 BA%rF/ CF!iA BI:Aq/%q(ZPpBb  &@L%R3d@rQAA8Spj* "!c (ip   !V#B)X.l5c0DGd4( @.  E@*E@
(1	@J@ 
0HB9=9A#"#Bp zH)0  L AC $G'hBB('MB]R0vM !-`4,@1D0I$xS 9!`*	WHH(!q"*;A@KQ L#' 0	-A8eH p$W |"@"<5 		BR0%x6H2h#=ITE(qGy)d TB!(cEXK!ZD DC"7($V5@BT!KQPb@aPD[#!I n V#  yB`FH@fH
	p @@ AK)U$J  ar@07-$&*"@ "&# `dbCS)QE`!0 ,%@.t!"%
 ! H "&P!p2' RTBT@["0A-9\X"D5\E8QQEN: <)PA!\BH 5QH PY0A	 LfP2Ipf&q   3%SC`p(Q$ c @A	 
4@dBCN HDE E rEL1) P@b  !)D	A
C|`J 4)	W b Z^pA)L4q<@pD, 	D Y , TDY]R"@BaKbh0S#VS2:T  	"#b<FDADU!D

AC`AeDGU@$/jbAu 3&	iBbe6J "m! H
Vd$z

f!Pl@	)0IC $B0 )PCf&b	2 A2)CF~ Aj !LB!*jJ`&F
A
PAJ&4  VSAbpPt z@\Q$8f b')0&@C$P`!Bp  q 8}8 0 GTC p T G! 
q(B BDA;aW$%dvf *QbD"H@W["P\X"hD,A pKHDRgQ * a,`H!G*0	@*V"
f @1HH!`rh&%RuG -wfnK+~>EOUir/O3%xr9_iqq;o}n3J^  AA p
Su 
2	$Y+0I H (`X0 ")8j5	0$QB*F@  K>@yBXH!R$ha`@d !Q!IH+T'*#q@ 
X% b
'H f$`had IHP	d2PHR5$   bD \$*4<TQoW1o??3:m8Gwv=Ej-/&kd7v%y{|AIxW4w@"*pV 
QZ@P*@Q< "c i2Jc6F5P$@h5SAd0.8 DA !8P.1(TTb `@JH%cYw_:GS?r{dIUo6_s>;wY
<;t~oz[zXW^b;=k?+olZn9c<=yp;{_~7m\I}?xMom.Nafu/):_{oog,!P m 4@()(Ml "%)	tC   S AI` 0   ! F` t6`M tT B"  ^Ywz&~er>mkb_g?c?V`?YDV#YO,{?J:>^9FxI@X e0] I@#	( PEt/U`eddoDbx< 8)pHt0 GB8
c 9U"& 0" %	 d@4"$:P.?  j>	( `6*DBP xX(`1 ['P@
z0)0*66Z\pwd$Xs#D)hYhx\rO*gn3WY}t?\{#pGrP4?{\[47]sso_:=O+\|{k>zsGu@, aPf `x  1:%%A
(D 3 X:g1
T E: p|7 8H 2 ]B` tJ!#@aV
 BAnO[syQw{_ymi_nK/KN^?TgL=M^`ry[idf~t?.ood9~W~s9<[C~<g|E}snJ&<B!M5go|WcL:9/DYhZi\cT	cc^on21"CHNzC$ `E0'a7 A &5#]
TD0i!1&H	l0B'H*mTBf @:g0 F_CrgCt@dpI v`s?z|GfK2=qYk#]k?W_c->{i3N_zx<C<]]IsWF[	F )NiQ aTQ%	R"Z(G,$JU[$H`g `RwjfaPDxID N@F8L@-h 0A*t  EIP(R  IRq 	`, df  	0#&(V3\ q 	LvLlm c 
d #|]}DG'<}sW]Y3/BWx?NvC*	>/g~w9eJ->_tPU6D@&T 4@;<IoP$h	 <@d5 ^ L6 T}*$    A$"xEB`O#@
4
 =G;y/HTo[Y~~bw?f6|eFq;]}pjSeIqM_}=/z{+\
^=W/4c}kYD|2nW?>s<>Do??:xe_`EA^1Cnhr7J2tpbP` 

??XLA8	 B
 V!@Ee2DM8d&B }P L1$ $lZJ!`XHuP) L@@	W Defv=[7O{_}~>Mq{7$[%T^sv9}(o6O'vP:5:FwdW"DB iHMQq0`X)f0(  \bc+
& `0`@x=LH A@d! 	 
a,!2 i  X4!Dd u@ J In@ BAc8Ht   +		5 
S@$
#x " 0(,
(4}$#":HPDj"j&C 1	J?||u}dZ+{Fk|c{>Y{77wVu?z9eg_YSt0gU\G)- +"
p@@Xx! gDAVjP  @#7AA	ON B$H($t H".Pa 0)*(@aA@ H"DJ(- 6bqW?coo;5ssW=}#?R9{{b_z{bK}y^_WNMK13_wb{]|?y_u[7+q9{|Oq~_l\n?w>kQ@-*A@]14 a  
09 6 A l
/D70TP,@ J@N1x atF1pC2  KAX@ *,\)cuufs#oW;;{|[[4gKf~c?O_=]t(Sw}  *J2"A~(0"  	\/DL (id"XP\d@$p0 ,f?qlT@Xq@4  c(d:C4:l" #R#k#a4	y	1$A0!" 	  
#!D64E

@jxsQ(?ZAsB@La ` :4Lf{r}]J|Cs3]y.{]!'r^)^Wlfo=KOuo BHLBL
e$H	 l jG%  Q)4 h!|Fe
XH$Ll ,a 4;   ,cHH BC6Fg>jj;~7g:.SiIzkKs5nVO2^Xf|_{kc=m7RwTu-5JzDAm_F~o7[od]>[E]A[VRh'V?]mFgJ_C[u7>1@@L#BHLPP 	Ea  !X` $ &^ARM&3Php*@@ 12k(dP X D( 		-$` _nBeu??)o?=z;Y<&o/W[GnhaF>UkER:rl;2]  aP\`* 0 P4HXj\$,$s@ `
t	, bxQ@8QBiIMA'DDa\)
B(x4G
(A!h K_@38bx-* K;T#HjUEdm5 & 1 B` 	0F(C"0"[
f 
&%<A  d	IQ
 PP wwx?ynwyCs_[!{^YWO>}Sb}k}mWo_DtZ>V0O~]OZ-i@   ZG @
" d<D	c 	n!iDE, `@E	a(QP%C #f 	Pm(	hAU{~#r^f\27>{w:Vpkp}.n|;?}?=WTMk8nsN~W5/o1M{)y|Kx)O;y?qL~j!EpHjp"" Aj6KRqm/  $`
 IP:Zb8'`&C g`a&("NQU&@i3uMqLBHF `!
X@ `XJ~}?w]62-e}5]yEK>~_hg{4kol!Ry;o~MG0y]q}/Qv $Z ,,@ 4UJa
eF+0j P47aURV# mXrh&xL @IDoI'VH)"9M^`E$,ZS`kP H"Q E'`4 |(T
@S 0
 \2P8RR%JXBwIEEI0'$N
aH." b(CBT/>;K{KnN	7rd<uQz<].vw}e2oAW_7|}>ge]qgi_uT@1g	Egid &Xqa`sh96X0I00B8k1 !( *Bk3"(7`L6 $Z`F@ B  ![]{k1Ou~}^c[pWn8YWKs]oH+_oO<T:+K{~,}D75gFUWn/ET6SwX%;<o;L{Ee4]M	H?i@&C8@ HFc" "@%h6	lt$GH&#0p`	Qt	
 d(UD8a`4Q4IRD&"X# ,x2]>8}o3^~nL~?]B{{_[rWf=<6').-[?n 0HeSHzB	
"6"L cHD< <B K
S ( Dv@a ]	@ (B$+(*(Y8>h("@1k%eC@I 
X2d/Ya5%+	EuRcl	R :ph5abN4)#A r:,jB%p   "v	 & &`
 H "@I "0A@C*CokP=(F]Qq|_'wewz[q?)oyw_Gw|uDje Z@@J0') '  
#@(6@AFQi)AHF)B( 0@$` A@2`    %"A@@[riwZ7_=v;m9$vv=a@U~5|&s=[mg7M}0fn>p~_p7!_S>3WGkbj;o9y=oS<h6z^>owu}?}b, =3H^A1YBBh !CAAESc  8BFi$|WP0Ul8 &Dr%B"X
 ,(B8"TH	PbyD  N" DY8e j(ht(r2 (B@6(B40aB&e3t0 @e0'P6$@`(!8  Z($hz@`P !?|I}+/>Y-q~'<w>/?}zn=>{kxo/7,{uv/p?j"E,7k*whl[7_&y
;c/iir(W=PZW='tJ{s8!'	0X0(@p
	d<hD2#0e!# k	\aIN 
$Y5 HpJ13LDPIlYr#cAH<+ Q|S_}wisRo}?1w^[^wo7]\u.}OxoC?7ao_\WeRey\1@AI	B@($  H8!s|A4 P @B4HP`#@p0	@ `jD(dN "@ 
@ CT JK!.ED(4 LY :	d 4@" *@"!S[B@9!<e.Lh`!'j%DHh!!!
s`A2!I2PpL`+`0^}}	?WO;z<t~qn2O.umd#~p3oBWg4{%= (L5B)4`8G'Qt@)5@84~ &!2<FBp4i0YEVJ*4I  E$HCQ@9YE<?	@4$@%	}y^oSoy?O9yKst?8VhfEw6Ur)Y.[7?5w|yG'$^J;)o!_[tYT:{Hr^kxo>;'%7[?;?sn/Op~;]2?;oi_mi^|&9u_=@YA	"$`!0   XH@@xC8
 @Xh&8m6(A"+6A	`'	t,  'A)b@M 2V<0V(2@`D-A>K*9E^:}	[_+n?%1[Lss>~KJY~;'7<m'7:w3v%(9$b	0pB5A D 4,RR  Xs
P@J 0Ql=Cd0
`A	DL,g@L@D C(@ S2FLB2Vx@tB@H<P0DIPA:a  E5,'>:H@N +(
Dv($4<c@Qv@9Ai2
1 @ "@#@ PnGxR_'F-wTe7G'sa w7&uK_>oOS4ib~}_	?3"fnmS_VD< ,$F*x0, ZDW 
N, HW H`x@ B]Pq A 	T , 0 )C-l@#b@#X`k,|I]]gwxrTd~~M83&qvc4uZ^	me:zea$^rW4}xsm=?OQ/tMc73-B{70.s"yi1'._oI|K-'w<wq?/]?Y7y:k}	^gm011B	@60R
k\Y:ND% `R	z%H@<x
J@$@
bdPH0&P*t,]DLKWr{s?wsYE_imepl^z~-3G>j)3I<v_}2V'2zB?toP	Dt

ip@ B!l*bA"px  hP5OH `+1CHB 3&l@iQ8dc <>rD1$ Y
Hc)dt@EZ`H#y
@2)p !4>KB0B) IX!f3 (A@N"!4R/V^v:;5? D$jeSyx|Dms5/CwyU=k}?koo}Q~uX*--]vZNwy/{o_Bwp>{!?p0 :TRf0&1*#
` x@@(0y "6  ""X  9J0u#!"%l4(A$8@ X855F, F9t 7=/>uv/v%6Nyis&S>u [+eSrK'gI
^{\{<7j2T[#|3V]vW;es{w6pG_%No<gLs{z>~Me9uU=[`q>~'k/]ooxLfo<D86q8@(9AVIL `10C Q "X@A2@AB61,H,lR^HtEh&*I{|&%r~.&E6^[};+vy7e+z=R<?7Nu\]q_O'wu8zcHZNC/C 
+@B H@Z'F @0B	R4ci(bA"!	 (BY@$d@v`B6uBDR-	f )hd@$0m @e4rJ0G q fh WAa n-N+!6ih)"<f`H@! I3) 06TDC2` $!@vO~d
>z:{a]>+B}>&R_Y,3W?>G|smSgHS7sw][|>yy~o/gs~-XrmATS]JoYq}}vD>^_;)'b|}kJg5=EhZN;	ey8
 @*0"<L(&FB0b //`pHD
.9"P pX  2HbD,VjB1*!`@ C"%*n!pC	AV`A\2@jD tA
(;@
@'@0Al888N@* R.z
C)
.??7/~Cm\S7^{}^Vw_W]lsv9yh7@e_l}`1RgB@H3%	1& P`Q Eb5B0w()#7T#1v%I"QXAJ%8PPA D@p&kOrfG|7<7~s~/[r}Gb'K{:{q||w+UwIvjeMB'~vs[fs?;zO|_^IzI_.i57F}?X-l7_S /-e  @J$#HwL(Bh0b1 "
	8fMEbT#]B6 -1P[{-?/_}eC_=nuO3;O@~3|T~|~{}1k=tm}_~};t("V=t$-v(CMB 	<IE4	ld'@ S5NtDM tL1 '7"Mm/R 8n AYBp	Dr"F0T2@H
	#UK-8X!i
l)MJc, 4!q*eH2pLh<T) jD@ tt`2K3I@h48bX1};Z}5O~YmujMv|mz_ykjO7zpo]}%$n,}}oOs-Kgs%4$U*2l D eT J"!E *)110`zD 0ThE$&jP26LT@8pf$( NA*Z\
	`RHPI5bann|1v?|>>Ll}}[__Euw:S\dp_?__^_MG)W|V}{\F]Uk~8joF}wlJ_g=w%y=_O[M}>/}^sNoN"p\S;wz{~?ks%)! :^B3xA
B@HbBH	a`4ibdd XL+I+G86Np"
R@p10X  .8R5
vP/C/y}=cwk/OwwuW9=WP[yq<^Oc_u.WWyo`ph_Dd!k f. dkb,P )2\>RTg$>0p*``fAb`,#PJ , 0c 
`Z"^A\R@S3 CZ:OLB,m$e9X" $( @t`@B!^0ELJ[3pm 3E5(V?0Z Q
`
P!WP@"
*BE"0__{Oy/ypua6p=o&cwwo4-wV2??qg{ O 	"P
BLKm\HQf@W  R*@) da,aL  bQ_1LhDXBSd`p JYj0pl V`}?Gon#Uo|W6gw}_%?|7?t^W-]+a6?W[dwexwK35Kn}~ G}{}==n.+`6m<q%ewt?[5 %# 
U3$2%@yLrAC%D4 `h( L !aCPEW	`ep"U `IhH;\L3P,`2hZ#`pYg{MB~nMb9dl=zwu{?/mV[OkrG-_wN	<?_\^~?>ao6+1)D).I70Pg@(0Py b%rs@LPp(1 %HT0 0 q#HB F(F JX0 -5(dJ FDGsF8(`	EXDt2&QmBTC9#U N	 @hh4, 	#2a WMmi !/]T}oVk[F_U\{qw5W~S]mW_^}?q8<{s'_t |aPE	d@Y-lni	1 JAu 8Ip@1 U 8HdpD	,"@8Tp hH8D82 L`fa 5o8+@C@ D i>_s{oY>}7~_z7q~mZwk.oiOz75~=:V4^AvA^_.wWwww2lWY]}?7]<{Y_={^;?\Vc4(I (l1)	UIH $"G'R$$, ``" GD!
b,q i2$ PT	P8k##21BPRh UPmpossible to type if the document has a touchstart event
       * bound and the user touches the document while having the on screen keyboard visible.
       *
       * The touch event moves the focus to the parent document while having the caret inside the iframe
       * this fix moves the focus back into the iframe document.
       */
      function restoreFocusOnKeyDown() {
        if (!editor.inline) {
          editor.on('keydown', function () {
            if (document.activeElement == document.body) {
              editor.getWin().focus();
            }
          });
        }
      }

      /**
       * IE 11 has an annoying issue where you can't move focus into the editor
       * by clicking on the white area HTML element. We used to be able to to fix this with
       * the fixCaretSelectionOfDocumentElementOnIe fix. But since M$ removed the selection
       * object it's not possible anymore. So we need to hack in a ungly CSS to force the
       * body to be at least 150px. If the user clicks the HTML element out side this 150px region
       * we simply move the focus into the first paragraph. Not ideal since you loose the
       * positioning of the caret but goot enough for most cases.
       */
      function bodyHeight() {
        if (!editor.inline) {
          editor.contentStyles.push('body {min-height: 150px}');
          editor.on('click', function (e) {
            var rng;

            if (e.target.nodeName == 'HTML') {
              // Edge seems to only need focus if we set the range
              // the caret will become invisible and moved out of the iframe!!
              if (Env.ie > 11) {
                editor.getBody().focus();
                return;
              }

              // Need to store away non collapsed ranges since the focus call will mess that up see #7382
              rng = editor.selection.getRng();
              editor.getBody().focus();
              editor.selection.setRng(rng);
              editor.selection.normalize();
              editor.nodeChanged();
            }
          });
        }
      }

      /**
       * Firefox on Mac OS will move the browser back to the previous page if you press CMD+Left arrow.
       * You might then loose all your work so we need to block that behavior and replace it with our own.
       */
      function blockCmdArrowNavigation() {
        if (Env.mac) {
          editor.on('keydown', function (e) {
            if (VK.metaKeyPressed(e) && !e.shiftKey && (e.keyCode == 37 || e.keyCode == 39)) {
              e.preventDefault();
              editor.selection.getSel().modify('move', e.keyCode == 37 ? 'backward' : 'forward', 'lineboundary');
            }
          });
        }
      }

      /**
       * Disables the autolinking in IE 9+ this is then re-enabled by the autolink plugin.
       */
      function disableAutoUrlDetect() {
        setEditorCommandState("AutoUrlDetect", false);
      }

      /**
       * iOS 7.1 introduced two new bugs:
       * 1) It's possible to open links within a contentEditable area by clicking on them.
       * 2) If you hold down the finger it will display the link/image touch callout menu.
       */
      function tapLinksAndImages() {
        editor.on('click', function (e) {
          var elm = e.target;

          do {
            if (elm.tagName === 'A') {
              e.preventDefault();
              return;
            }
          } while ((elm = elm.parentNode));
        });

        editor.contentStyles.push('.mce-content-body {-webkit-touch-callout: none}');
      }

      /**
       * iOS Safari and possible other browsers have a bug where it won't fire
       * a click event when a contentEditable is focused. This function fakes click events
       * by using touchstart/touchend and measuring the time and distance travelled.
       */
      /*
      function touchClickEvent() {
        editor.on('touchstart', function(e) {
          var elm, time, startTouch, changedTouches;

          elm = e.target;
          time = new Date().getTime();
          changedTouches = e.changedTouches;

          if (!changedTouches || changedTouches.length > 1) {
            return;
          }

          startTouch = changedTouches[0];

          editor.once('touchend', function(e) {
            var endTouch = e.changedTouches[0], args;

            if (new Date().getTime() - time > 500) {
              return;
            }

            if (Math.abs(startTouch.clientX - endTouch.clientX) > 5) {
              return;
            }

            if (Math.abs(startTouch.clientY - endTouch.clientY) > 5) {
              return;
            }

            args = {
              target: elm
            };

            each('pageX pageY clientX clientY screenX screenY'.split(' '), function(key) {
              args[key] = endTouch[key];
            });

            args = editor.fire('click', args);

            if (!args.isDefaultPrevented()) {
              // iOS WebKit can't place the caret properly once
              // you bind touch events so we need to do this manually
              // TODO: Expand to the closest word? Touble tap still works.
              editor.selection.placeCaretAt(endTouch.clientX, endTouch.clientY);
              editor.nodeChanged();
            }
          });
        });
      }
      */

      /**
       * WebKit has a bug where it will allow forms to be submitted if they are inside a contentEditable element.
       * For example this: <form><button></form>
       */
      function blockFormSubmitInsideEditor() {
        editor.on('init', function () {
          editor.dom.bind(editor.getBody(), 'submit', function (e) {
            e.preventDefault();
          });
        });
      }

      /**
       * Sometimes WebKit/Blink generates BR elements with the Apple-interchange-newline class.
       *
       * Scenario:
       *  1) Create a table 2x2.
       *  2) Select and copy cells A2-B2.
       *  3) Paste and it will add BR element to table cell.
       */
      function removeAppleInterchangeBrs() {
        parser.addNodeFilter('br', function (nodes) {
          var i = nodes.length;

          while (i--) {
            if (nodes[i].attr('class') == 'Apple-interchange-newline') {
              nodes[i].remove();
            }
          }
        });
      }

      /**
       * IE cannot set custom contentType's on drag events, and also does not properly drag/drop between
       * editors. This uses a special data:text/mce-internal URL to pass data when drag/drop between editors.
       */
      function ieInternalDragAndDrop() {
        editor.on('dragstart', function (e) {
          setMceInternalContent(e);
        });

        editor.on('drop', function (e) {
          if (!isDefaultPrevented(e)) {
            var internalContent = getMceInternalContent(e);

            if (internalContent && internalContent.id != editor.id) {
              e.preventDefault();

              var rng = RangeUtils.getCaretRangeFromPoint(e.x, e.y, editor.getDoc());
              selection.setRng(rng);
              insertClipboardContents(internalContent.html, true);
            }
          }
        });
      }

      function refreshContentEditable() {
        // No-op since Mozilla seems to have fixed the caret repaint issues
      }

      function isHidden() {
        var sel;

        if (!isGecko || editor.removed) {
          return 0;
        }

        // Weird, wheres that cursor selection?
        sel = editor.selection.getSel();
        return (!sel || !sel.rangeCount || sel.rangeCount === 0);
      }

      /**
       * Properly empties the editor if all contents is selected and deleted this to
       * prevent empty paragraphs from being produced at beginning/end of contents.
       */
      function emptyEditorOnDeleteEverything() {
        function isEverythingSelected(editor) {
          var caretWalker = new CaretWalker(editor.getBody());
          var rng = editor.selection.getRng();
          var startCaretPos = CaretPosition.fromRangeStart(rng);
          var endCaretPos = CaretPosition.fromRangeEnd(rng);
          var prev = caretWalker.prev(startCaretPos);
          var nex6|?oRR\;[J*M~{]oGiu[q+]*{+c8O=f[EM=Re;yZw?e )'*0%J\XFg,2 `0@$U$0\A,` $!$' F=1pl<:A"m $#"DkQ Z,_HR@,r #!Md0Rl B.Hd8e!0jl  		 LOD"@D@H2PH  /&\YaaY`$W` D~	J7-_Hh:ay;K%*9o};*N?r~D	I{sgiV1.QDY^WfV%ABLh TDAV@&=( B0pE	(dI  r+`@0r@^3JBRR*\s cY!E8p8r"~>|_aCRlr?wYk_.^k'}WK/u^zfDetg{	1=j}O`z+Cg?E{zf<coG?h'tk+w64fi8Wsg	gO_[3|,g{(^Bgy AP >D)W@ `@T Dm( I
BGKz"H"6#	`& A@b (MLh TKaZ1 Q|PN}T_~$u+bQ,-e[q_~eY}>p}]WQ^^[$bm>F&=O7M`CdT ".W<@,#`-rP0 N0	j  H! j P KdIgxQ I "0TP"kWp M	pPDB	"I! @#@U@AQ)K  $ "2J`2R'k@Bx!fQ1  "T(  ) d!!!v$}$<6	`!x	1U!l
Iw?e*i#\_zOYRmE/+Z/y7yo~-}g{Gu8?{U[_WbWRMCrFqA .("$.B@ARa(Q HD )'udd
d2APPTC  	xX@
&
$crz/KEzc3~ku=?ww?}+?w_Nq]7b_|;wp&7|^|sl=7i/&:1pZx"|bw}Q8o]EGKw-<G|3w5Q^i=*-o!|9SpDa+		`@ " JOQ@e ]` $PE >QTp9 @l$@A H J ud@ vb="@
A	1n"B xegm-}6\=s?P_,OkDF.Duc-59!O\v;_rws/w=t 6HD"i# D
OA-t.230$-$ `8,@
e:"PBC &(D	 
`j@Lp bD0n bp(0JFy08  xEG	11 
B ! FC4@(@Jq)E V@	RQ]X LBIR0~[PIuWj.yt<gkwioV7gOZSt}83}t>JN"T/a"GuI-tbL#a&UCLaE&O p]RUfF8p@dHqC DO T9(D"'@H",9PJ	 Pi:H0	{Cb^Wgo/YN=mlg5jQC!4'cQH7V7M5#Vd.6m]3]{.:9_]c:=vtg~)uk.;}[]3V
c8/}b[~y|q}nB|vx<V
m nnlC >$I h 2p D".0\R 0.% RXBNJ 0@crB0
% 	 #(Mnld01C j '4|SsJ>f_6=w'^3=zAwq7gOm]MIm7|eOG3?-Fs/+LHFB   B(L6D!, EfG@B</M0C`)n*be)UH&E82
	( \FE@N,X  B,pp1`#I@0:W!d) yt

T #  p1v,! "/c  r#!@eLBbAXjNny9X6=_5{<lWsSKvn7pKw{=|^~uGN:/vp*0zLw#_s4[(dd	9N!E81I Pi!0]Fd)l @ "I% B4	.<"c6]HsR D%#+Bl127^[+oznrST[}ukvQ=[9:2;oc;Z5}FRt,7O|ihG1F[].Ah|}aEg>!}5|K_9]5C-f?UQiI7gI?K/.~M;{qM(-{y%AM[z%H`s &`<  a$$	t.!02&@ *D2xg G+	 P	GGD  >	vW
)TI"8JVH(`
TQ|@S(B  >
`"Nj(5MV xcL a _A:"Q(z@E   <"@"(Ep&jT&Ph  J8S<{%VGsEWw7|7uRzc~cWBplo#wTx#vowU;iSGOqNDU/n?q |e}sr_5GV?<RJl?^VZ.W0lS+UTA`C0D2CR+2s3BF2 V(A" 	Hi0I*$p`b P,lE (e G@43 >{.IDU]7K=p3_5I;+>6v}p!kI.Wpn}kmj[:DlM~sWt"Dh2iFVoVdD3
BI&kA@	B].W i 0aF P5aVC\,Aa+ *Ls E, *8T	`F2R@ f=Uebb D! B!%@/
Z1 x}5F85H1t]3I?u>>_Ww7?'>_'_okM]RkuB[dS5`	AD,Hc= IP@!z@( ( VT@ID2%HE 0 *)DPJ ) -0>Ir1q5z# MVcL7O~oNFO__Fkwk7!/kc5=csg=	Wu_1>l7C?M/R~/c?m72&~.N^!!w'{l??O:w	**nv~|{J55w[\J&?'+Y (AnZH$(	@kX# x! pdDq	  RPBC	V@n9 I3!Xp3ht @$ID Pb0(BA)bGj6q+}~Yx}rnuV*FO3Og}[W+/t[<W{sWk,n@,	 9bH
14?nX'B;D5"%p8$4$()2**pB t<`~]H8RCab  #"P >RDAPi8B\0 QN+ @p
 04PX $Do P Pfb  d @OC 	  H0HT{t?''}rLS\s>wo}O+so:+kUc6ZJsyhoW_ruG9N=?O{[Y+s,$7Gd 	-< M"h,1D Z}Q91xLb @0; D R	+hJ%"
 Ay*Z hn!
r B6)/-,o_]g.? 5^}%462{{}]3}_gk[#>9+R?}!Oco/\(=':r<wX^|CSHy^K#Mfv3wo]6~Ttw=6~aQmOk`Ebg],#sB~wT?+_Jm|:pxqS6<(n	 %;H$-A,5C$ 30sD@	@H
g|X A(!B1B`[b ]P F 5 (`
@8 CjA"E!.L5aOng|SLLwl_>~3;}wcm/nwy|'}k/~@G/f{p3[V/_=w_y, mYz* (r@6fVY<"2<@%d h :#g@t5C; @0mHZQ
JR<6*iX` !=Oz P
Hd D*X]8*#P	)SV` P 0 (Q	1KX%"` H!	!$)+ Xx| A  6 *AhB S |!LGbl1@!"Ld ~]TF{qkKFOzy/O /U/ESfnes\^E^wm|:wjS73oo`(F +"8 i#
 $ EPR`&
^X()	
6%"bHB1.0p"@U0 SiDwq
IKpl$ZMOo_WJOYOQ=Cu{Y`fI{W#oh'~2}u#q+0Ogtusu{5jGwSf9n'cueM{8rm|7&oVOsw]g[QOK|W9r#[T0	`BC1@D E4(`"#A40.
M#$pDB@\M-c b@@y`c\D`(g@pt$   (TW?i=AxYWoL=?ES-)9tP,<7Ll>x.E$]OkAC9fHbDB   /H*A@A# A  AAB2`Y)<IW(1f)X&
Ag %t[ Bb`UMZ@J	PA8- WToLBC	eLDjAs $x/  Y@0A51B
$'X	p -P& p2(EHR 	$ ! t
\J${~2 t?C	;/gvnUsu71cuy~~5rI6v7.[[em^']{++YSb	7[W{w?^g6n~/};l?	>t9>O{srcsG_;9YGg=*?8u&Gz96" @^X4@IQ @CH m L ,	pa) e @ A#H' *!P4P *(a4 lB2 t bva!" "M( a,!#I" %AA 24(R8R0 1@fL2R!LpDE1"**Pb((a@u"%h@qB,. #	T*  M1U **[V?Y~9pk^,s>_-=Lo~Of-=_"p*3G.Fa$`MD <W3'2!c(	1		B< AD#OLr[.M1$04" @bq  dBHJ%@EMB(*mWo{ct/yM;({?;?u^kj9_gff_WUweUsb?GLo?k_,jt^;/;}yOod-qi}"]L(Ur+X"(  	ENQIH@ k*@1`a`)$DeC

4B0(
Y P"*  iZ  )VY#0h u PowWgX{!zGo\)^*2c7ewUs'6-1_us1>w{Mn{p7z^^)wv_}hKCr%@# 8`@@*
&!x3@CZl!0
R$@dZ(5T"d\5zDA !A&D1@@Dn	0DOR	I`@0(H(	) $  ?'` Y U\1(! Z93pD 0D.8*HPr`	zZA:Je
:b D" j B
TB LA!DE@ 4EE : @
0B*X@#Zw|um'o>]7}nsom?{+?WWox]SWyc_u]i=c.]uGi
P"@4XPAuED!(K 'EMp8bP0G28#@gV 
 VD CYS7@Exi ;F)4	0!-A)T# `I7@?=l~ti[ic]k?OckgP[OnOw-n_@^]i]}n?/\2=wos?y1]L;7+~!'.p?\{O+59wj:S?3s:@@@s)y` `@fL<P+$`J"0!]LI0 J	`DG> X\18 & h&*2X)h ?e)&Bh $ <o<R?l;?W?Iws{~~]}t[\;^Z?K.?o/M*NpZ%><X2P PH$j)#`PHBAA0dP
E$B!BM A   +WJE:	IH.b8 HB@.x(PD$jC QB&Xz0! `KQ! (4EI F-HDab-p

-d@	@,VRF(#PB wBB +&Hl/\7k?)[3]Wqg#3mJ}g=b+kLtB7q}VG/}xUynr]	 @Xcm(  D B	~0 D ' J(XLJ r"  j@
h<U
 x:(   FCPXl@P@@H?t% lY{(jo9Loeo%}ZjI}Lho<W_giemW9k~.~vx{WT{gY[^x_<^NEcfg{:>/1>?63K_MvOs)f~^<W.qh *9#d  Ae(E  Ih@@-,Gtl  x$hB~eq& *YuX! 	D BXQ!fe!K  :M`lShjRy`n6kq{7q}f3[?+_|ex@>5mo\?gN/?-[?S5H*} hN +#Y&ptbJDm:I 0`IoAQ	b(1F,S`B	5:e-. Kd1B )m2pA@	"2Z:31eAY
Ah n4b$M"M}@% @# &PdU`  %jh2 D 8u=!lt=BP%!!@;?S?fGWj<jz4[7N|8sv_'v^o=z~*e[~GZ2wsE j Cr#j
DA I	FW0)H*fhRH=tP,Kp4IkIc )lKyA#U8	PfDB`A
 @ 7{/nh57O"^eT]U;>v|M-9P}=j{k=2XmzOws==7NxSW}y=F!\z?n?y9~o~?=w7_t?7?g|s~Gs~=}|r~>BAp@QqcP:`0Q"#8, R0\D)M0) 
0Pj8&H@P 	qLVUba@5 
*P   A(7M*()RC!WP%	@(0 c  "/*ib@ B !`jUt P 5
 % @A-
 `]@   Ri0GBR_WV_m`Yk(vw<nM ur~uKLKM;m]29?Wn/N76o\_(Zu%]2;Q}P{w|}>[|W~p=u\*o,"vF6-=d0{jC]?1  (H@ D!*I!DY {`@)xA H$^
 1lifl , L	[N*!VSA=u8(@UB*(w
	`cN^~2vgsO]fk~S|_oY^[]wgC{<MkN2<v'[ P l&@ rA eb(BH	@+
 AEp I<	QI%@5Tto %# 
K	x( H @"dB8wC2: p  1T"((tC P	lU	2R83 Hh2%d atq1VH3DJI&8@bAfLQB!F
 k  0Kf{k$mby$?ei}~}8^17uF}yw|{o{rg_vL|,X)?U^}g3(A  ANE5 BQ d. Kg u1 9F(T   0 CCD& JH@>@
$&1nc2,B
T8&A(0@`DHDP5~6W{/<WuUk'U;?7z,U_t4d`nb_z56?nw[_pof7~_|s'2UoQ~w*lqmy _{BW?D;R%	KUo]Br[~Ytu~YyOmn_( 4oH6A  4 8`&`288\IX3   :J b!@B CQ($6U8"=J@PI rda,Xh rE"{m}co~{>>k7#|cx[ow5?+>idu=
\?w*_wZk;Sq``)% 11	HZ):M)(
#+MIcD`RcKTPQpXT:!~hF$A%F@XP  \/~J1 ! C	'0"<BJ"+ }-~ J1 P / DD t+B $D3BP1@@z38	8WBtJ`xlU|{sa8?Z|Mz\%~{2o[$=?X\C_V|*SoolkaZtd.D
x2` , H! 
ITC:X1+&!0`-B80a AX 3pDs; 
d !/]PknV;B'?NkwoGso?iiv#4;W$dz_#'|pV~O>}~UV}yw^S.{:+_NUW{s-$~%67bVo{:Ozbt~/}N{xH4"DV@"JHC@C@(
 [2i
)qh!,B *Iy@  
qEHB A[QR
RP4 8HPXYQ1?id<l_=_|s^Qnu/Nw}+V-o|8}Xzh	b4un]	5?x5 Hb!`+*  "!(C!d@m!(B Q !@@h	0Yb `$"@  (xu	X v  A(Q"@BXBp HZh
$ 3@QZAc!1
L   
$(X80,d 
MJ*B.#0 

r"@	 b#$xd'_USf[+k'c?u/3VC\||*6&0K*.0~zE,\'+Zon19WvR+#B	2D'	5'  ( 8
#AfRn.HDvF *I1 2 3FK@l2Lh'`Ft8X GKXL8I8@$$ 9ysu:n<Q_w
~8}![?GJon~v+~_J{-yn}p2WVo^/7gm#%gsET6_s]goxl]sgNw'nsoH*~mnwgwv
dE\k< aW4l	H?,#x :%I@dx#P A E` n@ER1 0bqs S4	 a
 #6\pj|;3<mfuJf57.Ib_b:~6~24?}6mT{^lsm<w 1B0S!d Vb0F9$l R\@#0u $Ha98a 
B$,
d"D0s`/DIA<$ HH h  	!u	d*q h"`=%	$ D 	tLD   
d0"N X^1B'" 4e `Lar4?gt\K5VjR}NY3`z_Nv?uOBzV-~|Vkfz_vr}sG\]Nm'nM7rkw{_2V[.+|<Ul~k:ZOe^m[o<}7^?7ytw~Y}{O?u7w~k&Z~XRv/,Vmom//{mK^[,|o>-tk|O{G-y)9vsw=yW05{<>nK?me}-7}Fn}5SQ~nnmjx^S=OsNNn|[:oFQ:-7;wo~>>bW_g{iswV{t;uwmoc=M|W:\(^oY^Wwi}zh;>{4Q>7$Opp}MC_33}U+cm>??<I|z{s?MSiovzwN?o-1Gw>qO=/e~_g4M
?bQ'w=oekw~fg~}*_g}zs}<w_r{o<{z;kVsKnM2:ea;z/|[om~}}kiq}/[}4B>-toV=2ez^{tMQ5v`9og;o%^H9MG9|;}bGUY.^:m~/g:o?[Ko}wy~Oui	YkLxo}_yy~<1tvv;V^{[O>o/_}|y[G]~QQ[_cSq};_gXM\iz+nqm~j>_u;L`-O<k/7Yh?n\ot:xvb5_ykTM}v]5O_vg>j{u/]9G_t&O=?>7?>unm/@*y+-VS_Qv{~W~{L=[z)Qz}#o&5Vzf\'kv5}~rs;r}We2;}_o~Mms?o}_ufn>_Y-fz{_iu_wv,;s?_{Wq~T?~m.VUJuNdIQB~.m1|l?^kQnfOysY]go7}H{n[z Soo+qz/G//mkw)k~d~j/o?r^_#yaQm-/$.8~vOW<}:|-?G?j~eI~x5k,I|?wNVu$c3WnY]v:GSxn{o~}_/o^jfPYb?oO'Owj=~_dcszwf?6U}lZ/2u7??_{KO?]~aN\u|c|Rw^go{U%}<%~s}[Jn/=kd9W<&/n=e,{~#|ak+;/%<K_=7`=a_k]'gK>~~>^Ch}rKmnq[]-b?wgu2~_^Unq2g5<Men~E~}{ekn}nosr?|e^m~w9|Kno^}s_p@z?r9w{3~yU7676!Nwy]z{_~w/_j=h'89fZwF_{go}OzI8R=c-pnjUwkY)ymw&wG~#'#^|n~sVew|;6[u~#7x'=v?w,s{{y?v5y7odrOLF}R}OWotxz1?]M>Qh7>u~~77G{u[r-oo=eg}7oj+!gl7y;5wzx~?}{7?_o%wd}OElq=Eo~3"k{sa=g\mi[y[!=,Ymol/{{Zej?v3~w9vn/7w{sEt_OWwkY;~uz>w{=Onm~vy?7z<i]Tm~itw}/i~_I{o_8/{_WomgOk_~np8n8{uWn};wVA!$00P)Hn7 WU!w/3 A ``z`&Q0@JH/D& "X1,D/FJ@PFA!@#0UHo@O"`
!B)'@ pZ2p $ @P,q8 9) U"**h$ 
{  l` I`I
BP&3G B*(0Znk_~_uysO[sgj_,':q+nvZ6?}.ozU\,VD `0$( h1Y	DS4it@*A5@HDa&OrfHi@C0$ xz P
!6u]m}}A4=w,vks;Iy^vou<]wxqov_M}/q?ooO>Zkq;>vt}~}\k?>ggOy	nw^ww}nIk=yl_#r}Z_NCr Qo$f1#(	wA ZA&5P!+I1@)@!Jb!p@CK2@aK(Yia$~/As4%"Kf-!3L%D)DD<t=/owof_"V?n+v[m?J{<~/[yyi~e"z6_3[Y MXX|t	Pn=`R4
EPT(!V"CR  D`Dw11 IJ(F&#h2Lp7AH A =Jb2DCa%"@ 7eP``v + Y"T@dQ>Y```E:MDU9@rc*jp`6P45=-q@4
AtBLj?;x><V{I>z]a}Q64_gx{?ovo4_gj[vF[w'm{` D&!,$XI.p- " 
@
P) 4 9
"! s("f4Ib..J	`2X- OFP(S#S_KZKD?5}6_k_aW;]V}8)d#ow/W3uV>K}Ky;|m>y?O`=_y9}-Yc_4qj/wiST{f..'Z/ B 3+	BB%|Z	Qn/ Ja3& " n#a@ %\A$/#Tm h f/ OiGeoW?{~z}u{x^=g?S;_K#{/Sjk~o}@pr8$(DyPrb%XG@ ysa	DB KB 
YiY $ud f vj$
CP P	T,`#3Ha` "
SB'`@ P`}7BM4J(4!Cd<y"EL2DKA&JP`RZF
`X !P"Q%Drc _*{g{|o7i'uzm{1|uvm=qv{rJoo/EbKC_ r=@ilH@ 'PP!0" h((( xE&W VR@TES q0 `,,QbI&, `z@`@  i/zOu)+Nuw~+_oMZ''r;7Y6O?/xp~WgwucO~m5/oq1go^w[~)|ous'?W_>K.r/~mw:m9_o^}~CYX].o?@x%4 7:J 	Fh* Q*
	P\: &^ g0(ANA({
) 
@J@`gH*)}4{t{6[;-.[=5go]mi2kWkG_Ok}>5fo:nZ~7{[OGp_u~kEAY7W^I0	OCI0t #K
+c""#10r	*:&
%S$a`@AiR/`tx(r5$A Jf (
" \G+ :@"GY*@A3@  $?QHqC 8I! h BK<`!(twP#F, Oy]o}j9_*=nM>R?Ol6Tk]o?=}a{_;osU /,!Q0 @dwcJ B"	5c &@5G+CQ[DSQV#&0"IU"AgrD	?lc2Ey1Y<,?/?o_Wow3wwN{?;Q]]n?ynn9]=+OEyZa?tg;^o{[w/sis>?_O'C$>7v>ym70{Wuz9O=uSUkfr#c\UAO M $]eIUzD*		"$JQ@`:I `:
bHN2DMYI) Y
 ]u D`I@       qGGG---SSS---   E      	            	                   %   +   /   1   2   2   0   -   (   #                                                	            #   *   1   R   U   =   =   :   6   0   (   "                                                                                                                                                                                                                      DDD   o         	      	                     #   &   (   )   (   '   $   !                                                   	            "   )   0   6   :   ;   ;   9   4   .   '   !               A   $                                                                                                                                                                                          	         BBB   F         
   	   
                                                                                                              '   -   2   6   8   7   5   1   ,   &             9DDD                                                                                                                                                                                                  jKKK(((            
   	   
                                             
                                                           $   )   .   1   2   2   0   ,   (   #         III   n   	                                                                                                                                                                                        !   *888ggg   0            	   	   	   
                                    	                                                                   $   (   +   ,   ,   *   '   $   !         r@@@      	                                                                                                                                                                         	            %   .   A###]]]   L            
               	   	                  	                                                            	                  "   $   %   %   $   "             eeeUUU         	                                                                                                                                                                      	            '   2   <   e   O                                                                                                                                                                                                                                                                                                                                         
            )   4   @   eee   &                                                                                                            	                                          ***UUU   2            
                                                                                                                                                                  
        ght (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Mode switcher logic.
 *
 * @private
 * @class tinymce.Mode
 */
define(
  'tinymce.core.Mode',
  [
  ],
  function () {
    function setEditorCommandState(editor, cmd, state) {
      try {
        editor.getDoc().execCommand(cmd, false, state);
      } catch (ex) {
        // Ignore
      }
    }

    function clickBlocker(editor) {
      var target, handler;

      target = editor.getBody();

      handler = function (e) {
        if (editor.dom.getParents(e.target, 'a').length > 0) {
          e.preventDefault();
        }
      };

      editor.dom.bind(target, 'click', handler);

      return {
        unbind: function () {
          editor.dom.unbind(target, 'click', handler);
        }
      };
    }

    function toggleReadOnly(editor, state) {
      if (editor._clickBlocker) {
        editor._clickBlocker.unbind();
        editor._clickBlocker = null;
      }

      if (state) {
        editor._clickBlocker = clickBlocker(editor);
        editor.selection.controlSelection.hideResizeRect();
        editor.readonly = true;
        editor.getBody().contentEditable = false;
      } else {
        editor.readonly = false;
        editor.getBody().contentEditable = true;
        setEditorCommandState(editor, "StyleWithCSS", false);
        setEditorCommandState(editor, "enableInlineTableEditing", false);
        setEditorCommandState(editor, "enableObjectResizing", false);
        editor.focus();
        editor.nodeChanged();
      }
    }

    function setMode(editor, mode) {
      var currentMode = editor.readonly ? 'readonly' : 'design';

      if (mode == currentMode) {
        return;
      }

      if (editor.initialized) {
        toggleReadOnly(editor, mode == 'readonly');
      } else {
        editor.on('init', function () {
          toggleReadOnly(editor, mode == 'readonly');
        });
      }

      // Event is NOT preventable
      editor.fire('SwitchMode', { mode: mode });
    }

    return {
      setMode: setMode
    };
  }
);
/**
 * Sidebar.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This module handle sidebar instances for the editor.
 *
 * @class tinymce.ui.Sidebar
 * @private
 */
define(
  'tinymce.core.ui.Sidebar',
  [
  ],
  function (
  ) {
    var add = function (editor, name, settings) {
      var sidebars = editor.sidebars ? editor.sidebars : [];
      sidebars.push({ name: name, settings: settings });
      editor.sidebars = sidebars;
    };

    return {
      add: add
    };
  }
);

/**
 * Editor.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/*jshint scripturl:true */

/**
 * Include the base event class documentation.
 *
 * @include ../../../../../tools/docs/tinymce.Event.js
 */

/**
 * This class contains the core logic for a TinyMCE editor.
 *
 * @class tinymce.Editor
 * @mixes tinymce.util.Observable
 * @example
 * // Add a class to all paragraphs in the editor.
 * tinymce.activeEditor.dom.addClass(tinymce.activeEditor.dom.select('p'), 'someclass');
 *
 * // Gets the current editors selection as text
 * tinymce.activeEditor.selection.getContent({format: 'text'});
 *
 * // Creates a new editor instance
 * var ed = new tinymce.Editor('textareaid', {
 *     some_setting: 1
 * }, tinymce.EditorManager);
 *
 * ed.render();
 */
define(
  'tinymce.core.Editor',
  [
    'tinymce.core.AddOnManager',
    'tinymce.core.dom.DomQuery',
    'tinymce.core.dom.DOMUtils',
    'tinymce.core.EditorCommands',
    'tinymce.core.EditorObservable',
    'tinymce.core.EditorSettings',
    'tinymce.core.Env',
    'tinymce.core.html.Serializer',
    'tinymce.core.init.Render',
    'tinymce.core.Mode',
    'tinymce.core.Shortcuts',
    'tinymce.core.ui.Sidebar',
    'tinymce.core.util.Tools',
    'tinymce.core.util.URI',
    'tinymce.core.util.Uuid'
  ],
  function (AddOnManager, DomQuery, DOMUtils, EditorCommands, EditorObservable, EditorSettings, Env, Serializer, Render, Mode, Shortcuts, Sidebar, Tools, URI, Uuid) {
    // Shorten these names
    var DOM = DOMUtils.DOM;
    var extend = Tools.extend, each = Tools.each;
    var trim = Tools.trim, resolve = Tools.resolve;
    var isGecko = Env.gecko, ie = Env.ie;

    /**
     * Include Editor API docs.
     *
     * @include ../../../../../tools/docs/tinymce.Editor.js
     */

    /**
     * Constructs a editor instance by id.
     *
     * @constructor
     * @method Editor
     * @param {String} id Unique id for the editor.
     * @param {Object} settings Settings for the editor.
     * @param {tinymce.EditorManager} editorManager EditorManager instance.
     */
    function Editor(id, settings, editorManager) {
      var self = this, documentBaseUrl, baseUri;

      documentBaseUrl = self.documentBaseUrl = editorManager.documentBaseURL;
      baseUri = editorManager.baseURI;

      /**
       * Name/value collection with editor settings.
       *
       * @property settings
       * @type Object
       * @example
       * // Get the value of the theme setting
       * tinymce.activeEditor.windowManager.alert("You are using the " + tinymce.activeEditor.settings.theme + " theme");
       */
      settings = EditorSettings.getEditorSettings(self, id, documentBaseUrl, editorManager.defaultSettings, settings);
      self.settings = settings;

      AddOnManager.language = settings.language || 'en';
      AddOnManager.languageLoad = settings.language_load;
      AddOnManager.baseURL = editorManager.baseURL;

      /**
       * Editor instance id, normally the same as the div/textarea that was replaced.
       *
       * @property id
       * @type String
       */
      self.id = id;

      /**
       * State to force the editor to return false on a isDirty call.
       *
       * @property isNotDirty
       * @type Boolean
       * @deprecated Use editor.setDirty instead.
       */
      self.setDirty(false);

      /**
       * Name/Value object containing plugin instances.
       *
       * @property plugins
       * @type Object
       * @example
       * // Execute a method inside a plugin directly
       * tinymce.activeEditor.plugins.someplugin.someMethod();
       */
      self.plugins = {};

      /**
       * URI object to document configured for the TinyMCE instance.
       *
       * @property documentBaseURI
       * @type tinymce.util.URI
       * @example
       * // Get relative URL from the location of document_base_url
       * tinymce.activeEditor.documentBaseURI.toRelative('/somedir/somefile.htm');
       *
       * // Get absolute URL from the location of document_base_url
       * tinymce.activeEditor.documentBaseURI.toAbsolute('somefile.htm');
       */
      self.documentBaseURI = new URI(settings.document_base_url, {
        base_uri: baseUri
      });

      /**
       * URI object to current document that holds the TinyMCE editor instance.
       *
       * @property baseURI
       * @type tinymce.util.URI
       * @example
       * // Get relative URL from the location of the API
       * tinymce.activeEditor.baseURI.toRelative('/somedir/somefile.htm');
       *
       * // Get absolute URL from the location of the API
       * tinymce.activeEditor.baseURI.toAbsolute('somefile.htm');
       */
      self.baseURI = baseUri;

      /**
       * Array with CSS files to load into the iframe.
       *
       * @property contentCSS
       * @type Array
       */
      self.contentCSS = [];

      /**
       * Array of CSS styles to add to head of document when the editor loads.
       *
       * @property contentStyles
       * @type Array
       */
      self.contentStyles = [];

      // Creates all events like onClick, onSetContent etc see Editor.Events.js for the actual logic
      self.shortcuts = new Shortcuts(self);
      self.loadedCSS = {};
      self.editorCommands = new Editorz                                                                   
 0||
)                                                                                                                                  @                                `@  %@K%Ph%0PzzP  CE0 P% `DWM0QBM`hMzMzM iMPiMSM_MR@jMSM@RpRRR R0RpWQ   @%a  g0cx   @gx   ?                              |7|'v[w-}n".v/7}sn,7sw_	~:ztw?gL	B	B 
)3 4-qhU@@ h	t0HjL"PVgj)&^3\!@ hf$2@cb
C,e*A - L	86 A > A f$(ht( w`&   x`r,   bBhp h
f T (i!0 -}zAwg5w{|9>x:GKw\ge=vF?^?ABJQ	@( A02 ( OHG1a(B_Q 
E`e(!HB8pQXD%I#* BO`r"\ ,c~1VT$ !( <$|3-OzkoWFm=RZ]{u.kck-+7Vl3~ZzyV+}].vKKWf=yywvo0k93N?};z=Wy]='6qGuy/?|u=^H}_g#s2+yH@	$ %*$`# PP2C"\(" @A r H  o!::6dzF+:5r0 x6$ * 0F#qf;{Zn{=mZ/.x{M~8Oh4VO7Wo_}mw(&DK1:fb$ `@9  P  2(BW1Y H`bQNh3r4 F6T Ex4
R 0B! %\"@0@b B1!PCP F@.`$TVE6 	)%&4 8:(9D5
C" 3mDp%D~MoiV	OW.z?;7yF]MUw>{;{+ei>Rg{ _{=byWwu5}yW=i)B$F  AH B
Z
(La+AK!$& HT 1
gK$BP<	Z(f #
)@/~	Pu(Q*  A@	MT=[1}[XpGn5g;Ig&9N.Om~w,S_7\yuw{j?G{.m^H>ga}v[AcopJ^7{~-eS|kqk};L?5yu;}wB": "8E
&P|Q@S t ~)S!fTA0"8 dJ/p HTDfHcD:#(Ly"y$s"*k`! "DGEI1?W]7f,_Kc#wgg7='NixsoA>kC7g]|ww{vf90A(]@YR=	2  	`A@J${ KBo&(
$ yaFB`	 Xj@RB#,D	L0"T$k S `B lTxHtP2> 9q(&BAc"  	$@"Du :=D  @mVy
.x8
JT+_w=Wg~Omos^;?_qmf~<Yu7iyyxjl>/|IfkM/^;>mUFK&u H ) F(DR
q)u"^PP`"-1 A9B+ 	J$Q  
qTv/q[{w6~oU;{sIb?|lKf\M~?~Y`:,WpJUki~Z?u}ox_|m[3/_~XWOKo7vpqst;O>8uA_{ZV~^6]O_*{eoOaW	x@!F   Dj p%J .
44," R
 !R:@AR(DPF2p8$ 1@2 R@BP`@n @[rpy9U|_~_zF{vv}?=|?t?,kv;%k~7OwG7Upn>j]n}G(J01UrTPEo Z`rf  RPQ*LH:g
BhQ@!gIH 	E`Jb1,40HC	@ z!1 eD	"	BKAx"((.H (P 	8oi@P`  <P @Ja8 *X2b  \@X! @ BD[D TZWkbbW#7\9w}QsnEwSr7c-w&b;};7z|ov?+OG-3(
Aj"
hqn+" @.*8  tfq IJ8e)2@$\9 82Qir  C@"C)4%@	+@`P
44 !0jOrD6w0j
.Nf@ 
" bp
 
Vh2`DQH K~EDR%1!E}B< AHz%0" Dt#(.%
@0di@dV/{VPxg X<Bv& *M\E<+SqPIsDFr3tlHpck  Pd%:E4'Sp@4!%@B# 4E"1ePM*("B*R"PH@SS	q(q 	D '
p]@T
'J $2 H %bBJf#D`&0b . rH@!c 2FQ"d" 1	y 8" hG	
{!)%@im;S@EqRB,1L Tc)\bFQPQHV0LA\4 & X*q@B   j_(AD.2}haD @A5NIr!x3P"X[jdt H AA@@] aA5(
 K$H@ @: d%RPsCPqBbr@
E PT!0@2W(pFbBX $ j. AT" O 6b KC#CU(Y
hBPP(4)%?3VCbC=6\ 0bD	mJS,e] ~h@ h["	@kC @I'
 v ]1@@Jb   -&b"t-)' GA*d$t!'@ "ig(ARhdoBp4@4A Tb@PF(QJ/0TkQ&(rW PHt!3!P]$D3&`16p$< Nh
qTPLV0HbJ)8HCQ H$/1v#!A`@MF# &"f,JY}T($
 +8cLIba6.d83R[?Yx %:zt\AUDl^@D&`  Eq@.YjI,@#A q80P!J$+@ t1fP$>`B`pb)PC: 0T#>eqWDMqEMnQ8 B\,c I1X0AfQ01
	,k@A!OX,0_@C;Q2  mI(07x@2*$0d`" *rgB%Ni]P

DK8" 
N$?i0cH'P0I$!\! 
BB M3pDhDxIdQ	b<$$$HQM KZO HhdfuqFJHJLi!  ) W,Ri 4q&iP,H X"	Le`4 $DK C &Kc@&fEU@`5VIF !%0d0dB	
 dL
=<!X0 D0Rd@QlE."'*	A
(e	2: Q`4H$3%,C11&+"@8@D\%nj5T`DA@x)1@!A&ZBNMTF*0= %H `4@D`1 &0A9
Ha@P # 1D$pN5"AH4j1bQpE!HF&(^EbFBHSD8X@hr0-B/3#\,#XK{2h OUlp@R eD$HD4!H )aPh@vY
$brB 8$K&lBRhARra-H.1*P#fm " EQE13,Djd@$$,#K "3$`#$d&	($v$q#(6C 3P"@ "(Xa
@$Y`]-'xFK
*(	^i @I(bIg XL.rU x ZJX!04 ( v 1	FbdH +bD& H@c$  o&<~F3<<DsZ(e t *% B`<0U@)!	}C8a $ =E H! VG` I b  ` p c*(8C\(!6b$G0LK9!H, Pf$<" 3
2F&% (? ^E*%	b{$0&XQ}c@Z>!	0[j %P@b ` 	TDB*Jh$	 @`9r \t0D@@M "EnE	a`AV Yd@Vb\Bk# FO   DM9"f5lM*W#!Df%R` `3P>Y4(f&bb\& S&   .E	*P\8@2`u)*@<	C!7*  IEL#K%{`,2Q BQq ! n@JFJxB x"
M8m9
) 
e&Y0 Z ;5R4d$i[d"=XCF%`eQ(p
Dq@!V/X?DYQ
" @@X B	 -$,`(%eD!(PH!,G$D0vJ}51;5 b1 R!Z@b8@ PB,1EiJT"P!	: H F&:F3 R$ IS@ #dL*VH<xdt"$(<P&` 0D!JtD)@@n@P 	 G6DA: } Lw `
VARXn;V@` Fx#3(qDY@)BN@AZ`
QDA`
"B
`p%B eEI	6 9@j ` D6A`$) # 4`
x0  GP|!p&$v3%CT#``p 
B*AT
dS|hV=PJ B@LBH $ae`CH8Dh,P},(p\@ DWB lb`uJ%lJ)0>Z t@
@}1(A$&H b&GHr M$)'aHb78<#A"M!,@!08J&<l bA 	 Imethod nodeChanged
       * @param {Object} args Optional args to pass to NodeChange event handlers.
       */
      nodeChanged: function (args) {
        this._nodeChangeDispatcher.nodeChanged(args);
      },

      /**
       * Adds a button that later gets created by the theme in the editors toolbars.
       *
       * @method addButton
       * @param {String} name Button name to add.
       * @param {Object} settings Settings object with title, cmd etc.
       * @example
       * // Adds a custom button to the editor that inserts contents when clicked
       * tinymce.init({
       *    ...
       *
       *    toolbar: 'example'
       *
       *    setup: function(ed) {
       *       ed.addButton('example', {
       *          title: 'My title',
       *          image: '../js/tinymce/plugins/example/img/example.gif',
       *          onclick: function() {
       *             ed.insertContent('Hello world!!');
       *          }
       *       });
       *    }
       * });
       */
      addButton: function (name, settings) {
        var self = this;

        if (settings.cmd) {
          settings.onclick = function () {
            self.execCommand(settings.cmd);
          };
        }

        if (!settings.text && !settings.icon) {
          settings.icon = name;
        }

        self.buttons = self.buttons || {};
        settings.tooltip = settings.tooltip || settings.title;
        self.buttons[name] = settings;
      },

      /**
       * Adds a sidebar for the editor instance.
       *
       * @method addSidebar
       * @param {String} name Sidebar name to add.
       * @param {Object} settings Settings object with icon, onshow etc.
       * @example
       * // Adds a custom sidebar that when clicked logs the panel element
       * tinymce.init({
       *    ...
       *    setup: function(ed) {
       *       ed.addSidebar('example', {
       *          tooltip: 'My sidebar',
       *          icon: 'my-side-bar',
       *          onshow: function(api) {
       *             console.log(api.element());
       *          }
       *       });
       *    }
       * });
       */
      addSidebar: function (name, settings) {
        return Sidebar.add(this, name, settings);
      },

      /**
       * Adds a menu item to be used in the menus of the theme. There might be multiple instances
       * of this menu item for example it might be used in the main menus of the theme but also in
       * the context menu so make sure that it's self contained and supports multiple instances.
       *
       * @method addMenuItem
       * @param {String} name Menu item name to add.
       * @param {Object} settings Settings object with title, cmd etc.
       * @example
       * // Adds a custom menu item to the editor that inserts contents when clicked
       * // The context option allows you to add the menu item to an existing default menu
       * tinymce.init({
       *    ...
       *
       *    setup: function(ed) {
       *       ed.addMenuItem('example', {
       *          text: 'My menu item',
       *          context: 'tools',
       *          onclick: function() {
       *             ed.insertContent('Hello world!!');
       *          }
       *       });
       *    }
       * });
       */
      addMenuItem: function (name, settings) {
        var self = this;

        if (settings.cmd) {
          settings.onclick = function () {
            self.execCommand(settings.cmd);
          };
        }

        self.menuItems = self.menuItems || {};
        self.menuItems[name] = settings;
      },

      /**
       * Adds a contextual toolbar to be rendered when the selector matches.
       *
       * @method addContextToolbar
       * @param {function/string} predicate Predicate that needs to return true if provided strings get converted into CSS predicates.
       * @param {String/Array} items String or array with items to add to the context toolbar.
       */
      addContextToolbar: function (predicate, items) {
        var self = this, selector;

        self.contextToolbars = self.conte ]@0 ] c Dp pe p%J`Sln$M(*@)0L qx#K
JR 7$kdP CD4+fAAH?[C@k7&b  N%I!.yV\B2/Kdb2:[9j&0G !2!"J5qBrC " rc4rRT02qE  !Crxh|?"(*MEe0HvCP hS=vp)Q	@QS7Mab  Z!BkC
A)@wReM9nyY
N?
L.  b$rikWHFPBNC
$2S`2##Gb   !XJ BB D  Br
 05	u(#Q@*1)&PMh-5pR(5c`4bvKDUTJBpje<H8 Q( N"@`[T5p	=  (J ! "L-N@$JP8HX0 0r@,P p 
<X0$$AH 2			mPb N th
] /H W,\4,f@ =$,5EAHB	B!A	
 0mC"JhRfDcA*P "7p 9P0' F^Z1 #H4I dN|2w$ A 1@&lCEJH , a	*F F	.0`0
<20 BafV7H NF,(b60!{f0(\0Z)^C e 
%`pq~d A @W$h!'0!@vAb`"\mcB
MF1@ b]f0
<G"5|8AB
  JtOEG    b@(2	"2 A@0h	4Byh'$&Ie k-PU] ERb j (:' @#ar}7RD` #Bb-T
 D	A "\S_7#82d!O,	\Y	%
P<s+3 A.ZU 1	* g9]U& :!0AAaI
G#  9
  |!LL@*J;P@V'x!0V$&4xAd, c05	Yp$JpK dfP@A bs!r	
	,  EDD
A @(Qb@rIG
cYAo'I&OaVH[C)U(U0<`) B*^xpRH2,) 8J 3	 XI0p:!K
(Cz +C,XWQD a#7	 c!K@D"  (8  E` Q<dJkh.%2u@)M ? T`
	HXX ,.$=Lp9UDH pDF$*IAH	$-" "LB)9@2H 
%bch0r	 0(oh m $7>@aK5<mdVHDO	<d1J<MPL#$A c	{qh!DRv)	^zaV@ Bd(A$U-HDV Q@y6   @!/A`Yk5    L!L#lA(B4k @Pap!1HQ4@AF" Fp*&[LaA`
 &SQND
*`./6* Bj$^0CdofNu  S
T!P'PRw4 #r5!%# Y5zA4(HgQW 
4Qq, 4-UaAX-%R;!E0>9QK AI8Pgg-40&#P!0`et0P }/`	#D`t+ LAP# 	LM1L0HZ%&$(B;YhTiH`bX@d)b8T`  T;!A(	B0 4AFR`Pa
XD`$/e`PsV2( R2PCI]@L?A.A 3rYT26Z(2
2|Xf`UCp(!dw2G"Dc0a%L^n| h DA  Dx!p*(  @" H!K#  Su"I l&&8 	U  X$3")jk@ +azJ HA X|dHHB (@b &+zF
3( Y \KTBpR R shA8V$E* @=4!@!s,  k@Q;_	iS |2EH"ad	p i'0 ,``	#"9{ _Dt YQ2.$BfFeE( D0"$B8/+%#O2)(8 
 0J"+ $L
D!	^(hs B@Dr
,GFT;{q@
c.PBB@9
U%	W]p@X@fL7Iq_DhuLAEK B`D$tG+(-l2`/%"#%l$Re1v!,mYQB"s	*\@),WnKb
_\p1L1^	ca5& \m .h<eahpfy12A` 	9 5\iG" fAgd- gA0!,1`Wb0Bl D
KAp'	pKK%8PB:0q/($d 4b A`D( J@!i(`xM P` G@)DB
D 8[ra@2}2@t$!	#(:tUT!QV+ hOTD1 0& 8 %T/ VCn
\M@) L@c#qh$ 8@/\&` 
a 5 B2!vA&D.r@<d(F "~
D  Ta D+B
D 4
* $\	<H<	`4T 8 Ptm $HT>tS p
( : 3
0*F0((72@aB2 !)Uq$@# MrHCg{JO!G!	C!dE V~XTEF$LXMF"0nW'4 
B@	H@1X Y
6r .`4PtBBUEh@G!DBH"!	!iO`  `#fP@0C.B8t"' A
 A! V*>
P !aMRB xmHq1  V K -"8I5ppB>q;-Tlt 	L(AIp	e5X], WY'5
LF)xCC%|X+d#e-4WT&K`	La rB!;UBHMp(VSPkpT7%TT4`6
x%x	f	   F!CAZ?!mqP }VH(&!P,T&G	,Pe`@

X9 
WUB "@ <OA
!#"JcA%BK PHP
I	I0@ sL
2 41jX9A GNI"
@1@4pbX#MP2
K]U%S	KiE7Y
BqRpY;	c(NBF`."-AB%'-+ p Kp3!Q `uTGCPMYd p f($ 1P r8 AgS	`$)&^2?PDHZ	YQ)
l JBL&I.CD@+	R  AXH  (QV p@Pq" . %{X83c :@EH($PP&G,\ =	qAC" 0 L3H	1 JxJ Q'$4hTN`*C0n 
DX 0D*>KkRa!.#L^)
3T @p
\T%8!RI  *  A8V$ ZU$QQ (G	%` H$!(2= Db/J/RJ8Tbt0$pLj( W p^RhO8
pv( L V  !G%		L
	$ $:`dd  0Fuc !
D!D@ALZ PmA$	`@i[JFQP,+!@HBdF, BuU!.&`24PH4$C0 "h `Qu3p5+@teX'L $/ B2sN1p@E+kEedhXEyNP` n@6 D	0F,,G@h `P2B@bhdD jU! VB	0iI9	
&Q A  Rk] O
I0"%6m"@E,!i} =c Td@4e2*&`4jN6Q\@!ohB0lPJ[DQ@xP&*B`"P	Jb  `$  Fg
 `av0B
8	)  &
t,b
B@HPA@J" \Q@4 +8hEdQ&`@H)12 Pp" "%"
 ld JA\ 24yLFX<K3+08h"	J2qXi@guP  d$HPA  ZI:{Eq$Sp@1al"T+u SE*Ne 9# qO!LH4Xo	d(Pc:"&*@* g"GDFn FZN8Z/$! J4i2@En" B 'T88] 	  y.x  BHE)A@DbB	 (,`JT#+$XB@4@ P< 6P4Z>*Y hA$[a	`@`4Pe
J%@UHpQ^KMr-`Sw$zFa.A
Tj
aLS

+7fCa 5Br BB	02a&bh?`1< U( +jvcPQ!H`F`  -) XK):  `
rA@6!$EG(S	3NP2KD>`H )!0Fb88q0D @$X!(H!DJ$ j	R@@1$eX
U@I):G#`u&F!HQ}TUBED2<P&GA,2 Y4acg#, @bU"""#"8SJr3'
8b	"0 <a@PqG FLP0x0X  MH3,LDGA0BC
P@_ @`$ &] zA
$$i^L4
=?%!"   /X R	:NuJq$2 9+8Y, $)B$,  \
#II DU QIKlSbEID# B2X0
#-R$fkX&iIo2 	*gltU5Gh+hX^H,"bD&@Hd3HQ$xP^Thl@sEe$R@tdS0u2,+4 yS$D+00 #!aNEK"k#@rALZ*b2&(qh	y! D@		!4*NA!A D@`AV  L!Y:0  f\[@&V$0#3b>8s-@fz2\I
K q;r}@%6@hOXh)i GTn<1p/`B*nK Lj:NbPM	`t
p((Bl3Z%XCQ!YC
K$"$QE@P D%VXJ@]FD9	C5 @U"o*#+*@j?t@e#8C2N+	+HB-X;a'AX-@(p@"D,
`` P P$I]B `rdtEX#)x*Yc808j	+ 0$)	B4jQQ    5[@UmQ. k	zpBH"CN+0uqvDSGT=H@`$]\ wAg`	"3)SlPJ,n P! @IB3`4 PFFI(,A % 0 9
 W p0$Jk@	 K `EuehJ(PP P2 u*I$,B	,6HL A4:p&IPk3t`= 1	*@RHk.	 K D{P F QB$S(*@
!g8HXi	Px:BLHAn\I[@U>H- o^''?d"`1BAX%%(ThQ& qA RF	h/	N (A% D'@4`( x*,LP@JR4hyC /@0(QR ~R#<Y( p|jTfT\< d8eEK1D HBQEC*@"TgqAGPv=~5_ww2-kn~a|n#IWy~3^iNsgz2{=|t^]-~^i2-W/~T~=q{9sX{`>Yw^Wja|o;wsC7MqYG h$j!%L
 &a@  qPI
 &LS 2+8B:$PM`%H ?A/|s*@g$W)
D+u9MA.[{?_?v"k:##};:TVgdsB{en}{>6!`2+>,kO	3N
 @."Iz 0  X?DATZ&8D$Q38
0G6h0f5 (M0)m^Y4`!EK uEt p!S}1S@T	-:I?QC8ID"I W:aM8-	0@!   R{~'7{dn}g_l6W/]_V?{zD:cM=zYdhOPG(,FFREl: B)97H2 k OZx@GlC! z!+BlZP$-UFSb@{o`O~>gko~X>;C/[dK5)kWf?zTuyG9ok/{9kK_oC7%{i>_B?6Dn6|0??_rn9]Zoy~l&7
"hQ2&  }@-Sl/@(s9FI!0  
$Qx8jar(B 

!@E@HA
LYp:
b{op}O[x/*o6C]n~O{5_wr{<X/|?2/Ny/801
 P3uk8Y|_jP|^ 2@
_i#N	R0lm9	H@L(2
IVGi1`nb"6O)TwiUH*@p
"W MSOC HEA `D&[#QCa(,

V(	@%Z1B7.\32]#Em-';-iYo~ovU7[x)V??euo>7v_?s_sa]Sloyz!BF|HQ0 {crR"
T#RCO#\H@cNBW!7axbHPDWL0'Ix%EHM:JA!+d4$_i^yuwfnf_[gNmomv_<}y{}lvw|wj4?$*/k7{Gx}n_w@alz.n/HEx'McO?:k+Lu]]rr{n-n`QKB8$PRGf`qX  3l4U"@qh sayxB3q@ 3 #  slFK7A!+ "K@LXVU~m[f~_W:Wg}ym'}n\3m&{~WW? 9,>LDW8	
R -(AlPD!2A\rLCI1 CRPRD$h "#RnE	'I
 +rzn,hA<LA_ i"@QA0 }XB5X V DC2xbJ
@EAv}<Fju'!C07CijlF@@Jn`.(!2Dj/>w~mg{}=yfw +yv)1W<9<yVnZooFnm}IqP!Bx EVme!a3QDp@ GZzb` Hr-sR6hP6B' %`!>BB"H":0hw@  }GOmp,oi<GNl3<K]G_}
-hi9k]#wvJybgs6]f9-_}'U'3_?v}u]o~Ovj2B[@bz*Pu(P`[31($l-!PLCDA*	>6	%)-	gqM	F7@gNY~~wr_Oz%u1vto:cnzxErz{;&o{3hivT%$`\0]!*@VNU-yb@`)AAXq/p$_b 0XjS1SPD gC#ihOuRVS"@(23S"Bh3 EwVB0I3 
b; Dr@I2#)+gP%#2l~)` BEDE@h E	c^k+enEk~?_p:ly{~aJo}f} around through the whole set process.
       * @return {String} HTML string that got set into the editor.
       * @example
       * // Sets the HTML contents of the activeEditor editor
       * tinymce.activeEditor.setContent('<span>some</span> html');
       *
       * // Sets the raw contents of the activeEditor editor
       * tinymce.activeEditor.setContent('<span>some</span> html', {format: 'raw'});
       *
       * // Sets the content of a specific editor (my_editor in this example)
       * tinymce.get('my_editor').setContent(data);
       *
       * // Sets the bbcode contents of the activeEditor editor if the bbcode plugin was added
       * tinymce.activeEditor.setContent('[b]some[/b] html', {format: 'bbcode'});
       */
      setContent: function (content, args) {
        var self = this, body = self.getBody(), forcedRootBlockName, padd;

        // Setup args object
        args = args || {};
        args.format = args.format || 'html';
        args.set = true;
        args.content = content;

        // Do preprocessing
        if (!args.no_events) {
          self.fire('BeforeSetContent', args);
        }

        content = args.content;

        // Padd empty content in Gecko and Safari. Commands will otherwise fail on the content
        // It will also be impossible to place the caret in the editor unless there is a BR element present
        if (content.length === 0 || /^\s+$/.test(content)) {
          padd = ie && ie < 11 ? '' : '<br data-mce-bogus="1">';

          // Todo: There is a lot more root elements that need special padding
          // so separate this and add all of them at some point.
          if (body.nodeName == 'TABLE') {
            content = '<tr><td>' + padd + '</td></tr>';
          } else if (/^(UL|OL)$/.test(body.nodeName)) {
            content = '<li>' + padd + '</li>';
          }

          forcedRootBlockName = self.settings.forced_root_block;

          // Check if forcedRootBlock is configured and that the block is a valid child of the body
          if (forcedRootBlockName && self.schema.isValidChild(body.nodeName.toLowerCase(), forcedRootBlockName.toLowerCase())) {
            // Padd with bogus BR elements on modern browsers and IE 7 and 8 since they don't render empty P tags properly
            content = padd;
            content = self.dom.createHTML(forcedRootBlockName, self.settings.forced_root_block_attrs, content);
          } else if (!ie && !content) {
            // We need to add a BR when forced_root_block is disabled on non IE browsers to place the caret
            content = '<br data-mce-bogus="1">';
          }

          self.dom.setHTML(body, content);

          self.fire('SetContent', args);
        } else {
          // Parse and serialize the html
          if (args.format !== 'raw') {
            content = new Serializer({
              validate: self.validate
            }, self.schema).serialize(
              self.parser.parse(content, { isRootContent: true })
              );
          }

          // Set the new cleaned contents to the editor
          args.content = trim(content);
          self.dom.setHTML(body, args.content);

          // Do post processing
          if (!args.no_events) {
            self.fire('SetContent', args);
          }

          // Don't normalize selection if the focused element isn't the body in
          // content editable mode since it will steal focus otherwise
          /*if (!self.settings.content_editable || document.activeElement === self.getBody()) {
            self.selection.normalize();
          }*/
        }

        return args.content;
      },

      /**
       * Gets the content from the editor instance, this will cleanup the content before it gets returned using
       * the different cleanup rules options.
       *
       * @method getContent
       * @param {Object} args Optional content object, this gets passed around through the whole get process.
       * @return {String} Cleaned content string, normally HTML contents.
       * @example
       * // Get the HTML contents of the currea@Y|ZLyB$P^'fd$pq"vU
  imP @"Pix"$K ``&i5 k(!~)Y9"u?6|'}__']?Y}[vk{V&]#W:vyvz~LO>:{^!x_{IWC?[nj|ok-~]'KOt@m[2HgTh_A$ C=q#3	 0\Lp n6X2 JE@_Fo4
\rp@!B&.`\EN}t7?y:r_yv?W|GWM^uo}P~_{{Bmuo}{{-aS?-MC03T:L( !e21WB%C J`pQDDWZ0+ '&I`g1
z@ cLESP&[%5 AB P@+	{+(`T$"p)AS*QG2]T6% PB$@ `0Q"|D[=!J c	4fA)2)2$D9www?}uA]w{+7=~Tmo=]d._W9&9*aB # Md
 tHB:2L$C@.P@!t  i8Dc|AH	1p:!D#bDD0@*D5%a[}cv.tc"|-o`i~~_m<r~Yr?oo{}LN{4sWuY]dzi?mw7/u/>^ L=w<:Osg'{D?N"oc}'<Ofw^, T Hb vH /&
Ndr i% pLPt& w  @"t8-BAB\9uw0JWb9.os}~}Tr_/nnyJs\8Uw[l[=>?|u9@?mo~tI{zn?~>S|p'C(/ #T4d1$>&&pI'F[lJV^	6PMC&L(@PE#<` 	SS!I	'  B1%YBa ,x ]+h5<$r 45#2$ J
iKhAH
Ya@4h"$Y U dh]={?~\T}7/m5c+{KMOz%3;oR:O~zn0 `d%(`qDXPPOEA/" AHS#*4 T0 (Y	c@5nT"M CE(%`4H$Cv^li.`/hn~wWON9[oGWv|^VpW{cu}G~Uouo/f^;3:USkwuUMiuOTo[}s'i>a$E+RnfH>'+)Gb1g0:I0
$
@yJK=(>: 8ETe`?ArPJUA2*Da0dATE/XO{_ou^b_tc{6~/Or7?K<\tg_sg04$9+4*Tp2,) P4"DdC
&SBCQ	d0x/dUE;x7,#Ca0A+C|@B(DAhvQ!	 xTF ( p 9 Qj
+9V 	 Dl@|'r@6Bt"R !Pb0bk 	{HI{"_~G|'?z-v/?=O*%H{Rn^vwjd{TeQ)sF8 PK:3

($I% P6`1P3 PP)g K&! p: E! y `FBe REa* JB 7t/]=}~qco?g]f{aW5}Ns>|8nj'y?/yE?U[TqVUey9+X[wu;~6}n~X|fo_vw?.]t'	`! ,Q8Hj$_*lE<t@rF!,@PEI9zEdV5 Ej1QlLB2"c&LH37"%zPH.?~{W~k<}{~}to>=/e]n]_UI=?[_?x!?yvzuBAd((0&$:"JDGP-G &p0+:Q	+f-c fIBPHw
zl0<fBi!DW]f`o9 ' kFd4cm5 d`H5R(N[XK3RPB	Gr\2DA8Q@%R D@
L0(BX @L@SI@ih	 HgQ$/{$j_+~_xwos\s_m_\K}gOT={z|:m6|_Omgsu\ontainer) {
          self.container = DOM.get(self.editorContainer || self.id + '_parent');
        }

        return self.container;
      },

      /**
       * Returns the editors content area container element. The this element is the one who
       * holds the iframe or the editable element.
       *
       * @method getContentAreaContainer
       * @return {Element} HTML DOM element for the editor area container.
       */
      getContentAreaContainer: function () {
        return this.contentAreaContainer;
      },

      /**
       * Returns the target element/textarea that got replaced with a TinyMCE editor instance.
       *
       * @method getElement
       * @return {Element} HTML DOM element for the replaced element.
       */
      getElement: function () {
        if (!this.targetElm) {
          this.targetElm = DOM.get(this.id);
        }

        return this.targetElm;
      },

      /**
       * Returns the iframes window object.
       *
       * @method getWin
       * @return {Window} Iframe DOM window object.
       */
      getWin: function () {
        var self = this, elm;

        if (!self.contentWindow) {
          elm = self.iframeElement;

          if (elm) {
            self.contentWindow = elm.contentWindow;
          }
        }

        return self.contentWindow;
      },

      /**
       * Returns the iframes document object.
       *
       * @method getDoc
       * @return {Document} Iframe DOM document object.
       */
      getDoc: function () {
        var self = this, win;

        if (!self.contentDocument) {
          win = self.getWin();

          if (win) {
            self.contentDocument = win.document;
          }
        }

        return self.contentDocument;
      },

      /**
       * Returns the root element of the editable area.
       * For a non-inline iframe-based editor, returns the iframe's body element.
       *
       * @method getBody
       * @return {Element} The root element of the editable area.
       */
      getBody: function () {
        var doc = this.getDoc();
        return this.bodyElement || (doc ? doc.body : null);
      },

      /**
       * URL converter function this gets executed each time a user adds an img, a or
       * any other element that has a URL in it. This will be called both by the DOM and HTML
       * manipulation functions.
       *
       * @method convertURL
       * @param {string} url URL to convert.
       * @param {string} name Attribute name src, href etc.
       * @param {string/HTMLElement} elm Tag name or HTML DOM element depending on HTML or DOM insert.
       * @return {string} Converted URL string.
       */
      convertURL: function (url, name, elm) {
        var self = this, settings = self.settings;

        // Use callback instead
        if (settings.urlconverter_callback) {
          return self.execCallback('urlconverter_callback', url, elm, true, name);
        }

        // Don't convert link href since thats the CSS files that gets loaded into the editor also skip local file URLs
        if (!settings.convert_urls || (elm && elm.nodeName == 'LINK') || url.indexOf('file:') === 0 || url.length === 0) {
          return url;
        }

        // Convert to relative
        if (settings.relative_urls) {
          return self.documentBaseURI.toRelative(url);
        }

        // Convert to absolute
        url = self.documentBaseURI.toAbsolute(url, settings.remove_script_host);

        return url;
      },

      /**
       * Adds visual aid for tables, anchors etc so they can be more easily edited inside the editor.
       *
       * @method addVisual
       * @param {Element} elm Optional root element to loop though to find tables etc that needs the visual aid.
       */
      addVisual: function (elm) {
        var self = this, settings = self.settings, dom = self.dom, cls;

        elm = elm || self.getBody();

        if (self.hasVisual === undefined) {
          self.hasVisual = settings.visual;
        }

        each(dom.select('table,a', elm), function (elm) {
          var value;

    ok5(
S$mrj?gm}/uurke68}J=wQ5?Q-Wc?rlu=;?|U!V,{Z\9J=nGQ7y=}/5}_{g]w]Cgw\_:]S)%\]jrMzv\NUWf}l	/u}O==G1uwonSwM77w~5Vc7nj8w~9pf7=wzow?3_~_|dW_[u.H1w1'=\-Ufx;F_~0)lM|fbw'+{w{gVqg_W?0-+j<V]~}}sVm[{Zu3wS;;n_to[~~<zo}hng=yW?a/o}<}_~='7-bls}~k}tmo{glrUO7OW)v}oSqZ[}1sQl\W)_5ao?Z}~/=}~ow/`>Cw?u>,>Mq3w<]7}|{kvv%{~}xizw_zw_}k^tw[]$tuo}_}Zv}]ICn=qZww7&F$}}_<O>kVz{Wnyyco6?*uTO^+_cOOm7s?Zww(nWnrcw`qJ?Y`k^]<?	]iko}l[vt_}^S&vuW3}~:%?]E1{sMf/orq9|UW\vO7n|}o^Ow/uveKiO}fr}|i.n=>]6>5[/	guw\Ao}//v}"tKG\uww<cMOIw=7/_:mNs6o?EK|6PurSwh?_U~^Xxk|q?dVo?/n|z\^vwN^p}*ch}{~k3>}9{guOys;vOC<|NMWx4r3Ww&^_w?f{b]]_~_7=,{>ywwccf/6?]<{_?~n?WZ={t>Wk?wOcs~}KlfZ_s^}?[vvt[?QVf|^';m~sGs^vbni[?>VWM3W?7o:v^_S.Yw3/j}[COq?Yz~}_N@F_&?{V{O5N}NM2M^?tP/}Nnoo_{owD=TowS}~~T0s<;:;F[/R-]nQ7u[oU5;??WQC{=1M=}S*fMcnf/qG;s:J;\g7yG}NxT_\Wg_w~~neP{hFY.s_}s~na9}7__O|j;o=<s{Ocn.sqs:_s~gE?r~[wWS9Y7,XSS^x{<[w:q3*yF{n}7_BcRk32w+6|}yg[A6u\>h_|e^s~RklN~/Yu}_7Wpj[zm~Bgo=~m1/%POqnf'}8jC~rvs}kmzcgMmt+>c(kq>M.?9}Mm~foK2o^=~bgG!E=iuq<OWGDo{7We_(gD|?~yo[`~9w}WnKNy>{oEN|}m4s:;U;rz:OKhci>?5n\|;dtox]gYxU}{qw`sg[-?/rVLv^gh^|/w}T{_:<v-bi[Sw|O~kjLk{o&ry9[emwKN{zno2u_k|K35: z^W/~s_~x?^\7_7gv?@%Gtif{wW%|r+^n7w_+>t_gs?/
,vYKuW&un}Ki?{^i]f~}w'AC?,H_z|.>djWVw_?no?}@Xh"R1NDAD&0  "X 1'(LC(Pb2&5p0
H`A 4.H`9 S|;\QiDEJ	c:Hz |	$l+:p\!5hQ)B	-T.S">\$
t^fPh#  `~C 2 cb`4-0,:4pt<@HC 	BB  0-sBmm-jKowu`K$z>ow?Gz_4/gnlWkf&t[nzgAHq` a"L
9PFbE721<!`r `M$FB #X% `/'QB0'%
^wIch ,Fo.56m{~A]bfr7gVx}8"tM<V_?]}%:; ]\rw*WyWWux{_	qS}k_uRo?)|	}?o=u[WqOgZ<@3:0#S=A HWEB2 8]2xA0<$!{7DlJ(-p)0F
 mA9EZQ\H($@D72r uZMwM~/pz?{_}Y_x3?nv3w]7wx];nk~~Kkei/X36<K`X'@ R*LmBaL&)D13b@pD b(^ gT(
@,P#LJ3
(yD(FP@RAb$?D52qLZX.@SeV@vX*Q
A*cd %1  H	#("C$KbQ,R!o& <b;:)cPb~y<WG'w~y=~{~s|]_S_z?x=No>z=-2_wb@Q#-H/:Jw[eC	L	*1$iP$@@P`pTJZM)("-J J%DPWJi7A`aR!!@1Cw9_}~;i'v~|ufKX://yS2x=|uX)W:p_?Z\}_^[N?=]uvmHuuv~9OMNo?m:z;wx~u3y|E	$NB#sD
0
,B $PeQD$KA.@"hB)Wh-P$H@uN@ZX#&)DX  .fA"w;PI0!ww_}uoSG+F?&N~#O/r.7T.cN$wxRrW**nB
(= E^&E#9i$ ["  R*B&EA!G%V0TD`DB("& ; 4BFM,0 THQ r\apA()[ `B!AnF[( A2VS%  Yl
IDeD%;:Y[oYD!!G="J@B0T#
8O.Y7xo;K?8n<Nl,_63[m6|zG0%pdH!p {0I,)zAe/p4s F8LC9'CPP!BpQ O!aZG-L$!cPP6
Y0p!+;YmtswA=QM{EVGwSmt^~u&v\^?~azoij{??7<O)>SvT;s\xikos_Uwk/j*|{g3uv{=e|>|e;2!:I `@4, w(_V8&W[?BDBPA$plD r8BR[!E		aYZ	71Q @`\6P3%hr3 %?_Cf{]X-}_u
l^~{[Yloo_q)w?pv?n~9]~9~~rS? C_M ID+0"&4?%
@x$+X\`'Y E$aL0	B ! u/`9#,Ei0)4
tX3X6A dQrD\HC&P$zia
%rb0(q@wE" i&b!5TBP{`xF5[2 V2  +$E0 [	!P 2BA~-voGfuGU?+?Uah_s~sGk/qw}2` `TFJ\$Q E A`CP?bP tJRpH8 !w0.	GfA
hCH&DY`` gyIPTKcH6  l@V
}Pbyo]>:{|W?!)vwgZ&~Z>F>{9>Gg_.Quif>Yrww<//+)7(um|}?9??lSt @Aq8 C4 d&Pb84(!P9zH%	bH-x!BTs AA JA1I #FA)EA * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class manages the focus/blur state of the editor. This class is needed since some
 * browsers fire false focus/blur states when the selection is moved to a UI dialog or similar.
 *
 * This class will fire two events focus and blur on the editor instances that got affected.
 * It will also handle the restore of selection when the focus is lost and returned.
 *
 * @class tinymce.FocusManager
 */
define(
  'tinymce.core.FocusManager',
  [
    "tinymce.core.dom.DOMUtils",
    "tinymce.core.util.Delay",
    "tinymce.core.Env"
  ],
  function (DOMUtils, Delay, Env) {
    var selectionChangeHandler, documentFocusInHandler, documentMouseUpHandler, DOM = DOMUtils.DOM;

    var isUIElement = function (editor, elm) {
      var customSelector = editor ? editor.settings.custom_ui_selector : '';
      var parent = DOM.getParent(elm, function (elm) {
        return (
          FocusManager.isEditorUIElement(elm) ||
          (customSelector ? editor.dom.is(elm, customSelector) : false)
        );
      });
      return parent !== null;
    };

    var isInlineEditor = function (editor) {
      return editor.inline === true;
    };

    var isElementOursideInlineEditor = function (editor, target) {
      return isInlineEditor(editor) === false || editor.dom.isChildOf(target, editor.getBody()) === false;
    };

    /**
     * Constructs a new focus manager instance.
     *
     * @constructor FocusManager
     * @param {tinymce.EditorManager} editorManager Editor manager instance to handle focus for.
     */
    function FocusManager(editorManager) {
      function getActiveElement() {
        try {
          return document.activeElement;
        } catch (ex) {
          // IE sometimes fails to get the activeElement when resizing table
          // TODO: Investigate this
          return document.body;
        }
      }

      // We can't store a real range on IE 11 since it gets mutated so we need to use a bookmark object
      // TODO: Move this to a separate range utils class since it's it's logic is present in Selection as well.
      function createBookmark(dom, rng) {
        if (rng && rng.startContainer) {
          // Verify that the range is within the root of the editor
          if (!dom.isChildOf(rng.startContainer, dom.getRoot()) || !dom.isChildOf(rng.endContainer, dom.getRoot())) {
            return;
          }

          return {
            startContainer: rng.startContainer,
            startOffset: rng.startOffset,
            endContainer: rng.endContainer,
            endOffset: rng.endOffset
          };
        }

        return rng;
      }

      function bookmarkToRng(editor, bookmark) {
        var rng;

        if (bookmark.startContainer) {
          rng = editor.getDoc().createRange();
          rng.setStart(bookmark.startContainer, bookmark.startOffset);
          rng.setEnd(bookmark.endContainer, bookmark.endOffset);
        } else {
          rng = bookmark;
        }

        return rng;
      }

      function registerEvents(e) {
        var editor = e.editor;

        editor.on('init', function () {
          // Gecko/WebKit has ghost selections in iframes and IE only has one selection per browser tab
          if (editor.inline || Env.ie) {
            // Use the onbeforedeactivate event when available since it works better see #7023
            if ("onbeforedeactivate" in document && Env.ie < 9) {
              editor.dom.bind(editor.getBody(), 'beforedeactivate', function (e) {
                if (e.target != editor.getBody()) {
                  return;
                }

                try {
                  editor.lastRng = editor.selection.getRng();
                } catch (ex) {
                  // IE throws "Unexcpected call to method or property access" some times so lets ignore it
                }
              });
            } else {
              // On other browsers take snapshot on nodechange in inline mode since they have Ghost selections for iframes
              eLGv^vO[vs=W~Ly[Ko%vfEigfW?om3J~qsG<2
Z9~uG8r^nViz`z+VnsM'N.gt[?/h?8YB||}knl?:~lWGg_+~~BK=o|j;go~?^YW}wi9L}b/6:>+>}{m36<g+M~I'z_W_w?\s;>]]g}_}Ss/r}2yr_}_NNNOn[l?aq6Q;?qWm
;+w~U7n<C~VYH5sz~\w~9In~8?]Kus\ :>-[M^gj{{W=mosw{;[y9[C-/8gp;+]aWBcm{2w7_?Oo~a+o_wW>[no|%,}[f%VmGYSY_b]U8w9?g~W[}sw#KoXf{Wizo+Aw GrChs '_z/3Sz/?iA=6wyVfG,Mohs]+iE<wyMqo~r~UWyYWGMzsk^?3|V7_]_*s_oZl\\Siys?+\!kyH"=OO?<Ngg_'t[oeS;/+	mooZ;~.RNw'pli|_&~Mv_|)-*\Zf=yS+slok;zXo3?e\~w=fE,_^|o~T/]O_;}kz~hu}uY]7/7/6_vo,XvNw[-Mv06w	Rs|~rikKaY7yXso97^O>IqcwQ6~_~8*<xm,_=r<_FY>[w%cpWS->*e.zGGw}bx8O=y}s,qi'xYU?<Gc;s[]Wp?Y?.W~7>??S<{=noh;I7u=~X~z_p;T}=y*~W[0ZOw8moz_ikW]krj~w>?kO}:Nrew{~|VgwWjx?lk[zz{zy]{{{~ys8}_qi]|o|6o+[7Eo^?7weyY80CIL/wM^?m"Cme*4seuUzv]_	k^/g0wTO[kvb}m)?]NiUN{yX=NW/{J;B_+~~7WngO^mBnb_?{-a]K;:_>~n]>=oSnM3Rq+LOnOls9\;wgwGjeH:~7FsgGQsS~o]yBI7.={m]X}~'j?cwG7>m-o7OoX7>U[{k4mj,?nt}N3?g{&	Nc}z)/o,w-n9Wvom?w1vv:{u'j6os=%Qk_1?(w&lr|A}Ny};uOyW-/}tj>+}f__B!zmXouQ)il=cg=_[;
p~Go)H~4{{u?m}{lNl|_/_|;w5c.[x79]/Ro#(Ow|{wi1n-=Mu<Uw/VCv?Dg686U5n:/Wj:'Ks}~M{QO~7{//?Woo\.}g[uklT\{L.yG7Y_\ct}O!5kwzS/E}xx#;HpG37wNwr|k<o=mg?g_W>]yq/t/+iY?^I$ge~]_mzYp'H>u7w/s_v^sW:.1/_k[+]2yi*9|=Ug\|/Yk|o>~kw+Q*Z ReAr5Z 
J&
#lt@&4(f5B@i $[) MA((-` H%d6*KBQ*AhD!JtB
1 V2 -"@+PDFqF!`@H3 "HT 	)#\HFJ"# L @`H!^S ay &D#$Cd HR9Am(,e,	BG`L "#S!f%IA, dU!a(Pb
B R
& 
M%r4Z &rQ@XHp(`e	%y ! iT@F_H,xSE Zq<R7B $x8x#$*K1@*8tE+
PA  	  ( u.H( 02H F!(\@OC- kd@ PD'Kd 
LW`<.f`\  H6HU !NxbL P! eg[n
L "h&  @
a"Qd&UV tAr1I F$& `PSFe! (@a  &Pd t/04m dLC`; A@T s 
BA	 	"=LD&	 !f#! R;J!D
T k& %' ROLC 0@bBHJ*r B|U&HA>]HQ E |p)F2 U A;Q@@0 O`F ~J@Q`P@J6] 0A/R<0T$	]aQ,AcLbf#Dp  @` 0E*&2BB4#kxH@ *'EK d!X1 ;!l*Pp 	CHSQ80` bP,Q "4)L $	 !
D0;	DXPBWD IO')@T` ZE ,X<@K`!*A0T  j 	$ EU%!`m%D $
P
9!^	 <'	d:uA-S* " ukS&r8B,]I5b I0$tfq
`ADlz+@\  0-fI 5D0' ,P!6) l,M@T! `DIVQX 2 R`@8h$!v$Bv(JT	0RM@C@x)B$T YX2)40
 $@)/]H
BR   PCqd%@ A1 dC`$#x),2C@>IaxL F`b
*&%9TD1s0F v0
BkT`scU07M@"@BBf	bt!CC-	OTI*c&,BpL(d
B1 !,$p bZ@AhP@ hR
8" `TBIs %k12IH!Pa<MP&9pC&@d(i4\Q`	8 Fd

 AbJ,!0Ab  pDpiP"1>X!4#(A	Aw2*$,Mb PL(T
AD9gF2KqR`aJ@D\	9Hqs@XHN P O)`!< KP D !/ ~J BK	(w$XE!0P (Q
 F-<dE>MbH;D8JI! *(H0BI*
H 8PBZ#P@ h(|!ED$!FB:F2\KP~,	RO5<AxO%F`~!m@t2,HD(=  Q
{Bp*e$  5  @dD@	rRR9EK#@th	H#(%O4#8D +&@
bb pPC1B DA$K)X 2)*F +/2b6 `)`|@@@8' P 2 pwLB\}0- $$ )YVS#DvH (~	p(A8!h  Hp@D <# R@N` ?HMMG:S (I&` 
h [[ fR *,<i5$EPbF$@ 2- Adt0A	HeMC T%PB=2 <K@&0X8w#`b  ?1D Ot(hxk[ 	
M=HzX@( !+@y4	 ]1ZnL<7C"Q(.` jH&%H`# W)9!%Kj"@%p& :HA*@@0@Q@b	"$ t\ H$+IQ#A q C$Rl< Br C!Zv)!i k`  DHFE!DF$E$t))`bn2Cm"5s"F e A<|# V !	JD@5#$@DRDX8 Bd81T80Q^D9 @EV@ 

0@y4X S A 4RDM !F<BsD
w
	!	\L h  Tv]g~7S!@` 0$T* J1D	H h9hp3 HB) Xs/iLl&H upA'h`AAc!AFc#'ws` p!
(UFd`5@D"m>b"
'"T@pT {Rm>"B*H ! I>&C"3K, Cb9t%+@T&

xEXpAHO 4xl F%HG8L2(Abq	 IL#Ra(*QEJM4L@X`
 "h!AL$*(JHC   rHpH +Bj
F,T*a	$0fp @L'7fVRPzb j~,F@FOCg)4& @,jPi9JK"/ Pq$f1$/)!<hB4  T 
@4"a21h<DxeD|*) C2 )RJ %EQ J BM 0Q<L@%e`mp@="n
B!QT 5l !	NL#iA@`r!i@  \
 u
$8 F@&JQ@F'	P## "h	BTB@
&VmFk$a2QAc@ N,it.: 44Y@	 xVSQLq	 H`: @f#+h,,A"F
sHB@`# A('g%+$A?EDb&X\ -i@bG'|2J)!R^(Q$*
!b:.B`1B*D0<I@7v7gm=}W;rt{~Ou%?]du2}tu/D>-G-_2Y~W-]{kGN}GR=co{*}o_'un9<4P_>O8Mzmo/n^ PRT_QjY  [p3 DD2HP(	 d@"4=p#u G<ua%QZZJ"P<H%!bPX&L)A\|k7,Fm	u.=[}xt~5}Swru}c~)?sY?7"gozS?~o'QA IE8x "X.04PtJ@(IJPB F5'25=!m@+"&B0cLs)My#+BPLxJa)<}4!@IfTA@8S!g'ACQ}N"D0AB,PiI3 *ZrD!`U' h$BJ0DS\P"?<G[xytWVuH	Oo&?7wdP\o_v./z:Zn~ .HGxOD@ B: PE@IhI.T'2
G `e
ae$Q1AVQ4'F$M @j[ E	YOXE >;J{x?u~?~vnw(wjM}zNg6~y_&z_s-wv/'&-zeww`U_'gW\4{'_{.+|;_;x?7PeWo7ZJ5GE;, &@aAZN#b FeP!4J[2D	/[8d6FP\RH`M)pNQjP@7#iAw@!# zo?s]q{~.}]zhKy9y:x\p;'cgO]/vyOjw{O 	c1+6G)$2b^E8HTk_R'GDk ENl.$14> `ry'#nkvJ0D ,JET: "$CpiFA %F28J5OFPflS-yBAx8*'PV%d&"P"7qe!pF&|C!M>a0ARd6g8dFtD~_u/)k7RfQn4}mo|E>SuruAmG0ev)_/?mqvg,&E;ogV%HKB`I%E(@3,NPP	B	Iz`dp0	 	F1	T&F@ .,nfO" dw9TF,F3H@VZd	fV0"p8;w;r~+}V3wn\=x_:c}PE_yg{fj||s"EMWy?k/Yn>dHTvJd,nsxm}ow{aN\y>{.kOGy\<k~d:b/{vvaOGLP2=P>&$H1c2`LX@!T ,C7	o/4(="P\{ 1I44QFgE
A	0qB `m=
	/+uV;O[}''z~7w3FuX.|Ezo}WOo3_>0$ bb%X`pI6RA%$n`G^D	!$1 QZ8!IF+((rGa`FEA Dt@`)JkfC<$EE"fD r  	PRRAQbkdY X$&$oC"1D1Ke1
]#2S$1)#?0S+ c 0\`tTh<RF%l[l|?Z}}T>/~W{zo[/zk{Yo?~>D~{DWK0a\H*C_#
DLGA&27"pM	v( T--GY$"a)	d4Z#R!
(0! "DIwN?E
`
e{ ]MOcom~R\ONG{^5_qm^/m]O{n?;#->{kgd6{do3xi5{]wmw._6>M+w{g[:&m?6=O>'t?><^kY!;(v+RPI*: U5b$ TR4\beB!P8	b60%<Y1T @ P@ zr	,\a/a`,CB<(O.P<_mNO}l|?>U-;2{{]^{/_cs7%o+?#GmJLt[\Wp./@B
 I	@!A4$#0t3
%Wl+MJh/UEE,M,A`d@y1KX[Az& t@9*0(L6
GS%YEp$!8W* 8 H .gaN@c1 
	0$SOX84RAHbsZWx?}FoKo|6f*][}y{z>|fr-SJ_ww[Yfi`A.WS?Bqp0'*YQV%XWR2v*W1l=!,kD*`@DJD"5;&AHK7
$ $Bs`$c<?_pmkl'o_kDYWgl/xm|?6//^o||Wn<|FOJz=w^~swj/N;Lvt}6/6gsu7OO}-~|yWR8/{H`$z L0`"EJ `h,hD|@s/U!lS5a):?%-@*yW;6K- @p4b*IF!EB[w_Ef~0nzc][g]5S>naN\~}SYS?v^zw@eM~oPx@XQ &ZUdPI,0Sd.SV9dz8ED8CP)xQT&J
 a@I	$ <+"!k p"Rl7JP AuL	Ve%1zHa!,.;0)('<)DM'#JD#4%yC0ljB$A}03U[
#
U
P" _Hr~so<W^o*2UO?3wJtk=R2ZO[swC8}fj}s6E%Y zDfN"WBT'
`fc HbJ>j?  " Q]TR,a63 ] 0RA `4dC(G`! L_g8-o2]w'?WnMoHc?Om~?!RV=w3+G~yQg_ve_lfnpyck[lq_3iuzxywg_T-o[{{/e.xB
Q;,}| Gr 6,I'$"-.*` 1$ 'wq$QH(GIh3IfU	0khK&\AJ#gtk&I~}roQor=gor1~WS[_1_]]u9wj*%$m"%0\ou/tM(Gc!B
4p| U6C D'v$Q! IQ#0 2(%&h*+SJ 00x	$"If^sM,nojKD^4    ;JBC-{&`.)],` es
X~hSV('5
r,a.D.e.ankc_o]wk[k{{{9~z8}Up>]MMK}8v_R[7z[._+rDnD X&NBFjso c'*Z <`B	 0 38I@+T J@t 5Nf*nt#&(D%' =
&b|-\Asl>[_z3n^iYO__W|:<{lcO4#7OKAx_#&~k7+.aISs?z\6M}Oq?/5)^~ZMC|-@O,&1XRST}"{a\	:
X[$T	! +	f#
P#  >(NK0:&85`SYI-/BdAO*c\]=vM+k}w2.[U}Foo}E~oqW}_~S#dW$ !
	 A# 6TY U%:A.I	aG&rV@&HJ*[ 
! Q'C)Oe (
 eQeD pPaAA
&   H!04qYke1xb0	O.@2!d/Wx%p@
t#Jy*
2H.
A		 & B)?{}CvaY}^NrOO/=-Oz1^NO.W[O]oo/LI~'M/ *P  IIip FH[fPOYHp@"!KJ1Sb &Z@b@vpVM)B3|-SD/$ajaA_{=sRM:?_S'^46~5m}LI_];~f]~q%|wQ]}{/pa}/{zT^uw<is^_o9/3g\;(]Kw>|s=q}{/De7 ,Y N##K7,	cd+a^I0 HDpWGCYb `$~}kQ%$C0VeWh@9;Wr_wz6w<K_ W}2}+f]Oo5C/ 3|OA[UxXh 2kL@TT P@	eD dAP;aSb;: E(D(Pb2*#h7"*f,j #0N I" ji#qYi2@TRPa@2a4	%Q@i1V$F4B[	
di xx92FLSjotV/v;7A?f:vgttM}W>^Pw
My|]KgGYggc?{z_/e<~o{e6>T.]hY eP[%gJ8(Ac&, HXs Dk	zZ2ITx2
Q`TJ#LEH
BQ([B@j~Q1H\+[it8so
 P8@I`5 7RJH	2L57@D FRH`"L(:QC qFpCcxomjw_|q__.[vr2_YOe~{u7=iv/3I$.E@xD@dcTGp`%$J2@xj-Q,0*&^4!9z`cR'6 C
P$#weHv=`8?<]qz7zZ:}XoasoB'{|;|[G7FlTt{?im%`__2ozO#?./3<^T\}6-BO7YzGouw^}gL|_?c^wc-jiF:z|0	 "(&
@ T6GsI2'iTphK	@Anj*-`r BbD@r2)bb^"4  S`pDM| >\A`6's$%X!Q RTI<fASpR@Ziyu58`Y1=5$'pU : 4=@&,wx>oZ&?;7yX6=^;kw=s^_x~{R~fSdo~_{ASOg{[oswi;+-57ip\Z>8<5.s>]__\ooq7e*!`& dbGWAPG( 46*DB *C1a .V*q ?@GI'b:aof%Z0lEt^Wl*szqk{?mWl6mvt~keJRmxSx/=n]vUWwxsu<3-vI/}vupT?<@1%@<*$DjGHt% rdC*hEa	Bd)M_(29 	GfqZ@pcYmQ	6H!A\0yf
2=0p2 hQ^/3X&')'#g"F9RDfV
TnVxhPEAG5sru_~HCmdv$qO?k_h'Ywou7sV	OwO~c}~CmGurb;w=Q777 V`FT+NTAQF0*- @F1XF|m`
6EZW12GA,0Lj Bd0$ iH0f%DcKl-Y-M	~/=oltmidk}?Vl}7uo}zY{~'7O~l>l~:C|5{?GU]G1_^^>rn*)wgmwT=7pR"	 !%( T+s!N7-X-#H `C\D0e"] Yn,R[DU #
{E_x #mS?]?lmyWwO{ix=Iz}&>ow\8|5<=_vvX5O~.wZ>Ca~{J"@CDI#$lJYQ	V+m  <-0!ABAIR#A@Dpj!QT
`IoU1d @!	%)	=) 3* (`F@20%RJ;CaF&(HBQ)  x@pD`F
}7S):%VC_RGskM*{eGW719Wmuj=mn|/^3~^Oe3eXa{w}t_kwDt@ (FD*I 	 65m}pTXA(%$oH}V ~e+CN4 sJ`M @D +4a ]rd"do|o~vz<:\b?s=~=k}E,Y'{KS>}
o[5_?_yy6Ma)Ip=o^m$&_>/^=d_~]|{<Q~g
CQ-0|C$LI2a@zgm.xE 	P=xGWHp9ql% $(7uh(]c[Tj AH4lfgS5^IzjM{|#~;wru9F+??k~MTw+^.%%4b`Uro'/& (4gp <GniS8&0HZ_{iG\B5X!]G\Ey.&Od"A
d",zD<% N%ERESTMD0a*c$B?&0G
z*O|Q.H
qTl K&a0-pA BOx}|?^o3}5/p~=&JG7oK]}^?;;pVC]x_nn.9([SQ@K|Tn ]Q<,BS`hchZ_|%tpH,6'p!b D(T]@"4T`AuDF
(e6&& lBF'TA~8V *'j$t /C`4.wB"\4D !sVM ~`KShpXl~7v/)^hLauk>_3VmQew|w}oA/z+=~k{wUGYn7;k25vy]~}=a:Kwni?v/U{{TC! t)T$ 'C%SP !It"F-Q`6I2B65SW
0&TD1(2|vOxMA0Y 
za5 Lxkm>37_7ysb$*U{=>YIc~+{Oke{r~]jhd#%4@  n5b$@i@R@@

H
n`FOW289BS@LD*
6/8wr8kZ6Q%P@Y'x#-Ns0!H 	AS6D-CGYR@:(\$@6&j<DTtA  l-`)8~1.8zRu~V~]qkN~VIwrV|\#T__wzwng|?a6w{J:= 70 v Q+b=	y9b	B+0 ?I9 p	7 Q%${E 0G8?J!< (*X@#E%J(C`r 9B"H#@OZ[kGKn5wI?oC~Ow/wT}amOmG?/ZbIlm{NbW_h;o+?iWW
x{_u+oe[g~*y}^|}~}HGy&  /ZA
<EYO

2ipbm.PV!;a8'3@Fb_B2R
AD_Da @`B$xQA4)j^=?jy=wg_}~_fw~|vwTk 8{{Ouoxhu~soj	DB<>V@"h8!! K~!nC
b"0yXA- D / !Jbc<*X>UK@b@BPBk @DET9H0@00aeZ&t#OEA 8UBFgj$r*(ADlmM@Ad'V B	0Y-jjDHFu(NR~ ){mb9qg?wwcY?^~}~y{|v>UsvS.[?j~Wo|;mK7o>vi0M 	R\'I+Q QqkJ`@%TLS6`A- mrOq z) &.G'eFA unZ1H|A

Nw[w-l>{{{{9l6wc?5f-?;l9+oz|6zcM{}vKcy_*w__GKBcom?[u{ZQS_|?Er}uuxWzX%WckJ^O5~(KN#^V*
A``$,?A&`JLRV2Bc/@!FDy*
RdVK`z
B0"ZK21k2,AuM]45 d\ AA
Ac6byoO:u;>#y<Ne~ny=7k];s_7,o^h9N)r=w"A1
RQ_PPgdAY[te! 	APF^aF@FVKp6_(MSh`d6 bI D@n N1(0F lhZJeea4i$#,,29
X!G$ <(!4+IJ58hE!(PCd4dCI IMU& c(+	,`H#4m4 VAD,pD NP-|^J?Ogy_Z}%h&V{j3|kgn=}/9_>7/5OS{e6>T.]hY ePS%gj:K(AC&, HXs`k	z2YTx2
QD`TJ+l
BQ([1sn}W]\puzk;jG._TnWu}OBj?5^}c[^]}<o{uy|1v|6Ou{d/OYO5z5e?B@hzQ1H\+ht8Wo8
 P8@I`5# 7RJH	2L57@D FrH`"L(:PC qFpCcwfsWd[N/m{9_o0g|z/?g_;m;:~WO_ogf{//z?"I$.E xD@dcTGpd%$J2@x
j:Q,0"f^4!;j bqR'6 C
P$#weNt=`8-jiN:z0	 "(&
H T6GsI2'iTpHjK	@Anj*`r B"D@r2)bb^"t$N?voYwGC*/~}OuCE`8.~J&}s2\o\ESg}}/jkn<[ey=}8iy[OsZol9;Nzw5uaw{?{[us.{{W<jV/.~io{I_8bkr.;|~wv*?Wgx9v'?}1Xp?qN?	od>(_)>^W)jOccNF&@q{YW]n_wC~`_NN?>Opnj:|oR_'>_^~r=o_O{}Z7?V^mBv?<j|_?Rk~?;1p{
4)c+1Kw_^Rs[w+g>5uAeSZWOlS&=[dm<v]/?3>8vY4r9]se/>%9)ee=lJW8GZ,u_={(2sU]S|^[6_z/;sWgYIl7{
jwH_u3%|_U7/ySu}79[GfW{=i[c5of
OVkfuoB^t?fftmvM5jg&/ t;[mo*on<{?~eV}g'q_>K_[fOg?Yq]j6v_GyYOnOhUsOD]>i}{w{{e_:<n>r}3tEn]Nvz7n;^)c;/go;'
/?Cqm^_#paOR9<
;#nY6a\}_}~w_;Uuo}
p~nY~3z6ngc}x6?S+PpVRv?Ue}_w^w-7c+;TN83{gSs2qEmzU)k_^oln;-{x@/sno[E}3{gupxWn/ko_qm)v~g'uFg<iQk{k;Mm9/%fZw==tpK6{{HIo}[w?8?]CR^?unyy`lnWyz0G|l:PV7k>C]K_loy*?g]_U+o3~+2:o/?QM}^w{"|o+l~As.U.?;]{Cpu7w^_7Nq,=[&~~3dV+'>&.(c=~kr4%gVW;OrG0-oe[{ADuwgo'&RWfo,u2|_6&'C^C]9fv<p1%\=z}~o^v;-\}X3-K;o5u+izvF5u_W:ro{#{/?_,''.WIi)}{{GC~?-~TJ_%'O[-7CyuWlM}}M?	<g]MFY/>+'rA/%<Wy3Y[F~KOy~ssa.gu{.;_zS-v7]Uu?__k?~[???_7/tow{~efa{Jwz?Wo-XZfn]:};m?c}v?w67{}~n_pqx7s~S#wuOq=yNOq7SwdsR^]srw@/5s[y^{?4~;ksG_j[wTogW?#w:Y{oeo#x/q:<_\w`\mSXl)h1WjYsT_~g?g//cW]|>9[16[SJy;NiM.
NW+zGyep7?Xkuo)wR)?jqp^buLyE#EQUI=kc?f?{u_x5tz]>{gq?67!xzO]=]9zzV[1]|z=jPUZmZ\~Iid9|esnbewS"7{4-~[}2Gu.~q~mw+1}ozVG{n{}iswOQ\k[?VL{fNVu]/6xy>V7lO~RIjS{wAuoS}/YmyvEtpzMoWKNE?{o3U{e]co3=Txd3[^#u^!,Y}.;2p+~o3L>mor_}              self.execCommand('mceAddEditor', 0, value);
              return true;
            }

            if (editor.isHidden()) {
              editor.show();
            } else {
              editor.hide();
            }

            return true;
        }

        // Run command on active editor
        if (self.activeEditor) {
          return self.activeEditor.execCommand(cmd, ui, value);
        }

        return false;
      },

      /**
       * Calls the save method on all editor instances in the collection. This can be useful when a form is to be submitted.
       *
       * @method triggerSave
       * @example
       * // Saves all contents
       * tinyMCE.triggerSave();
       */
      triggerSave: function () {
        each(this.editors, function (editor) {
          editor.save();
        });
      },

      /**
       * Adds a language pack, this gets called by the loaded language files like en.js.
       *
       * @method addI18n
       * @param {String} code Optional language code.
       * @param {Object} items Name/value object with translations.
       */
      addI18n: function (code, items) {
        I18n.add(code, items);
      },

      /**
       * Translates the specified string using the language pack items.
       *
       * @method translate
       * @param {String/Array/Object} text String to translate
       * @return {String} Translated string.
       */
      translate: function (text) {
        return I18n.translate(text);
      },

      /**
       * Sets the active editor instance and fires the deactivate/activate events.
       *
       * @method setActive
       * @param {tinymce.Editor} editor Editor instance to set as the active instance.
       */
      setActive: function (editor) {
        var activeEditor = this.activeEditor;

        if (this.activeEditor != editor) {
          if (activeEditor) {
            activeEditor.fire('deactivate', { relatedTarget: editor });
          }

          editor.fire('activate', { relatedTarget: activeEditor });
        }

        this.activeEditor = editor;
      }
    };

    extend(EditorManager, Observable);

    EditorManager.setup();
    LegacyInput.register(EditorManager);

    return EditorManager;
  }
);

/**
 * XHR.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This class enables you to send XMLHTTPRequests cross browser.
 * @class tinymce.util.XHR
 * @mixes tinymce.util.Observable
 * @static
 * @example
 * // Sends a low level Ajax request
 * tinymce.util.XHR.send({
 *    url: 'someurl',
 *    success: function(text) {
 *       console.debug(text);
 *    }
 * });
 *
 * // Add custom header to XHR request
 * tinymce.util.XHR.on('beforeSend', function(e) {
 *     e.xhr.setRequestHeader('X-Requested-With', 'Something');
 * });
 */
define(
  'tinymce.core.util.XHR',
  [
    "tinymce.core.util.Observable",
    "tinymce.core.util.Tools"
  ],
  function (Observable, Tools) {
    var XHR = {
      /**
       * Sends a XMLHTTPRequest.
       * Consult the Wiki for details on what settings this method takes.
       *
       * @method send
       * @param {Object} settings Object will target URL, callbacks and other info needed to make the request.
       */
      send: function (settings) {
        var xhr, count = 0;

        function ready() {
          if (!settings.async || xhr.readyState == 4 || count++ > 10000) {
            if (settings.success && count < 10000 && xhr.status == 200) {
              settings.success.call(settings.success_scope, '' + xhr.responseText, xhr, settings);
            } else if (settings.error) {
              settings.error.call(settings.error_scope, count > 10000 ? 'TIMED_OUT' : 'GENERAL', xhr, settings);
            }

            xhr = null;
          } else {
            setTimeout(ready, 10);
          }
        }

        // Default settings
        settings.scope = settings.scope || this;
        settings.success_scope = settings.s.  PP`E!1$`t!!
4 %r.$ )&Rz!$Jf  +a."@E,C AD" (hAx +#AHWHgD$A01 	 R@!)!: !VR_I= 2.SB`C HF1T4a DE9t U8 0A#8cQ` 8,T(bfn   P8EF
`QN `^H0
!Abj' ! *!4 1$AF%PT@tp Jr0/,*RE !(t>`"A3r PO0@@"! A%JCXDl0mD8J0#	EPP'@P #lh{n AC @H0I\pC$	J`)@ RY`XtHbYIx/ AHv3 @4+b9
$e7+0C$`ZE#" 	]g)14*U.It	AA):k "Hd2@H#:#4"	 O#THb` I0XLT \b 4	%R! H`az@E$TQ 0qLwaH-V@b9$ @bRIB @VCoBBa!/ZE .bXG @<bp :3q)%xBEdB
 `BQ <+%%!LD	!"e1;FN
HqF)aNB3`$SR(aQE*bc %MbPzDRA Va `^Vf5-a6CX(x@ "8l PDHIc.8H!'\D&@C\O@=O@  g@`3}	!#% eyK  `# @ @#AXL@ K&8.
WqujG!  g,@PR$F `  ` $DG@'4)s60
@4'Dd3 F  J." "D2<' D0"(@*ef q8\
L@0S2ia- >dpSAhKFa""TrBBqjAW6B1t7 dLEX6(Y@	@8T]B 4XRG$D%  d
 B*p@D(^$!	 	uGHH a`I "; Bi5p%)BVe#$A' J Hq9FmD3I <$U  ta$@h!P`&`P (KDHg$+ a AE0 2@BN@lF.,Zt@C!Q T/H
/8fCNX   !da:	J- X2@ hB9P!(Ej@	V1g
Q-`D0ISx-r!QDa*00%)I
@ 0!R$n 0BHnGcHcH@Dh(qBC$  MlA	Y]0 @(hLyS0$*b g$`|UdAa&N,<	:^T$bd\h"LDGr!1@<Ed50FD$xH
	x`|ir,CH\!N6L V!`Elv@Bn5@ 0B`6 b0` `@"*

!@%+ !CAl*J1m@-!I"!6.HX@'()GI 2*"4 X,-"q49Y,HP F0 fE	LNP9%RQBU\feMS31TR-`%E Rv0RM'lUB8K,!`GQBXE*[t"XH]SE``88  +B($<5DB 1  0$\E!l	 zLA	"0BPHPD4BIf) 0LGK,0{TZ`!n,`	 "( ]EB"!S)F+cQ6J\<DEl@0A$@$(<[i@5S	zqB4B3!jp'=t:|D0)*b?5Zh CqVs6\1WrJ$30N !G@0  B+) L!T"Hm!& %xH(@J0  `cH A"CIqJh001@C  -o.[APf0 !fA&Ha@b`@("!B	p @P
!D@@ !L=LR[2erO AP4LQZA{H"$ a)<L"-! 0n ,@HH&,h!dT , B %/ vPT |)-]P`bifCDm`Hd$zE
0Q `h` |j1? P&#TL)80(E( D:=D2 & 	A@ *@& m:G@ pB alE+@<,!HYB4V*(4`=
Q1`1FX;$c(``00*``u0Pe$e "x }J(b `	   Y
#P
q 8Ze.aB_Q2]HB2ZgP$(qN(\ HzGV!)PcLa!%*B3 5F1X	R(KTK 2
;FR"qD "EP  A&Jp  %| Bdu!DBC
  Qd
  NQ@jD(ruBIK"f
DFP3!;@
ZA"  2P@pZsI>/!!*jA`@ 
 j 
q	!!k t'KTDT0%bBLc +P@0 Je(@ytQ!	W  MTX $	!`d@	 , GF
 d4 %GF  Q  %
xN+," HP<pHPPBB+L (F@@r &A,@PBI #r  2q$D&4J H.G!&XPZ@	}&Q	3`d@h	!``0C  `DQBdHeBqvWT  >CPX+s2cP$]@1=qti) * 2q*FW;/Qelt"K A8AA&@4`	%& A:x)9 !X <KUx'L,$ +-@ic\B 1raD5FTYG,@F' !dHE &J(+0CKb&p:H#@) Fx`LPD*p H4e',+2l2`aKG0 UK"BT:$	RDp$"bBP
!# `]	& S ( R	qV a$ '(4P@pA
2Z!#)A#P9@%0=F L 	F)6PBS(! Rc@ZF hmM*, &@1D`A		lA<*3gGd	m	1C>NL8b$ ka	<" !@[r PxF@6`@	 A$@	26 BN!
=IP`X&(*  `& P@b1 !pM$IHifh	DI8B<	LRg E Jp" S20 @Q 0p'*"DfFT*'hP(n(%&U,Ja 8Kb!**((Q i4@ME6Z%8"QX40@
"AH51 2 jH T !00P
(] "-Xb&?Q rB5%G(5wT91&ACB$!qQP Q@$\@,F`DJa,B4B!R(PM 
*, ; `+C@j8$ 	I "M $T(PA Cr^@Aj$Y
K!()juL^"8T)wB
d "RTC@>dk+OgnUCa@S%
cH
a\W'`Pd H<0A_F,   3$H  qrB	(AH  ` P rd0	H$b,&L2q@VBTMS  pA(:t%" YRCDH X[@`LLJH$JX(`%(PL Zv{rL	,  $ 8H ` P9 LA IP	0`@1 % H(E4 $|0d)*rp ``@8$@*cAE*$g+D(I=0HIf5@#>3m&(xAa`@.0A) `@T7`D4YG(C)p\M@dAI @X 	=Hfm0XX8  E p" M&	P  ' T@4f z`K/@'c@ 2-HID"QTJ1D!
-"`y-<0n$$B"A0"
Q 
]" {9 :Bb#:P/PA%0 dM5I0QGD@C*/ Q*1:ART .RJr#y 0@K`SlHI4Z @   `79A l0,JBP/%RI`!@
2B KP@	$C 4b '+`m	E $ ,   
%MmF,0j!#
PTB
&/.^8 t  , &Nrr F.ye(a	QTeGX DQ$@%.  LP5O	@fq "RDd\<\	( F8wH@ThLN   #at4@a	A 1$A D*0HP0K@`j"HQ3t!$% +HU$$@E** ,QP djW"8<(ah
T	APD:]E Q $ QQ
P6B*Q^84@  @(	 +T( 2kN$F("S0T
AAG`"HP@
]   H1m ' )% !Nf|D@"Sy |6*JKQe C A
"$CH(E	 Hto,
 *bG!P\q<T@@ B `BHX4B @KrBCLa )1!p( @`r
 H`1`#D04SA#$!fKqY?A`X0P0 A $
HS0T0M@Cy@bI G]@(i8\
gQ @>j"
` @( > ,A bE+ `ot	]hA& 
d@(&4jQ'@ EH8&
 r&Mm$n :A h(@J`TQa_bD@AZ(@(!YkA0!]Jd 	  0A|aAaI`
 f3-R6@lP1B P!	,aTr
9BTTn"4fW1$I-@!#K&b$h4,$hxR`h?5BIl-1X2P7!" #0  D@Ap8lMZ%F\RE 0  h+ 
C D 'PQBHr$
 b=D@41JB$d 7((o  eB)@2D#p4$x
"Dq`BA*@pT P
&H@JW3  @d4 Q0) FtA
 9[.!pP+DP|d[@
C`4M LM4fa`TaTIgc $."E!F l "T
T\2Bd5L D!s>2Lp6A 2$ P$JA DU  A1H
<!\"@q"L O Jb D $ IhdM$8&,4
h$`'!Mu5pPacE%Zk!cD~=8( @2
 <$C&.4DH  4lJU@I0	@OwPq:A	qRY6h0
f* hj@wH0$ lat(s@"G M' RA	0Q

"tDp$hE@>!-ub
3d	,F e!	6f `,B(%$$$I 1x!0B8IQh  I , -\ >((:4Kt*:Q,= %29)w{?EMT{{bF{}>bEw7f{>fR2-.v2+g[ku':7wy 6y8c*%igJ@p t9pt$ 8 "2R  @(XHLaI2G)hX@@	  e( Ik0AE %#"?8 `4G Z!  lMB+"&m`	("r EVMjDA@a 	MID!J@`9PLa10300 t= @S R\S.}z6_MW^oVow/|}?Q|^vnF.f;V4<KWW~||<Z^SDl#P`lcP D dH$$E,A0D 2P& F9HZ  V"*vK`!	8C"S
" "C "K@  S9G92nom?}Kwcz3qgW@ }m]uOe^75.-8<Ufk~4"v<O7.WhR(:z'7Us[W~=.xojY_w=u?VmF!cs?sJ89^ 	\Dv <!	T`@@!@#`B )@va0ha@=8J
IH
CD,	`
T@@PXXBQ$[ #}ng$o3u.uo}<'2'{Y1?qw;zFNb~-Ec>OQVK}=rf$s
  @Q&8	2!X* %1 &@8&Pa	 P U`i0lpP!8 -n,xZNIBp`DoIcB p!"HT0L d `G bt Ip 
 *`P	<!, ( T[% )T` |6g$"(LE\ rE J H HHR@U6?t7n'gqdgD]A*o-_-_6ZF~Kku~~}Jze7n/c54_osC_WqwO1wO, `L SHb Ra41 1-$C $@ B@f" (yp A E Mp ((" @(	c-:#D&1& X{>gq*Kc}i~/wn:r2x]1Uvj[z}8z{2^_xf>u^p?SsC==m|
}Y6|:K&m\-+-~vZB'6A >J	Iz G,|!$(7t3X`2DF B`@D 4- F(JQP6@@C6 9Hx 
j%L TUV"\ d2P7'S:#'+)UNeF:*G]Iv?1w*:f_P\~=~g_=a@AbJ@"`-I-$0 `.!i%%`aD@B @ Kp*	
QpO.YaRH)t4!{ E1C/@#\@ QQ@	!xBf#!Rj T	 Ga! U>h0ZPT tP,@E$`PX%|P MmUR<t,Ta&@{;%O}cHr7|w?YTF?5U"^M/c9:/*sfn^g/o$h4F"w{nGO;A@ZN  T	b
$#0`DRhPT*!dh ~  m+@ @P
HlP a X ATL@$2+A+D FjK ` P(C w^^}nnfS{yT@dc+OB5S6=g3]=sYO.\F;Nv#omn~=6/O:gwhowL
Nwq$;&]>NO__3&A^Z/QR^]>+g/o8sgwOr.?.O;fXpAg HQ!&	 "E0h`J#Av0$" M@AA>"CSp BvJ @HM}
,6   P/@D& p H45/c{_V?{\v;/ g[c\?g(Pczw~T,Q}Du:\)eTWzwa/-@_/o@&h$@ C Dfd`@ B$D $ l\*cF40$A  Mw ,"TB)IqG/H"D A$  " !-1cZ$TC'{pM $@LP&TdIP $ -	 `XP
'!A (w 0h
 (bC PjA,hAC `1HD>]l]^~4:k~gSG|Jo{3>n%#XXH9CMZQ7?{?]E{~/uO/7-- '  
 P"HH@08"1@m	D1GS0
 I`KdOpTb T 0HC F, C*) 	$X/ XE8PS B !Z{=ownsU^?wyJ]whwW^QHO]{}a;lE[OfYO=?^}W`g/hqW/KKWB`dt/3cf{[Ws|_:uGiLQ+q5~uuc>:el>Nz{W%.IT@Q@ -E IXgIoA	
 $+!*EA@
H@A$&pa!*8R#apQAsx  B@H	.8QJ N dA=K_WwOo[bm{K[MlVw,!-o:nZKY~}}&lM]wNu|]] .C*a": 4'b"JS		}CCcJBeP@aDCPCs$ 
@& TP~J%5|@'V  A 
(a $:POo,$!@$$"e  2HA) dglR FP1	 8`Fx  ) B3P(
e@b$&d@EJkd;Q_:z]w[E`v=?`y~_f[~3gq~N}~7$	#$ @r3\F@ZJHJ-&@@Yp.GHb@b(|JAj0/ %a#@OP
0	@pbEP ,fP4N"	hGqwIO)d{cO{}?oZ3s|:?/5WDXvX_oX>/zoQ&p[-|RFwll{#*'2[7.t?o/[|^6yw3=]^Q#aSQ@  +
	` VZr98"% h(p
FK0<@DFVu&(#& ,ar	`b
$@IP\"BSd
BL
o>6n}yto'o%Psx'39q~["3Wzj!O"No/ "S 0!$@0@ H(p	mq
  p`C<$%@CA"D@'f	FRq g@
^wL &\^)PP((", Q@R$`%	CL`(EUpv8FEYB "`,` B  `P Sb# 0E&BF	aXH2 R(NK {( @	J^1}To%Z|7{Sw-/Wz/S;L^~nO[2.U>:vI*tL<S[}s{wf]y%Zqe[|fop@%a l`R2*#3TT"x P0X1 h2 PH0  T!B(+Da!n0J;P@
q2P	H8 *
,"_n_g,-vF(sWsTl_RwlGw5g_|wM f_{u}G_]$R<~??bXpt]!!>#;f?=o:/W_{~,Vo9K{_yVOS|v7m] G(@ eEpL!{ G)#x	+Sb,:7N*K     5`8*D bT B#(
I `oXD
@XU;d[#u#wsou{z7)^3CXZ?lcZ/uyrJO^7NWnxO^vq]k)dXP]h%#&vH82E &E)KFQ	"Dp8 DR@S&-0  "Ds  P; $4 8`NIJ1 AMP'%.SNd [e1( 0 	BLpX,	`

(* DGL#A1 PPoO9qDY^zwNo&Bunf9M>kOIm/r_UkLPSo~}tVZ.d~D4tMLZ :@ @4fL8Si jNY&` K@2k2"8p@G @ $ !ZXED;1!DH!
bQ<3cw7Z{w}S'a['U;O:_>gx6o>?fyorC?z{i[0h8J?zk_?dFw9zv>(GQMm6k~;Sdx?\9SM}[zy@PrB 5QC)bbrA@ E A>X( @	P   
x= Pp 4$D&#
9)?j	RAY4%
= SD`C'D@}w-*fU{UO+vr3#8wGwi~~?/z"t<?W{p-[l<M=tcMX^HW) <pI	P/y  hX$8r	 
p  `  QrA q6B@$0@$&6@
HF&0H  Kha$D\ (
sq^@K@ Q!Px#:8  )$" KQA b@`N,zHP 'R20,>@ PA$)% 1hA I
nO<{g/hwo37]w{VDoZ%^O9>mx}`pNO[Vdo~]F7mzO{=_E2XBT/: )E)dF)@j&!)4 k2@LHnUQa %@Z$:(K,
/eU)q@8-8(cJ$+dH0;]qE.wmR*m}['w<Y#t-zZ_a@I*%wov1w~7&J~ua?oZ[Nb{P5u5nL_Mg<??rTU^7C8\0C D2'1j me!PLEM@T$@"4@  BN@r	
 (KqKC(  c	@1`#ZD8sB)8>I#! <@JyPP'4QC"x -  )!J	!ik$la4$F`fH3XOh@ + [!* 
6 e
 ' kPB#$55 lX@! CD'+PD#7$ 
/9eIBVpW #,\P  rPWlTX2qUiAasHC. Z8! )(KMFGC(`UUD.@@/P0@5v] I.9 (	9p =@)B%VH"!Ad(p)`> (h.O0`"3Q
b 	0`2  
@Ld 5K ^
D#r),a-
2``AE 1-,K D
&H .[4eAbRnTH`AA	ASB%YP1ETJ(jfEr,XO4 "4, $J!r!U  @(#`@AVk%lPVRlp,`V#@A@@1@C"dSX F*@ Lh %Y L*	=c L XrL 	"@ #%%D	HTA*@8 4H,<P  `|A@9X(D<Z@'
g<bIPcC}:T%diAaL4W@0V"Gh
p H<&L3X3 A[P(1kyr )  H@BtP!$@H\A\kaC2F	(bB
Av)T1-"D0 }a@" e@00P0PXqj$U Z7DJ w 	F!HN `
:@8r(HbJU<FRNL4P!2SLbFt h"@@pFB)X	(L M%!+1t!5H%  A M`D4.@2J2lh"Q  OZb@IHYSS.9AdE
Qlpl\Gb&d'  py
s0% H$)T
  "fIBc4	ud!@L*%U$s!8) - 04@|,Te<:~P0  $I@IB@!p%,Rw B#P $*  dI "T!I `.q8)J % !`GHT$
V
p! B  Lhq-1TX`&A `B&C@XL0D 15iEJ&4)GTAH08$|2 @BI&%hC(4$# L0 C	3 l (bDOds
3g(b 	!3>G@ =X jCbhJv0P!X n GB FV0@J~FeiM &  0MR(Q :@1J4R`@P xQ j*"JY "RH
i0SgLa0
`26(
i%r@+P BS-U V!k 	4A HPDfEpBB0Ei X:Pd`D3#0p C(0AQnAvU0@P 2%!3pR[;G!   Rhhl BpUHEA
p!>t  BN"J:s r\  pCD &I CPd) R 516 P %
!b +UH@#FD
 	euc#4 1f '(`,Nvn!@\D#!>b(=$^`MFa$L AA6,7di(A &yTP@aI 0xjYV }
f)Y0,=B\:	
+HcAj  d ` AI  -29HB1&ByL"T  '&)R(0 @A$$K5FFF@`2.&#d@Av],N4&E$ZI 6z2:d8i (P&J9() {%Q @$+' )
cK5P  `VAJ(*BY*q -dJ09!	&   U0LJ`  a8&D\$S"B0PF 
ADh "q(s2	$H02B% 
b *)	(!84 `
X	 I`tMfQ45GH%#a4 tt
 *BZBiO4	BzD#.I fBb  K4 r%L 
HE>	J g1FNB c%!rF H J"2LDIBuQP!  pRs!F"rF=6:@|(H\T (,!"0/HAB `:	B`dFB`L@ @#&l%P XQid4
 2 1.@ 52,A=),	J@8QL0)@Q 88 bRb
H,@t%
m)PRAB$
#A@m`QwH"@(5@XX jaBT DCe,H#0:c^ ` "XA'(D$$:8.cfa /{r  	BTA'$)	)p89q"  p  -pAdR}@p! sh*@"
)]A ah <2DC2hPy\*Q<d   UKg  $%Q
*@CR!AHPMD :	
Hk I E\Bj LH$K8HEp gKSFHk	 x9 	=@M ! (q U
A  FX"G`BB!	*pth`	9!3T0@BcQT 4$SJ2`
8
p &*3Sd%G8#|T@73I<On(UXk
H@`@P  4- L>L 1
`NGD (;b E @D#"9H  ,@$mQ x! BH  - @)KB 1"A X%`Q,BJn!	2Q $N`#`3A@x!1H  i`@Be:j\..@  6b  T"M1($:&$2* B
[Q X
EsE~Qkt$(,*{D$q	zAO+X 1"	1\||{6wn45I/{][fwsyO{sp{]'Ov? @n<X	2282F@!N	5*"a|,2!iSC`,A2 F Z0M,Iy 
VR|q (dBh'Ck*]H #@8wL
:.QNE 
l
`P86V+  %JIG$820"b{{:9` m2|ZI]O^78O@BcHh^ "?~p~QG~rz;s*~+nz~}ue.n)z}:*76fWybpX@Zpc6~`p0X) $k6 H,}p  uRFSFE\_,1`
} 4!$1L%'PAJT;
C#6}+{5^~m^/-'m8{N+v"K!LK(ro*Kd|C\_%'~gz1N"#}}Y{-m\Y&>w'=rzcCW< iH%&	b0y A$9Xqe+&(!	:E:M)C= [  A`EDT(0#@" ~d
"RLvTDIJF4Spyb}e_~2^gg_p5Wm_'<O[wVw7}o^t<e[=W07eT- u<!0j'\[@#K+@BLA@	3Ye14@C
 *|7JV	@<`+4)Z !^A'%u OP!CA!%%  CjuQ| DL52b thGPxi-JtAE`	&B#tr(lACf0N='
lVHLFEx90D` BM\nN_z/Wmo>W<F{=nln=?w{F?m-_wMo8_z{yjZ<8P"!R  &!6!! p<>d:g,YU( *(
&Bce%r,t`=4q%  nN`	`k0pW1!p"(W&GmKjV7xJ]~cy6Wt]}v]\Lr=>@k{Wcl-=o}oi|t}jkxR.q;?i6Ym%m}rNUh:{^^{+H{NO)]_wW{ @i/#b/7L D` K d9
b p
cT=2VT fP(GA`P!dru@Y|1 B/@x.)z	_p8m09to+V|]U{?_^v};]-R8	*% HLgJAHC$B"/BHeqa`HrB30J0r11R)`FUA&(HE,JSr+$,9X#@Zh<I=,~N\"
# Q	XLE7PTAcB  B(_E^:A.i
mJ I
$LPqPXT]p ;PL_Y9=_K3=Ko{NomMs_BnEE/}r{?<lQ^5u}K|~k]imDYFqD$jD% J2xRc.@`qP J"[ JT^9B`DfIX#@!I  *Oq{2CTTPzI D`Mp	)h *?	+4Wz6]oXh7yf[/^>oWuR{w/?w0;u:}m_Jy_^=_xvYj,z6gw;7xl{Wea7?sy#m>zs3n{4 38	"&7@R*+(> eL  ysbN &!(p5tXQ ;[M!B"@xfFc	Da#v0U3CHq@
k7OKGs{iIt'sxzOHyv_kg-OM{mo:f&u~/6  b!!5)rHdaGBy3PP "Bn(4FZ9w o.!EH :H2L$K/%@Tct+ ,$P,`Op@
53 V0<`"$T! P D( 
 l+Rs`0?DD)M@$7N"HQRb9 pM )@j}_]}d{8k?~Y]6~_v{m{fs{yZ\5}N?/
 ^r dj\@ $H  q FA 9jLx*0R%BD $`I2CBhLH@@xH`u`>|m~MGm3S]~_?^wwbs.gXtytoI-O{?zmQ)ssomMT_wl}k~yxm_35gtmM;;';{z_{mpv|/^W c(% 1. VTmEH e
  a4]NRRxy*DRI6!L3!+ @ rw{Owrgs{1Gw\o?+l>o^o(}cay~{cIkS?_?hw`=iul~3]nXG~i7?v/)i\~qLzw/^s3Nw3
e_N5}8n}+}KOV]e,Z>pmmuoSmI.Od^lS[[?\G?:=8s%hmU|kV?On{rLm_o_qOn|\wN}~o{2LL}c_/v/}gK_yw'?=u/Wi>_V^gMw~o6K+>m^72|hx/d}+^.%~sWv5t1]-O$W7muwojOKx^Ov'[cf.sN<O;~Muw7G^o'zm~|>|~J]{x~/u9?9]n]Vs_nOC}7cj=y%?jii^gz?O~&?y_oWd
vzv,B.{,b\~@%9HnMYw,gs<UVZ8ygzQ{?:{uOn~o6EwKocQz-y'yvv6~hc}]Rw>{],Zoe.}g^=v{~w1s:Q:^='n=yyv{?}Oy\9kNUW->#1{_^}5{O~G~y{{>.77??6n*6_k}}=,';/p{ik]g:[_DN7ww{>Uws#zww<m))9!~^[Ip*lo~>NcS7}bj^q?{cqsgOO
mW[|to1o;c=gwU~7T/KT|X|"v.~=m<2x1zTKm{^Ze\V^.}6,>2W;_zG;Wl}GvV}&^?u\m1!{?-6|wsUsmst|O*{~T6XF#oBlU^W_+:sU>{:{t=Hu>+yyonu^W}o;g69vT^v7~S.`?^}6&ZgL_O.y}GYw'9{'noo1y{-iz/Z?3v~o=io~d_osc>v/3Me /SC]W=HWHSW{?6WV_65h:No?Ou:v?kwo7WjV;V;>uD1>W?6~E[?}esUwsy?h=U~?>_<W]j/yY</WJoov/7c-X&fh_{.tXYKV+Z~;_;4gZH[v7Me\/wk#>Z?iM{k?~!l_f=ky3_monW?}\\Vu$w~x?~gRA!4'-w=w_?|6vz}[3k#}-,Kt=W/_k7f5/[+_]Y4Z8a6~'@w^7nww?txG:/y%q~~|'_Bv{}g/JKv>/]_a.6,vZ<]W=Wo/?Y9]z?^~_M8c4s3'wvp)\vRxT'w>W3{w=?UG#2;6fy6U:XyGm{u?3{ZbwYGg/w{)7[Z_W<z}wsZg~_fn>m>^_WD_{Ga0E[ygv^mwwp?Kn{g[f2;{Cu~&gtojwF}t'~Y.+=Yy[-yw9>0o{zn!7iW_{6OiV+W=]`s_lzydHY}zsd:SOnW=2_WayG7}=[+{%__GTs=Fv;_E-F|q|]gl~w>;oM[OuW}Xvwfty|$
??"sm?-6z;jEL\i;-nv?0L^/Jzi3*~?wGcG{-|lw`&&]_=dne.
       *
       * @method repaint
       */
      repaint: function () {
        var btnElm = this.getEl().firstChild,
          btnStyle;

        if (btnElm) {
          btnStyle = btnElm.style;
          btnStyle.width = btnStyle.height = "100%";
        }

        this._super();
      },

      /**
       * Renders the control as a HTML string.
       *
       * @method renderHtml
       * @return {String} HTML representing the control.
       */
      renderHtml: function () {
        var self = this, id = self._id, prefix = self.classPrefix;
        var icon = self.state.get('icon'), image, text = self.state.get('text'), textHtml = '';

        image = self.settings.image;
        if (image) {
          icon = 'none';

          // Support for [high dpi, low dpi] image sources
          if (typeof image != "string") {
            image = window.getSelection ? image[0] : image[1];
          }

          image = ' style="background-image: url(\'' + image + '\')"';
        } else {
          image = '';
        }

        if (text) {
          self.classes.add('btn-has-text');
          textHtml = '<span class="' + prefix + 'txt">' + self.encode(text) + '</span>';
        }

        icon = icon ? prefix + 'ico ' + prefix + 'i-' + icon : '';

        return (
          '<div id="' + id + '" class="' + self.classes + '" tabindex="-1">' +
          '<button role="presentation" type="button" tabindex="-1">' +
          (icon ? '<i class="' + icon + '"' + image + '></i>' : '') +
          textHtml +
          '</button>' +
          '</div>'
        );
      },

      bindStates: function () {
        var self = this, $ = self.$, textCls = self.classPrefix + 'txt';

        function setButtonText(text) {
          var $span = $('span.' + textCls, self.getEl());

          if (text) {
            if (!$span[0]) {
              $('button:first', self.getEl()).append('<span class="' + textCls + '"></span>');
              $span = $('span.' + textCls, self.getEl());
            }

            $span.html(self.encode(text));
          } else {
            $span.remove();
          }

          self.classes.toggle('btn-has-text', !!text);
        }

        self.state.on('change:text', function (e) {
          setButtonText(e.value);
        });

        self.state.on('change:icon', function (e) {
          var icon = e.value, prefix = self.classPrefix;

          self.settings.icon = icon;
          icon = icon ? prefix + 'ico ' + prefix + 'i-' + self.settings.icon : '';

          var btnElm = self.getEl().firstChild, iconElm = btnElm.getElementsByTagName('i')[0];

          if (icon) {
            if (!iconElm || iconElm != btnElm.firstChild) {
              iconElm = document.createElement('i');
              btnElm.insertBefore(iconElm, btnElm.firstChild);
            }

            iconElm.className = icon;
          } else if (iconElm) {
            btnElm.removeChild(iconElm);
          }

          setButtonText(self.state.get('text'));
        });

        return self._super();
      }
    });
  }
);

/**
 * ButtonGroup.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This control enables you to put multiple buttons into a group. This is
 * useful when you want to combine similar toolbar buttons into a group.
 *
 * @example
 * // Create and render a buttongroup with two buttons to the body element
 * tinymce.ui.Factory.create({
 *     type: 'buttongroup',
 *     items: [
 *         {text: 'Button A'},
 *         {text: 'Button B'}
 *     ]
 * }).renderTo(document.body);
 *
 * @-x-less ButtonGroup.less
 * @class tinymce.ui.ButtonGroup
 * @extends tinymce.ui.Container
 */
define(
  'tinymce.core.ui.ButtonGroup',
  [
    "tinymce.core.ui.Container"
  ],
  function (Container) {
    "use strict";

    return Container.extend({
      Defaults: {
        defaultType: 'button',
        role: 'group'
      },

      /**
       * Renders the control as a HTML string.
       *
       * @method renderHtml
       * @return {String} HTML representing the control.
       */
      renderHtml: function () {
        var self = this, layout = self._layout;

        self.classes.add('btn-group');
        self.preRender();
        layout.preRender(self);

        return (
          '<div id="' + self._id + '" class="' + self.classes + '">' +
          '<div id="' + self._id + '-body">' +
          (self.settings.html || '') + layout.renderHtml(self) +
          '</div>' +
          '</div>'
        );
      }
    });
  }
);
/**
 * Checkbox.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This control creates a custom checkbox.
 *
 * @example
 * // Create and render a checkbox to the body element
 * tinymce.ui.Factory.create({
 *     type: 'checkbox',
 *     checked: true,
 *     text: 'My checkbox'
 * }).renderTo(document.body);
 *
 * @-x-less Checkbox.less
 * @class tinymce.ui.Checkbox
 * @extends tinymce.ui.Widget
 */
define(
  'tinymce.core.ui.Checkbox',
  [
    "tinymce.core.ui.Widget"
  ],
  function (Widget) {
    "use strict";

    return Widget.extend({
      Defaults: {
        classes: "checkbox",
        role: "checkbox",
        checked: false
      },

      /**
       * Constructs a new Checkbox instance with the specified settings.
       *
       * @constructor
       * @param {Object} settings Name/value object with settings.
       * @setting {Boolean} checked True if the checkbox should be checked by default.
       */
      init: function (settings) {
        var self = this;

        self._super(settings);

        self.on('click mousedown', function (e) {
          e.preventDefault();
        });

        self.on('click', function (e) {
          e.preventDefault();

          if (!self.disabled()) {
            self.checked(!self.checked());
          }
        });

        self.checked(self.settings.checked);
      },

      /**
       * Getter/setter function for the checked state.
       *
       * @method checked
       * @param {Boolean} [state] State to be set.
       * @return {Boolean|tinymce.ui.Checkbox} True/false or checkbox if it's a set operation.
       */
      checked: function (state) {
        if (!arguments.length) {
          return this.state.get('checked');
        }

        this.state.set('checked', state);

        return this;
      },

      /**
       * Getter/setter function for the value state.
       *
       * @method value
       * @param {Boolean} [state] State to be set.
       * @return {Boolean|tinymce.ui.Checkbox} True/false or checkbox if it's a set operation.
       */
      value: function (state) {
        if (!arguments.length) {
          return this.checked();
        }

        return this.checked(state);
      },

      /**
       * Renders the control as a HTML string.
       *
       * @method renderHtml
       * @return {String} HTML representing the control.
       */
      renderHtml: function () {
        var self = this, id = self._id, prefix = self.classPrefix;

        return (
          '<div id="' + id + '" class="' + self.classes + '" unselectable="on" aria-labelledby="' + id + '-al" tabindex="-1">' +
          '<i class="' + prefix + 'ico ' + prefix + 'i-checkbox"></i>' +
          '<span id="' + id + '-al" class="' + prefix + 'label">' + self.encode(self.state.get('text')) + '</span>' +
          '</div>'
        );
      },

      bindStates: function () {
        var self = this;

        function checked(state) {
          self.classes.toggle("checked", state);
          self.aria('checked', state);
        }

        self.state.on('change:text', function (e) {
          self.getEl('al').firstChild.data = self.translate(e.value);
        });

        self.state.on('change:checked change:value', function (e) {
          self.fire('change');
          checked(e.value);
        });

        self.state.on('change:icon', function (e) {
          var icon = e.?h{jYoj		 9X :Z~?  vG@~L@~L bL:.PbLbLc6.!5  `8~L@~LpbL`2.bL6"~LL._GpU@:~L(bL YvL@D2.q  	@LXI .99 19@GFr%.}OI~L Q9T9H'8pDgZ9[  Y=@!~L`~L]L0L#)._GM?R8~L~Lp%~LbL .PM5LbL-.bL@SkPi6`~LL(.`cL  ]8 ~LL@3.`cLxL.NhU8@~LbL@1M@bLlyA~L>}L`~L~LV;M gL2L[L@~L ~L #~L< bL0.PMbL^C  @`A`	L`c@HD@:. @z   6@$~L~L~LL<Pg1.`cLpL,y   \8~L`L~LgLLqH %.`cLF;9\LD ~L ~L ~L~LhbLJ/.bLlyArP:~LPCz.F  : 	_IwIMfmL_:5X  `rLD~L`G bL WL'.`ScLbL i6@*~L ~L~L~LK/.L!p7 ~LI`>).La7"H9DH8.H9 <AtJ@tJ=0m6.0<XyE`A`~LK< T+.IIJ[=B~L`(~L0~L7`8rJ}.LX7*%C`<~L~L~LP*~Lh/9h{5.Lp
M~LWZLRcL 9;0l5.hRcLk
}D6~L +~LRcLLcL %.hRcLRPG +MD`:>L0-.=F;I6~L`HL0=LGO3.3ML C;4;G !.pjAQ yE4I /~LE|;'. ?\<^h?~L ~Lp,5H>6WH+. 8L V=~LP=\<D9 .  <!5`8GB@oiL.L'c0; H@LEGJ8L@ <>H
.XTLOE@M A:P/DN-.HL</Di Q;,~L ~L(7x~,.   k?Mp9<q,.;I6n>>>>.>!^.>.^>^nnn.~ndnnn~~>~g>~m~.P8@$!8P,P80-`@8 .C8@8828`A8c"08Cp88#888@` 88`78(88c!	88c8C&C8C;08 8C8 .  S    "  ?jSjiPi
~j%/{;o*&~9Y)#Y)1*9YiiY
1*9Z
ZZ G Jc9Iw#;X#D]MH+.B#DL{:WL~L%~LH~Lj3. gL-T  xL/~L0~L@=LHu.  <~,CM/~LpLPw..  <o J=GL`+~LVZL HcL %RD).GcL(p\@ pG~LL8=(.3Ml  yAvG  ~LbL{GPbL,k LD ,~Lm-;*.m-;tFNELG;@M2. ?\<Lu   l?)~LP;K<a .IHK<" 9;@~L~L oD*~LT:#1.LM`(~LI07X .LF7~L~L+.L|'`<~L*~L~LP~L@~L~L;.L-  M oD~L~LJE ~Lo..Lk' f ~L (~LGbL9t0.@wcL{=2.3.P6&~L~L`bLY0.vNt  ^:YL bFYL 7B@B0&Fd 0M &~LfLL(.`cL9  \8bL8{,.bL&@d6`~L~L~L0KmG00U7~L %~L~Lg).T?:bL@.PbL;I6 +~L!~LbL0.(p  \@xLR%H`n&.`cL
pN"~LHL!.wx  t:x|L@-~L@ L HA+5. 85`:!eM~LM7<P<@LM.0 `1;~LbLbL`Ft:.;I6@~L@bLph9L bLc  6@bL#. bLlyA=~LF0/D ~.HD/. 83vGI`rDIpm7EH-.`s7PEH1U7 i|LP^)B`bL).hB)B3}"  	A ~L@!~LLX6._GXLr  X8`~LL@SM@-.-Hl  T8@'~L =@'~L0=0Ca9.FCre  `}:vGbL0.PMa  nuA+.;I6 ~L0Q9H8".@Lf =;@-~L`~LHL(+.U<yP`}:IH^L`KE.U<^L)~P7~L TL ; :_S>:.u~Nnn~nkfN>".c>.^[">...."s>^  8# 8	#88*8 2,8c@	8~)$`/$, 
<c88  PI= GV% @R Hpz^K1l1GD<UD*8IdH9u-JpTB,A8BX,""5!1`b"@"	:8EA\~0&Dh5D5@H=!D
Y8"cm@B @O
    x s+`$Ap ` `Q
,!")9"TT@!A20L"*bD2Ch2HP(JlJX 
0. "v * `)lAx	 Pb r@&IdKD%"I\P b#hS.E`PZ0BYF"%D,(D`A@"8 G|MJ!L-tHn!OovH- U#21L	@bbPO*! HQ0	@  Qz GDK@"dHB	q  P@Rh&F+	Za 1dJHq   re  
- D   (0jCHDp;@0B	(@{@0VU =##8S<*02e A1	G
S Qzu?E
8"G#n 4  g28QK@B#(KI$e;K,!0"``)#7V!TbL$MA4Ug$M: JA4d`	FAH$@G2 Bk%$Zn1 '-2PZ$$(! 0"'I dP)d%$Jg$ 8 " B@2Ur|  2.!P-S,Jl+((D %u&(4E
 J 
L(  B1R3z %<- t>@F
  $S$p   H|"H.f]2
! $V?B$&@%cI	 Cl~5+Ji` I $A@
&)kCUD#&Qm""G0	9	 jd2@@(\ G8  $  M0"$`  H b	 
`3XU*a 4
d$
06 &@`<7rBX@%^'` `<2vp",%$5I`!`.`Nt 
  c`C .!;hQFx=MAT  eTAt@ R 1+PI/b)a. `kA;xEH `*HR}T0xSKAT #1 $(T@Db 5RHF-K:hh0W*\@ *Q 4CBD* %D0i*B0! $@"J_Jl"
p)lfA  CYDX&SL  /We$2 P M_0`	I A%BI'5	s1* CF20F	>?8L.bg7cP :H- 
 M+R)+[&Hz"#@m# gnth4DE^T";m c4$cmqDa86!tgBa1 P  #}B(bu  D JB(c` EL
$5< IQ@SF` Bp`B+B00AJ$:`SpJ ("
sB\R 
H0 !xH  0	 `BnHRL-	(NW-IQ!P?E)YD@yAq ( 
G_'8
9Qx`TI}_ (#b&pE@8$"&&z` d8% `B`@DthZe&N!0ar` 
HaB &Or<x -"j$[E  J1 n
' 0 BR;FH\|E@0F+	%  2 D(	 L   s D$9`a "
>A( : 3  `I@e` 6 ic@@j" Bt*9"
y dB p! (@kh`@R	[`xMB@@KE2(	%A&aMlJ@	L. 
q VSbgjf`<JeBijUFDbX1*@0 8$p".	e@h9 0 G7KP$,I~ 
ICT 8&M+d8  0kZ!`(" R XP-$ E6Tdj #qD5(0v[c"r- iZ8\!X5`XZ(\bpF& ,B&\0HI$>M)-x.P 44+GbzD	$0r$`-D"y( E,bW*Nb L*a@ !G' TPIvQ@A%S'f*A8_ y'e`5R '@   JD|BqB
HtW (&,LPMB< Z!&T:$JJHeH`1)Ag@$6DXDqOQ M)r0jJQ7l! TQ\`%@555vEi2Q "(Z++` ,"D/@C\Tl.8@a.F31*=BB bAB p
$+
`  `@@l-  r @  ASL`%2BbrQ@$D$A>}
=Rch 	BBXyy$CJe/Tta %VV (
@blb0Ha @ 0g&r4RxI `0?b&/i  C4 Z 1$$ PSE	 H`@ H!	Y	x +A@(H @V"$B @R /ML1 T]PR H0 E %#	 9 Ra	FdC'   $+ [
   <DB10!V`dP-#%   bE q0pv #I!VhXS=2.Sqd4uph "j aALD"H@0HXTCA> @A,)IdPM" `)!
B`2^rl!=C 4/I5D ADtt	 HEWiG@h#)Hb#z:O("%0c
$3*2!yB [l,7@
v- PPDD RPVH4 P  XU # TbD THDR{  'LD		t ARI@	PX
A A( PTCf!1rV@"MaFBf 
G4, JdFP1 Xp	KMw9Ij6Q{~n^>GCkM-SovxW|f9}rBo0j{Gs{&KhzeW'n"\=e}}Z|Ux=v:(S/^zuG>n3Ef{s\^{?(=.?Xuvm^-_qG7V_}%|eGU+o{:skF7Kew{k(NX-u-g/e*}N^>\mp_k|;~"z_iaVF~Fm~&]k/?UqZ?zzrM}U|gu[[~Ks1wx|on}&O;n}x>_qM+{Sf}ym?Oy7l,es_s5o<>_}~]S^O[u{Y}y<+'/6yzY7kFAcoF7~}Myo^@6Skgo^19.W9^la:tK>o'w|y_o:um/Vms}=)yu&[2yhOZ7/o38o/>=>8oWy_?~;}3y}?O1^Y_G-qYV]o}5q5M;~z(`n>!Wq.m5v8U^yw+fwM-/%\3o|B{^{Zv\{k]3wi#l5R:y~8|0uULsq#o\==/<{xWksy>vg-w{ZX%p[~l~NxZ/{~?kswnw[|]okr:>Nk'
/{wG|ZA{Q?/Ue{.\g3zunkCy_rGWg;Q?kgc{?|UtKL|)O:wYWz/FYWr|{[VsM_gan]kgwwc(}kZK"kn7H_?i/5^ysg>wXok53^Gyx7Q_?rqwjO~om7=i,`>NCy~-m}:?b{3$Mrs<ntB{WHqWUnK=w~?wc^ovg+w4a-}iqR<?_n??61F|{zSwnG{]]?&co===.ex3s]&i+W/mcc]egoRv;SA,|K!^JzXusOx5?:u/ewu=T{m3f'E6;Q?+}OH|OWp/~w={mhifI>:oo|8~vW_vuWhKwjg{%4vro}X+kW3{~pX~s{R5>>2;S#=wx,KaXkm?>^pzr/{59<Ky=yvN^5/_\_>6wXuys+_-n{O^A_cz];qF_nG\W#OVh.z^d^3t~GG_w]OOw~9jxwO;toO}0i>gqn^|ooeF[jA~|;;o9ramSgGIs?G|[^_^NSe^~yz|o?:?Tw]qZ|co<=-oZq1{^7o'>{_{Y"kUnw]Immo>'ucGy[q\mSCF;r(?nBx,>V~h?d^uyW{\g2fHTGk,[N+Nu~J#ooXwroEky'y>g[/][{i)'yUnvuO>fO{_yo_uW(<gOG<ik_oiu=|__?Ey4=^Y^o_q]o_lss;<axuwov[?e\<}}]osv$Yo~{-R^_W_w/4[v%[0_yWO~o~%'u3g{OWOpKwo}_w/?Fts3vyJ?]Zk4~~'TQs[6%]^l{IF_vkzmvv3uQWs/Ly6n_W)icEFV}z;o-}Ws>5!aVxzo .0PHR@2)\&f(t6:$"LBE
F"`I1COK%(j 1 4vP7=A	 w]i\2U93^5.w=nonuqh^F#Sf'{g2wn9wjS[r?ej_/?uoel?}Ku=Db}?{\/v>=ewy4=e}n:<kK?l<@IxDQ 7Ch'tgqB 8  )(0	!
iIy 5`L)  AA0h&B@+d GI ~O{*w-^^oc_kgxy=?}NWH/_o5wg+{>?y>,De L@60! |'(3+`LJE&@J D$<f 6@f	"\hT8"r$BFF2%T2.D
fo0DNK-=1 B
NT6 HM13!bE" D7%
H r.<x Q@) P 	D D"p
HqAU'$!T!ig7{_Msm/i}~~~(oxF~r|Lg_4|{{?=z/YmOY#qe9=@5&H2ADN $#L PX gR;8#O
@(L2	^@ BDVDXx B@F<J@@0@A@ 3I  [wnVj?o}tn4{{Zw{+jUc3}Z:__fo:QVG|:=?U~Wywtu&U>{Z<_jLSWiYxUVQ{vRukxf S'0@A@ D `$0bfH&rz $@`
&%Bev	R<0/OuB`E5%@ih0D0,H=.95}c=85u7{3jwL6\k];3=.&}k{YwW}=}ly_[z[zOHv^1WRR@| H[@,*0'D0OPgR2, `Y0`@ H(_\B ihXv  CZb1g 0 >D,A*  - D'1.$@ FCCvC
8qfARgb 3@Ll dB$@pG1[ @ 3QADDB1  (()Xz?hx?m=w~*ozhEhtw^}I9mWaW?uwl7< AD*2: ~0(2b:*0Ic6R/  D0E1QRX\C^@J@UqL`T)`@X= (!K`P)+J%OC.|Ks9y?Vh\0'-);~d"E:kMT}'m=y[Ov>oM|};4/.{wu_^4_Mw?fU}V<K}v:7zy>{&R=HxbZ
#1'Bc 5AQ dH
Dd*3k  $W CD@	9 

4G "hQ na `R`Bcs!qTAD3QwyO&ukn)?|O7~s={rw_'j2U/o~YuooU^-{CB2i 8E:B  (-A
	!3G2(aiCH[V *J_I"<#"8%$BAvE
\$PYA(tVHHACaD !G'@I$ DfJAk@p%"pvLPH-NP} b@VLA$@dB)C  %+\y-wl||}>{{;[7_]}w)MF/szyWGo<3/k:o6}c]|N{t{0`TT"X
+K
2W @+( $$0'Lg
EW.TD! }@P8 $5@B#(
@h`)YR((K! @P;DI $-MZ=c9|V}{{?:tM]O!]'yO}?R~K?x[Oslon_:{oW?n[|_}]+4?}C{7={;>R_=Wg=KwO_k,{5^}mtnf QHr`H 	VX9 ! d
d(`f ! T2"g$K@ ^A@ojZE 12&Ia Xp`H  4P ,EH?={igxSm{i?Wfn{.'gvsq_~;7''Sv{E'wf//__T4\F] v+w`KatG  FX@bHE@H")@.%z#Mcw*9K` L!
>Y#h*QjH\#T*D(BM(4*.
D#> QC00AMZ
2VJ
 x0$$lR8(a0PB&jV
31A J8O#*@7bf}}nn?rX+Gy?tzy7b4oky}epWW2cZvR6_-wcW2^:$z|i~-=MYg?)|s>%vOT7o-{_ d `EU 3'C\! %Bpo22dV! P	 @M\\Gp	w
jI`#EAb$@ReoT4iQp:d"(%F4 <wIB_qY20RJft@DbkAQfa&,`eV4`E 8D1$6"  F( +PuHNO_{_w{jV@_ggwj?^\nft!{soz/p6e:7vo r	DpD1@Q	XH H#  B\5	Kh,j4@T%K.
<!"v,`rBT Am{oOkg}OIG{~g<|m]Tuw<}u/gpkM{F&U|u61Ngag?|L};oWp/v~_|}|5!:Y?\;+NVw~j?8@q;b,Uf 2I@@`D49p(c
  178WeM# #E3=QPSZ": tI%#T 4
5V@1_yjrdWj^y?rSO]<5kwOO]6%~;rVu#yFWyOG777:!Ua A\  id "Af 2c	2DFu
,SV `*@
"H,  pPE@vP$v\1"A8Qdc
,p9% (X(G`&"40;o@(C!'f4Gq-`?@
 Pr4+zH2X).$:D%4t7Fw[Q_5}w-goweGss|]j7vo?o~{_wgOY-_]>9a*~   PeI8,SEa"qQ 1qH'hm_)B@q3e5	P-,+	IDCr]"
TPD2e-$?\9O\J_l/g393q6wg_d{_?<3Gp_;}>UokKm\U_kz{k;{gg77??~_Szu_wwtrK/Qd#@*&	*-I&
`n
<ZlgI`&@IAEA (A@(Q4Z%dp@0RAb]@ ! & *ZyFto^;o_{b?y{~gm/_3x_}m_Yt>fQ0{z[\qWuDP-"N}q?",0 #0`h`S9"Bu  8(@#u,#(RtA!8!%:,X:ND66h(+bL4@Ah(!"7(!CMT">(C,A\@ 1
&CH]kP$Eb@~&d@ q!/
c	:0R0Da M 9{=#wo{<.F7_|~*s>_?pv}gw3W8vt_lMFkO:_
1'_&p DbJ5.N%	qSs $$. \#"IBRP %=X0& M DVh j!Pd&OnG-oMw^]5S;[ms';'^.}y9z#?}B5_n:-b]?s.V?;gPUzwpvw^Mwg|zrKsnrz~eryU#e/[,'O(pA~S	~ F.&F5#
 @V*c R G(4[	& ~:!:Ah
"dB>#qb.@4$l4A $@FV rnuker}|Kcjyeu{+SaSs_;Ti;u
&7gx]~oi	PEB`d-D4 @"+b%
D<FP:& \x   H DW2F@'rzS %EBA! I-* $B4*	b
$ P DR0`(,X0&ST )#b)#a&
`L$uP%H3 -DP	 @ A)!@MCHpxR$Ip2 lOPE <Ibmn{u?rd:AehN>?f{u|-m.x-OW~77o{OYemzLv+cfOg AW\S$!CYM0 *3w`Q
(S8>h
2&
 -vP.8A\Jq,' ZHpdDg==BSR{Y'?w|Kw{=U{o8 ln__/	9y_fxFg{?[}_~zuwkoyktjKud??M#DVU__gw-_KouK3V#9|`D~#U1t$4%Ka3:d H( "%+8K2  p %)9 JfZAP!0 !v%R+@P#0*0ZDR-a9C 0
1! & x &J)ddkA 9k!L
$ 1J82$ @ YP
	goZpo}}iSn%d:6gzm3.GN.]|6v{ao/fQZ3v3^w{es:S.8<g/=~6?^~o;W{_Mk^>7qo<~/gBHA	bpCP*4#PKC`RX4@	@0Q`"B+Y:H%`lC*Q(p&B F(2
TE!`p j}
 jTBO93k_jy19o<.T|}/d_qwpq>dnvW=^w\Im~;{V 
TR(4 Afdr#:,BF	$ZAF* 
Tt$ ^$	B@ 3,V& "	 8d@	gD  v	 ]*6 PO
 4^	
!@5 $0p 6JXH(D	( cD#L! C`
ppZY\"	8 D4N 3. 4LP+WkVz~V]p}IWoynNu'/pgFq_?Gv/;/}p2zpZwT~|y9MDC wES =X eL9`m@NXc	x5"R:-QHj h) P g@P "P  @ @ $  dg&B@ H;TIFkD?\nS`o~cpg}OA/nbyaVzv~07-Wvo_o_.zuoyc_#tvOW7^zMq~6;@R{?0~frV}-`3{v\Is[fK)69
  H(	#A(Y*Dz+4*F1a)%\>  
QMq "^#:@"BBCZ  >29F2`A%"AbN `tuG6ni}wy>kw>7o?cu5{O-S?7=XwY?9;j[w75Vks@v`xHPnH@ 0AN `sB 	`X tB\  0T)`!  H#IZ`F%H0HR" P@@P #DL\`t HT'l,I9\B1y3n TEA`v	D7d*"-~.F00 q@
$lI$"P@48 (@*t D nWSk+b;o_qwP&5O|~66{eEcC|zsC15mXwwjgOG;G3Cr;ew_RcX ) <@"A X [A(H H!-m#6Q L,ZK* U  ~J$V4B p@B$PFXVAp@(!$!5Y_zj(?]|5ggyqWp5h5_U=uW[Fo;dl97sS_wN[uy'4}->oa\~_;S_?_7?<}6yo.Nw_F{=??]?7:V}?%UhOv7{=S]NM8R x`JQ^<f0
ZaT 
 p@E AZTa`#0p` 2vFS DS"M  Q0
DA)
!+@bu	 P
TdN4?{>~gu}o3~_?}rGRwu_2h|B?}/,~?M_+gx"A5|4U,RI M D|LB7ETVH  	H
 8H ArY	BAFLHf/ Q$ 		%4A@&m n	HHtDa 6PJH-E% 5jT$d LPB$0\`0 @< !-HT)	L#*
@'z I 0Si+P>@;gY|Z+oYqkT?[gw_C]j~DSB,:?Zynwjoa|/Ct0@`, QUiAE P[F
BEAB~ ' IS    @D= 4(x p' 8!Z]2-Dn`.=U;>OwbjFn>N{nQU|n0-n?Gs7z7F/D6-*[?E:N9]h5bCouM|^LC_[}t?"_vxEq{5g_24Q>wONE@
*lH1DF 8J@D12  " ,hJ `:Jba4Z,D@HDAW `@Rl' AbDR TZ
KJ$>MFx/>[};%Ldi7!k{FWOG'~U_5?w[|rax^iB!E!L>t D@ eB@  S,@3B=@0C B)DXMN$bA* `54$@!6( JIQC$u](3p).&09C  @u	T$ U"L!fE8I,F2RBB1J 	q	jem0"H!OTK:
Z`OeHH$TtlN;I9;%kk]>oMgvw-=?6Y}wK}Cz;w<%|Zw/42\g\Kd&PSE}r)L9DA~PmPBH%xDVLBQ_`	83[`"zO  o	fHx(5	1@Pm\cQ
&#BAwD0`R&rG kMAxU)k$	,bzcTBhvr 0((@a bA2 P
! B
*yR Hp	x@H d`  48Zc2d C FdFJvcHsl
m,pDaT01XA 
x6 M# 	 QHt	 &s` A@R0s
Zm@X"KNwASmOERCH6LEf4"oiG@vX!e KAD '$ Mi2X  E DPS0m!|A  `R" P1a( vlpA'	AO"#8Tb1 Ch   1D !H RG99h@	)	@b A"$!    (Td
d]8HQ(\jM6R `5`k`%'j@1d*$a	-L D \i&-B DgI)0P B1@ PR4@aX0Ed{15QDD&H$nVQo% z@8t~{bQwS*	L& 83 Gr880_,Z\"@2(Dd % 2C"&( Ehtp `Hb"B"h
0u p8R  0HaU	Tnb7@E@"\   R6@AL)I!"@hw m7q#d!u 
FyxIn$IlE(!tK*As*(J	#>-	E A	Ah20;"DF.VB"EJBfd`EQDA9 @L{	 m$ZB  RF%"F@  B`  
,D Q`
@ XZ ,(JP &%2!h% !HS 	 H )_ c"@Kr h 
`(A0	C , ` [0x=IfAP+  @ 2  	`@k ."
	F P	%XpPT |oH1u aJ(VJnF%G* @&U^p  	`5LR!\GZA0U_P]"rFt	 uB@DIJP#2Yib3 D@ JH$MN`o@a  BH  q#Z l	 5H "A $_abT4 e|VdBb;iW)C w 9
D-G)ADUIFa1zfBB(UX (d@QASXV q1T	z,8D=JaP(d.`0GLf f,W'^JDS$rN$ pC)I	-#@ A5h@@j0Li  AT&pq GWA$B b B Q0GP
  *iT%. D2JxPqm0h' I3+<U@  	KP(EL5*Z@P*   hH"(E$.@ P3a\e!hyc&*bd Jj ~` 4f 
*DE RN$* 7$*iUAP[2rarJd2e	AR"2(0\ 	
Rp{Ax`ED" h (0Z + P  b&R,2&  $ @@ HPU %i@(wxh @( XCu1 @#R 8Mp P4
4PB K@62`MX.E}R@IT@+hWb =	Njp@]PtgS
 DnA4b@3BLP
V)aY`aX
E@B ,b+J  ^ jP9 A'YC$  K#6C`"PB	! = IHBIC*)
S_
R8*qY?AE@MA	=@XtM=IFX(-e@0"Za%&S@ r1@
ughk@B-41PS."X	4>UP U)Y*#B1r
$DHr!0 \4VG(5&3Zv4,IE<PC$>b*zDo U"T`+H0S"bG		
 $An%!" !B	"@Bb	PZBHJ8hKE xD` BI?"" @"TBb @a@)A"X "!HX
#@0<^LR(a"UhK 
S?hBd)Z+g$.H
!A2`
 612* QqaQ?  x7KA@S[I= +LE(0!X4B	Z0\%  d1%!Y:`] V Z TM4a%T (@!	6R5$ 	+ i"G J   @@A3HL `-a^6. L B 0(B< HD L$$T(BH81"9HPAk8p
i0,`)P@T !0 0HtiLaY|pj~J qZTLP'v E!G&B(8' ,(@
&GB(Afp! m	=ja 8pE I"F C0 F`HT @$ 8EV@( $4$L %  % bR	 @R.Bh+q+T( 4*$@<)	C,$pf@t&4AXBC@@@!:"aB G4:8125V{&0 NUT:0D(A Ddy1C4 M@pn< i(*\C#b8 0Fp88S mxSH`fZ&ULRlP#H%= )ri  J,	 C4 @Y@/'QXgpT
L%
	yKIEK
h `MM ' %##1`T 80P6th .  (8"Q\_i=_>sU~~A?\Oowus;n?^yGr^?S{L|*4GO9kvc|m~N2rS&]w\k=tlo}/|~7m3M;[~?Z?^{G9cO3?IC>~{Os_\04]_WVzk<'Y.f~v?Exo>0oe:}~t[~vU57^,<UfSg-:^]upg'gyvxk_xw)=/{{sl{>Ljwlw<Kws%rt}_}W]}|v-;{G*WjKfy}{OK'~	oE'[iSNvg92g/}-kwSa'9,/:G6AZ1?[u>^{KWfL<=%wgy4}}w},EZ{kZQ_}um}{{{{onswt=w-}lxw#}]`[xXv_|s1g:=>g[x%=?u{<ST0"{enpvvs7}/v7{~|3v>=;s_iN>?[|7~_}1g>}]yZ.yK_[M?'q{v]@__E[8\x|/_OIq}i|E[z}h<qkwm]R<wZk}>^g?ZZ~mWo.O?};R9y.k^U{o__;bG;kZ}=7?]]cm~s[o>-9|v1/}/:_56]oG.~okoowqY\'no6=~Vcyz.48]_oL}wSo'V_Z\_>Wyd_{[n~54nrtwgjz4gw*bk,G+|t?>OR}sg+9^>~wG<oz0tSLiw{G~fs|Q{?	>q)}w.?Wcpv-=_po-[T/~>>4r{+u>;>7_Wo{w_{{*{m|e_MPx)]Xl==Hot~V_^Y[{oK?wk^y[4ok+_{}=S/^w&t4se-l<6m{?w|m+ttp~}zK' zwz{?\img*-k&ZZ2{G_?=qvqg3L_/{~&_k:k_[g:}}~uws[w;?q_^\W3yc\{>wL}}yw-zouLUUezNr7w{s~na&Z~[k{7o^lqcX&uszw[V?U^[o4YEyr;k~c6Z[y_W7wm}-~_{~7^l}z]w}S?Vx2%o2uV{W~XeM~kw rez}Oo,cs7[-%~D4IeSSq5mE|lv{U\?V/~/yW%~u_kkNq6Qr7?c>7{tek%o\s^Puosgu6{$}eWoC6Q]}_>}}I3Obfc_w5O[c=OkNX}k|vuo?6_V|t.f.~^+z~S.o_c?O>;u|Wy{n[{[wR^Wwon7O_?SzuH;MOms)E|e~^>xw7wiNkcy_-wwo?i+7?7?]^vo7Mccgo_n<gjW~9>^MVstw]}nmoz__OGEh~?Mqz~W&}=S/og~fw3#/o7_6Y|yweeuN/{kM?>a[_ySvko^np-Gr_Sx^dfg^&i:\s3m6-}UkfI7tz~}&w}5?>j]E})~GO3[m^{/~MD9NsC_?_S?K^W|]z]{;G~j~]wnMu}q8o:{]j|SXyTm.t>kzkKuoa}O[7uMcg>Z}=w7kwk}92Wz?OEnM]>+kD*A+wo9fOu}C_QKN_s[?;U/0j};7w+s	67O{Q?7OoV}?p?@^YVJ?=}inzOo;l{2'{O_=7^vk>HB]wdq Q=/[)6T%q~}`/:j}m@G:=]0eV1wA7bU_U6?n;W+=enuw%wcD%oW;8vY5)ow<}9u#r_{]fnw6_JJn^(7>7Ky|X>_UOY>}k7iu_vg"Qqgoy~/]vr?#Y5ewL<7TC+*[og6[G\+'oWo/Rkm#.E6>mhzm7m#=_r#G#=7y^ooom6mo[}{~~BwouOv/e^vx<_'1>5[;s[st,_0,{Vv_~Ws_r6qbW1UK:G+yk>	>;QRSk_]t7qwunE[!z}qGF!e[BfS
Qq=$SwcUo_Z-nrF1|=5o#:~y<kjq[$"`6=Oc]E?y{[5&7OE57'wf>[KZ-w?;irlo_}#~'_x+^+T_c=i]>km;}(|OG@sK3ozV2+4u{gM/NfGZm%mz+ts_}6%xDY1Wgg/tz3R
'{o;f8;[wkc$vO{k?muij:kL&_qooM-lw7WCQoDYWvg<_{<S:kpkbcgduy4pg[?N~/"[_~l4m?k~G^-:Qod%uy~k6;}=lw[fv|y<.Mm'2}gguzj^_oyeW9+C}o~]wyvg7tGguYmMgN,vg]3z{;n[=W9Fwl~?_A.
;[rc>6>e6\-;y[O'~wmaj?cm_b|e_{|;S][y7SMV=y+{S>3eh)=+a\^m_^\inw[i#\^Yc.K+f}mwo}#eOkZuyZ3~U8{_]rYv{6q_-{XKwyWOYssze6>i{'7w]{^Ovgk{g/_=t_zQDZ?>6l?;z=5Ks?DvYcnw?o|+q=~?u^/Yr]r]]?wY,Dn;?m[p}>i:^?_k/[m4zwqg*oqV~oq>>c{I@[I_~~|K}coz)omwo)97[yd=5s7wj"jwo-n's>_O}>U;pktOe=q6Owb[o7yhvErXeh[:}PkGv/r3[qe1wss~o}*_8W:}_o_}]q?C/#}tO4}EvQ)wR'Vl_Z}F/[?z2P}Smg]w_]9)}_c,T6Yl3_oVZMuK{mQOZuoniK=Vkg=v[3o3ot<{/_7^3~ok
>n~;%'Y??}eos_wm~|[d;{2}y;=qe6{?;1!{e\oqg8{Pilgw9GgkeM.[Oo{8Cx=S[oonjlA=7Ow?Xh-bs~'yM}v|_Mfkm=n=2G]u=>CWw>m}K:u<}(uT#/dn-)e+W{{[?}w[_c~c/o{?~sgK?+:3o;O+-~\W}f^O3Zkg*v_4kOBO}WBk}\9>y$?)_YQ/u-I=Ynuov3}~{~o~~Oxp}/?qs7]UHX ,P}\f1&@ )4 !OT$H j $C"P-@A{z% )cSAA A\2HF] t
YBW""Cb%	"8&A6ud,=
 @.`(D"@2@G` QD$$TA|	#QHa`t#bD8qb3X
e[[oO|ssv(7]o?{{5j;M}G9{|;9s7?|*_}7Gh&(#,ILa<;F)AA	Fq  	St$_0yS/e ;K>$*)tAbRJAx	B 0#(*PB's9Rdgn[qwG?Wkn?\?jOv$?\t-s~JgWK/kVkro[[}or ~//Mx6K_g3UVx5 	@
xc@T#P
 3RICx6,]`	Dh")D $uX( 
#%aXD"a00X!HD@'7(#T37@" R#!xS@> IVA#=[~t}1guU[V__~5kv{;|;w_M^?Tl_eZ^{sN]W/l7p"$Q&3B e	$H M3C	`H&CEY
&aP 2 D@o d@,8$Mb- A0 ,R2(FEp"C$ YDU/
 ``T	A"@MSX4 I
 t R>b 	>))L0E$y 0Xhhh%`N[81$r?jVOy=rp_}WW~Ol+>o[kC?g~S}]Uc' Aa bNQ!Q4& 1 DQP^@G 3aT	 B$i*[E&@@& 02  R Dj/?_qF;q?w7F}s}}nq}g[^-:Xq}>4rgGvyxu<yW~g<wNs~G[wo_:O?VwY{u?Ku\;.+_;k*uS6D
Q2)J0EJ05,CZ-q`
$RT  pz Q# @P@MOh#E	V25'	X $Ri4'W4RP_n:5kOoV}Y}?O?Gu?oO?~qk.o[?{x@0!-2!d$0`vWCrTiq q7RwZ[CDTF[`'CaS# @B
#PLS(0PIa)C<.MP$bH@bBD>q"
@q r  H@%	jhp]bp` &hJj@R`8f,0/( nCr`&`D  BF 5cGi?o1?}oOJhg]oS/;EuMW}f_}JOxs|&c %A T@I$#$ 8"aB$B+FbB-")*BBBaHc9 @>D_s~}~k?%{{w~{{}_k:Uk{r3_n3s_7/&{v3k2.q\i?l[>c/{=9g|~67y}>[oOxGS~}4#4NF\}O_m:L%D }C"J
=W,#p.pUn5D0vDl6
h:"s	YPI@b a 1|H4|( @ ed/?og]wN'}ZiVzWv7]8cuYn}{s~u7woNsn# TqDL0$Y 4a"Bq[@F, A  DcqG'RyR`a h	eMHvQIX@:`Xc(
"X0 `&T9`5 HSIH`8_79@AD	Y@V!]H	V -1$pEBp0,6D!		*2QLwnewk_zW{&^<_|?U|6{Hw=]_S|~F|K{\k;>2P+"!:qWhbh.@HEmW %)RgE`T j#a G HBAB
 82cFT,qb?7z{j._+wG[{[Udz}g&k)|uOr}_z_{Uf~k?WKo=/S-n}>oC~^|7M^|>WM~}|/W$1H90Bd%,pF#,W`6 ){r]`7 L	"2`8Cb@	R1T"`)$1FP(!X'* ]gDx A` $CVG`iAH)]#tu^.TKwg(Cl|
 (e@1^'>FP\&3w	M!P3HV8T]* ET7 VQKlD  U I)@!FA `P%2p$%'A%@^" S @ZAZH@H1>! P9 BX1)     V<AdHf 
C%p=	 +b>@ !x  H*%nO} k P@   aB `: !`0#r3A,@22jWg!kqKG>) `s D-M0"et%E,!`_(8e+zf&Db,*
dL1QTB!#GQ7fMcU!A  K,@jFISA0>AP$DUZRJQp +@a@( "
9{'@D iCh  ) $$ ?"6p *B.f Jq6}H0 /P"@H3@ >j"s Cq6u7RPas 
WhI&U"&L04If@B+:APWM"xV	%Cp!( P% 6:0ad101$	#p\^kIq39$dFP["'l
52R$P 5qH&*!t(:
M60 W4A0 LpA8BLGN(HXE0$ AD w&<V")!i]dD%
"!MF[#@9p-tbTFNH 3 6!v
Y!VnE"2p3 H|] W'7 t2MC(b4 @[J BY*LhBR0D8<xQe
!&;  rRH(dHiGUuP xSF Ba@ $ P &[   qP*(r7O]IRlafiC!p-+8,B?S$)@g*qC  hX''`8 1|4I4 8 ~C"B8pK8
@pAG+ TKo+P k	5`C(Y` CI%pJ
	fqfd*(%r]Zj @8@(QCR	0@`) @Lmf  $|,`E B2mL, k' L6w0 AF:D	A@0 E$ F H *  b`{*T$% z Y#+R$8f^QGG$XScc4*`idd)r:64IQ) 6l`!b}:UP' [ NH@G  b TD	 6F\dDH
! !d&A	J"
FD#GM>B2/6p T*X(@NT$3rA@ S*'"1<* # {@W HTfjL(.^	@0@ xaEKRp)9k|` rb  4@ KlWVBP8*R {3" *`0@'`T) -"C Ju~h%P8,Q&(9m@)  JGa.})U 6DSn&4)V
'j0Wj$	 EPB 5IJxb&DXGT
`~p 
"9 Az( L  sh! `@e,H(e U r@a 0FDcA4JAr  AD l A2" :AoB "0b(:D,i
4 # o$ 	c LlpAF L(
 1 *j	U 
!Pj#Fw4*PeQeT"P;F*k .Q"UT$ 0 a@"M@tkFmedd(3$2bF)`C* V3 1 HpO@LEG
@;;
)28)&PCd-WZA
b0   HCi 
iBc JpP  AB&WF%j]:V&nd`ZL7@;w3*J%0 JZGOGe9`1 3C!
j
DL	-X0D1QTRI*~dD0wHCA	  h@@0A
L1(7qJ0/j  uN `8I4a"DIKNW(V8 AtL
TI*	#1) B1'y+2D A\  L!H	 @ % #$g	p. SF@0!@Hr  0P@E&Pjc"*$ !1 X 	
R
 XC@`\Q0 '3T Na	M !%> PUXG.(4F`Duqhh>5E1wh@  `pWcdjR! T$)`Hj0
2CKY
at0& 	-D
 _A,` *nD	SXFRI)81)Od-< XB*q@  #q@Z2q*pHa X	wD0xx@X#6` * `  P TB,&BZt0 +A!DH$h&<~+O*\BaAK6 DN-d0Z1(S, aoD  v 8	0UXqE4"22A!<>vS@BeElIL
 ,l> `@+T $L *  XX.0GE   Bb~Q@@ni!R <Ft qDJ	%Ej34H-&E AH&\*  pKH	(0: )h
1Pi8*L?CY)K$J"C>O T!"EtG#aQP
'/HOpcs DQ'g2 Xt Ua5J)'&	KJSc8E"GJ#P	I\F2G`HCH!6X*8K$6d	F 3 mNF('F A/iQ s!1-pKL{ cx&@GB@  6%TE 2Dm8D!N=  !DY " & @4"*YHH4S(0 
#tF5 J 
B%N$,p$%$DI+$Z^pQExA!"LA0P
DB.E6)	P$$M><a  hX( $Wi*xlZ0&Pd(pZ..Wx{9G>?oOw_v_SwN;<P#:z?:^v0:?{ve*ow]{	[OOun~VMo}6;cKtEEr{OxzMSW?P?<9v!;a9'<EP,E!Fd
)0#DAn%A' P`oE@\d`y8s=qCXC</`A4eAR! q7|Oh;;7Be__'gu]#g[I[y~.Q[?ad@,	$U0RbpB@ Lod0"@+QdP
=	ZE\L{[RO387Ed\ZiF[aA%(=bf4Ao049uAL
k\z!<
U#XW (AUC$Gms@4n0Kq\hx R2q,`%o^m?fFloJTM\'{RY|;4ow?JzjRguUz}?lF#QYQ!EI ;@PHH,!jq2,8qca2eECHF
ECSKD3S`@E J L3CAV `bP2&I}?%V+?~Z.QO?~7}w|joq2uov>t?G[E!oycI]yx~Gv;;7}3KK~'mYcda_E<us*o7o;_*?P=z
2	#@/A- E^P(b3P~ P P"lTAb `8`B(Xa ;Pj0NUA&!ERf8U u.S@_|Oko_[O?Vs[N>|x}|k]/PV~tK;ge5g9 0B\!,"  (/C$*r:&@-U@@\e`	H#$SB0;x+]*O *f
?	H>0	.2AaX)!Y@0+D
fZQ ` uOj,I:\$dAP{I@q (^, Mkhb5\a<K (`0$G^'?{:?3[[0zVsLs#o_zY_o/g]}om?) %6A5
Q(?FC" UFo A% rp'l6I(U:00 &OPOPCAA<f`7At\rdJg`q/_Ld7so/ds|+[Uuec6,cx-7{CR[W6}NooZ>{^{m^:}m?WL%k9m9;/on?}3m->heWv~4}+CJ"ga&:3Q4	%#0S!*
3wu0*MG ,$g/* `r U>R
(k*G  LRA'M$a0Whj}9~{byCyJwO?ol,Gx~oluGOsroS{GqUv_}~s[B@@8&&FpJ @ AC/@H@-WM!	q)&@0)Pp:@E"KP`X"-x
QT@

O /BZ14OJ 
! JP! G @Z:
*-bj!
,+cK i]$DDm
AV,UaU5Cb7 <bDaUh1r9l:
Sq@6 6%%$Bw0_g>+[wy~9}`o]$}P{q??9WE,]eotw~v[mmg9_[d
)*nLD1'"!
H&@P~/L`}Qc b_$!^bId h HF bI$@ #`."* D[HXzJ~{k6q_g__mu~}x_?qm44~xjGn~6!^/}9g]{3+;nwpohLFS{6S?>g_ui~mWVo{}Q?i|ar]k~,>yL6 Pm Ag
HfAT$L<K P/
p(P8 {Y##GaL-c@A#ZAV@e`)r,PP)	%(!R!WE2>I6n71o=S;~~zY||5l{?w&{??$%%gTjI7n=r{D;z2Z 1cov%j!d)2%n@X .CAW2?$*Xb (W
EFu@VB=DMgvHfDeVV`$$4\$W@fE O(V&A*RJHVI QKpu>xh,Qh<TD3UJdD! %
VZ$ b"AM]4NvB736A+K bC/@Z$=
$rzq=sVy3OwOusLo/w?/i\}"r_~~z'vW7~{y\9^OcGGh6>-9>*IwW{G\{-u8,_yso{<k9#6K^[z_Of7_?ys=_DWaW-yGy;d.}vkC/V;'vVi*W~?w!uw,L?u8{KayUois?2>g}O+&no;;ry??qc33Eqss?:oW/soSEgu;?=l=^yj;7]{{ggy_}dyB_sW3~?[?o4~{
o$[{xm}[w/|;qJoGrm.O*K_SmK_s:]-Ou?~d|[csv;sV+Y]mSnf~~~75?65>yw_wv6y^wu~eF{o:e6I?_wLoo':6i]_rwk/OnktO9=Vd}n[~k+yK?_qaxGWqvM+[k&8K{mm/ID#w]g;~egvM}&9W_mlz}9-Er}o
b_ox?{>}p~k4Sn,/t}z)<~gkUWUs_soOgN3r`#OukvOGz3~|],Ozhjmi?o/z~S{^gw-gz46:oouz?D_n~e~lfnyAUg/8|sw-Lam??7W^}O_[?yz8uSO~<v[<>K|FU7~2?~n_+5Yju|^]M}~sy.e+I?6zy|U^K8e|=_Jr{tRo6J_Y+sot;	uV||m}u}O{+w|m*/W+xo&z{~~]7V}?M^n_Oo~co?>/}.=dgSz5){s??~?n?rk/n=W5n^{[?+U&]/ooy>+9^oG{Cl>jvw:,z7{7a4{gYyS
+vY&4V4}l/uww^;\lEy.)m^Y_~{ao/ts<[_}RK+uoTy=u'~J|(#,yj/G~v}i?$-{'6^=}(svQ/v>,qn;_TKPfs{=}}?g?/;G>OU~um,Q{7|\!wtw+?]?V>.Q=^~{}J9Mdiv+lv?jnqMko|m}If(}u/O^7~vYb3/{>io,un;{>>%|W)stP7l,d]w1gy_7V}?_qwWwTV,?gdgUf/jrGv?m2ocWx5I-F5SW}F.qe\>;%muokw=Hsog=?Np7?{~OK6v|]5~WevS[w}{Gn?>ROc)Oqu`{TZ~:s6b~6;v7tyJtG{u#x=}s.B4?#=+WDtoU}ZCG7M}>v/w7{g}7?w1w_Q}S%/[gCo_{wo<>3v=r={GqWm<+i%LVd&W~m3p/cx_}o.9-me/OKnZn&z|[w^>z}o[/+M ?zZKGu{_a_QCWw.wdtp/mN}AOW]f+2kYV^v?~__?>^_Nw?Yl?roSdu]
5%~g%/3:X}UOpK_?2`fuZq]?c9ww-w-+'mvwom~io./v?{WuZpo=og&=s/soO1w{z+?=^zMz+K	)Rw'z7t2[+S>w+o`]O[ON+uoSw]T'koZrO]^W/=v7._\uoKDvh[&vnyT[[-{vW6:9gnq^I|+_Fb}a~wc"S9q{.suz[M|^\;WWZs~mW/?'tuG}i}Gowpvki|4y`n|o}e>{n[s6zs~nsn;Y[T6:u=o/^vmv7Ov].5vf^yoGf6U;Ku0y]}V_+gWq!_k
qh$[g/cz5>?|H<^k=go_=z9_w~-{5o/9o}3['0O=>}kp-G^7^N3f q/>ks}eK~gs<o?qfj_G|o;Y&JW--s<i93.r{7go%6WPw([-uzGi><~[ouj=W?>^_a2{Kwg_-^eV^W<+b_R>jk?q'?fey1Ko9S!gv=^`{{
fwqqBkm%6m;7kmuoqc],R4Uz_=s~'O|_mynM7w^}}k]gmo'F?zl.{fr~O~rwVk-w>?G~>WS=y;w}VYGozs'v|~_RV<\-}f5}<dOxwOK["esgQ?sFUnk	/J~}Fc:u'4{-nZO~G}?m{}{^||y7eO=x~{g3?og_5u_]W.^x)ow~|{Y=}g?N6=}Sm<1,>OG%tnVU'{2mAo}N2\>X3{>s^vOU{T/mGVcgsohUm>nnW},UwI{$nk{yE~-_3;zu>;-C'.{6<3io?G2w?j?oN"`?f_{~_wol}v`9n{Z+2s=orw?WMm>1~Jwzwoq?}~[L#x '>q6uB}}gfZmI{;Oq?wlk_{y{_\_}L^{|_rk~O]_;-wj9]</wslOw|l}7_~t4rw-oxwv?U>KsowIbLOjT[_rwz}O7\{}>s{w7;C/Krww\{gi?g|77'Ok_Zh[~_k^Oo>Kr?s|n 3_bkxz<w|3,d?~`xwv?Zo^,/=?;~C7kY9=ui?f?s>?4Z=W1oRFQwGm{uxVJ[|uGIb&_3d^uk9/riKmGavk?#-]{qSu;K%g{W_?x[sf#{_s)s?<ZzYg}j/??wlUmU_gwouNPmUlo/-oV?a}??e?B(M-{J{ZbB}Ow;9&1/_	fF5&w]Ss%sAcVAomj5g}.`G|_9y{tRZtO~+,?~w{>nwns,NfmOyo|;[}63]~^LT\k~:{w_V</_/stw^2l>v]o|msM3{UzS6y>^uk7n]_Nvm~|h.yx?xn=[
ug5hJ/w]Vw68nos7A+_o.vwzsu[L{yg|oB/*qFw]r\_7y4Wu}foUO~wq*-{czmO"{~;CEh5vS'}_{No;D(}`$^qh//Z=Xc7YSWkxmAUnn^O=EE7Ckz;=u_V5OcG{/	tgOw~O[l7c{ukgyI~/:73;>Io{-_G{_] j`SQC' I`	R!PcUW CE0
 PCTJ 0BrB0 z *  AD0."@Nc Tud@@ +6"1P"`E'
  ;	!D&(SDC?*DH@	Q $1H.AP -s`
A % P"0 8E	@	P	>	L }@:pYE,!j@@})'!?D8JsoIpb_ (Y=	d:RM%0mp*fRZ\^GDA6ABH*lQ 6am'B!d8N4T$
d@VmHPR 	6``D	eLX|cFl	nN-	PEdxE @T    8H`T5O,[PJXty
|: . [!),8Ei 4h`Bp?DE -M3AKLF1A+UZI.DfG`!k#xcD	&De5@{p2 |
2D\<HJ1+@D+-\@Rp`u% P aQ@@@HE:X*"
.C4l	!s
  ,1-),2)I/8FB4 (4XDQ@21ODx(DpD`k/1J` b@@`pt%( 	 Z 7@PPH6@DBA
`RF
`@T{mTg@ a)O
pLBh 9%bceZAG	P @ M"a
.#.i60EX02IRx.4@FC&H GKeQRF^@RL@L.2HDkPR"B& >C2UX /
{x(pm!t'/s!SKH`W$j1	tK)L@#`<P!Z0@(`\Q@d8p M& A@mj
>B c; ?Ab@B	`f;b a. J}X8(%C8)[ 0HH[v7ed.t^P7T `+ V P#xV@6PFQ]ih#f
`&9.& F %c0P2S
!NIA	s ("oV 6b"T^Z b*0
~(kE0d!8] 8!9@-
eF3$pZ p2*l x o
6B$F+ &d0@<  Bb &Fq "p;^A3,E= "=k
FV<e%!U<m5%-!l	_ 6! zAQ<\"@q5O \0H7'I^@`5S@1$ZIAAL o	CFbJ1B #Y 	u&FDa]"2)U2BD PX'	c3Hx'"CBr R@z

GY0!abA V 	   bE  3(0A
P4l%S	]DC"1F) #,Jb @d+I ED%rLE})TbFXE#VCCZ !ni fEH&S	 F@"nDA !70.kQ
n/ '`2 dZ(M"-!!HsF
wrqC#]T#P1\B~ YA mAt"1 aT]U'xDxb@LM1JJ$$ +z.EJ,X[ }0&;1
(XH %@ )D>FC {$?`	0[}$,0e4;d$CVf,}@$MX`BB1|xf,@a s&@-"7cBFm%8"p$$@ AV
NA(KD)TKH
Qw+^=D	 * w1 _%!@"AJ@.) g` r4g!jo!P~ gc4l8& _ed"q	C9	@ 0A @) ^"@4  SBdMM BDS _  P4$d  X3wWDd`b QJD xXg,"
d~IO OhH):D	#Q% 
`qP]O@Up  ,&14`	F.XaSA'HN4 	jq/ldh+Hga$I=g
 @@""kZbHLLl+C v
GN"p[Q;3xa"A"& (p$Mo`q	
0'.rP )  N$6,e&2Q`:5C8`AE6<hG'R QuUH ,;Ft  ?	@MFCC","c-a=:fH$Pv()[q
aBK6"f*EGhJC((NUP
!)C@01hE<<L4HU 
  )$P(&*PKRGKP"5PD F_F<@
m#5iq~`!9bb v)Ckg B;VTv1	& 
a%! hRVA*0@ (}oK&!PA	
s(@Ae@#RD81^tX[@)A((HSB>0@-  8F`ET@$	d	ORH VQa(r@A%4 xxe&~E	%Q0@O'G@2 a(DAA ,;Kn0?D +%w/q}5/$Hc>* &Pp-J&PL H$	!G*lx R
B@@`HB( T`/8@6e  `v$ @s 	n,BH!(#h&0W'X"BE|K@pBPp *A%p4N#`.q'$de:	 "uE oXp!	@1C<
'BR b3O	1MLH> @])TH'$= 
1	. +zxH d! ,kpr9 M"#	*$[A@P 	$BRi" *@YJ`m%@d/`(ec@[ "Cp( 
S#PTHJL N	$D	R@`0A       parentCtrl.recalc();
            }
          }

          return;
        }

        // Handle max size elements, check if they will become to wide with current options
        ratio = availableSpace / totalFlex;
        for (i = 0, l = maxSizeItems.length; i < l; i++) {
          ctrl = maxSizeItems[i];
          ctrlLayoutRect = ctrl.layoutRect();
          maxSize = ctrlLayoutRect[maxSizeName];
          size = ctrlLayoutRect[minSizeName] + ctrlLayoutRect.flex * ratio;

          if (size > maxSize) {
            availableSpace -= (ctrlLayoutRect[maxSizeName] - ctrlLayoutRect[minSizeName]);
            totalFlex -= ctrlLayoutRect.flex;
            ctrlLayoutRect.flex = 0;
            ctrlLayoutRect.maxFlexSize = maxSize;
          } else {
            ctrlLayoutRect.maxFlexSize = 0;
          }
        }

        // Setup new ratio, target layout rect, start position
        ratio = availableSpace / totalFlex;
        pos = contPaddingBox[beforeName];
        rect = {};

        // Handle pack setting moves the start position to end, center
        if (totalFlex === 0) {
          if (pack == "end") {
            pos = availableSpace + contPaddingBox[beforeName];
          } else if (pack == "center") {
            pos = Math.round(
              (contLayoutRect[innerSizeName] / 2) - ((contLayoutRect[innerSizeName] - availableSpace) / 2)
            ) + contPaddingBox[beforeName];

            if (pos < 0) {
              pos = contPaddingBox[beforeName];
            }
          } else if (pack == "justify") {
            pos = contPaddingBox[beforeName];
            spacing = Math.floor(availableSpace / (items.length - 1));
          }
        }

        // Default aligning (start) the other ones needs to be calculated while doing the layout
        rect[alignAxisName] = contPaddingBox[alignBeforeName];

        // Start laying out controls
        for (i = 0, l = items.length; i < l; i++) {
          ctrl = items[i];
          ctrlLayoutRect = ctrl.layoutRect();
          size = ctrlLayoutRect.maxFlexSize || ctrlLayoutRect[minSizeName];

          // Align the control on the other axis
          if (align === "center") {
            rect[alignAxisName] = Math.round((contLayoutRect[alignInnerSizeName] / 2) - (ctrlLayoutRect[alignSizeName] / 2));
          } else if (align === "stretch") {
            rect[alignSizeName] = max(
              ctrlLayoutRect[alignMinSizeName] || 0,
              contLayoutRect[alignInnerSizeName] - contPaddingBox[alignBeforeName] - contPaddingBox[alignAfterName]
            );
            rect[alignAxisName] = contPaddingBox[alignBeforeName];
          } else if (align === "end") {
            rect[alignAxisName] = contLayoutRect[alignInnerSizeName] - ctrlLayoutRect[alignSizeName] - contPaddingBox.top;
          }

          // Calculate new size based on flex
          if (ctrlLayoutRect.flex > 0) {
            size += ctrlLayoutRect.flex * ratio;
          }

          rect[sizeName] = size;
          rect[posName] = pos;
          ctrl.layoutRect(rect);

          // Recalculate containers
          if (ctrl.recalc) {
            ctrl.recalc();
          }

          // Move x/y position
          pos += size + spacing;
        }
      }
    });
  }
);
/**
 * FlowLayout.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * This layout manager will place the controls by using the browsers native layout.
 *
 * @-x-less FlowLayout.less
 * @class tinymce.ui.FlowLayout
 * @extends tinymce.ui.Layout
 */
define(
  'tinymce.core.ui.FlowLayout',
  [
    "tinymce.core.ui.Layout"
  ],
  function (Layout) {
    return Layout.extend({
      Defaults: {
        containerClass: 'flow-layout',
        controlClass: 'flow-layout-item',
        endClass: 'break'
      },

      /**
       * Recalculates the positions of the controls in the specified container.
       *
       * @method recalc
       * @param {tinymce.ui.Container} container Con{X9K;}[Dxd8:{m{kv>/k,k]6]5~\||'iZGkYoMN.T
w~bV{qW'>p|[*OW~oiMVr~L\s{Or9}_~r3y'+Cz_77}#R%[xl==~uY?ay>esww8>r][!0/~g+gmfoO	UwsG$~{z*(kOkt=~\9$}/*?mu~%gl_~qs[i1+t>>WO_N#mM6b>~w5]}o[}~swg3O{PkX7[h[N|_Yw|ju;7V59_CoxgMr}GbnS!GK4}7_'['}6~r5lSwWM?yY-FMyykW~C9?~{^xg;7?vsJL.~ZGf'Ms/ew:P>)\)u_od]kmkmU=1iy wu?wz/pccgvoook}bEiZ~q}s5U-x{c~XqSslm/_so?hW!x[xVMzwmO?S7T_p}C^U?OKWq3y?)Gu#,{gomjnzxltoKWC%n&g	/?ye^wpf6gb|IS^cms~?od;_o/.kwu{,iz?>r{rn>4xW	Ev5n}ir=z]o4S{6_;?v9|o_XWET8{=nQn}o%~qy?jc?q	aa[/j_z+-7n}_'r.w?,i/6{sG[]w>wg|oYg]W<+RTO|b7or_e_y.vdXJ>}k5om4lOg/6?W[',WsK[6i?lkv7Cvsv5,{;~-C5[m{v_O#RZw@kS?~7>[7r=u6o;ZW^]6_xr;7mm;f]?zWWilf1Z_sUv^xook;^<]O_l=n^;~GnquO:wSg
~_V;=vrsk%u}_wwD+a36w$Ou5?u]f/WSZ/w>_-YM\fT;xM_^7sy1u?;^~.?_5_vwucm6^/MvN9we=oC];_rn}cVvz6aWH~65y'^sYWUw}o/k5NN_o;}|\;M}Ou{kpr_-,*{[^-Yz/^;;??vw>kws=3C/Io']eu</_~M}s>zHen~~^roarW_w{_
Gl9NfK}gwG>/]zt"U&;/Z=u)w~)	|W1<xnD>oJtgU-vw<_oKS~Xe7nhw~bO>1vEa~eFjn._79O_'m&G[V?km{scv?WU>ywS_oKiO]|n[_;/V9/~5a{v{"}I2gy/}]lwu+~w[v?swEZ?YeMk_>kMz7n[OI0m|'E]R>Cywgn\CM+B~Z~~]|o/9?&zr[2{pRf~)xnU-mo<Rr6orsTT&F%p9}?U]8g{3cSp~O^n{ko})~|;w?Oq4H-3+F|=wX\$:U-WaL5i*/mrg}/somkUOwLn[Y>}}l-_s}9G}Iw~?#)[3G~70^{Vw[Yvf2M]}rE5]uMj_s_]N><ow.?~Vz:>^g~t{&b]{_Qcw?Kp]OV:oc?X/d'cE]ogU1*M'O+azv}W'js?|?CH{oo6Ow{5vgp-u1Gs?n_[~CSkw;{8Wguo^wGv$?Ew~7:Jo/^;no{ms=U}~N?nt~?jo/ug;}O'{sG?nMV+J?	:.G=*Ew_Uz3]}?yu`2[?Z=yfO_M}+Y9u?UG+GydunG~~xv^ctou7/<|O7nOkkRf|7E_L{'>O}V;m=/N=doOw4vl~'.ymS_(k5?Py<nK],]pLX|[\;?5Aw}~c_D?hj}o|/|[dr|umn=^^/nt9~Ez4-lQ}w=?/gm{yOuc=3_{W~[k{g5I>gV=1s___/u=}~L/m?rD>ym|?[%.|R/[{o5mW;_w>8/g+Z;TnU;GI~\K6z~smO|<^N.?hwz{<xFv]z}_SW9z;?V::|/vykzn7a{\S^p0_jsev~FOrn}tqgmov_} KXmQu?1=6'5RoD|im1"b~Q}6:{]gO};Wm_|'jo?m=~jM3[+?~+wt%osKT8[
?1}~CKd5^Hww7O{]n-Y?xC/O>wswqk<7WUzv1s,?.kC+UwG;KwgZY[jOomU">7_k3i {7{t5g$=]?f_}]^u5~e{^^gz>{ozCVp/6?WG {||eM]S{,c8w=~zwVu`7i;os+Z=t9{f'_?}TS2;^XVnt[8<|M];_qwku7o~;VwfknVor~?{w}eDvz3<=^:nu7sIJ}~]k;j}SnSU7-3!sGIK<7}bvu<UTz#i|.M-_mz|jW~drw+3{x\$oJj?$shKn}3hgjFkK0krMZjvp~6[zY_aYy~~gvTa/
=t~jSgMu/kw_K*~dw\C7k_g=Owzjhr^W?kv/<6T}W}'_Y7+eqN/sW*;%|O=r?c\0.\c[u]mtk>--smS_=v\~N1luK^z^]{=m~6EyZvxrVp=vN}Wg_O5%Soko&~/:n?o~g~)]7wUoM\K+_8U>l%/xoGG._:w)>*i?wY6~?c??\rnOh}g_sXg|R\oZLik?9xo7/~e*jf_}_}oZekZ<g_Rf@?zsU~it9OjW|>V02Y{|X9Oqy7W'own{}_nx.f_suR[wR>t~{q-?w);w{u^pSoI^^ro_cu'Gz^}>]?oow=eMl=m^?{mGs3vlW3)yX~to3_St/gL[{}Z0&oc}>&v
~6[3:+/yJ3wIT5dDY%\<_W/Y&5~T;owv];y|F^=dwlX_KVN[n$]qaenM)[_OwA~Vv]Zloyoo33.O4F D z!)(A0D.0VQ8g"H5 !Qn6#@$zD2v(
PDL (( "T& "D1 @IE
!Nev*"C`,A,F	A   8E8
$+`8#{ )F1*"H 2)  ^H$a2T PMBQXT	9-$0RY8Dr`p"(p$"O&"0F %P!
iK$=|T<S!( B, 2s"V!*aBi@2!&K 
 / $	,&u"Eq f"h e*I@GxBa8J ()@x|=h 		E#[	r$[ H
&3D4h ^%$(Y5HA7A30$HPF  59-)LD<4EI fE&BRL@ BlP `
@H *$ @,Ca4E=JVAT
T.p !"t0I@ 0QSE)6B  f"@ L4T ";LX!HD@!R! "&aBVdt) 4 I-E0AgH!,
NI P!G F25#"{ @"JFE5	( pJ`Be@8XyN,"wH5 WGaLN5w0	e"4(B<oR`H]T  [d p!sp@'bP wE>)PHp 01 8 
 mX 0dp(	c>Tl`QH tH$H tR0Z 80r 	yB1&
F~ 2"!b	5@Dp@p 	d*G(DB$ 
'p&pDd0`C"	u" 
aKinJLN!m	"D1IBg</5	n 5ak L4:sd&A[aM	8Q  L@*H ` 	-  4#-'AD(JZf LDb /r &EE	
NP8*k /8%>KLP, R6@Capq	 (3'H#@L8	P1hHB"q+@(z-11I/PszDL@ pR  d1d% I#C|! 
/@ CD9 AAN
W!@%! \a 1U 
0aVaH"0)S#0  Y]b4 'Gb$ D(#APO aHI]`M]KF0~pH!<IB++ 3	#%&DI$tQ	(`$< !"(4`utQ&@ I7h$$($`N 8J Q `jBx 6@$f'`s@r@ QgISP@
F #(L !4&  1P )Ht@S U$ 'l/#J1m d&
#u&qa"T[Fd(T,Rj9P:$@iX	AD%. 5 Q$KB:l7/v"Ab$E+*#= .!\EY@ZH&@Vd(He|p2 h\`D	mD=
AE(
 CE90	A&@ 6I042i@6'M$e	 <Lhl  8a8"F1iJ. "FF,P*(Q 5d	`!TY' 
 BLM+
Pa(#tV' bDb%\@kazN;`-D@`:`
hm0,t U"m!g 0=QU
6J`JTHBcI<(FPlRTO\A&b6`0XQ I`1fWUF1FyO!
!`E
F	#Y%2"JM9-'&] A*1 #\pQLp@Lc(L}D	U!$ ` 1,FB b*( EO8"GL HACb/jG#X0@
**5L0MKj pC IbRC!0 pH8g0#eKp1#rp8'0`I.*"@ a6A2E: OC$I`DBg4  $a6^_ p 9 @" 0@ 3`c z$xIE`0A F6 z  H1h(XS1A6 aM`R.	PZ0Af
$ '
L `P'HJ4IP \\	W 1LR`t@DA"L C"@( D@"xv	 8\@FvxpFx5 I5CpaDdQ!3%L
'Ab~M02A1Q"R 
Z!D;`	qPnGHF  E&0#8`@ oe yF@I0D%  0T&hLHp"M0A: HUS0h9@+h P 8"Ph0iR6@	m`Ez)`H)P(1!R!	zD -@5DJ@ 0 *"`S h@H *0Cb41Fd!%B4f# W!/%u4uv[N@G@PG( B/ F'r*dbB<
(BeJC%IA 0`D@^2$J? pXQ gtB 	 %:^
b YMXzvB 8"2JHj z#$A %fG 800&\%	M%,1d!DuAIdB!?2(X`Q<!{T'@' 
G )* g@)"L@U"1/0H#Fl	 &`* e,0#@t;V$DTB: (4[aD$ A`B0 5F0@H!B,(X0058I MX "&|6
#`v#1XR

  $@ DEH @UAHTS AF &  2B (dHi
(` !  
JFj$%@ $rHPA"!1   	
2#eO9d"$XIhP!/ATWaFQg&43	sx1X@-_ (hALt1! x 0<A,$sxF  cJ,0CPHG0Pz0 *0B_,5'I@#% @+#q$Q' a(2:'I% a&AHjhIR<%2d@e6 Q^P@ @*%OLB2 "
t	1Gv&A2P u!nf|@	AD_`Ac* B0@dPP@S@@E!!P`LZP0G
 a	D(H@AV8 !Te@3ZfPPT4$X(I2TD>pM(@&)HPH w, bD%P#@|i#UV0]d"0 Ci#&	a"axaG%@UVV) I,`!;,
 TpH\`1t.zd	2ma"+WjXr8-@pIL@PY
D@0p	 r$LJh@lB5RTi  1") i40#"4<)L0L7   i}$SjmUy	0l40%@%0N"$(@L", J8@@! 	 H &`Q @2S@E"@eIxB<WY$(`IZJR_x HT@#  Ba|3(H%0(D	\  AT{r#F8B,\3
p  &@I rP  2UN"0Ab I Y$"2E 1DL UPX%` @@E@n9p9 *(2 1vpg*Bl"YI<L@ :N!DS]DJCJCJ0.Crp2@`P@L		J *Zc &T@Nj
b  D1 ,@&E$EZ AH 3 21-LHx0	pP(9 `D4USST4I0 %Bl	3*2P !*@dm U(dJo,,N @P1
  1F2fI$`ELF	Q$	,	AbVR4
UP	!e)@-p%Cu p At\}{-30N @0(@lXpH"pZ!i )@KpH!
Bp;b @$ ^a&(%'<P(hrH dKG- 6p$fCVX@HB@b `L	`4lQSf@z-M%8$P,88&B
4 b^LPTQuc '0UD**R#i$ +B#bf&Y(7  dD# I &ZX`* =aG C	;u#!$-9d10*2 @@@\-  Q)((!
^%Q'f`"$" DiT$,4EGF tx'1
'	&$P!u@0 & $'8^#8H M5\\BV
#3( Lq $r-'2"E@	nCP0( VQ(K RT$({	}Q%FPMBY#IP1LKTQJ8}R! "P$SE	%W!B D Qv@)c@  @AD @P`Bd-A6V1
	h&3JT&`4 @(X
 "Ah4MhXa&b*b D $@TVT8 3  X< "(4/#@%d<A ` YRNZA bHH8H& B($AtmWH   `EIB0XP@AJP'Tq\	
CDx@T{ A@?`2PfZ; s@ @BS*hRfPX  DF#F`p9dHQDDELDLFP@EA%dp4PB1  cY$A @-D2R&b%"HR2	 0pFpEJ FjKX5&0T I D3 xT;(
G$u!S@d#A`U>hdJ \	)J# FBZu (NZB8 f 	MTRP@GE!X1Qgh`!A4%<  A)AMT@`t GF!d'TfY	5`@:V4t$ DK/	`,DcB@pDA
$@t@  9G :#Y1Td  S0Bb(  |l %JB4X W*P8C HT J  NA(.Ct $< EU(U  @%h
* Pnb02FMA2G `c@aL $q2 2$%E-'$rH&2 Z J	 &"@8 O&h4R,fhK PZb\B<	
 # Ab*"A `   PfQ7Q>IA>J(8#
 \$&@%L)8( *P e`YE%Z`!+AC8(rANHl PI  * 4!f @ `DP<(&FD6 2boI|DS 
T`DJ,nl	(ERF@"h
 T)I`8Q-jhSt`VfQ- m(`.xIAwD0H&Xd|CH!q;hP]\G:5 B qe@Q|B}c
L	  (MD `)m<	82u,,! IRlq\x,)`P!UC$l1diKP(A@flDBHA
r2(@p,K@2 EE 6|V dZ0)$*/T`(ABQA07TP l_ F2H`
 6J0h@CXtDI
qV0	Vl
C`qe.h
; te}[b h 
bIC
tZBM(A51`!5r4NB!
y!AD H 0H( 0@@bp$(D0%X -  $ B0	$1 Qc zI2Pj,A!z%)! `E@  F(MILG( {EoVv=rv]^]6>{oX=5k9~w_WQSki2>Y~.\Vz D zR!(A8D.0VQ8g"H%d !Af4 @$x 2V(
P@ (( "T& D3 @IEP
$	,&

q"q v"h e* G8Ja8J@))@8x^=h 		E #	r$[ H
	&3D4h ^% (	Y5KI?AH#Se{
Os^}CDoW/;><+rYwkH?Ogw]Z'j*y<c_s/W_\]Nd3&|zI=uxD
T p !&t0I@ 0QS)B 
 f"@L4T ";LX!HD@!R! "&!}s#C?77u,Z_2T=6G_o@~}$/|qioV?()OJy?v.spxol;"n~:{3w-fi}6wY.?=}[w73n	wSf%#S?,n:yoi>xBV$t `4 @I)E0AgH!,
I P!G G25'"{L8  8"B8FE5	( pJ`BeB8XeyN,"wH10WGo[*+ms?c'x<IWtaFyVY_j+QjU)wOKf;7]>~8Gi-856>0 80
 MX dp"T`	H tH9 H tR0Z 80r 	YB1&
D :"!b%@Dp@4 	KFLP, R7@Ca0q	 (3'Ic@L8	P0hHBq+@Phz-11I/Ps*DL@ pR  d11d I#C|! J/  CY:ew[W7>yC?1=|XS\t_|_X]k;/*Fwg;+]r_}oxIB+* 3	3&@I$tQ	(`$< !"(4 ttQ&@ A7h$ ($`N (J$Q bBx 6@$Qf'`5Z}j?a
{sW|sh{~wl_{Yv,<r?{F:oSUe6D~[Z_i_MTsWGfJ=t95if{_bu[;]o5g~
#%-}VZ^Ss@2@	 gIQ@*F #  !& 1@)tS   'l/#J0m d&A+u$Sa"T[Fd(T,R~|La]?6wvie7p;o/?=z-m>t>'Wgs^
rwdWIOp	:
 h`F	m$D=
AE
 AE!0	A&@B 6I0ti@6'E!	 <Hhl  88 O!
!`E
F	#Y !2"	JA98'&] A(1 #\pQLp@Dc(L}D	U#$ ` Z1<FB b*( zEOx"0GL Homk/MSG?.a+5hr_]3ncfo,C<w66<_\lQn=<&UKt++--|v)guok	 G$I`DBc4  $`6__% p 9 @ 0@ 3`c Z$xiE` A H6 z  H1hX|/y}_cK{M;[{}O~<ow/l~:?V\UjWcc{khwe,_{[;5m}]]>j76	
u'G}ston{7z{tor/</F#N<_;OvfVLf[n7Go>y1AD6 aL@.	PZ0@f
$ 'L @P#HJ4IPT\W 
LR@t@DAA"L C0"@(  D "xw) 8X5lnMCh\Fq?R?/-s|w']acL5otOso7?j7={s77tgen~8`@ na i` F@I0 D$  T&IhLHp"M 0tdA:HQC0h9 +h P8pX gtB4 	  e:^b@YMXhvB8 2JHj z#$A %bG 800\%	M!,1 !DuS.kSez-5V'>g;P`uu?v[om9s0OaA7kM'\s/~w4* e,0 #@t;F$DT@: 4S!D$ AC`B0 F2@H!,	X005
8A MX$"$|6#`6#XR|l#_^~m7~@?"p!}AWlWzy-w|#T7o_g}U"~|c(,N/^9Fv~G^|lDi}ur]V60<[3`uz+N[[ -_5ONof?uI?[-~o5-m
 `!@DEH @UAHTS AF & 
 2B  (dHi#
(`
 !  
JF,-@ $r`PA"!1 	7I D"  "T2I /cH*WPDLC@ p EAtP v@
 	$ A@1@%zUlE $@ [C1 h)
A^@F,:HKO,$Q(<X ca
Z-P2@TX&vb36L xB >B0U*hQRJZDFr * Wy.TBp0XsRDRH:sDNjZ!e%4\EUfQ@(H#4M;a@j08%!,C{/"  
Ga/@  X5D!Q (Z2A1F!Ap86(&@9@@'yHB6 #:,!Q	0 	F	!P*|J/
40B
 Kt	#2lFpUX)&2Z clIDS9"IBY $8DBO 	`Qk@ D1-3zJ(F;LVQ	A0PqI0"`$T$(IB_.#D #Z!$<@
dA)  #$B"'ErA#@a266  (R P@Q	i"W( ) " 0$ *H XD "dH(1u N \ RLs 	#" 5I0l#p@e( w
04/!Pp2p@A KVfO'4avz	$BHzSHPVR =f`b5 BW>X _-f xG1S4 `=j5
T%  *$$|dJ!	
0 X 	(t@PFA@ABBB D*MB4rQT ^N08MH R$ )+42@,1N$
HdLU:4e@8%LCPv&
2D"dRA94 0r^z	O[,+!($6@"-H@K#@6EMGtZ	H_u `0d m.
%QptaR0 4x<HN`R	 ) H H ZNBQM6.,5*CGK& FF*sD@I <	QC[@!
)T2T6kQr F>+XQV   
  #&)$<ULP 0*F#((+9Y	,f)F4<i
gf	p #! UpJTAD"&/T.B!Dri2AR_#NH	LAPhK$=X	h  42(!4 R	\K$D$W  v@(D,A]$pXlrE&B B - zUQZb(@YHPP"0 d `@'D)C@C#&D **h  3H*"
$NR @	T!48pP2	 N
" (0"8D#"(P&\Q%JL:"dYbX"@AIBM"X  %1	\B
&QB.;lpX`@}e4(F2<( +A[6F0bStGuCP18T@!AI  QH$
7J  Q AlI 
@8R8PeLh#9! &!(p	a(	  Im#	0pD *,i$@f ) $C-\'
t(KDa1ba y
0'@2BP!dCD^buB)sbo@tr!"D	!l+#),S*B*&f8[ 
Q!W"jOK ,J2%DFqTeY3Hf uBQX@]7D  $qXDXH!a"\BlHH`@0 H}02HD C)B%E	A
`!	PI|^P &ODKDB R#$ Bh.(
DHB,G B )hF#M2Pe# Ff"fuA p:^@H0&eD t4QeYX)b) QP F	\ B0 .DH2!@+  B
!  !\0	!  pV3 ,   U"Qp  ")D:b' R8X	D4h,8xA & 3XC2 P18D!iAXF De04 $*4K  vMaDD	AB<0\ pPREARE Et5ACaD*( h BHe|)p8J`GPdOPH^"@@`5FCAg 	xpH,+k.44	Ebn yC `{8WD(EA 2 *Jl0Mp RAQR@H6H@b 
 Km39\@N.$@B2`0@&  83@V  ai	@,!<RpXP^T#Q ! 8e5D8GdHR@t`da @PDw D@JpHYWXt(B jO7 !tl?#J"UH=Ax BAN1B`9QZDA/2FD, BE%
4fp Q@HX|bTg Cp,pJr`JLg
6~@@*B0`I`0U` lENrQQ +B@2qnB0'@(9uzeF@H@$8 & Sc	J6[ pHGNcPP6m1`E _.q`|QE0YC@*8k( rRZBQKJ S%Dg>J]B$AX).A1W9) {'XULQ\ "+IH]" Me!db (-@CF Rb)l  	MH)@ "# EI
R3 JH0`%T& X$!  (Rp9Cd@&uTE0I 7   4 ,MvG8
` 
  	'XM8A&+@J 0$Dx 0$+%$~.YQWH93
#A${<a!B) CBC#`iEBbJ2 FC}F"+aWC!L(C?I UrqBk]`DVr/eQMWr~t #B%e&5f" ($phB<.DAF,Ix C	b`@
C
8Bd;& t Hk	Z$fTbTP @, `aB@L(r F
8P" B2!SQH
",D @WX` `/F2 )K42qI}%@ "R*`A+2	Kh`A"18" 0s@$b@F<(I(
$( @(!i ``I_" >S(@
 ?R4d$PR@ \&/aM@{*4 :68YVDI	H"$-	V'Db#1}t I#DI<e%9R*	zXDH@ D`a0!H+Mp<$@i !(0 k
.FF,hrLI/) dI(Tb(QcY$ l@6*GgBDS@$ WBL QnbDEWg#uFNPJ^R<  a"/ Ky? (lP!R0	qZ4mJCA<L8L|P"nI).B 0 (L*e `q!0\	5)?q d@Snx +
eP N9fCZM2pP]bL52!"S0t@<EbEQ\WT dLc :n|
("n2 q/ J  K**  Q))|# 9e0B#& 4 @ DG
(fZ` U/jeC0 P=B@_8xV$' d[+ \%Ceo>G#"vcMT*%&eD !C<@F9!i )*@Hh 4x&),!|LC0) @@ECD% ]l)J
$dS m"!U@ @eSU @ @AL	 Q~TQXI1L@A(FGAL\"BG N#1B,x
aU
JA@UadQb	7@cS+D%#f 5; F,>0	Q`@8CSB
o( b1"C!(\}WC&l(
SfdR2J"`-_!WXOH!bJj)	!p" T6HHN&0!@C \ ,0DI"XV@*v,X5t&
d`;b5G	" @ldA$KP'  &U!(E48E%.Dz38h$uLX *R@WrMiD8BRO1a2dD 9# ( bBx<i! y!H+!J*%Kt# ( b S&@u!tB$B"Gf@ `G
 !Ud "%6*P\Th$S`K\B4!5yB BL+`	%A(- SH(a"p@ 5  j	3,01}	 }JPC)(;  QA"i`FH+	tRI"d$ I> ? U t  1$mh	HBUZ% ? "!QZB`92	0(W@VP~AGte  
C"fw`@*H
AoA0A#2p	@X\ApTd@AGa
8!	@i2U`J*4A8X
I0 pyQm@#!$5eA@AN  89i@S4D]6T QJ	HDs'aKXcAX] I0 Bqr`V fCxC@JF'EP2	$P+ d P*BDP6T9)@ I AS	`Yt# J"jGBAD  e& %D?)N	0l.Jse\!
'OQUeFQg9 X$H$KJ-qB@Bl*sQ }I 4Y&!0`M+!
DG($C	6 D$ 	v 403%IVbppY SR&X,UP " A*"H0	Gk6Yb = @F%"`DB@HL
3 "PBm e0%2$`D JjH< 5#oB ^ y%ZRE-L[^$Vqr+OCVG/$EV% @ 
-@r	=$"t`$T)((dey8" x$a ( "2Y*J D0db1N4xs#P B G =jX0%(TLEc / $"P5C%v4rqh/}$4`90	f.$#NA@31e'P21G lFH*4#
@!  I a`! $ A$1R8Z  D H` h	:`Ua/REHL|x"@DF @L1T @H@4]tP
Z,"B2V fZ	31gX*ltPMQ"RM3(h@$ ,&J8 Z1 )CP`B8Ud',Hli,kJQXq'a "(
phPX1d `  g5,r5dFiNaDF#vbB@O1!eC$00:pTT!CY"X hj("S ,0&@$-{&B0A
1PPAE[|P1 \F%QRC Cu@!@8xU1P T	0H Y0<	D` S# A	t(j(6v	B- !Rj4@#"qJ ( `/"EAhLb@'LF0'%ncqA#2	0K]&1&%%X_c  HZ	4((A Hr:jg$I3l1A2$Q BF")?@g(00\!d
B$5[	bE
AP0I:d H,$	4 % +P A	p4?Jp`Zq@ xFa + Cr"@@M *	p "P@0a7wD`") 1"hB-Q@`(  kF 8	d RIP0<"
D' QxQDJX&_@d"H 	XP< ph	($/pLH
4		TUX9	5XB\~	{6H@ZDHXDB	Xvn~ ieaj@HV !(E%$)pANHA(sCB FP
H4rGTPBO)9R`";iSW@H(	8A 6J- -(@($9P
U%	o&F$("0J4 U@ `E'# 8,?0D@``"WDG@()8"BC >r 6@!!QK@J ,H`0 -@Bu$@JPb?F$ zmF p9Sx,yG	bf( Q%AAP$`T&0Fac(" @L
AS-##S2b  RBUQX
J3H2D  J'3
@@?`` S48)JB	 XOFYB(CA q` 	s.iF4&f#U,Ab @dF)L0:N KLB 6PhHnKPt<@"P{$H*A@*@U$!B@0!
d 23@< @@!-G5(0 yrxWD9 S0IR	p`4C H6HBNPz9?x @!CfD#4	&4!A5!90jJ;j5  YAB&$3| @	TC)@W
0"AMUp``
h# 8t@ AMARE2J  pC3I( 
"` G4dADB>Vy!AG"Y	Iy(@kn@rh8$:
p:X '(az( +/4T"S1Y!`
b=aV!kE $%DB:R6d(J3-VbUK-P*	PK:R5I"SNH53 :\e>AWh||x2_`f*ZEHBEPUA`%d 8,c0#$1	sb0)'PaCA Q8@J (#x$`@,6"!pPBbA
<e5  @A@Y
GBU L@%@'!@)D"D2U%	*@A+>.lEIqtl(0"$.tG`V1 "
@QAdUH0(#d @| FXPGPh0TF@ lq   ,F Q>"5V`D 4-B@dBD (p  h
9M I/  
PX-B  5\p@@ `B	4(bpH i` <cYJ'4$8N   (V`72te&*pDDP T0RePb@d!Cx" B 
$Ap@|  pFb	pFn @GF1BGK/1" 
 `'GF$!YM{,;AAX %#"k"@"|^h6AA E*I%P!CB$(X2InW%cFt"  a:Y b( 36L H@@PH$405(p}#X/  (2 :BPU H m   #  zY!=4
eH00E&% B&j=]1A-g5 4!N $H0Ea B
 AfexX. ($`
%C  "B@"*7DiD;NR `Fq:PKdD'r$3FLpU<Z8P^ ]@  %I0v3AxYsr[E@2 a& |P*2Vi @` C
78#   Q4d(@8 dWqA@* If P>" d*B2h(	 T-l1 ;`Cp8) Bu&$ir!<# D HD   RFBP%r`1D@0pdD0@@ $]B'05D=X+R^F$H	Tb<B# :gFE
0:"r 9,t $Pp r 	2&Y		@T
L  lZc % )N),@  D $R6K@>< ,+x$X	CUq6PADK8#MGk  P%Y[
mdE5Uh)*|2@H"^)l8u#$0jh@# % 9%@$`@H(	R:B*XD`%G0 @LA5 D$B@w'F8[  VP<cS$; & 	+*6r1
qx10#,$%M 0
P05% 8LUGZWAC!%d^hBA tA Nh!B^ 04$ 0HL
PS<t(E@	6sn !aZHHD
7@#2Q AR*Q<tE| Vlu2`#DE l jq
AT$fV\8:EzJo#@h Tz	@ Ce(r J X8*CEr
`@A
G`T>	(@ AM@~$OA9U (Eu3kCP6e$.C4P#	O 	Fh0+1[*UD0)4	@@p^= 8\/ZPD@E Z*$01`EzE0 [,Y?a @( 12BH(B bI	0]& G0 ($*#UF"  4!P" 7 2 H7 "(
{DD_Dh0B6KTk;RDL{"O* (R7
<&sj0FF!%p(@rR\jxSRA6")  $D
IZh`	P jFUD  f .`\i)r	l( R
\ ?
&Jt8fZ 	Q$2#P (@ "L a"aA. Xe8B*"p0!8Fp!AA<  /AC ?S$Q!@d	`%@ P#dQ0RfDBb(&PLYaD(K BBO0I,2 	T)B0GS0H]"Tx4!)	!I\  h0$C0@	[HHZah	,	@*.B*LH`pHHDA "J8& "B@ a *E ,( g8R1#"zq$@KRP0 $m9U1 1R+%' (a H (O$=" sp{G0Ad$hNu(a3b)m(`X8Qqp`p$kDCC=8r b@	(D&$Fh@ 
S)C?  S#bDHB{!O<H ``DSb4 `jJ $	9?@]I8I! BPt "*# 6@p22HD"b L:@RB
Ef #$"lx /]IAiPtj mYET\@HN-[@@ 6nj7kbFu fNb2P; F   G@`(D&~3 '%*qH{X74+CL)Ur!	"(HG1WkA0a( PNN f:FE? VPA4aQ  \-SL ,30)" 23FIPYQbL!H" ! *Fh@f ^H6!Q G1PL% jR$x8 D!Q$Q)a	,   3O d	[( 	H C(PU1(();_(  YCKD
5f<CRRG $4\
!q  W( 	D	F@B@x!JI@y" 15A-O $		R_! % Q`@&	x-*`pP DfZh'#Q@0 & \H@ Bm 
 b pdV09-412"`45Q	 \]P(6 $@*C j O_#c`JO	5DAp.L+
	Q5'bv4O 1f@qbhMhXB0RUH)&e	YPlk
S jYJc'H&r`J(r@jC
A@@`I&4Q
FN +h\C#m*8Q"$B @ $2bPT8"gA4#Y!@ x@O@ B"(6B#0TX4"$I" 
(B,` acTKG<F 3<6$R ,@%5	HBH	(Ci!
pib(2#``a  $)$$Ca|n
aDYB@! P;JJ-  # 0!ePIJ@DP$$QeD	A (B " NRAh
o2( zG"bdB(P B#UDPrl6 DbT/.&R <jX 
Vx%$x"Fb8#@4AIq7!EkPVMJ 46pBE@T($2D.p0H'!R!x8(
1@l0 P6Sp]kBuQPHitHL:
LD!d=1D(8B H  <4B
Z I8 s1yS0fC@` bm	C BBC!D@ a	PbTQH "JUJ("+bD@ %%SD&T   CU$CK2Y$b@f  tk	dD8i7R=Rig p!:vS\>+!"'BIg1! WBDy!v!)!01`+QP	;F"(Gq+DI>;
82DM@kD=CbY`Sfx$ Bb$B-@ \64$$s !&`%e P 2CPlk 0 $ R@;	B,-!,B d!.
)XTBA! T	A!! pMH  dSRQK2pj00 T@ B@$!@
Tqp@H5?A
(XNE)en`cpB@ad< 
p!0}h DirDGp !&Q= ;i@HI@2@amN!0`ib ! BGH :@,ApSbd`|D6dBaAM1 6
@2 * S "`.@
Q0 ( @VADD%0\&N<,7^(  hM)*6HBbCRReH`@4D(KF5`Ar")3&0QH *t/0 1q$ :0DBM @YQ  Kq  xlEpA 
QW8%0P&  BMT1@ %XN4.!8a!C~ / @ *Z x6+_O S!hq3@2-
Pa!D&"D6 4:HXP(y-  4E-";ai^mfq T02C@  N@"08| rlAAz1Bt	qN'",DpP"XTBo00%&JXoZ zM,l0`-eK@0LHb 0Et@0F|)eb A"n"eXhA AD@2F
b$IPx
X !MP
PEeq
 lb 
8GY0b# dA@S 
 rhaNK *( D\  "U Kz{H": kH 0H@PTPb!@R`$clL3A
"&mOP&d1T	4ai8@ T,{	fa-B*lk 
^b8#-SgO -B|AXTX@@
t>P=<L0A   /I"  ( @ +M5X)158 B) *HBp! @@qQa r gBPZ" tvhNRA  D `@X
f: IF	&`+D!%@)	GJ1`0 af6`C! YPH	iC dJ.jHF%Ffr E@Q8L=hP:	 jgspC	\p'!B`It4 E((Hd$% 2 iN96}JQ
"@:E T kvc|m~N2rS&]w\k-x}lo}/|~7m3M+_~?Z>^{G9]k7p_gRrnv~h~l9)6%{rB\Y?=mv?zKzG?1Qwmmw~Your>2eww]s\G7<O'WVLdt~e{x;z;%i]=K8L_?Q?cO3/IC>{Os_\0$][WVzk<'Y.f~vE8o=l6ZVfU._?I?^cqNVA}z0+ugBrcdFz7WM;k[Om+wqyMwy~xk_`w)=/{{Sl{>Ljwls<Kwsst}L<=wg94}}wy,EZ{kZwQ_}u]{{{{onswt=w/ylwsorw<wK{_i[%=zZ4Qo3=D~"N5t`IVqi6v4][t~yg~sG=p?a|#_>=;s_iN>?[x7~_}1g>}]yZ.yK_[O?'>q{v]@|O}o0Y[ws&45t~WCeU}	iuOZ>|6_[l+JY
8Pk$fZO{p}u5__ofgDkw}SFNF_M:'g?oc*~%iOWw}97;Z__E[8\x|/_O=	qu}i|E[z}h<qk2m]R<wZk}>^g?ZmWo.O?$#YG4+sv=sy>j{w>:t
_l-\'nVO/~okoosY\7nm7=~Vcyz.4k8__oL}+wWo/V_Z\_>>4zr{+q>;>7_On{w_{{*{m|a_MPh)]K':wZ[~6Of,nH^*J|Owyo^K/gNMOx^o	ze-,46-{?w|m+ttp~}zK' zwj{?Lieg*-k&^Z2{G_?/g=w?*?'tns^^'}{Ggtbb9-|mj|Uy?5v{ao6S?igW}'SoWwlV}&/,n.a]6/;Y,{>B|5is^X5s0wEN3&x=qvqg3L^/{~&_:k_[g:}~uw{[w;?q_^\W.+/7>{%Xw~c0Rwy{i~}Ww;O~/m}G[T?UuU/%\nX&uszw[V?U^Zm4IAyr;k~c6Z[y_W7wmm-~_{yW%~_kiwNq6Qr7?c>7{tIK|%o\s^PwosM\;n_iD>sGuvs .iZq7'KP}gFZgmGo 2.u:<==oV]vuo?=6_V|t.fOY~#z~S_.o_c?O>;u|Wy{n[{][??u]J{5&3'e u~{}w.lvg(x1/L~:%JTE=u>9YOtcl]R:J/S#=]lO~w*_>{<wL7^wn;mwO'nR{s}R^Won7O_?WzuH;MOms)E|e~^>xw7wiNkcy_-ww~7+f]]:ONLA{7cnvn?>wnlU~Gs~OW'Lzvmoz__OGEkh~?Mqz~W}=S/og}~~f3#/o7_6Y3{my^{/~MD9NsC_?S?wK^W|]z]{;G~j~]wnu\oUX=p.5~Y En?["AY\mU/;zMXYv2n%w`Er:vea][^\oI2)~5wgW__}ng{/~'I?u$=?S{ZL/(^uVk}^7w?FdrnNKo9UkB7_Zwy!o7n~W5~MORo~^[gn/s>Ki{69}_O>Gu4V}h_e_?1Fu~7U38jPXcWx'D[upO=jyLv!x^wdNHdN%xk{|_Uw3b}^/s)g?jl[W=9Au=h~d_>yc'w_as3_[uW*q?['vzwwLoTZk.2~?'2m?*nyi&eWo{?^=)vhYw	9~K?-wg~wjqWc
\]7)_(m=xWQrg^h>2}g<Wn/]7{GTOk*tz_u]<3_Ti[}j{A?ug<-y{CI?k
.~W>`wf/=RKN=h|4/"29towpT3?}~=:;ZyQ{7/.}Q{VaJwa5W8t|5_|y>/}?{}s}|8g_.{,}V<.c/KqW/]9<-~9[;a&%{o==o>^~?_,wZ3c=Lft{}2ZY/:w
9_C_u|SQ>cg^'o7_R~'::&Z;^+c<{w_[y_?j%}!Y>;?v1fxY~c-~Oy?wdW6W8z;omR&p(./Zwy{t~~kl&+|v]]wk%?.4wK3d]wo-5{o0'EK[W6O<}/ZOh%_v#2
dU{v"b?dxz_t}l~gn&@nwqKv}J]}~>WoKhqmX>5sc{[w#}_7]7XW\u_v(YvdZ#>}+[I/Xo=w8mtv-R[,UwItT5W->k_O{v6\Wl'd[?Q5e?7[N^t?7}{o-?WSOc~LW>hw_5+oxv{r{9{MMc_1U?).NT^;\s)K]>_OvwlN[_Wv	]U}v}Nd2sgm?n_8xm+UG<'9rO/+I!Z~_}.<;[i|kIOs}/y~n?{;-~WWM[u?Z{_lw+2O6UVH'y~6T{+~_Uf~;E[U7;=q/?gy_og>'^kWV_uiWG?rXerO>*[S{&o5J[vT){eO]7{B{w_/u{4{|JO7KWoAvd~G~n;z/Dgu#_o=>z;}oK_w{~%o.Y+{\^w?kmzv[yJ/v#5eq#w~gtn/uGTW1m|}ZYk_GWu{u~qk=m&{j}-e5Om7;3-_07cwLurG~vKw?}Olu4wvo5?M=?_t:{~\v6:K}\}v3{w>r{Z5zo|gTm[/]Jzs^3?-Wnug`?]wT{|OU7Z_6y 6}1bN+SK\~viFC*N2\?zwmw}X;q={}8IjEk~hy*_]=={h8nlP~t^~7oW;!{&YwH}%ch_Oo)s~\Oow>sgv~'>#mxgsg~_{3O8svonuS~s	u0u1OkINe<t3}wxa\__W:f{l W-o;Sd}o<-Zs}on_}:}xonn>3? .CO!($0  @0 G`h	4p,
%1FM ,X$CI
I cX \h$Kb0@@X(TE0$tCmso?gYok{}{#Z_6.{Ez_&7vu5?kpk[|
R9ENuNz}nmawAKuQPyp3|`-[{O][.W[w#Kns] `4bC`@z( A !$$	A! e@C 1jTP)5jPaQW F%X!jM1,@,|HXR]:rVqmr_?VR62msyO|ge}ikNc[{*U_6(;woU!)P~An G %F F@0X UD`1  4 H/ 0X%$f >A( ((M$H!I `     6@)  ;@x#$	( Fa2N 1U2B$E# H`0
BP- P."`H1!B1	BPbRYI` @1;n#T
 +0  ] DPyp")[`Gs=
_kE?OG/<"/{_ws\,)o+>xm.I*'8tF(d  NAK(D K)X+p	 @4HcB )P @Y!I
  	$J  p 0H|A!@$pLwlib0s-pB-Vjku{i+%3tGd^o.jfd\+vV(9}[3tYqo6c]K?~vUqyX=W}l5-BedM<r+_]o6ogh3&v/7/*[tgoggk0=s/gS^:8aW !"Bt LHEPD @   (D!*
X@&4  /Q0 `NP@BdT
 , % A! pz	 1@Qp'$BAo}_?.~j=SQwewZ/~7?-t1|?H~X&2skN;V+;Os_{`T0	$"0 1e	A` D $,  R Gh Pp` P &F  		 & xP a,	@  P@TPu&@P lhBo@ YB
6	F03F  B% (GEA R@2Q ! dLK4 xI@D XEH @C)  !  $
&%&@1b@J_uoW2vN*]sZl^>OzkuT\c~W_wqiygs=i&fw}
+	#!qU  (%C u& &   A f!TR`@S^\ Ax$M  P H@`!X j	$ He@c pU>E}v[9/O;e
_;~t3;9G7rk|gW*p	e}B_9^mf[o9'k/W-qU:^ooI_7ZAn<'mB~,5Bmgt:.Hd3{~fZEy6wwZQ|wVzrv>
AC  0` $Fa!pP(!(  jPp@  *8(	P$,	
 l("PQ4d D@)A( VBG J)	*rSlV{y r~l};{_{5B4?}oyo~_@?_'e@eh!	1m(J\@@  0I! C HK #(M * A&(
E (CDfH(C)942| *@  80USC]SB @C\`K'MHPHBLH ,Q 0h@,@1b dfH(<*PJ6 X7 D#x}SO?PJg)_e/~}8K'{c'k_yzAzw\3n61r`L4(H dI%*@PBh#Id
` 0PI6 
tQ1  6E!#XyD@
 	 "Db4Ue#=
n+uu<go'{w}vQcpC>u'}s-F~u'XoG7g>G=oXVw+S:O0GOC7[y~S[u7Mqu	_qO[jo.6w~g]XQ~^y?{81
@ n4p  B`
:xnP`@ #p1(cGl20 $`
	A
 Z#F`	 (@!E ;76g_}B*N{g}w!w[Uo/nO.w^{W";YA`i)@R!"S0 >k`&"!@)( h @P}H@Pl, +		0hU*U I` % Hu@T@
@2:EqTqD!JCSXV qAp:Pei  j!)AE MSAX!! ) {   2  $0o &     Dt$#B	@P6_nR_Fsm.oW5|kv;{O<fko3~:icK=:Ao\?Fp/8y#REHw
 &	"30YaAP rN d@,2Dd abfS@0 J5)I (i 	 @%
 H*a:1gN bZg ,-5p%BN 2GxMpA*%(bCBE BjBfc rXfFyPMY
(M	c`)IdZ9l-xQ *b{@YWp,YPB AP2'q4{uQkRfUHS EX:EU@@@6Fr !F(|XQ@}2	@<ZD$@" F
UE  E*aJ,i#B]C\F$A*<"A -[F @ #% 
JPqDz(MP*L WsuJ	zkXf!N<- 8U	FDuJ<GuF H(t	4G}kb,Rz`$ Lm1c b`bbf  0	)Bz 
 v D B(i#@;bl@D$*("Df.   A"m\IHb@DBH4aAG)!HL@"I	Zrg((Tpr@Dd8X#@@77@ I%f#Bz	^ rGr
 (&#B&@ZT#!bbV-!	P*&CM!rm BA?D- 
`%8ID+U KII5bi. H}$z"l$OJ~!F&Q`dT$83(	`Hj!NhT @"ETP] ! @c !00ADg  :HoFhZ4'UIc$f@I@`dpLR`) ,4A`ecaDB`.0@DU@Br99".h4bd%ck%+9# 6N`%0!n*=m
	
*(S2TB  E!8AdCmj#y  00^!z@@!~T2K UA*|TD(4 Di% $(0 JU,  
v3^T]b  [Q!V	3F!`T
	T2!V* vE"X"B&h#`q$)#2p) akP 	@j			B@D	@I 30	H(A>POLH3E"0&	D X*# 7HcH$"	f'SH|hcB G.FG
F :IL@T,	 	@(&!B E#02DW' Qh<
HPQ@1Nb
		p*`!P7F	Rhq>,LZ Q\DP(!'4  `p @@a0 4MMS B`4A8e.$4JITR!4EQFp
@& &T^	40!(#rXy4@#b!"`u)$2 *'+M X .	)S<p 3/0Za6+ (3{yU8b	4l@RC  I8!r. B8  L! r81alf`=$b4 ` C	@H-B
IxSpR H*X
,LJHJa/RXz-@%
h	p	@O" M`0t!
)$ pNX\tP1$2L`w/(kh$Z%R!k$	0*a<?DT*QW]	K	BG@`L!6y@Yk,JXWh@BC`b(b h G0[D04`'<$4-"
-S%Q$P@b)RR@D	L\00H@Z@AEgnQ\X0$0`Z"#K
Nik(zK AhS`PBCEkQ H8+p$41S-&`7K'h HIG `s4HBCP8)I!."@8A@n '$b $P3@@\" $B$%T8H(D (C&KhD&* `ApBBAB$M H(|
!! `a5I6@^+DP0nl#P\v@xa0n0	
 `01!.DtDPibE! a$ LJ 	G " @n, `ND d rBD+R`$r25P4Ck(8H4lP/v@}O2@D!G"nHAAu#Fv`	T	8FPC 5=4DW$f/ T18	]B5$^d1&n%0	0Ie&% $W 0p` B0A.!P0 PH``<%<`"@'pb( 2"vcP q (rcH+D;0>`4a'G<@ Odi Ad`O -) !
G l-JA H{RE"FVVZJ pE R 5x_JS@HC	*`))z*49'D&NJ#)$ \mR0_ 2"	6H ~0s>B76@A5JlO" 0xY3@;@!) . T2HE O]PV
)($ B  Y`m +*g. p @ ?@  `$4!!8 mB "6!@D: @/Fu` :JXt/GV{	Je/bq@^R!QDk f=wZ 3cR:Df  Gp_d
ARR"cA(Y@ #8)J  S)PPU:,R  m@C -X'8PdAy'2F F&.PQ0pLIC! @N  t	*
`d`@sEa`,  a2@P0,:*ChAl
T @ $ @ A gQ(AXd:01	&$H1:`X=e." !J}	R"XFJ`HEOp$CJ
c@I	pL!J@C!Ha%F,w`R|&5B(gvyCQzoouo}9~5~V7}{?Vq[no`*V"}qI>u}_~m7=;31vO7_6RMPaCAe
X!
0|G!V<l5e8&H?E002  \I9>B@d p+kXId hZ[0FB`BKZLuO @!pa W2&B4@G.DK$alB^ DJ@S11Ye* Sc0a`#2HJ'0L" ACI SOs~wO|zqMoz{~_^myP{wVm9g"]V8="Vw_&%~.vO 'D (Q#E#@2` Di Q 	StC	RZ`*`	$<7.AF!K*3_@"$^T@@(0p

FL 	Aro?n'lEWjclmoYg}/{T>o>|,x|{]sk*s||S}n/^IxoK9U-WUK'S=]~Uw{n_>yy}]=_}@-~tjT(F[2o .FGba|\PQzAp*i#!!" \0($4PN`S w"C@H@$c
 Mu$ 4D;Zp.RQ p AK1fjv~u]_?w>~vioR5nZ{7u?~?n>+9|@s%f%YaA A@J,`,$DQ(f
iC@sxBANb\ &IT #)0
x"f`"+P
.L0K!dhJ4!
pX GP*D  B=DrT  e84)"W B'LE" JE@ FaB,b	V[ fLyrl`#p2Ps~fUg=c%wM.o2Z~_oOmSMnh~:;h0'yQ0(	
r7"yFAfQ@$:,*i#i|*xPHO 1 "m  . 1  ! P 	@ PrLV;T?u^]|Z,/){ky2osx{?;7ggFW|I7C)2n|#g?|^_/[ogN?=/~4Y[kwtfvz/LwKJ?}F:]ujn_'uWxwo$a+,b {E
"*-QBtX\"*5 Vt#CK0&#CMP9U +5GB<@Ah"t(ZB%E{.z:'O_57/O_6wziV?kGx9=Eo}uRs:[!	10("@e'((pF %pRHF'B)_ H` 3A`'Sl4`;A Hi\uR (`		T k)*r C`T( 4@<5J@ aF`$L,AN^ 06 @@2<+h*(xPrB`Q u1@fBvzxMwO&5|yn.2wTwOt~m9[E\*0CoLpALIAF1)*1C
 MIc  9c40)l7b!@#A# [	e!"HV|k@e2lQBR!*Q*-AtW\?b2>;{{|ketUYg]==6.k%7_5w]Kw}_;;~?wjSvQv]}xkmeoovgu:{/}>~?vk=5n?_o3OHD#TDH@F0 !P3QxP zhl4Sabx$A!Z0BbX*, Q>,FQ!PK#`&D`@tk3SOYsw?]~uz|?^77_%cl??o[/^m@h0J3wA_`O@J$A`4F!!wn$Y2J+:p D*P@I8p"lpihbWJG9	b
:@EHT P 0%rr"4(EtMd@ H:21bU%pP%C@T4@48  ^%$I&:B(QB:d1"a46 /1( C CaR5{v**ojsGQ?on,u(z\n_WnvZ_~.iM_xst}r,1rpR! 8m qDCQDt(xD"3
 &+YZ!x"#d%)a /l 4 "/)(p^BaBL-@hH7Hzq'>}]~y||}/_+^o{_5om{:;qmtu5J1gOZmoo?X;=5[|]:K{Y}0_W<
{_vwYWF0!!B k,P<@@%2	&($7G:
!B-`Kr#4I q8@Y	* 11 M !EAbJ LcH% QEj@{noew{w]n~s?Kooo;{u/_==7>e]uKwfR^\V~eXc?/+-y[>c~Sz7u16U/`~o*dTs3=J\IBHvO=u}<r~J/[cF^w3n~3oP8+Qob7>3VK~g?Oo!n=.5y	n<W6L9dC\Fz>~/^-p~vsg_u]_7hmo=qifg;({^}bR~;EWk_uO^aZ~B?}ZD_[RJgc>9
sw[4=]p_Oqv59WNy"i#\W?1+xwA{v~Dgzg_'=J7e{]A9]Q2yl/7e};wC.09;~I[{~tdvR9~3z=y#yIksqsQ5_{_qv^(Tp^X;1w4.M?o7wi7(hV-w}-~7wuk-zkWO?bS,]`wosu~|a3uZl@j7]u	}%S<#9@~jf4M?X}Sj!jX[cLe.|?u|=~Ie/wQu&K/+\{[3kwz@]8W{hcvYcnek{c{_k\wuiy?|W,f'CM)}pwopmhAC{_W'3~/\>>sQa6_eT~<g;(gZkrmU~gT	!ovjT5|};goqo*s/'?,$UV5c{w=7.~>o9uq7.[M{k?uy;_w>{U=okO5gUUr7wX[v_Oc?xN{qKlgy?swW{I63gNoPZ~\kO.O:o[)*rzkY4;w'z!r=[uG}Z_.]7Sz_y/Ci:"M76u]?A~Vo[{Wyc//+>8qw~)>opo~u?;wrz3mra<GmGsm)|O9IrAy%w+bu_Ofv?BS2wf?7ujmf[V
Zt\}Jd7y_ /;50jc|m/Rr+_VR5|_~aY3_i~[,[GfGS~Z]>i_[Jk2BWCw\{]vc_/q}>5}w,__\qF7*.3._Tmw4s7\[?xNSi_p?NwP{X-T/t?7s|qOn#{:9_=r<}}yx4D6bF#cfk:||F7g?g-/QLukgkWv/_S#O#o}kt}7#cnOKslgGT_l_Ov)5%]ONCR?VyWG1gn.x9vFg]y}Rv_Z~3tv{b}u3{j=.m[i_o-oGo~oWB{\wuRn{>nddugoGe_p~?oZ['Gxogn92o<2c;[_=z~7boOkY&c?^?qlM_2Q+Y6"}x:Ow?7vi'OMO(Iv=My]SXtt/34'>*(||:{_kevO:q[[/W}_*EWO5W>}~>x}w9smmT[OOm[s<pgk'V:odn[wokGyswYuE[+/YSUWsGWw/?e|{i|mw/q_?[m8JO}_JG k'8}Y,rou};>$m?K:Xwkt%kr>y7t/._;ot[H6~o}skC}^u^2xNkRK:\U51\e}jy?{Vfx_`Ss=:+vwvNwN}jk9?Cy`''3az;kq;ykO^_}w^}3bzGn>C~_W;}^KzKwhc}l<.Wm=V}3qpEAT 2Vg(y  #X *PR%R" AH @J x&@P0,4	0R"J",5c@R0XIT @,	B$t:Jd"kP\K E|`hJ  D*$y_ Hpc PBaT9 PE HLl&
  )">l,Agf@l@ /$@c@$hxG >)*/"T<El@Vo[  hR	Pq\@8P!.QBYJPe xPlvmN(J:V"L P nlI C<BZ !@@ b%( F$4PD A@!4H
AbOgtcNP(EFH "( P *\w0D*pX
eLe)8F0qeb0!Zd*CU&4 +LH0nzTfB# JcKA4!D"qPqmBBG$# (qDA54hL@E,;N@ tC@rRA@a  O
`QLdf) 31  h4JSt ;.DeT]A4@!((D Q	TJ""Z2'+0`F&
On8 PU0D%Y4 kD&tP^+@00BI"c4J"PC"TP) ZIl2&IJ@ A3aeQj@,$P!&P`zKj (D Pa(T$eD@Qmr\pt I6HF.W	$C!"7p)b G0\(`")P0<?& g $  #L@H(H@C2FB+2 G"f(Pp By+FB!
``pb-|m80"p%H9V@x _9J|,P>JTV G6h#19n`vhs8L[YCP.(HXI+PT KJ	*A@Q/O)F2W/8v=8HFH&toML6! D]$ Ip0{@8@}TSqR.Y@ hGP! alE&$$
) Fh @ jT 22 `@* \$@ 
.@BA""8S I1X
`*k!Gy<qOcBC dr2aA Rk1 h# g 9:8zEVaSH1<&#1Tc	
4(R.-f$b"@i	
	@a(P!W@J!E(GU(!JB)@`82@YDX
7	7@-@W0l8Y@D") ,4OP 8H42 BX20&"	r AE 0JR  b$
K H/c1`EyH3y4jX3g0J	( # U( UJvKJp@`Z  >3AMQ*!
	N@d   I$0, P%RN"	 /`Y"BDa60M1A@pqI @S@`)A#(KA"#L J FTd@``FQ0R(  RDp*B 9i<HZ 6-@F\1^E(5B[La jJ-yQL
\01O&!4Yp DO`
i-8 dK$V0 (TU!E)A E1A"p.IEF ), F_TX$f0!AC2 PU@k)Q&  ! !(A9pH0qXp% LP    /W$
 	`\ '(
5yq !Um"ChJ^o@kRegL@I 
 $ adZ"^Fr -16V4e@BjB2m[I	@@1A2I3$V!'NfF@:@4,1/06fSA;BCcHC0"  oz
fAQLfZN E]  *L! \ 8pJ@0"]H$BX)  vHH!TF0 l#>T*`9&
"0"" :m`XP,j+#`R8*0C,&@OP9 ApP $e(@  iH F"H * 9Hd " ,  
( %6 AD-	PyC5   kP;.d41CQ} R  HRP0	3`a  - l,l!R(q
5lT9 )h@l J8 P(Ux!`
9 $ ) @ 8)NQ40H
*raS( Ap%H"3 V06r)40A6(Z:,EJsQp	 ~ So$B*|EQ ~j1hR- tSG	
OA08Rd`nJ\F"+K lIXI3@TB  @AH!Q$J)" _:p;\VRPWAdxFPMsP%`C:ex'=|
BA"0-"t ^)"fSbK`Gh06wF2U, P{2	J0DU!$`<QP<<A P'P  v eHO@`K	H aG
A\60
 z  40  
K0jQ
D
~~l;B9RB\!sQ$Cp1a1*#(#`
VDA^_OR$L f""8
1DU&1H"'&ZA%L !PS$8  @2$GaBGa94`"U% i Jf He "H @Q<H f0(  jD`[ FiB(!0$ <uUShCI(.ldpRALF4
 (hb-`j	BBi  $ P@ 5!@pn9@@,*K mb Qb
.Q8 RaJj`LS=Y+0"D#
( `01*+H	c  PT HRAMiOk6R 2Dt"Mb(!T1B!eMDl%, 0v\.w  0@@-L!b `p !)Ef$(`ACB	' d a6d`#&BD F!Q(%O^5UD`clKV%Ud@P.qHoBE
h$F3c73Gc2@$Nx <@$-g|d8=O).*5c W +`A"DM0h`Xw-C@ pTG+X6O1`bw5D.D@OiHP( f+F@4$
Ja!JP6z0M) +$sD[
 Fc/B' ``YTf2T(   LC1EH@(A H  M$LIBF  T KZ JbMD*4~H(Rq3ZC"doRI !D1#CV5?&`A/-$CO&0uK`k#& #DT( @!b`ABc"gM, D 4l$(j 9J2 $0yc<K0  h $" 8 4EB DC=8Gp LTGx8B0tE6i	(R  Kem #A\aMz"=ZAB b@@	@(
 $ 6#f`W|(axXPV`/Fc  $@ BHmlz jB&% F$	IF8`Fbm64 RH'3L` +B+rHD!  @(0.ZY/FAW[@
plx t AN,J>$F-$
s@d `T[-0P*(q\`B e28dAUr !@k4Me2 6p,
R@4	@H@  RAfh/B2iLpl@T7ARIC"PD 3N `u#-0]LjPJA(
 `'HaP1tBCig)!X4Im
ns q'd%G=l#,  OXE@   UP8"d`bxP3x0\@xD]Xx4X6B #E	AX4,RRQHaAZ,0TicBqi (" " H  Hd!pEH+p60V+&G  bd"PQr 0\4M"
 9DM"F J@1 ..	_(wT}x1@ R )"h"	D&ciL2!q	Zf	
U2#Y,&Y ,E`LD $	 @uAq 
#E'  8SCdK0ADF'L)A @E02L %p`' TAZ`pz(JPbM@@,$V`T0@ABd$ 569(<A1` 4PA
H V`@&&54wrDKBH@$@LrDi1"F 4H` 	ID$@ 1p  pD!Zy3;YWz#  8[qBXTl@+!9 &P2K!0qY*p
%pds b 04L1TXt b &X.bD5D 1EB@IH@R*dBR>&FI@M$
5P$CE~ $G 6iDpRaHW3}
Fj A.7ab0kvP8tyEKrHL u6XPB!1(-p|J@68`!gGP/20h3M DS u` "h%qC%dyB0H4+L(<@'Bb K#po\c@ dA..bYEfB#o)
*FaQ8 
K&P"V(!1 Q0B	jFyR0dBB\ VPT CB dv @2`=s1  @"n%kUJ&B#R5gJ*py ME
E:DC$Et5j,QP (T4&%DLJY>$@82-S;P[1&MI"`b:HaQ*tDq}H" ``j$P"H@ {  !|C@
44I{CI ($q)	 
d$L 	a1;TlP;0 (#  PB\ $ B:4!\!PfEQGBc6@'HJf ` F`YAC*P(V@-(*X	Uq>	hZ	#DE
%Np#8 )	!NCt  )G *UBpF6`gA ,TBG$4 , D@`   K0KB2`(A :  (L!F LDQ
\	D  pn8a'B 8DUd;	N MRH   QLprGI	hX4 C@-xF\"cKxLe@ga`iB%A/xq@`B#	aRx0>S@4i8D1$ #_TbTCWce3@`i iJ u* @bpR1DUL	eV
)%,BCaXR Cbs(x
HF(	  PcPQP!@2Ec JFE'
D  !pBk bhj.FXP1N:8I X P X1a,Zhi3z3	#AM5`0R*a%b&@Beb@Y&A@6<5 ,pDML dYDa0,P<iADnD4`J"q@ H#=(P9By iI!N$P	8HiqqYXB0r

 LT0M\($  $@R1I" =L$Wp
RlBL LP0  d VN!L*Y8yPD)  / 3 $(pr@5 @F"LAA @"D 
\Rr8PD >P8TA3lFi@jJTB0Vx@AC&&t$ @ v"8|$yYX2X(	EJd-BVJ J`1;\FCA27hgR~St6mwT>GZ{#Z	%,Mno}~Y_>yknYw.++s|W3_}n]K?yN][}onhy7=_^3w;I{?kn#5=k|y7o/oEM=r>?_U.}Z7c_uk`{OUKP2'g&Xi_cCo{^]6W=0nInOZNuU	~[_x~G'o4:{ocw<.H#Fm,!>7+v~wOxsz{>_[}_W^/w/>uwk}y~;/WoPtg/n=EYYmZ^_~W.uw	O'@'q?/k=^2w)~3)4~uLd%j._g7qvNjo")W_xUEZ5^*w99wOTF~~gWaV~G|V;g~.Wt7wtom_FyOvi{>9-K9IIeto=~7~Zgm2w4}O_zwy}Qlz}W[}^X=~{O:W&lJM5_rfuMz~sXx&7nk7|5SOy;_1zs}n}o^m];{y>Zp]K|n_?=o_o^zni~o_q_={o[4?w7t|y~N;'Z?siV7:%\a^}?-W]?v_R?>uZ;O+CkhKsRgv=;&	gqw?_/&!cz[_Y?o5<3y6=~^}{ws~Wx{?(=w3ozxY3}fMx^}XI?#pzr]=#=uS_dNIw-B9bWatwWuk}^~y|zjm%Rt~2/G5=C PecG|@ObU655N7Ny.},L?:y67ooZN|<1by{"^.?nW7z/|{>]kzXZmS/^w]{S_q'p#qxWS}gl/fp:u]o.Py~?+T)X_7w{{mX;{o#Z7^5:Kq'XwJ}S>Q)5[O,.]~Z}v?~cWcyO~R{6w?~tds~u'_;]>~\.=]OoSk&}w[u>:w%k0kS(=_Wo~vfw~??qF_.Iw?gykTcwop-	,M%fvd~}Xr|k{k}}Gmq?S~_ulc?~WKVo!yU_}z?%;6>}U<vu#ZWY}n|i\c\<L^}zIl-9wae_rl{_=O}_zKly @~y|qM<{c$?->_:5/[[[Tz)[}9r?=^~WmG{|gwz+[d{*fn7]{>g;m5cN|?n|WO$X}[p.9W{)Sl=O*7_7BH1fgMgB}{cj7<e_~k;?~z}IJsZ/'{eP>w[E.=]_9/|}w>[z?7/zg~wzJv%g2N}>P4w3[7'vWw}wn._lN_}jwVa^\wW$_wi-yE}Ko3]nzn}=z?unqmoZs3+pny;MuJ5vxUp4=7~}Uk[y]ts)Vou[}gn_=o'5G?~V{Fo^s.k[LCmD3/;_Z{	,;OsN7kk;??6Uwv'tNWg~td?|lKc?:_7"\RCvr??wboA{c|n/~o6L.R7=,zEskwoO[:]_qOu?-j!v>_rOw5guDgTu?{-vW9SOoS}g>^^hoOo~zM_k~u?3IGcWxk?;V#$L@UJ P
e 	X":A Sx4B9a({Mj#%pJ@JjY
ACT Bh%kN$V M$A@RX$HXI+(@01@z`( Qt
I$L 0  Qs0  :f1q#$HX(@#*A&(` $.@D 

x  >&H*(^)A N 01*XK"x,!&3E@" E( o	?  )%)	`p0 02 8'H 3D X qR !A$b  6q 9B&Er+ C`
!<9j[#
AFZp@tFYA@%l "hL!fBg'TQQ@$"Dl (( CF!pL 	)E5$R-@,0&AEsPt1TI 	BR"&]*'P)  8  "$(  
*1 7$F j(jid0`"j2`0'`A Ud`P  d X! @  ,&	 38J@
jj&%	Ey@] "(TxQ~##@wK.MH"+
*`=h Y&5@9fX+IDD
 ep8BHU <'R `>  @ BKN@ z1F@( (Ba(@-'`JO2a/"V<"e CAe .0\PdDHtP8BDVL0(`Bv4&J'dlTA	b 
	^(#0"
3U ^R0iR(+a"O Z$	Adj@"D@b
@1,m# P B%a#@| 1@  "pHN20  d.L>5`8 RIJ`)cRLE)*)R$$ BJ/h`X4Ir K|XhAm N$y=	W" $  Dx @/E!E 0H _ 
aj!P<F,t5I
 ^	B,@E
8p B   0Bp  0 b#% T)PCkLhDU2+	R38	JF +u@ D
 b2FO B F8!FqBpD	R 0hJG D !2GhCWy![,4L(x/ -@Q
hc9BTcLX8$ALE
= b5!H]Fw h 5I"P 4
* V 0\(L%($#%,E0n
@rT.],{h  91@9j3tH@`a%@p@ 4e" h$IAc`*t
% jRqc@b2fY0
<d iC	LHh*8i1BsSL
0Ba	HpQ. $00B P@E1+40^&0RHW2I* V)a R 	8@H
@F0AD"x0@&	  AN P Qg , QbI&XBti@`K2"@@qH, dH qGnx`0axFB,Dj%Ga
x	%G1
R1CA P*Dq&POiZ$4@$4@Y 01 BJ I	B$B=mU0   6D#>$!$Yb6~E@0JhQj(6/AZ 0tHKKB@xEHe4A+@pS* 	j9@( ZA(
$
!"T^l2YRRL P1:#a lHB0!aI"c 	
@xJd`rK#A1W0&7ZEr  jYG#h	kR DL2,Z #	@ &G2 pQAH P i\  !2 $Q4( [`dkG\"D1"NoJ IR"S  P	HcD 0h@\'S@ @T!@+ FmdU*HN yH`cD	.hHQ  XP	pvaE'q
*T&>a!P dJ@`#_PB @$J!P`3$' E^#|``P6,H!X!@*p` P,GX 	PbL hNRSP@  JFQ	
rj *` -fi Y%Kq
@Z$KRL=$R%BDQ!Y (i`K?` @@4	EbH0.(`D)cE p GqOu 2^E a  =($($C8   pJi;/	
X	*Vb&D1 %4E1$	YHAH MQBIty &&FhE <!H6&2@
b% VH" 0`@PFg,A`   m$ I0@0b3JKyC  @eiZ@7FV   4H 6T *d 0L,lcD@  T9 T&P|PHQ05(@"/#@ @C)%% q xxHy`2(,*!	qJV(E] kH#m8 BBML82"<ee  K@Y(#:A@	 <
@d((@P	q&	P(H:q0!E cL  g	:3@%eG *@2@.)^ 5XB4D]",\]b "AJ a @G|H@ H !@$!@"K4`F@aj9 6*6a 4YpHH&t"	"<xRY2*PP `$8 `P@}
PA0
S$KB l{CZ! R#Fab, C4"Vi@ (R
2	0<)*A;}),C90i)@"H@BpcY=XcISR8X%
xk$#>E``4*D"  !+ 
PqP6 5'B0L
	 O@AL&%a@ qq!a[# !c%Q`	 !$0Y IU@9" ?T >T5@QCt&LPqb Er#@i |9"D $0@, j = self._id, prefix = self.classPrefix;

        return (
          '<div id="' + id + '" class="' + self.classes + '">' +
          '<div id="' + id + '-handle" class="' + prefix + 'slider-handle" role="slider" tabindex="-1"></div>' +
          '</div>'
        );
      },

      reset: function () {
        this.value(this._initValue).repaint();
      },

      postRender: function () {
        var self = this, minValue, maxValue, screenCordName,
          stylePosName, sizeName, shortSizeName;

        function toFraction(min, max, val) {
          return (val + min) / (max - min);
        }

        function fromFraction(min, max, val) {
          return (val * (max - min)) - min;
        }

        function handleKeyboard(minValue, maxValue) {
          function alter(delta) {
            var value;

            value = self.value();
            value = fromFraction(minValue, maxValue, toFraction(minValue, maxValue, value) + (delta * 0.05));
            value = constrain(value, minValue, maxValue);

            self.value(value);

            self.fire('dragstart', { value: value });
            self.fire('drag', { value: value });
            self.fire('dragend', { value: value });
          }

          self.on('keydown', function (e) {
            switch (e.keyCode) {
              case 37:
              case 38:
                alter(-1);
                break;

              case 39:
              case 40:
                alter(1);
                break;
            }
          });
        }

        function handleDrag(minValue, maxValue, handleEl) {
          var startPos, startHandlePos, maxHandlePos, handlePos, value;

          self._dragHelper = new DragHelper(self._id, {
            handle: self._id + "-handle",

            start: function (e) {
              startPos = e[screenCordName];
              startHandlePos = parseInt(self.getEl('handle').style[stylePosName], 10);
              maxHandlePos = (self.layoutRect()[shortSizeName] || 100) - DomUtils.getSize(handleEl)[sizeName];
              self.fire('dragstart', { value: value });
            },

            drag: function (e) {
              var delta = e[screenCordName] - startPos;

              handlePos = constrain(startHandlePos + delta, 0, maxHandlePos);
              handleEl.style[stylePosName] = handlePos + 'px';

              value = minValue + (handlePos / maxHandlePos) * (maxValue - minValue);
              self.value(value);

              self.tooltip().text('' + self.settings.previewFilter(value)).show().moveRel(handleEl, 'bc tc');

              self.fire('drag', { value: value });
            },

            stop: function () {
              self.tooltip().hide();
              self.fire('dragend', { value: value });
            }
          });
        }

        minValue = self._minValue;
        maxValue = self._maxValue;

        if (self.settings.orientation == "v") {
          screenCordName = "screenY";
          stylePosName = "top";
          sizeName = "height";
          shortSizeName = "h";
        } else {
          screenCordName = "screenX";
          stylePosName = "left";
          sizeName = "width";
          shortSizeName = "w";
        }

        self._super();

        handleKeyboard(minValue, maxValue, self.getEl('handle'));
        handleDrag(minValue, maxValue, self.getEl('handle'));
      },

      repaint: function () {
        this._super();
        updateSliderHandle(this, this.value());
      },

      bindStates: function () {
        var self = this;

        self.state.on('change:value', function (e) {
          updateSliderHandle(self, e.value);
        });

        return self._super();
      }
    });
  }
);
/**
 * Spacer.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2017 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/**
 * Creates a spacer. This control is used in flex layouts for example.
 *
 * @-x-less Spacer.less
 * @class tinymce.ui.Spacer
 * @extends tinymce.ui.Widget
 */
define(
  'tiL   FF `L    L  L%$I,  ]!L  
	  m pt7   
 0o L~  ,   \BTE	|	 0 (  :L  7XO pZ  
L  ? Ol. 0t7   de	   6
  	    L  S  c  
 Px p   L  0   H   
  q @n|7      z  X   ^sV  7      
 Q   V
"V
    "~,      G D4    ""u `     R^ P ,   ?	 k	pP 0z <  
L   LLhL  X  :(L   
 ,  
L  fQ ,uL  NfT  + 7 TL7 0    
TY h *    G
x `e   L  I	      	$F^Y	 @  q   L   "}     L  o&   |  
L  2W ( $ahL E      L   b.	 @ |  
L  ` `7  M       2 w
#  
 L   " KO  uL   KO7  LO7L   LO  6f     L   4  L  ]       xc  
p+L      "   `  0      > @        "  Yj"zX  	   uL         u 3      
l "  l ]} 7 3%  p[    "a @8 '  ; ] %" P8   ; B  B.".""$"""i$,QDBRAR*R"PTEUUEwPEP%LN"W%)UB,DU1SU/[,US RR.R'E"B")	X/*"DB*BBV:)Nj)ZJ)RZ)gb)){s|o)}s73%8n8'8;905+9f 39.:^:,,,788/8:2-F, ?40;ZL   S    >  *h*/*("3)"!Ica*(2)` ` 
>*("2-Ln.` ,*22b"` ("(2"JH*H"` ***%.T `0*6
"-2-)` ` 
6$3**Hb""RH",((3-"` H" `K   * N# PK   \   u  
L  R  \ J  `s "  O. r)
 0   b-P"'2A ` !   L  0  p !   L  1   !   L  2 >7  !   vL  3 hR  7   4  L `. n  ;5 rV"  I   
L  / I   X&< @   6 T5   	 0   9z  H  
uL  ]"/ 7        +    lg 7       _ 0  Q  ? %  @   :rNB @e   b"YZ   l  
B  a"   lC j P!    <jL  D s `!    
L  r)  i  I   - $ $[   :L    &c p  '  
3L  #\J  E4+  8| P X .T]  xL  K %5v 87     L  * P    
 ML     N lk" p   O nA S*   gP T1 `{<  "L  r"w	 xF q" ~ 9 P "   L  T     BL  U  `    V 8[  p    L  W   ~   yX v I	A` ~   l2Yga2Y  Dz  ::(.	 M  }" "t7  
   "
 "  {u_ P   ,mX >  PV     b pjRT4 @/ X}7  
Z
c "  h d   h e   h f yu- 0 L L  g V%>  ta  
 
 \h8 @  4  i i	" P    
L  		 `  %L  { 5! ` h  m 
 0   L  n  p  
 L  y?&O P 0  
  p n%k ?      AA P   L  r  LtOP2^\D%"""B[*P%.@URcBZ"D"RlT5@URBZP""%bbB"BRN\~P%"BR*
\ N,"+,$,B"<T%U)TUJ2$+2/G$QJ	%RB%1e3U%8|%:3%>34LM&cm4G#$4n6kQ R SY's9'vi't'38Y8i5s5~'|z'_681E(Z(J(26L66o77 S    5  "c("2.-"LMb	N*>	M`iJ(FO B	B>#HR
fG/	Pi2O^#At((dO)@EE<%Y4 x DRDRDXAtD`qDAV$X Z @0`(0
$L@"	4DLT E@hLdqw( D1`B"H Z!C
H J  ")X*-bI)i>NC 7P<j02("Ph ! rH'j'QDj`+&H(	AT@JMA0`"1    *1A'kVmtJLIgF@Jxr#A(faP, NA5X  %*P`%M /Ab5!IeZ
pd)Zp	jWG(  St ,4";ERXX 0+YbdB
f	  @3 `@ @B   D  $P Q"RG 
ba p&7D$d7"@y@pO	%[!Q&8e2H@T:@ n ~fV
IJ*ZB(V.S"F|&9R&qZO 9J' BV!F1'%EF:fMQ0F] )j)(P"UNU pl8oa
FFY,&$J`p0 KpAf+p7!O!*X+[.	 HH1PC[ X	EHeIl"6" PAB#(dt0 h@sCA XL)Q!
I$0\^$1!H; M'M@
0B`	1`S,MIO9p'Muqi@@
RaAj4FR2J8I4I NZ-T H GBB1NGtky (&FFZ HBL`T D[    [5&
&UDDI93J_B9 "$.@b(J&t T)  J  
T* )
a"`$l 
A`` @$* !0 "L.aYYp@ q*c(U,E"TTuVA2z 2  pfl
t4*BF,T&	Z}p3^IIM T0T8N ,# Q	hOF1< 
:\U1@o! S" 2v,G@ 8`Z.;CA`60cNf
`I T]!2B@K?(4c$  (4@B !'CcD( 5U h @A
B(fp(  d jEpB&@R@@HPG%BD#QP^DK2U,`C.C|	Ya$'Qg+-aJ
 PK`  @vd]'1 !`EC^D w	 SaH`228""qk,Y!Y FMGI !abPXAGP >fbJX%kjIl" $F""%S 0	@D!

@AbhFp AG!	Ac	$
Ap
   	6C :!0! )ZYJF a@Q@H]DB B@!k
1R 7"GX0(e	xxF4h}C,mP	c"4D
B@4z9rh	Fj]2Q&	qblZ9^OX @@( P`9 8`44H=PT_0P94"D! Ba 9l(@4
`D7"I p [aF:@ft&#TC
L@cI
a&(@   GHb!$T, Xc # A,ET TT $$a[Ah@,-L"934$G<Oy$d@
 )h`1 %	8P p)P0@!u 	3$ %80 B Ce 
  
 .d@IFIx  `RK )`( Z xqm#n(H 0P +D F.F D qE@E& $$`0V"0AUU `Bl)P!-@RP$doA 
b*MP21R5j N$GB(UPn@4	B40 A"j	LPW TWHb"e[/d.H.$ZBB`D~h ," GXH(8IdDC0pcA8B3_Qb1bGIc	zKB
h,	FCi@4A #% *J!$D t|(DLS03F I
pH%t G: @ CjD Pg	E5I
H
@
 XHA6d4 a0(| %D8NZ X$Q@%aTp !4N`ICd >A2qKg.@[Dw1g@3A	 ']VACqJG`s  JP(#i	1)5"2
p"%  3@F prI@IkJ%
xHTdXEz$5HEb@c
X
!HkyL	 -HN   `8O&	=Q"	 <f[i!7!	
A	QT8BFR2Hk  (DE < 0P4* I" %J$TQQ"Lx L!dI;B ed)D z (D B $eA0@B\	 mBX :>L  d~(8A f
9#0!%DEQR
' M2i2'G\*)`"=HTD  [#  "0demAF
H(<6F
@BJ! cABrHP. Q "%!`  .L"
  ?%3xC! `D(IIa@iC*ZX HB	
@Ad0,FT dShqniyNKFQ@N'P.D+2AbJ\ph6`&MfK\RC 	`uK($-
Fa"@C6tc +1t%RNPEKt@P@IP*	@P2  4(	DtEzB"`J` 2c d"
J'\5 |I! b0 
H
& $JU
5H	 $pD&AzH#  A)B (!|(ce 1C " $0~;{?~smu{[zz_?o_xO_[83QJf\{g~Wo^ew_#z6'F<D0$naF06< p26pr{m'X d..c NQ"(h(Q0Q/H$@B J@(M$HJ BX)"5iJ`L4. ,@(& V1P 0@aE H AJ'4BD#q*9fE"R@!b00,8`LO||_wxbw?7g{ue?9lM"^)dXIR( 6` 2EE 6.4%da@b0@5AEG2!Lh#@4Kjt&z |
z# `EpA&D`@ZlbD:W,[swq?!_{~7m>/g}?{!^3zo~{~n)kOneqf~+z:n{zGMw^s?s2rz.KzyW__WIzv7M>O(]O %`qV4
F2 X b&GB  W aR  JuAR"C4VUcM80 hQpxAB2
$ TJPL#bt!`dDReo_o}o6?^Kr-{oT(}Vu{OQ|h9[?zo_[}Z]v{<=@e5 h(0_23!(4
SSx}SF4%FE@ D%4# 
r0X2T #pCg*L%L:iTa$I1PXP>	 $ %  (hgQH	> 1cB |#`i qD$"2@`b++dIIZ KGTi pOLUA PA
D@#@1w4{w6u#n{oO?\'6uoS*}<W:vOn_oLzm}mz<} (RDD\'1A`V36)B=kJ d!/3 "f@B%DDpp
 H@mb DQ5P-H9H#@jd`BIT #!w2|W''^y;wW_|W?\n/ry}}3wZNy[[}my{Z;7d(M~Yl;yj^imVO{k=G{=u:<a=Umh. < [YyPSb]%V A ',b854LxD8$&6LbU	!!P$@01QHr.D@bBP<wsj9wYz+~c5a}A--vV/?^/n=~:ek=,to~AF?m- K`,ee%F~=Y rCn}#p4`,xy.	
*#wQ ~ Xi2^r	RP*P'J 
) d"an@ "4$ "0#LH5p4raExz)eT$	!: N#f PEas0\ehk	
ArpyNn>x~|~_l\yy'V}Mo={PN?rw}o-K^tp4I"aaBji P!biV(X32H@/M2y uRw0)J$0EL<'$$	DeTcD
"TJ4e@?/F_f>_W~oyk_~HS6?Z-(zv^7}ohm]T|sC7w]M|N>W7{YY<^Xo?0](oUS_Wjwo>[.6s{X") $h%TPESm@^ xD<<c&fp8B)
_G Q2Dr7 "
D1 ` dVv
fOB: ANRa
vHA "V%|'~!9=uk/+k|*ov|&YGj7e=|[}wo$0d lPaO9 7 !UhDAc $jcYBQ~'| 4Td EU#6 x@@% 	hP@FQB	ba!H (%$
`@,0`RPEG| *
 a, @9 "hN@&!	%]3VDW,T 4 *<;52P>a!&_ fPG		0	<_y}|:{=nyou/YIs}c_=:^og~;.zg)w 1:0 F&8 &*YzT6V!q`B$.D}0 H$	2$*@@  !Fi @ 8 K@"TUa)BCPDT7W?0k_?
}+'tkwqW6V]w>`|k};\v==_lZqx_&FS>OOoUb?=s/Pq8ow}W@E  +
LBzUYD/ - 7C s A@ AFdTKW8 Dq  	!L<@%  !f6\%r"7YD+ A 8$wmV>iW\6gm'}J4x{g&|oQ]}u^a'[Wv73_OS`mg{gMqK/z/zf;7*S/7e^u3~/_U~
/9_<o*c|>^^m>y|>F^onxw[wG4n[Vg;[e=wu9{ou\g{|`/_6}u~.k!:{V?8{7<4=oO{|3drzWCiT~~o]k6dY_}_}h=f(h~gOe^:-w_6$2oJ_[Ov[w|Vn5W|_/zoo*w2;x]?;wy\_q1 W=_U<O&s~_iROzmG3/m|-shw{j`Nl}<.n<ubC;3Ghx^{{a[/7{{tdF]v5%}7}1}i[s}jvr7{+xb%g}sZ^b3;~?&f6/_vMtsrh7Cv}7uw?s&mc~hYEvtn(W*'FzU{};4yXz=yX'nZwWN"n@:`%[WOv}Y3{?[/W<?A^_[t+<V|\>js?g}sowkY$;7nsos3_\6L/OX_nMmLy>?wvy[LY*:y{d{Mem65t;/=1|xmY bxeQm,oV~|%@U|#2>l
ykJeUO~_/YXV+[r>tv:KO=dm_yMw_ GfvIo+QzWrRkt3;/?T}n9-oMu7PF[7~6^?}f3?kf9w;-8wLEoVGP9kf~Vn~+_?|{_O&37m[w}w~,s!SKiY	~;;qyL;4kzkOp,5o_.f2ycnuE."wI)Q)os|m/
f?W_o=6yg?^^Z'__y}5k?_}L_=St>J]-fXGOQ=u&wc{]z|sw\zgzKUz>q_iosOUV.q/QkW~>enS{MMyt.mE>wyo]}~<KOor's/_Wv~TUB>n~~|S,yc>[N<3<<luz{Zkm/Rs_rno%W5Sv7)=BcwbI~3Z[%/Kx=^^[~'^7t>|;uUe}+1tz?G]+;Rf7;wswzPOignRyp}__v+]eo'2|o~6-m{rwK<_!7p:_pyoo?g?=^zO606OR/Q6O!k]29 _{<35=gg=ogwlaoo\e?])~5?sv*%'wGqux5]vy_	Y=|(?#^TQ>^~J]~{vo{{z%wqkoZ.\|-x6p,u)[Gw&]oKVkwkw[z^_{]Wgk!Cc[roenV=Q_|9;QtGowMuW?{tq;iMF[[:q)k&qwoZT/}m_y}X`_o"}o|{Fu;_.oMw9yiF]Xvfy/v$?{e+g?i}uuW;O]?>?e;zg=8{c^vw}}nSfWnz{M]o%;X6_&?eNTl.V/S"9@]co0|Xuv}_.*=+?FhK\kz_[4l3n3-K)aT"ynu_+sOw?:kEo+/O]Sik$e\vBguKFe7Zr}|7no%&K{WRg`?Ns_<-}_ue=>6yy^{no.7V/]s'[;e[oq<*8Nzv):?H\CgKu];{/wW(O4j;1~*{|~@_v=w}O3Kx8pzzl?qg-q^_>gnYYo3UXtw?Goni8nb6__{k|}s8>lY_onCy3K_`hO}K_\Bf^ij?Z_r{?s7Im+
uEQoN7A9kZ\=beVHY 01kYW|us{x.v{;iOZVPbgSM{z9W^owd}O{us~nF/u=tl{__?TsY(';a\W\w|G7j]~vl3o:G 1o?y{eYlMU_k[KmivO~SWqu {M?]oyKzj{E}lY;;]Odog&~?`\oR%ygiM)4vhwz~=[vwk_{O_C;?OX+P_i9Ofg=:_{~4_3N}W9NC/]Ww3{/uR_w_o[]mwnsY	Oc=t+?O'wOg+=J]#2tk?_?in_p]g<o{D}{sT?}Uz{<04tQnWvSNuw$x<\p}7.a|l!]oxgr}/>SK~oTQ?U-j:}y}LlOUfN\qvwM
v7xM 2tSn1e<|Q?^oUq^iyU.&uGy_%SF^r<-qzJv<X{dH	Ev~^w;^|}~w?Om[{w~5z{6{Z-z}3_[pZ>v?_[q\_cr]z?W}qQ%}[vK7;k7z8x,Cws?]Sz~sk+o7UGgw`G9?dc>^S.;^~]J}7m?sO0?N;F+~y?~}|{wwmz|=Som,Egz 7.]d=g;wyoef6_T=5cMVe?6USCwNtlyTX7d9wUr'jO-[Z~um
_m_[so*.!/_Q~~X?g;|vV{szy||{o]U{]7_\{}]Fgm_ZDw7^EWr~=*wsz}
_y{~sG}tO/%'gGO8}Y)du)d]w}[yP{\W^AOqOd_i)?mscOw]){oI.#MJa$	'e/OiCt	}zH}|wogjg/;o^:H>c=&^~+}/xf|Y|u([Gwvi.7ov6n/%JeVnk?nv[hLx*/kY.u/Zkr?p}1ow<wnpso9w_X?Y.:v;G9}Ev.#{mW}>gN|{mhGS n~=/]|r}M3~_?/wr}_W5pxnWO~wn~OY_]|_7$n}YKVYW0{gs5OS>+58jyEcZ[~]Z-uv4bn;1;Cs|ekCn-]>=_l[^/H<?q9.?s"aXlo?o|UCd_^~_9SwgV>;m7rJ#_;]omG]itsw#N~L~KW?_l{\;[^;VyiK@o?R_rJ^:tO{{Y)wkg?=g~Ro;|}nd|Cw[n|X;?/y?c;u5na(j`B7oft>\7Fos}k>.9Rz/knLl=_OI05o}O4ynC
Z:UrkWv_-;n>Z{IU~EgO`gjA}sjL=G>z'ou?sw-Wg'[/e,Lo}V)sxF&oOV:Mo:;ffv(j}SKWWko}?goW]_-O+[~[>}_X3r.WvRKoi/={-nT+[kOkQcv+o%3~}YOy~J']nA}YNq@[wY[6w47r_G7=-G;>;9'QLZ/?O&